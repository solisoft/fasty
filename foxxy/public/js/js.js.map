{"version":3,"sources":["app/index.html","app/js/common.js","app/js/config.js","app/js/editor.js","app/js/js.js","app/widgets/apis.html.tag","app/widgets/aqls.html.tag","app/widgets/components.html.tag","app/widgets/datasets.html.tag","app/widgets/datatypes.html.tag","app/widgets/helpers.html.tag","app/widgets/layouts.html.tag","app/widgets/loading.html.tag","app/widgets/login.html.tag","app/widgets/pages.html.tag","app/widgets/partials.html.tag","app/widgets/redirections.html.tag","app/widgets/scripts.html.tag","app/widgets/settings.html.tag","app/widgets/spas.html.tag","app/widgets/trads.html.tag","app/widgets/uploads.html.tag","app/widgets/users.html.tag"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;CCAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAvdA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AAJA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA/zBA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA5JA;AAAA;CCAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAjVA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAzNA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAzYA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA/bA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA/SA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AArTA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AArTA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA3CA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAfA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA9YA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAzYA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAnTA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAtUA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA7BA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AApTA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAnTA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAnFA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAnTA;AAAA","file":"public/js/js.js","sourcesContent":["","var Common = {\n  init: function init(){\n    $.fn.serializeObject = function() {\n      var o = {}\n      var a = this.serializeArray()\n      $.each(a, function() {\n        if (o[this.name] !== undefined) {\n          if (!o[this.name].push) {\n            o[this.name] = [o[this.name]]\n          }\n          o[this.name].push(this.value || '')\n        } else {\n          o[this.name] = this.value || ''\n        }\n      })\n      return o\n    }\n  },\n  startEditor: function (name, mode, id) {\n    var editor = ace.edit(name)\n    editor.setTheme(\"ace/theme/twilight\")\n    editor.getSession().setMode(mode)\n    editor.setOptions({ tabSize: 2, useSoftTabs: true })\n    editor.getSession().setUseWrapMode(true)\n    editor.getSession().setValue(unescape($(\"#\" + id).val()))\n    editor.getSession().on('change', function () { $(\"#\" + id).val(editor.getSession().getValue()) })\n  },\n\n  checkConditions: function checkConditions(fields, formId) {\n    _.each(fields, function (field) {\n\n      if (field.if) {\n        if ($('#' + field.if[0]).val() != field.if[1]) {\n          $('#field_' + field.n).hide()\n        } else {\n          $('#field_' + field.n).show()\n        }\n      }\n    })\n  },\n\n  buildForm: function buildForm(obj, fields, formId, back_str, callback) {\n\n    var html = \"\"\n    var uploads = []\n    var _this = this\n    var editors = []\n    var values = []\n    var positions = []\n    var wysiwygs = []\n    var html_editors = []\n    var usetab = false\n    var tabs = []\n    var tab_last_id = ''\n    var y = 0\n    var _html = ''\n\n    fields.forEach(function(l, i) {\n      if (l.tab) {\n        if (y > 0) html += \"</div>\"\n        if (usetab == false) html += '<ul uk-tab>'\n        if (usetab == false) tabs = []\n        usetab = true\n        html += '<li><a href=\"#\">' + l.tab + '</a></li>'\n        if (html != '') {\n          tabs.push(_html)\n          _html = ''\n        }\n        tab_last_id = l.id\n\n        y = 0\n      } else {\n        if (l.h !== undefined) {\n          _html += '<div class=\"uk-grid uk-grid-small uk-margin-top\"><h3>'+ l.h +'</h3></div>'\n        }\n        else {\n          if (l.r && y > 0) _html += '</div>'\n          if (l.r) _html += '<div class=\"uk-grid uk-grid-small\">'\n          if (l.c && l.c.indexOf(\"uk-width\") == -1) l.c = \"uk-width-\" + l.c\n\n          var validation = l.j\n          if (obj['_key'] && l.ju) validation = l.ju\n\n          var hidden = ''\n          if(l.t === 'hidden') hidden = 'uk-hidden'\n\n          _html += '<div class=\"' + l.c + ' ' + hidden + '\" id=\"field_' + l.n + '\">'\n\n          var title = l.l\n\n          if (_.isString(validation)) {\n            if (validation.indexOf('required') > 0) {\n              title = \"<strong>\" + title + \"*</strong>\"\n            }\n          } else {\n            if (validation && validation._flags.presence === \"required\") {\n              title = \"<strong>\" + title + \"*</strong>\"\n            }\n          }\n\n          if (!((l.t === \"file\" || l.t === \"image\") && obj._id === undefined))\n            _html += '<label for=\"\" class=\"uk-form-label\">'+ title +'</label>'\n\n          var value = obj[l.n]\n          if(l.tr && obj[l.n]) value = obj[l.n][window.localStorage.getItem('foxx-locale')]\n          if (value === undefined) value = \"\"\n\n          //value = escape(value)\n          if(l.t.match(/string/)) {\n            _html += '<input type=\"'+(l.t.split(\":\").length == 2 ? l.t.split(\":\")[1] : \"text\")+'\" id=\"'+l.n+'\" class=\"uk-input\" name=\"'+ l.n +'\" value=\"\" autocomplete=\"off\"><div data-hint=\"'+ l.n +'\" class=\"uk-text-danger\"></div>'\n            values.push([l.n, value])\n          }\n          if(l.t.match(/password/)) {\n            _html += '<input type=\"password\" id=\"'+l.n+'\" class=\"uk-input\" name=\"'+ l.n +'\" value=\"\" autocomplete=\"off\"><div data-hint=\"'+ l.n +'\" class=\"uk-text-danger\"></div>'\n          }\n          if(l.t === \"integer\") {\n            _html += '<input type=\"number\" id=\"'+l.n+'\" class=\"uk-input\" name=\"'+ l.n +'\" value=\"'+value+'\" autocomplete=\"off\"><div data-hint=\"'+ l.n +'\" class=\"uk-text-danger\"></div>'\n            values.push([l.n, value])\n          }\n          if(l.t === \"float\") {\n            _html += '<input type=\"text\" id=\"'+l.n+'\" class=\"uk-input\" name=\"'+ l.n +'\" value=\"'+value+'\" autocomplete=\"off\"><div data-hint=\"'+ l.n +'\" class=\"uk-text-danger\"></div>'\n            values.push([l.n, value])\n          }\n          if(l.t === \"hidden\") _html += '<input type=\"hidden\" id=\"'+l.n+'\"  name=\"'+ l.n +'\"  value=\"'+value+'\"></div><div data-hint=\"'+ l.n +'\">'\n          if(l.t === \"date\") _html += '<div><div class=\"uk-inline\"><span class=\"uk-form-icon\" uk-icon=\"icon: calendar\"></span><input type=\"date\" id=\"'+l.n+'\" data-date-format=\"YYYY/MM/DD\" class=\"uk-input\" name=\"'+ l.n +'\"  value=\"'+value+'\"></div><div data-hint=\"'+ l.n +'\" class=\"uk-text-danger\"></div></div>'\n          if (l.t === \"datetime\") {\n            value = value.replace(\":00.000\", \"\")\n            _html += '<div><div class=\"uk-inline\"><span class=\"uk-form-icon\" uk-icon=\"icon: calendar\"></span><input type=\"text\" id=\"' + l.n + '\" class=\"uk-input datepicker-here\" data-language=\"en\" name=\"' + l.n + '\"  value=\"' + value + '\" autocomplete=\"off\"></div><div data-hint=\"' + l.n + '\" class=\"uk-text-danger\"></div></div>'\n          }\n          if(l.t === \"time\") _html += '<div><div class=\"uk-inline\"><span class=\"uk-form-icon\" uk-icon=\"icon: calendar\"></span><input type=\"time\" id=\"'+l.n+'\" class=\"uk-input\" name=\"'+ l.n +'\"  value=\"'+value+'\"></div><div data-hint=\"'+ l.n +'\" class=\"uk-text-danger\"></div></div>'\n          if(l.t === \"text\") _html += '<textarea id=\"'+l.n+'\" class=\"uk-textarea\" name=\"'+ l.n +'\" style=\"'+l.s+'\">'+ value +'</textarea><div data-hint=\"'+ l.n +'\" class=\"uk-text-danger\"></div>'\n            if(l.t === \"wysiwyg\") {\n            wysiwygs.push(l.n)\n            _html += '<textarea id=\"'+l.n+'\" name=\"'+ l.n +'\" ></textarea><div data-hint=\"'+ l.n +'\" class=\"uk-text-danger\"></div>'\n            values.push([l.n, value])\n          }\n          if(l.t.match(/^code/)) {\n            _html += '<input type=\"hidden\" id=\"'+l.n+'\" name=\"'+ l.n +'\" value=\"\">'\n            values.push([l.n, value])\n            _html += '<div id=\"editor_'+l.n+'\" class=\"editor\" style=\"'+l.s+'\"></div>'\n            editors.push([\"editor_\"+l.n, \"ace/mode/\" + l.t.split(\":\")[1], l.n])\n          }\n          if (l.t == 'html') {\n            _html += '<input type=\"hidden\" id=\"'+l.n+'\" name=\"'+ l.n +'\" value=\"\">'\n            _html += '<div id=\"html_editor_'+l.n+'\" data-name=\"'+l.n+'\" class=\"html_editor\" style=\"'+l.s+'\"></div>'\n            html_editors.push([l.n, value])\n          }\n          if(l.t === \"list\") {\n            _html += '<select name=\"'+ l.n +'\" style=\"width:100%\" class=\"uk-select select_list\" id=\"'+l.n+'\">'\n            l.d.forEach(function(o) {\n              selected = \"\"\n              if(value === o[0]) selected=\"selected='selected'\"\n              _html += '<option value=\"'+ o[0] +'\" '+selected+'>'+ o[1] +'</option>'\n            })\n            _html += '</select>'\n          }\n          if(l.t === \"multilist\") {\n            _html += '<select name=\"'+ l.n +'\" style=\"width:100%\" class=\"uk-select select_mlist\" multiple=\"multiple\" id=\"'+l.n+'\">'\n            l.d.forEach(function(o) {\n              selected = \"\"\n              if(value && value.indexOf(o[0]) >= 0) selected=\"selected='selected'\"\n              _html += '<option value=\"'+ o[0] +'\" '+selected+'>'+ o[1] +'</option>'\n            })\n            _html += '</select>'\n          }\n          if(l.t === \"tags\") {\n            _html +='<select name=\"'+l.n+'\" style=\"width:100%\" class=\"select_tag\" multiple=\"multiple\">'\n            var tags = _.filter(l.d[0], function(t) { return t != \"undefined\" })\n            _.uniq(tags).forEach(function(v) {\n              if(v != 'undefined' || v != '') {\n                selected = \"\"\n                if(value && value.indexOf(v) >= 0) selected=\"selected='selected'\"\n                _html += '<option value=\"'+ v +'\" '+selected+'>'+ v +'</option>'\n              }\n            })\n            _html +='</select>'\n          }\n\n          if(l.t === \"map\") {\n            if(value === \"\") value = [0,0]\n            _html += '<div class=\"uk-text-center\" id=\"'+l.n+'_infos\"><span class=\"uk-label\"></span></div>'\n            _html += '<div id=\"map_'+l.n+'\" class=\"map\" style=\"'+l.s+'\"></div>'\n            _html += '<input id=\"'+l.n+'_lat\" type=\"hidden\" name=\"'+l.n+'\" value=\"'+value[0]+'\" />'\n            _html += '<input id=\"'+l.n+'_lng\" type=\"hidden\" name=\"'+l.n+'\" value=\"'+value[1]+'\" />'\n            positions.push([l.n, value])\n          }\n          if(l.t === \"image\" && obj._id) {\n            _html += '<div id=\"upload-drop_'+l.n+'\" class=\"js-upload uk-placeholder uk-text-center\">'\n            _html += '    <span uk-icon=\"icon: cloud-upload\"></span>'\n            _html += '    <span class=\"uk-text-middle\">Attach images by dropping them here or</span>'\n            _html += '    <div uk-form-custom>'\n            _html += '        <input type=\"file\" multiple>'\n            _html += '        <span class=\"uk-link\">selecting one</span>'\n            _html += '    </div>'\n            _html += '</div>'\n            _html += '<progress id=\"progressbar_'+l.n+'\" class=\"uk-progress\" value=\"0\" max=\"100\" hidden></progress>'\n\n            _html += '<images i18n=\"'+l.tr+'\" field=\"'+l.n+'\" id=\"'+obj._id+'\" />'\n            uploads.push([obj._key, obj._id.split('/')[0], l.n, '*.(jpg|jpeg|gif|png)', 'progressbar_'+l.n, '#upload-drop_'+l.n, l.tr])\n          }\n          if(l.t === \"file\" && obj._id) {\n            _html += '<div id=\"upload-drop_'+l.n+'\" class=\"js-upload uk-placeholder uk-text-center\">'\n            _html += '    <span uk-icon=\"icon: cloud-upload\"></span>'\n            _html += '    <span class=\"uk-text-middle\">Attach binaries by dropping them here or</span>'\n            _html += '    <div uk-form-custom>'\n            _html += '        <input type=\"file\" multiple>'\n            _html += '        <span class=\"uk-link\">selecting one</span>'\n            _html += '    </div>'\n            _html += '</div>'\n            _html += '<progress id=\"progressbar_'+l.n+'\" class=\"uk-progress\" value=\"0\" max=\"100\" hidden></progress>'\n            _html += '<files i18n=\"'+l.tr+'\" field=\"'+l.n+'\" id=\"'+obj._id+'\" />'\n            uploads.push([obj._key, obj._id.split('/')[0], l.n, '*.*', 'progressbar_'+l.n, '#upload-drop_'+l.n, l.tr])\n          }\n          if(l.t === \"boolean\") {\n            var checked = obj[l.n] === true ? \" checked='checked' \" : ''\n            _html += ' <input name=\"'+ l.n +'\" '+ checked +'  class=\"uk-checkbox\" type=\"checkbox\" value=\"1\"  /> '\n          }\n\n          _html += '</div>'\n\n          if (!usetab) {\n            html += _html\n            _html = ''\n          }\n\n          if (l.endtab == true) {\n            if (html != '') tabs.push(_html)\n            _html = ''\n            usetab = false\n            html += '</ul><ul class=\"uk-switcher\">{{'+tab_last_id+'}}</ul>'\n          }\n          y++\n        }\n      }\n    })\n\n    html += '</div>'\n\n    if (tabs.length > 0) {\n      var switcher = \"\"\n      _.each(tabs, function (t) { if (t!='') switcher += \"<li>\" + t + \"</li>\" })\n      html = html.replace('{{'+ tab_last_id +'}}', switcher)\n    }\n\n    html += '<hr><div class=\"uk-grid uk-grid-small uk-text-right\"><div class=\"uk-width-1-1\">'\n\n    if (back_str != undefined) { html += '<a href=\"#' + back_str + '\" class=\"uk-button\">Back</a> ' }\n\n    html += '<input type=\"submit\" class=\"uk-button uk-button-primary\" value=\"Save\" /></div></div><hr>'\n\n    $(formId).html(html)\n\n    $(formId).find('select').on('change', function () { _this.checkConditions(fields, formId) })\n\n    _this.checkConditions(fields, formId)\n\n    values.forEach(function (v, i) { $(formId + \" #\" + v[0]).val(v[1]) })\n\n    $('.datepicker-here').datepicker({\n      language: 'en', timepicker: true,\n      timeFormat: 'hh:ii',\n      dateFormat: 'yyyy-mm-dd'\n    })\n\n    html_editors.forEach(function (e, i) {\n      if(_.isString(e[1])) {\n        try { e[1] = JSON.parse(e[1]) } catch(e) {}\n      }\n      $('#html_editor_' + e[0]).contentEditor({ value: e[1].html || '' })\n      $(\"#\" + e[0]).val(JSON.stringify(e[1]))\n    })\n    editors.forEach(function(e, i) { _this.startEditor(e[0], e[1], e[2]) })\n    wysiwygs.forEach(function (e, i) { $(\"#\" + e).trumbowyg(); })\n\n    $(\"button\").attr(\"type\", \"button\") // TODO : remove once Pell accept PR\n    positions.forEach(function(p, i) {\n      var mymap = L.map('map_' + p[0], { dragging: true, tap: false}).setView(p[1], 6)\n      L.tileLayer('https://stamen-tiles-{s}.a.ssl.fastly.net/toner-lite/{z}/{x}/{y}.png', {\n        attribution: 'Map tiles by <a href=\"http://stamen.com\">Stamen Design</a>, <a href=\"http://creativecommons.org/licenses/by/3.0\">CC BY 3.0</a> &mdash; Map data &copy; <a href=\"http://www.openstreetmap.org/copyright\">OpenStreetMap</a>',\n        subdomains: 'abcd',\n        minZoom: 0,\n        maxZoom: 20,\n        ext: 'png'\n      }).addTo(mymap)\n      mymap.scrollWheelZoom.disable()\n      var marker = L.marker(p[1], { draggable: true }).addTo(mymap)\n      $('#'+p[0]+'_infos span').html(p[1].join(', '))\n      marker.on('dragend', function(data) {\n        var coords = data.target.getLatLng()\n        $('#'+p[0]+'_lat').val(coords.lat)\n        $('#'+p[0]+'_lng').val(coords.lng)\n        $('#'+p[0]+'_infos span').html([coords.lat, coords.lng].join(', '))\n      })\n    })\n\n    var _this = this\n    uploads.forEach(function(u) {\n      _this.prepare_upload(u[0], u[1], u[2], u[3], u[4], u[5], u[6])\n    })\n\n    riot.mount(\"images\"); riot.mount(\"files\")\n    riot.update()\n\n    if (callback !== undefined) { callback() }\n  },\n\n  checkLogin: function checkLogin() {\n    this.ajax(url + \"auth/whoami\", \"GET\", \"\", function(d) {\n      if(d.username === null) document.location.href = \"login.html\";\n    })\n  },\n\n  saveForm: function (formID, path, objID, opts) {\n    objID = objID||\"\"\n    opts = opts||{}\n    var _this = this\n    var json = $(\"#\"+ formID).serializeObject()\n    _.each(json, function(v, k) { if(k.split('-')[0] == \"trumbowyg\") delete json[k] })\n\n    $('.select_tag, .select_mlist').each(function(i, st) {\n      if(typeof json[$(st).attr(\"name\")] === \"string\") {\n        json[$(st).attr(\"name\")] = [ json[$(st).attr(\"name\")] ]\n      }\n    })\n\n    $(\"div[data-hint]\").html(\"\")\n    var selector = \"#\" + formID + \" textarea, #\"+ formID + \" input, #\"+ formID + \" select\"\n\n    $(selector).removeClass(\"uk-form-danger\")\n    $(selector).removeClass(\"uk-form-success\")\n    $(selector).addClass(\"uk-form-success\")\n\n    _this.ajax(url + path + \"/\" + objID, \"POST\", JSON.stringify(json), function(d) {\n      if(d.errors.length > 0) {\n        d.errors.forEach(function(e) {\n          $(\"#\" + e.path).removeClass(\"uk-form-success\")\n          $(\"#\" + e.path).addClass(\"uk-form-danger\")\n          $(\"div[data-hint=\"+e.path+\"]\").html(\"<div>\"+e.message.replace(/\"(.*)\"/, '').trim()+\"</div>\")\n        })\n      } else {\n        UIkit.notification({\n          message : 'Successfully saved!',\n          status  : 'success',\n          timeout : 1000,\n          pos     : 'bottom-right'\n        });\n        if(objID == \"\" && _.isEmpty(opts)) {\n          objID = d.data._key\n          if(path.split('/')[0] != 'datasets')\n            path = path.split(\"/\").length == 2 ? path.split(\"/\")[1] : path\n          route(\"/\"+ path +\"/\" + objID + \"/edit\")\n        }\n        if(!_.isEmpty(opts) && opts.element_id == undefined) {\n          riot.mount(\"#\"+opts.id, _.last(formID.split(\"_\")) + \"_crud_index\", opts)\n        }\n      }\n      setTimeout(function() {\n        $(selector).removeClass(\"uk-form-success\")\n      }, 300 )\n    })\n\n  },\n\n  ajax: function(url, method, dataForm, callback, errorCallback) {\n    if(typeof(errorCallback) === \"undefined\") errorCallback = function() {}\n    $.ajax({\n      url: url,\n      data: dataForm || \"\",\n      type: method,\n      beforeSend: function(xhr){\n        var x = localStorage.getItem('X-Session-Id')\n        if(x !== null) {\n          xhr.setRequestHeader('foxx-locale', localStorage.getItem('foxx-locale'))\n          xhr.setRequestHeader('X-Session-Id', localStorage.getItem('X-Session-Id'))\n        }\n      },\n      success: function(data, textStatus, request) {\n        if(request.getResponseHeader('X-Session-Id'))\n          localStorage.setItem('X-Session-Id',request.getResponseHeader('X-Session-Id'))\n        callback(data)\n      },\n      statusCode: {\n        401: function() { document.location.href = \"/static/admin/login.html\" },\n        500: errorCallback(),\n        503: function() {\n          localStorage.removeItem('X-Session-Id')\n          localStorage.removeItem('foxx-locale')\n          document.location.href = \"/static/admin/login.html\"\n        }\n      }\n    });\n  },\n\n  get: function(url, callback, errorCallback) {\n    this.ajax(url, \"GET\", \"\", callback, errorCallback)\n  },\n  delete: function(url, callback, errorCallback) {\n    this.ajax(url, \"DELETE\", \"\", callback, errorCallback)\n  },\n  post: function(url, json, callback, errorCallback) {\n    this.ajax(url, \"POST\", json, callback, errorCallback)\n  },\n  patch: function(url, json, callback, errorCallback) {\n    this.ajax(url, \"PATCH\", json, callback, errorCallback)\n  },\n  put: function(url, json, callback, errorCallback) {\n    this.ajax(url, \"PUT\", json, callback, errorCallback)\n  },\n\n  array_diff: function(a, b) {\n    return a.filter(function(i) {return b.indexOf(i) < 0;});\n  },\n\n  keys: function(h) {\n    var keys = []\n    for(var k in h) keys.push(k)\n    return keys\n  },\n\n  prepare_upload: function(key, collection, field, filter, progressbar_id, drop_id, i18n) {\n\n    var bar = document.getElementById(progressbar_id);\n\n    UIkit.upload(drop_id, {\n      url: url + '/uploads/' + key + '/' + collection + '/' + field, // upload url,\n      multiple: true,\n\n      allow: filter,\n\n      error: function () {\n        console.log('error', arguments);\n      },\n\n      beforeSend: function(env) {\n        env.headers = {\n          'X-Session-Id': localStorage.getItem('X-Session-Id'),\n          'foxx-locale': i18n == true ? localStorage.getItem('foxx-locale') : null\n        }\n      },\n\n      loadStart: function (e) {\n        bar.removeAttribute('hidden');\n        bar.max = e.total;\n        bar.value = e.loaded;\n      },\n\n      progress: function (e) {\n        bar.max = e.total;\n        bar.value = e.loaded;\n      },\n\n      loadEnd: function (e) {\n        bar.max = e.total;\n        bar.value = e.loaded;\n      },\n\n      completeAll: function () {\n        bar.value = 100;\n        setTimeout(function(){\n          bar.setAttribute('hidden', null);\n          riot.mount(\"images\"); riot.mount(\"files\")\n          riot.update()\n\n        }, 250);\n      }\n\n    });\n  }\n\n};\n\nmodule.exports = Common;","var Config = {\n  \".fasty.ovh\": \"https://fasty.ovh/_db\"\n};\n\nmodule.exports = Config;","/* jshint asi: true */\n(function ($) {\n\n  $.fn.contentEditor = function (options) {\n    var object_name = $(this).attr('data-name') || 'solicms'\n\n    var self = this\n\n    var settings = $.extend({\n      widgets: [\n        { id: 'h1', icon: 'fas fa-heading', title: 'h1' },\n        { id: 'h2', icon: 'fas fa-heading', title: 'h2' },\n        { id: 'h3', icon: 'fas fa-heading', title: 'h3' },\n        { id: 'h4', icon: 'fas fa-heading', title: 'h4' },\n        { id: 'h5', icon: 'fas fa-heading', title: 'h5' },\n        { id: 'h6', icon: 'fas fa-heading', title: 'h6' },\n        { id: 'col2', icon: 'fas fa-columns', title: '2' },\n        { id: 'col3', icon: 'fas fa-columns', title: '3' },\n        { id: 'col4', icon: 'fas fa-columns', title: '4' },\n        { id: 'col363', icon: 'fas fa-columns', title: '3-6-3' },\n        { id: 'col48', icon: 'fas fa-columns', title: '4-8' },\n        { id: 'col84', icon: 'fas fa-columns', title: '8-4' },\n        { id: 'text', icon: 'fas fa-align-left', title: 'text' },\n        { id: 'img', icon: 'fas fa-image', title: 'img' },\n        { id: 'slide', icon: 'fas fa-images', title: 'slide' },\n        { id: 'code', icon: 'fas fa-code', title: 'code' },\n        { id: 'video', icon: 'fas fa-video', title: 'video' },\n        { id: 'html5', icon: 'fab fa-html5', title: 'html5' }\n      ],\n    }, options)\n\n    var dragObj, activeObj, loopid = 0, editObj, ace_editor;\n\n    var LSet = function (key, val) { window.localStorage.setItem(key, val) }\n    var LGet = function (key) { return window.localStorage.getItem(key) }\n    var LDel = function (key) { return window.localStorage.removeItem(key) }\n\n    LDel('editor-history')\n\n    var ipsum = function (nb) {\n      var array = 'Chocolate lollipop pastry tiramisu. Chocolate cake sweet roll drage. Cookie halvah tootsie roll cupcake candy canes pie oat cake danish chocolate cake. Cheesecake biscuit powder sweet powder. Chocolate bar lollipop jelly-o chocolate cake. Sweet roll sweet roll cupcake topping chocolate cake. Fruitcake chocolate cake jelly-o. Marzipan candy canes jujubes. Cotton candy candy canes icing sesame snaps chocolate cake toffee liquorice jelly-o. Pastry pastry bear claw toffee. Liquorice biscuit dessert chocolate bar gummies. Carrot cake danish cookie croissant toffee gingerbread sweet roll. Icing danish muffin cheesecake jelly-o sugar plum pastry cotton candy. Chocolate bar pie apple pie chocolate bar cupcake lollipop.'.split('.')\n      var output = []\n      for (var i = 0; i < nb; i++) {\n        output.push(array[parseInt((Math.random() * 1000) % array.length)])\n      }\n      return output.join('. ') + '.'\n    }\n\n    var htmlEntities = function (str) {\n      return String(str).replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;')\n        .replace(/\"/g, '&quot;');\n    }\n\n    var get_widget_html = function (id, full) {\n      var before\n      var html\n      var after\n\n      loopid = loopid % 3\n\n      switch (id) {\n        case 'h1':\n          before = '<div class=\"sg-row cms_row\" data-type=\"h1\"><div class=\"col-12 cms_col\">'\n          html = '<h1 data-type=\"h1\" class=\"drag drop\" data-editable=\"true\">Macaroon donut tiramisu sweet roll.</h1>'\n          after = '</div></div>'\n          break;\n        case 'h2':\n          before = '<div class=\"sg-row cms_row\" data-type=\"h2\"><div class=\"col-12 cms_col\">'\n          html = '<h2 data-type=\"h2\" class=\"drag drop\" data-editable=\"true\">Macaroon donut tiramisu sweet roll.</h2>'\n          after = '</div></div>'\n          break;\n        case 'h3':\n          before = '<div class=\"sg-row cms_row\" data-type=\"h3\"><div class=\"col-12 cms_col\">'\n          html = '<h3 data-type=\"h3\" class=\"drag drop\" data-editable=\"true\">Macaroon donut tiramisu sweet roll.</h3>'\n          after = '</div></div>'\n          break;\n        case 'h4':\n          before = '<div class=\"sg-row cms_row\" data-type=\"h4\"><div class=\"col-12 cms_col\">'\n          html = '<h4 data-type=\"h4\" class=\"drag drop\" data-editable=\"true\">Macaroon donut tiramisu sweet roll.</h4>'\n          after = '</div></div>'\n          break;\n        case 'h5':\n          before = '<div class=\"sg-row cms_row\" data-type=\"h5\"><div class=\"col-12 cms_col\">'\n          html = '<h5 data-type=\"h5\" class=\"drag drop\" data-editable=\"true\">Macaroon donut tiramisu sweet roll.</h5>'\n          after = '</div></div>'\n          break;\n        case 'h6':\n          before = '<div class=\"sg-row cms_row\" data-type=\"h6\"><div class=\"col-12 cms_col\">'\n          html = '<h6 data-type=\"h6\" class=\"drag drop\" data-editable=\"true\">Macaroon donut tiramisu sweet roll.</h6>'\n          after = '</div></div>'\n          break;\n        case 'img':\n          before = '<div class=\"sg-row cms_row\" data-type=\"img\"><div class=\"col-12 cms_col\">'\n          html = '<div data-type=\"img\" class=\"drag drop\" data-editable=\"true\"><img src=\"https://via.placeholder.com/1200x600\" alt=\"\"></div>'\n          after = '</div></div>'\n          break;\n        case 'text':\n          before = '<div class=\"sg-row cms_row\" data-type=\"text\"><div class=\"col-12 cms_col\">'\n          html = '<div data-type=\"text\" class=\"drag drop\" data-editable=\"true\"><p style=\"text-align: justify;\">' + ipsum(5) + '</p></div>'\n          after = '</div></div>'\n          break;\n        case 'code':\n          var codes = []\n          codes.push('<code class=\"language-html\">' + htmlEntities('<h1>Some html code</h1>') + '</code>')\n          codes.push('<code class=\"language-javascript\">console.log(\"JS ... really ? \")</code>')\n          codes.push('<code class=\"language-ruby\">puts \"I Love Ruby\"</code>')\n          before = '<div class=\"sg-row cms_row\" data-type=\"code\"><div class=\"col-12 cms_col\">'\n          html = '<div data-type=\"code\" class=\"drag drop\" data-editable=\"true\"><pre>' + codes[loopid] + '</pre></div>'\n          after = '</div></div>'\n          break;\n        case 'video':\n          var ids = ['AWKEWqx8OyA', 'TmDKbUrSYxQ', 'X8zLJlU_-60']\n          var data = '<div style=\"position:relative;padding-top:56.25%;\"><iframe src=\"https://www.youtube.com/embed/' + ids[loopid] + '\" frameborder=\"0\" allow=\"accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture\" allowfullscreen style=\"position:absolute;top:0;left:0;width:100%;height:100%;\"></iframe></div>'\n          before = '<div class=\"sg-row cms_row\" data-type=\"embed\"><div class=\"col-12 cms_col\">'\n          html = '<div data-type=\"embed\" class=\"drag drop\" data-editable=\"true\" data-html=\"' + data.replace(/\"/g, \"&quot;\") + '\">' + data + '</div>'\n          after = '</div></div>'\n          break\n        case 'html5':\n          before = '<div class=\"sg-row cms_row\" data-type=\"embed\"><div class=\"col-12 cms_col\">'\n          var data = '<p>HTML5 Code here</p>'\n          html = '<div data-type=\"embed\" class=\"drag drop\" data-editable=\"true\" data-html=\"' + data.replace(/\"/g, \"&quot;\") + '\">' + data + '</div>'\n          after = '</div></div>'\n          break\n        case 'col2':\n          before = ''\n          html = '<div class=\"sg-row cms_row sub_row drag drop\" data-type=\"col2\"><div class=\"col-6 cms_col\"></div><div class=\"col-6 cms_col\"></div></div>'\n          after = ''\n          break\n        case 'col3':\n          before = ''\n          html = '<div class=\"sg-row cms_row sub_row drag drop\" data-type=\"col3\"><div class=\"col-4 cms_col\"></div><div class=\"col-4 cms_col\"></div><div class=\"col-4 cms_col\"></div></div>'\n          after = ''\n          break\n        case 'col4':\n          before = ''\n          html = '<div class=\"sg-row cms_row sub_row drag drop\" data-type=\"col4\"><div class=\"col-3 cms_col\"></div><div class=\"col-3 cms_col\"></div><div class=\"col-3 cms_col\"></div><div class=\"col-3 cms_col\"></div></div>'\n          after = ''\n          break\n        case 'col282':\n          before = ''\n          html = '<div class=\"sg-row cms_row sub_row drag drop\" data-type=\"col282\"><div class=\"col-2 cms_col\"></div><div class=\"col-8 cms_col\"></div><div class=\"col-2 cms_col\"></div><div class=\"col-3 cms_col\"></div></div>'\n          after = ''\n          break\n        case 'col363':\n          before = ''\n          html = '<div class=\"sg-row cms_row sub_row drag drop\" data-type=\"col363\"><div class=\"col-3 cms_col\"></div><div class=\"col-6 cms_col\"></div><div class=\"col-3 cms_col\"></div></div></div>'\n          after = ''\n          break\n        case 'col48':\n          before = ''\n          html = '<div class=\"sg-row cms_row sub_row drag drop\" data-type=\"col48\"><div class=\"col-4 cms_col\"></div><div class=\"col-8 cms_col\"></div></div></div>'\n          after = ''\n          break\n        case 'col84':\n          before = ''\n          html = '<div class=\"sg-row cms_row sub_row drag drop\" data-type=\"col84\"><div class=\"col-8 cms_col\"></div><div class=\"col-4 cms_col\"></div></div></div>'\n          after = ''\n          break\n      }\n      loopid++\n\n      return full ? $(before + html + after) : $(html)\n    }\n\n    /*\n      set_windows_events <function>\n      Activate drag & drop events\n    */\n    var set_windows_events = function () {\n      window.drag = function (event) {\n        var el = $(event.target).hasClass('drag') ? $(event.target) : $(event.target).closest('.drag')\n        el.addClass('dragging')\n        event.stopPropagation();\n        dragObj = el\n        event.dataTransfer.setData('text', '');\n        setTimeout(function () {\n          add_drop_empty()\n        }, 0)\n      }\n\n      window.drop = function (event) {\n        event.stopPropagation()\n        event.preventDefault()\n\n        var el = $(event.target).hasClass('drop') ? $(event.target) : $(event.target).closest('.drop')\n\n        if (event.dataTransfer.items) { // File drag & drop\n          var isFile = false\n          // Use DataTransferItemList interface to access the file(s)\n          var count = event.dataTransfer.items.length\n          if (count > 1) count = 1\n          for (var i = 0; i < event.dataTransfer.items.length; i++) {\n            // If dropped items aren't files, reject them\n            if (event.dataTransfer.items[i].kind === 'file') {\n              isFile = true\n              var file = event.dataTransfer.items[i].getAsFile();\n              if (file.type.indexOf('image') >= 0) {\n                var reader = new FileReader();\n                reader.readAsDataURL(file);\n                reader.onloadend = function () {\n                  base64data = reader.result;\n\n                  $.ajax({\n                    xhr: function () {\n                      var xhr = new window.XMLHttpRequest();\n                      //Upload progress\n                      xhr.upload.addEventListener('progress', function (evt) {\n                        if (evt.lengthComputable) {\n                          var percentComplete = evt.loaded / evt.total;\n                          //Do something with upload progress\n                          $(el).html(parseInt(percentComplete * 100) + '%')\n                        }\n                      }, false);\n\n                      return xhr;\n                    },\n                    type: 'POST',\n                    url: 'https://resize.ovh/upload_base64',\n                    data: {\n                      key: localStorage.getItem('resize_api_key'),\n                      image: base64data,\n                      filename: file.name\n                    },\n                    success: function (data) {\n                      setTimeout(function () {\n                        var picture = '<picture>'\n                        picture += '<source media=\"(max-width: 480px)\" srcset=\"https://resize.ovh/r/' + data.filename + '/480/webp\" type=\"image/webp\">'\n                        picture += '<source media=\"(max-width: 480px)\" srcset=\"https://resize.ovh/r/' + data.filename + '/480\">'\n                        picture += '<source media=\"(max-width: 799px)\" srcset=\"https://resize.ovh/r/' + data.filename + '/799/webp\" type=\"image/webp\">'\n                        picture += '<source media=\"(max-width: 799px)\" srcset=\"https://resize.ovh/r/' + data.filename + '/799\">'\n                        picture += '<source media=\"(min-width: 800px)\" srcset=\"https://resize.ovh/o/' + data.filename + '/webp\" type=\"image/webp\">'\n                        picture += '<source media=\"(min-width: 800px)\" srcset=\"https://resize.ovh/o/' + data.filename + '\">'\n                        picture += '<img src=\"https://resize.ovh/o/' + data.filename + '\">'\n                        picture += '</picture>'\n                        $(el).html(picture)\n                      }, 100)\n                      clear_empty_drags()\n                    }\n                  });\n                }\n              }\n            }\n          }\n\n          if (!isFile) {\n            $('.active').removeClass('active')\n            if (dragObj.hasClass('cms_col')) {\n              if (el.hasClass('cms_col')) {\n                swap(dragObj, el)\n              } else {\n                swap(dragObj, el.children().length == 0 ? el : el.children().first())\n              }\n            } else {\n              if (el.hasClass('cms_col')) {\n                swap(dragObj.children().first(), el)\n              } else {\n                swap(dragObj, el)\n              }\n            }\n\n            el.removeClass('drop_empty')\n            if (!el.hasClass('drag')) {\n              prepare_drag(el);\n              prepare_drop(el)\n            }\n            $('.drop_empty').remove()\n            $('.dragging').removeClass('dragging')\n            save_content()\n            clear_empty_drags()\n            set_empty_rows()\n          }\n        }\n      }\n\n      window.drag_end = function (event) {\n        event.stopPropagation()\n\n        $('.row_editor').css('margin-left', (-99999) + 'px')\n        $('.dragging').removeClass('dragging')\n        $('.active').removeClass('active')\n        $('.drop_empty').remove()\n        clear_empty_drags()\n      }\n\n      window.allow_drop = function (event) {\n        event.stopPropagation();\n        event.preventDefault();\n        var el = $(event.target).hasClass('drop') ? $(event.target) : $(event.target).closest('.drag')\n        $('.active').removeClass('active')\n        el.addClass('active')\n      }\n    }\n\n    /*\n      save_content <function>\n      Save content to localStorage\n    */\n    var save_content = function () {\n      var t1 = +new Date()\n      /*\n      var history = JSON.parse(LGet('editor-history') || '[]')\n      history.push($(self).find('.edit-mode .page-content').html())\n      history.splice(0, history.length - 10);\n      LSet('editor-history', JSON.stringify(history))\n      */\n      var t2 = +new Date()\n      console.log(\"Save content : \", t2 - t1)\n    }\n\n    /*\n      set_empty_rows <function>\n      add Class .empty_row to all empty .cms_row\n    */\n    var set_empty_rows = function () {\n      $(self).find('.cms_row').removeClass('empty_row')\n      $(self).find('.cms_row').each(function (y, col) {\n        if ($(col).text().trim() === '') {\n          $(col).addClass('empty_row')\n        }\n      })\n    }\n\n    /*\n      add_drop_empty <function>\n      add drop DIVs when starting a drag\n    */\n    var add_drop_empty = function () {\n      clear_empty_drags()\n      var empty = '<div class=\"sg-row cms_row\" data-type=\"full\"><div class=\"col-12 cms_col\"><div class=\"drop drop_empty row_empty\"></div></div></div>'\n      var drop_empty = '<div class=\"drop drop_empty col_empty\"><div></div></div>'\n\n      $(self).find('.edit-mode .cms_editor .sub_row .cms_col .drop').each(function (i, el) {\n        if ($(el).parent().hasClass('cms_col') ||\n          $(el).parent().hasClass('cms_row')) {\n          $(el).after(drop_empty)\n        }\n\n      })\n\n      $(self).find('.edit-mode .page-content > .cms_row').each(function (y, row) {\n        $(row).before(empty)\n      })\n      $(self).find('.edit-mode .cms_col').each(function (y, col) {\n        if (!$(col).hasClass('col-12')) $(col).prepend(drop_empty)\n      })\n      $(self).find('.edit-mode .cms_editor .page-content').append(empty)\n      $(self).find('.edit-mode .drop_empty').attr('ondragover', 'allow_drop(event)')\n      $(self).find('.edit-mode .drop_empty').attr('ondrop', 'drop(event)')\n    }\n\n    /*\n      swap <function(from, to)>\n      swap 2 widgets\n    */\n    var swap = function (from, to) {\n      from = from[0]\n      to = to[0]\n\n      const afterTo = to.nextElementSibling\n      const parent = to.parentNode\n\n      if ($(from).data('menuitem')) {\n        var html = get_widget_html($(from).data('menuitem'), false)\n\n        if ($(to).hasClass('row_empty')) {\n          var dest = $(html).hasClass('sub_row') ? $(parent).parent() : $(parent)\n          dest.html(html[0].outerHTML)\n        } else {\n          if ($(to).hasClass('col_empty')) {\n            $(to).html(html[0].outerHTML)\n            $(to).removeClass(\"row_empty\")\n            $(to).removeClass(\"col_empty\")\n            $(to).addClass(\"drag\")\n          } else {\n            if (!$(parent).hasClass('sg-container')) $(parent).html(html[0].outerHTML)\n          }\n        }\n\n        prepare_drag($('.drag'));\n        prepare_drop($('.drop'));\n\n      } else {\n        try {\n          const tmp = from\n          from.replaceWith(to)\n          parent.insertBefore(from, afterTo)\n        } catch (err) {\n          parent.appendChild(tmp)\n        }\n        clear_empty_drags()\n      }\n\n      $(self).find('[data-type=full] .col-12').each(function(i, item) {\n        if($(item).find('.sg-row').length > 0) {\n          var html = $(item).html()\n          $(item).parent()[0].outerHTML = html\n        }\n      })\n    }\n\n    /*\n      prepare_drag <function(element)>\n      set the element draggable\n    */\n    var prepare_drag = function (el) {\n      el.attr('draggable', true)\n      el.attr('ondragstart', 'drag(event)')\n      el.attr('ondragend', 'drag_end(event)')\n    }\n\n    /*\n      prepare_drop <function(element)>\n      set the element dropable\n    */\n    var prepare_drop = function (el) {\n      el.addClass('drop')\n      el.attr('ondragover', 'allow_drop(event)')\n      el.attr('ondrop', 'drop(event)')\n    }\n\n    /*\n      clear_empty_drags <function>\n      Remove empty drag elements\n    */\n    var clear_empty_drags = function () {\n      $(self).find('.edit-mode .drop').each(function (i, el) {\n        var from_col = $(el).parents()\n          .map(function (i, el) {\n            return el.className.split(' ')\n          })\n          .filter(function (i, el) {\n            return el == 'cms_col'\n          })\n          .length >= 1\n\n        if ($(el).find('.cms_col').length == 0 && !from_col &&\n          $(el).text().trim() == '' && $(el).data('type') != 'img' && $(el).data('type') != 'embed') {\n          $(el).remove()\n        }\n        if ($(el).hasClass('drop') && !$(el).hasClass('drag')) {\n          $(el).remove()\n        }\n      })\n\n      $(self).find('.edit-mode .drag').each(function (i, el) {\n        var from_col = $(el).parents()\n          .map(function (i, el) {\n            return el.className.split(' ')\n          })\n          .filter(function (i, el) {\n            return el == 'cms_col'\n          })\n          .length >= 1\n        if (from_col && $(el).parent().find('.drag').length > 1 &&\n          ($(el).html().trim() == '' || $(el).html().trim() == '<div></div>') &&\n          !$(el).is('img')) {\n          $(el).remove()\n        }\n      })\n\n      $(self).find('.edit-mode .cms_row > *').each(function (i, el) {\n        var from_col = $(el).parents()\n          .map(function (i, el) {\n            return el.className.split(' ')\n          })\n          .filter(function (i, el) {\n            return el == 'cms_col'\n          })\n          .length >= 1\n\n        if (!$(el).hasClass('cms_col') &&\n          $(el).html().trim() == '' || $(el).html().trim() == '<div></div>') {\n          $(el).remove()\n        }\n      })\n\n      $(self).find('.edit-mode .cms_row').each(function (i, el) {\n        if ($(el).html().trim() == '' ||\n          $(el).html().trim() == '<div></div>' ||\n          $(el).html().trim() == '<div class=\"col-12 cms_col\"></div>') {\n          $(el).remove()\n        }\n      })\n\n      save_content()\n    }\n\n    /*\n      run_export <function(base)>\n      Export base element as json structure\n    */\n    var run_export = function (base) {\n      var data = []\n      $(base).find('> .cms_row').each(function (i, row) {\n\n        if($(row).data('type') == 'full') {\n          if($(row).find('div:first').hasClass('cms_col')) $(row).data('type', $(row).find(\"[data-type]\").data('type'))\n          else row = $(row).children()[0]\n        }\n        var data_row = { data: [], type: $(row).data('type') }\n\n        $(row).find('> .cms_col').each(function (y, col) {\n          var data_col = []\n          $(col).find('[data-type]').each(function (z, widget) {\n            if($(widget).data('exported') == undefined) {\n              $(widget).data('exported', true)\n\n              var data_widget = {}\n              data_widget['type'] = $(widget).data('type')\n              data_widget['attr'] = $(widget).data('attr')\n              if ($(widget).data('type').indexOf('col') >= 0) {\n                data_widget['content'] = run_export($(widget).parent())\n              } else {\n                data_widget['content'] = $(widget).html()\n              }\n\n              data_col.push(data_widget)\n            }\n          })\n\n          data_row['data'].push(data_col)\n        })\n\n        data.push(data_row)\n      })\n\n      $(base).find('[data-exported]').removeAttr('data-exported')\n      return data\n    }\n\n    /*\n      set_content <function>\n      Load HTML content into .page_content and run all useful methods for starting the editor\n    */\n    var set_content = function (value) {\n      $(self).find('.page-content').html(value || '')\n\n      clear_empty_drags();\n      set_empty_rows()\n      prepare_drag($(self).find(\".drag\"));\n      prepare_drag($(self).find(\".drop\"))\n      ;\n      activate_events()\n      remove_drag_attributes()\n\n      $(self).find('[data-html]').each(function (i, el) { $(el).html($(el).data('html')) })\n    }\n\n    /*\n      activate_events <function>\n      Add jQuery events on page content\n    */\n    var activate_events = function () {\n      // Set the active Row\n      $(self).find('.edit-mode .cms_editor').on('mouseenter', '.cms_row', function () {\n        $(self).find('.edit-mode .row_editor').css('margin-left', (-99999) + 'px')\n        var y = (0 - $(self).find('.cms_editor').offset().top) + $(this).offset().top + $(this).height() - $(self).find('.row_editor').height()\n        var x = $(this).offset().left + 16 - 100\n\n        $(self).find('.edit-mode .row_editor').css('margin-left', x + 'px')\n        $(self).find('.edit-mode .row_editor').css('margin-top', y + 'px')\n        activeObj = $(this)\n      })\n\n      // Set the active Widget\n      $(self).find('.edit-mode .cms_editor').on('mouseenter', '.cms_col > *', function () {\n        var y = $(this).offset().top\n        var x = $(this).offset().left - $(self).find('aside').width()\n        activeObj = $(this)\n      })\n\n      // When you delete a row\n      $(self).find('.edit-mode .cms_row_delete').on('click', function () {\n        activeObj.closest('.edit-mode .sg-row').remove()\n        $(self).find('.edit-mode .row_editor').css('margin-left', (-99999) + 'px')\n        save_content()\n        return false\n      })\n\n      // When you click on a widget\n      // It should open the editor modal with the right content / tools\n      $(self).find('.edit-mode .page-content').on('click', '[data-type]', function () {\n        editObj = $(this)\n        raw_object = $(this.outerHTML)\n        if (raw_object.data(\"attr\")) {\n          $(self).find(\"input[data-name=col-class]\").val(raw_object.data(\"attr\")['col-class'])\n          $(self).find(\"input[data-name=row-class]\").val(raw_object.data(\"attr\")['row-class'])\n          $(self).find(\"input[data-name=container-class]\").val(raw_object.data(\"attr\")['container-class'])\n        } else {\n          $(self).find(\"input[data-name=col-class]\").val('')\n          $(self).find(\"input[data-name=row-class]\").val('')\n          $(self).find(\"input[data-name=container-class]\").val('')\n        }\n        $(self).find(\".editor-code\").hide()\n        $(self).find(\".editor-simplecode\").hide()\n        $(self).find(\".editor-img-code\").hide()\n        if (raw_object.data('editable')) {\n          $(self).find('.trumbowyg').hide()\n          $(self).find('#ace-editor-' + object_name).hide()\n\n          var html = $(this).html().trim()\n          $(self).find('.edit-mode .cms_editor').addClass('editmode')\n          if (raw_object.data('type') == 'text') {\n            $('#trumbowyg-' + object_name).trumbowyg('html', html);\n            $(self).find('.trumbowyg').show()\n          }\n\n          if (raw_object.data('type') == 'code') {\n            $(self).find(\".editor-code\").show()\n            $(self).find('#ace-editor-' + object_name).show()\n            $(self).find(\"input[data-name=lang]\").val(raw_object.find(\"code:first\")[0].className.replace('language-', ''))\n            ace_editor.session.setMode('ace/mode/' + mode);\n            ace_editor.setOptions({ maxLines: Infinity, tabSize: 2, useSoftTabs: true });\n            ace_editor.getSession().setValue($(this).text());\n          }\n\n          if (['embed', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6'].indexOf(raw_object.data('type')) >= 0) {\n            $(self).find(\".editor-simplecode\").show()\n            $('#ace-editor-'+object_name).show()\n            var mode = 'html'\n            ace_editor.session.setMode('ace/mode/' + mode);\n            ace_editor.setOptions({ maxLines: Infinity, tabSize: 2, useSoftTabs: true });\n            var html = $(this).html()\n            if (raw_object.data('type') == 'embed') html = $(this).attr('data-html').replace(/&quot;/g, '\"')\n            ace_editor.getSession().setValue(html);\n          }\n\n          if (['img'].indexOf(editObj.data('type')) >= 0) {\n            var img_div = $(this).find('.img-div').length > 0 ? $(this).find('.img-div') : $(this).find('img').parent()\n            $(self).find(\".editor-simplecode\").show()\n            $(self).find(\".editor-img-code\").show()\n            $('#ace-editor-'+object_name).show()\n            $(self).find(\"input[data-name=img-width\").val(img_div.attr('data-img-width'))\n            $(self).find(\"select[data-name=img-alignment\").val(img_div[0].style['text-align'])\n            var mode = 'html'\n            ace_editor.session.setMode('ace/mode/' + mode);\n            ace_editor.setOptions({ maxLines: Infinity, tabSize: 2, useSoftTabs: true });\n            ace_editor.getSession().setValue(img_div[0].innerHTML);\n          }\n\n        }\n\n        return false\n      })\n\n      // Close the editor modal\n      $(self).find('.edit-mode .sg-editcontent').on('click', '.fa-times-circle', function () {\n        save_editor()\n        save_content()\n        $('.edit-mode .cms_editor').removeClass('editmode')\n        return false\n      })\n\n      // When you click on the toolbar item\n      $(self).find('.edit-mode .addwidget').on('click', function (e) {\n        e.preventDefault();\n        var html = get_widget_html($(this).data('id'), true)\n        $(self).find('.edit-mode .page-content').append(html)\n        $(self).find('.edit-mode .drag').attr('draggable', true)\n        $(self).find('.edit-mode .drag').attr('ondragstart', 'drag(event)')\n        $(self).find('.edit-mode .drag').attr('ondragover', 'allow_drop(event)')\n        $(self).find('.edit-mode .drag').attr('ondrop', 'drop(event)')\n        $(self).find('.edit-mode .drag').attr('ondragend', 'drag_end(event)')\n\n        $(\".fullscreen\").scrollTop($(\".fullscreen\").prop('scrollHeight'));\n        save_content()\n\n        set_empty_rows()\n\n\n        return false\n      })\n\n      $(self).find('.toggle-layout').on('click', function (e) {\n        e.preventDefault()\n        set_windows_events()\n        $(self).find('.view-mode').toggleClass('isactive')\n        $(self).find('.edit-mode').toggleClass('isactive')\n        $(self).toggleClass('fullscreen')\n        $('[data-exported]').removeAttr('data-exported')\n        var data = {\n          html: $(self).find('.edit-mode .page-content').html(),\n          json: run_export($(self).find('.edit-mode .page-content'))\n        }\n        $('input[name=\"' + object_name + '\"]').val(JSON.stringify(data))\n        $(self).find('.page-content').html(data['html'] || '')\n        remove_drag_attributes()\n        $(self).find('[data-html]').each(function (i, el) {\n          $(el).html($(el).attr('data-html'))\n        })\n\n        return false\n      })\n    }\n\n    /*\n      remove_drag_attributes <function(element)>\n    */\n    var remove_drag_attributes = function () {\n      $(self).find('.view-mode .drag, .view-mode .drop').removeAttr('ondragend')\n        .removeAttr('ondragstart')\n        .removeAttr('ondragover')\n        .removeAttr('ondrop')\n    }\n\n\n    var view_mode = '<a href=\"\" class=\"toggle-layout view-mode isactive\">Edit content</a>'\n    view_mode += '<section class=\"view-mode isactive\">\\\n                        <div class=\"page-content\"></div></section>'\n\n    $(self).append(view_mode)\n\n    var items = '<aside class=\"edit-mode\">\\\n                   <div class=\"sg-container toolbox\"><h1>Page tools</h1> \\\n                   <div class=\"sg-row\"></div>\\\n                   <div class=\"sg-row\"><a href=\"\" class=\"toggle-layout\">Exit</a></div></div>\\\n                  </aside>'\n\n    $(self).append(items)\n    $(self).addClass('editor-cms')\n\n    settings.widgets.forEach(function (w) {\n      $(self).find(\".toolbox .sg-row:first\").append('\\\n      <div class=\"col-4 drag\" dragdraggable=\"true\" data-menuitem=\"' + w.id + '\">\\\n        <a href=\"#\" class=\"addwidget\" data-id=\"' + w.id + '\">\\\n          <i class=\"' + w.icon + '\"></i>\\\n          <div class=\"small\">' + w.title + '</div></a>\\\n      </div>')\n    })\n\n    var content = '<section class=\"edit-mode\">\\\n      <div class=\"cms_editor\">\\\n        <div class=\"row_editor\">\\\n          <div class=\"cms_toolbar\">\\\n            <ul>\\\n              <li><a href=\"#\" class=\"cms_row_delete\"><i class=\"fas fa-trash-alt\"></i></a></li>\\\n            </ul>\\\n          </div>\\\n        </div>\\\n        <div class=\"sg-container page-content\"></div>\\\n        <div class=\"sg-editcontent\">\\\n          <i class=\"far fa-times-circle\" style=\"float: right;padding: 10px\"></i>\\\n          <div class=\"content\">\\\n            <div id=\"trumbowyg-'+object_name+'\"></div>\\\n            <div><label>Container Class</label><input type=\"text\" data-name=\"container-class\" class=\"uk-input\"></div>\\\n            <div><label>Row Class</label><input type=\"text\" data-name=\"row-class\" class=\"uk-input\"></div>\\\n            <div><label>Col Class</label><input type=\"text\" data-name=\"col-class\" class=\"uk-input\"></div>\\\n            <div class=\"editor-code\"><label>Language</label><input type=\"text\" data-name=\"lang\" class=\"uk-input\"></div>\\\n            <div class=\"uk-grid\"><div class=\"uk-width-1-2 editor-img-code\"><label>Image Width</label><input type=\"text\" data-name=\"img-width\" class=\"uk-input\"></div>\\\n            <div class=\"uk-width-1-2 editor-img-code\"><label>Image Alignment</label>\\\n            <select class=\"uk-select\" data-name=\"img-alignment\">\\\n            <option>left</option><option>center</option><option>right</option></select></div></div>\\\n            <div class=\"editor-code editor-simplecode\"><label>Code</label><div id=\"ace-editor-'+object_name+'\" class=\"ace-editor\"></div></div>\\\n          </div>\\\n        </div>\\\n      </div>\\\n    </section>'\n\n    $(self).append(content)\n    set_content(options.value)\n\n    $('#trumbowyg-'+object_name).trumbowyg({\n      btns: [\n        ['viewHTML'],\n        ['undo', 'redo'],\n        ['formatting'],\n        ['strong', 'em', 'del'],\n        ['superscript', 'subscript'],\n        ['link'],\n        ['justifyLeft', 'justifyCenter', 'justifyRight', 'justifyFull'],\n        ['unorderedList', 'orderedList'],\n        ['horizontalRule'],\n        ['removeformat'],\n        ['fullscreen']\n      ],\n      resetCss: true,\n      svgPath: 'img/icons.svg',\n      removeformatPasted: true\n    }).on('tbwchange', function () {\n      editObj.html($('#trumbowyg-' + object_name).trumbowyg('html'))\n    });\n\n    // Activate Ace editor\n    ace_editor = ace.edit('ace-editor-'+object_name)\n    ace_editor.getSession().setUseWrapMode(true)\n\n    ace_editor.setTheme('ace/theme/twilight')\n    ace_editor.session.setMode('ace/mode/html')\n\n    var save_editor = function () {\n      if (editObj) {\n        var attributes = {\n          'col-class': $('input[data-name=col-class]').val(),\n          'row-class': $('input[data-name=row-class]').val(),\n          'container-class': $('input[data-name=container-class]').val()\n        }\n        var content = ace_editor.getSession().getValue()\n        if (editObj.data('type') == 'code') {\n          var mode = 'language-' + $(self).find(\"input[data-name=lang]\").val()\n          editObj.html('<pre><code class=\"' + mode + '\">' + htmlEntities(content) + '</code></pre>')\n        }\n        if (['h1', 'h2', 'h3', 'h4', 'h5', 'h6'].indexOf(editObj.data('type')) >= 0) {\n          editObj.html(content)\n        }\n        if (['embed'].indexOf(editObj.data('type')) >= 0) {\n          editObj.html(content)\n          editObj.attr('data-html', content)\n        }\n        if (['text'].indexOf(editObj.data('type')) >= 0) {\n          editObj.html($('#trumbowyg-'+object_name).trumbowyg('html'))\n        }\n        if(['img'].indexOf(editObj.data('type')) >= 0) {\n          var width = $(self).find(\"input[data-name=img-width\").val() ? $(self).find(\"input[data-name=img-width\").val() : '100%'\n          var alignment = $(self).find(\"select[data-name=img-alignment\").val() ? $(self).find(\"select[data-name=img-alignment\").val() : 'left'\n          var temp = $('<div>').append($.parseHTML(content))\n          temp.each(function() {\n            var img = $(this).find('img')\n            for(var i = 0; i < img.length; i++) {\n              img[i].style.width = width\n            }\n          })\n          editObj.html('<div class=\"img-div\" style=\"text-align: ' + alignment + '\" data-img-width=\"' + width + '\">' + temp[0].innerHTML + '</div>')\n        }\n        editObj.attr('data-attr', JSON.stringify(attributes))\n\n      }\n    }\n\n    return this;\n  };\n\n})(jQuery);","document.removeEventListener(\"keydown\", function() {})\ndocument.addEventListener(\"keydown\", function(e) {\n  if (e.keyCode == 83 && (navigator.platform.match(\"Mac\") ? e.metaKey : e.ctrlKey)) {\n    e.preventDefault();\n    $('input[type=submit]:visible').click();\n  }\n}, false);\n\n\n$(function () {\n\n  riot.mount('rightnav')\n\n  route('/', function(name) {\n    // Here set the / mount\n    riot.mount('div#app', 'loading')\n  })\n\n  route('/welcome', function(name) {riot.mount('div#app', 'welcome') })\n\n  route('/login', function(name) {riot.mount('div#app', 'login') })\n  route('/signup', function(name) {riot.mount('div#app', 'signup') })\n\n  route('/confirm/*', function(id) {\n    common.post(url+'auth/confirm', JSON.stringify({uuid: id }), function() {\n      document.location.href = \"index.html\"\n    })\n  })\n\n  route('/logout', function(name) {\n    common.post(url +\"auth/logout\", \"\", function(d) {\n      localStorage.removeItem('X-Session-Id')\n      document.location.href = \"login.html\"\n    })\n  })\n\n  route('/layouts', function() { riot.mount('div#app', 'layouts') })\n  route('/pages', function () { riot.mount('div#app', 'pages') })\n  route('/pages/*', function (folder_key) {\n    riot.mount('div#app', 'pages', { folder_key: folder_key })\n  })\n  route('/partials', function () { riot.mount('div#app', 'partials') })\n  route('/partials/*', function (folder_key) {\n    riot.mount('div#app', 'partials', { folder_key: folder_key })\n  })\n  route('/components', function () { riot.mount('div#app', 'components') })\n  route('/components/*', function (folder_key) {\n    riot.mount('div#app', 'components', { folder_key: folder_key })\n  })\n  route('/spas', function() { riot.mount('div#app', 'spas') })\n  route('/redirections', function() { riot.mount('div#app', 'redirections') })\n  route('/trads', function() { riot.mount('div#app', 'trads') })\n  route('/settings', function() { riot.mount('div#app', 'settings') })\n  route('/datatypes', function() { riot.mount('div#app', 'datatypes') })\n  route('/datatypes/*', function (folder_key) {\n    riot.mount('div#app', 'datatypes', { folder_key: folder_key })\n  })\n\n  route('/users', function() { riot.mount('div#app', 'users') })\n  route('/aqls', function() { riot.mount('div#app', 'aqls') })\n  route('/helpers', function() { riot.mount('div#app', 'helpers') })\n  route('/apis', function() { riot.mount('div#app', 'apis') })\n  route('/scripts', function(name) {\n    riot.mount('div#app', 'scripts')\n  })\n  /*@{{router}}*/\n\n\n  route('/datasets/*', function(type) { riot.mount('div#app', 'datasets', { datatype: type }) })\n  route('/datasets/*/new', function (type) {\n    riot.mount('div#app', 'dataset_new', { datatype: type })\n  })\n  route('/datasets/*/*', function (type, folder_key) {\n    riot.mount('div#app', 'datasets', { datatype: type, folder_key: folder_key })\n  })\n  route('/datasets/*/new/*', function (type, folder_key) {\n    riot.mount('div#app', 'dataset_new', { datatype: type, folder_key: folder_key })\n  })\n  route('/datasets/*/*/edit', function(type, id) {\n    riot.mount('div#app', 'dataset_edit', { datatype: type, dataset_id: id })\n  })\n\n  route(function(collection, id, action) {\n    if(action != undefined) {\n      if(collection == \"layouts\") {\n        if(action == \"edit\") { riot.mount('div#app', 'layout_edit', { layout_id: id }) }\n      }\n      if(collection == \"pages\") {\n        if(action == \"edit\") { riot.mount('div#app', 'page_edit', { page_id: id }) }\n        if(action == \"new\") { riot.mount('div#app', 'page_new', { folder_key: id }) }\n      }\n      if(collection == \"partials\") {\n        if (action == \"edit\") { riot.mount('div#app', 'partial_edit', { partial_id: id }) }\n        if (action == \"new\") { riot.mount('div#app', 'partial_new', { folder_key: id }) }\n      }\n      if(collection == \"components\") {\n        if (action == \"edit\") { riot.mount('div#app', 'component_edit', { component_id: id }) }\n        if(action == \"new\") { riot.mount('div#app', 'component_new', { folder_key: id }) }\n      }\n      if(collection == \"spas\") {\n        if(action == \"edit\") { riot.mount('div#app', 'spa_edit', { spa_id: id }) }\n      }\n      if(collection == \"redirections\") {\n        if(action == \"edit\") { riot.mount('div#app', 'redirection_edit', { redirection_id: id }) }\n      }\n      if(collection == \"trads\") {\n        if(action == \"edit\") { riot.mount('div#app', 'trad_edit', { trad_id: id }) }\n      }\n      if(collection == \"datatypes\") {\n        if (action == \"edit\") { riot.mount('div#app', 'datatype_edit', { datatype_id: id }) }\n        if (action == \"new\") { riot.mount('div#app', 'datatype_new', { folder_key: id }) }\n      }\n      if(collection == \"users\") {\n        if(action == \"edit\") { riot.mount('div#app', 'user_edit', { user_id: id }) }\n      }\n      if(collection == \"aqls\") {\n        if(action == \"edit\") { riot.mount('div#app', 'aql_edit', { aql_id: id }) }\n      }\n      if(collection == \"helpers\") {\n        if(action == \"edit\") { riot.mount('div#app', 'helper_edit', { helper_id: id }) }\n      }\n      if(collection == \"apis\") {\n        if(action == \"edit\") { riot.mount('div#app', 'api_edit', { api_id: id }) }\n      }\n      if(collection == \"scripts\") {\n        if(action == \"edit\") {\n          riot.mount('div#app', 'script_edit', { script_id: id })\n        }\n      }\n      /*@{{router_cia}}*/\n    }\n  })\n\n  route(function(collection, action) {\n    if(collection == \"layouts\" && action == \"new\") riot.mount('div#app', 'layout_new')\n    if(collection == \"pages\" && action == \"new\") riot.mount('div#app', 'page_new')\n    if(collection == \"partials\" && action == \"new\") riot.mount('div#app', 'partial_new')\n    if(collection == \"components\" && action == \"new\") riot.mount('div#app', 'component_new')\n    if(collection == \"spas\" && action == \"new\") riot.mount('div#app', 'spa_new')\n    if(collection == \"redirections\" && action == \"new\") riot.mount('div#app', 'redirection_new')\n    if(collection == \"trads\" && action == \"new\") riot.mount('div#app', 'trad_new')\n    if(collection == \"datatypes\" && action == \"new\") riot.mount('div#app', 'datatype_new')\n    if(collection == \"users\" && action == \"new\") riot.mount('div#app', 'user_new')\n    if(collection == \"aqls\" && action == \"new\") riot.mount('div#app', 'aql_new')\n    if(collection == \"helpers\" && action == \"new\") riot.mount('div#app', 'helper_new')\n    if(collection == \"apis\" && action == \"new\") riot.mount('div#app', 'api_new')\n    if(collection == \"scripts\") {\n      if(action == \"new\") riot.mount('div#app', 'script_new')\n    }\n    /*@{{router_ca}}*/\n  })\n\n\n  route.start(true)\n  //riot.mount(\"*\")\n})\n","riot.tag2('api_crud_index', '<a href=\"#\" class=\"uk-button uk-button-small uk-button-default\" onclick=\"{new_item}\"> <i class=\"fas fa-plus\"></i> New {opts.singular} </a> <table class=\"uk-table uk-table-striped\" if=\"{data.length > 0}\"> <thead> <tr> <th each=\"{col in cols}\"> {col.name == undefined ? col : col.label === undefined ? col.name : col.label} </th> <th width=\"70\"></th> </tr> </thead> <tbody> <tr each=\"{row in data}\"> <td each=\"{col in cols}\" class=\"{col.class}\"> <virtual if=\"{col.tr == true}\">{_.get(row,col.name)[locale]}</virtual> <virtual if=\"{col.tr != true}\">{_.get(row,col.name)}</virtual> </td> <td class=\"uk-text-center\" width=\"110\"> <a onclick=\"{edit}\" class=\"uk-button uk-button-primary uk-button-small\"><i class=\"fas fa-edit\"></i></a> <a onclick=\"{destroy_object}\" class=\"uk-button uk-button-danger uk-button-small\"><i class=\"fas fa-trash-alt\"></i></a> </td> </tr> </tbody> </table> <ul class=\"uk-pagination\"> <li if=\"{page > 0}\"><a onclick=\"{previousPage}\"><span class=\"uk-margin-small-right\" uk-pagination-previous></span> Previous</a></li> <li if=\"{(page + 1) * perpage < count}\" class=\"uk-margin-auto-left\"><a onclick=\"{nextPage}\">Next <span class=\"uk-margin-small-left\" uk-pagination-next></span></a></li> </ul>', '', '', function(opts) {\n    var self = this\n    this.data = []\n\n    this.new_item = function(e) {\n      e.preventDefault()\n      riot.mount(\"#\"+opts.id, \"api_crud_new\", opts)\n    }.bind(this)\n\n    this.loadPage = function(pageIndex) {\n      common.get(url + \"/cruds/\" + opts.parent_name + \"/\"+opts.parent_id+\"/\"+opts.id+\"/\"+opts.key+\"/page/\"+pageIndex+\"/\"+per_page, function(d) {\n        self.data = d.data[0].data\n        self.cols = _.map(common.array_diff(common.keys(self.data[0]), [\"_id\", \"_key\", \"_rev\"]), function(v) { return { name: v }})\n        if(opts.columns) self.cols = opts.columns\n        self.count = d.data[0].count\n        self.update()\n      })\n    }\n    this.loadPage(1)\n\n    this.edit = function(e) {\n      e.preventDefault()\n      opts.element_id = e.item.row._key\n      riot.mount(\"#\"+opts.id, \"api_crud_edit\", opts)\n    }.bind(this)\n\n    this.nextPage = function(e) {\n      e.preventDefault()\n      self.page += 1\n      self.loadPage(self.page + 1)\n    }.bind(this)\n\n    this.previousPage = function(e) {\n      e.preventDefault()\n      self.page -= 1\n      self.loadPage(self.page + 1)\n    }.bind(this)\n\n    this.destroy_object = function(e) {\n      e.preventDefault()\n      UIkit.modal.confirm(\"Are you sure?\").then(function() {\n        common.delete(url + \"/cruds/\" + opts.id + \"/\" + e.item.row._key, function() {\n          self.loadPage(1)\n        })\n      }, function() {})\n    }.bind(this)\n});\n\nriot.tag2('api_crud_edit', '<a href=\"#\" class=\"uk-button uk-button-link\" onclick=\"{goback}\">Back to {opts.id}</a> <form onsubmit=\"{save_form}\" class=\"uk-form\" id=\"{opts.id}_crud_api\"> </form>', '', '', function(opts) {\n\n    this.goback = function(e) {\n      e.preventDefault()\n      riot.mount(\"#\"+opts.id, \"api_crud_index\", opts)\n    }.bind(this)\n\n    this.save_form = function(e) {\n      e.preventDefault()\n      common.saveForm(opts.id+'_crud_api', \"cruds/sub/\"+opts.parent_name+\"/\"+ opts.id+\"/\"+opts.element_id, \"\", opts)\n    }.bind(this)\n\n    var self = this;\n\n    common.get(url + \"/cruds/\" + opts.id + \"/\" + opts.element_id, function(d) {\n      self.api = d.data\n      common.buildForm(self.api, opts.fields, '#'+opts.id+'_crud_api')\n    })\n\n    this.on('updated', function() {\n      $(\".select_list\").select2()\n      $(\".select_mlist\").select2()\n      $(\".select_tag\").select2({ tags: true })\n    })\n});\n\nriot.tag2('api_crud_new', '<a href=\"#\" class=\"uk-button uk-button-link\" onclick=\"{goback}\">Back to {opts.id}</a> <form onsubmit=\"{save_form}\" class=\"uk-form\" id=\"{opts.id}_crud_api\"> </form>', '', '', function(opts) {\n    var self = this\n    this.crud = {}\n    this.crud[opts.key] = opts.parent_id\n\n    this.goback = function(e) {\n      e.preventDefault()\n      riot.mount(\"#\"+opts.id, \"api_crud_index\", opts)\n    }.bind(this)\n\n    this.on('mount', function() {\n      common.buildForm(self.crud, opts.fields, '#'+opts.id+'_crud_api')\n    })\n\n    this.save_form = function(e) {\n      e.preventDefault()\n      common.saveForm(opts.id+'_crud_api', \"cruds/sub/apis/\"+ opts.id, \"\", opts)\n    }.bind(this)\n\n});\n\nriot.tag2('api_edit', '<virtual if=\"{can_access}\"> <div uk-alert class=\"uk-alert-warning\" if=\"{locked_by}\"> <i class=\"fas fa-lock\"></i> This file is locked by {locked_by} </div> <ul uk-tab> <li><a href=\"#\">apis</a></li> <li each=\"{i, k in sub_models}\"><a href=\"#\">{k}</a></li> </ul> <ul class=\"uk-switcher uk-margin\"> <li> <h3>Editing api</h3> <form onsubmit=\"{save_form}\" class=\"uk-form\" id=\"form_api\"> </form> <a onclick=\"{install}\" class=\"uk-button uk-button-primary uk-button-small\"><i class=\"fas fa-upload\"></i> Install</a> </li> <li each=\"{i, k in sub_models}\"> <div id=\"{k}\" class=\"crud\"></div> </li> </ul> </virtual> <virtual if=\"{!can_access && loaded}\"> Sorry, you can\\'t access this page... </virtual> <script>', '', '', function(opts) {\n    var self = this\n    self.can_access = false\n    self.loaded = false\n    this.settings   = {}\n    self.locked_by = null\n\n    common.get(url + \"/settings\", function(settings) { self.settings = settings.data })\n\n    this.save_form = function(e) {\n      e.preventDefault()\n      common.saveForm(\"form_api\", \"cruds/apis\", opts.api_id)\n    }.bind(this)\n\n    this.install = function(e) {\n      e.preventDefault()\n      var url = \"/service/\" + self.api.name\n      $.post(url, { token: self.settings.token }, function(data) {\n        if(data == \"service installed\")\n          UIkit.notification({\n            message : 'Endpoint Deployed Successfully!',\n            status  : 'success',\n            timeout : 1000,\n            pos     : 'bottom-right'\n          });\n      })\n      return false\n    }.bind(this)\n\n    common.get(url + \"/cruds/apis/\" + opts.api_id, function(d) {\n      self.api = d.data\n      self.locked_by = d.data.locked_by\n      self.fields = d.fields\n      self.sub_models = d.fields.sub_models\n      var fields = d.fields\n\n      if(!_.isArray(fields)) fields = fields.model\n      common.get(url + \"/auth/whoami\", function(me) {\n        self.can_access = d.fields.roles === undefined || _.includes(d.fields.roles.write, me.role)\n        self.loaded = true\n        self.update()\n        if(self.can_access)\n          common.buildForm(self.api, fields, '#form_api', 'apis', function() {\n            $(\".crud\").each(function(i, c) {\n            var id = $(c).attr(\"id\")\n            riot.mount(\"#\" + id, \"api_crud_index\", { model: id,\n              fields: self.sub_models[id].fields,\n              key: self.sub_models[id].key,\n              singular: self.sub_models[id].singular,\n              columns: self.sub_models[id].columns,\n              parent_id: opts.api_id,\n              parent_name: \"apis\" })\n          })\n        })\n      })\n    })\n\n    this.on('updated', function() {\n      $(\".select_list\").select2()\n      $(\".select_mlist\").select2()\n      $(\".select_tag\").select2({ tags: true })\n    })\n});\n\nriot.tag2('api_new', '<virtual if=\"{can_access}\"> <h3>Creating api</h3> <form onsubmit=\"{save_form}\" class=\"uk-form\" id=\"form_new_api\"> </form> </virtual> <virtual if=\"{!can_access && loaded}\"> Sorry, you can\\'t access this page... </virtual>', '', '', function(opts) {\n    var self = this\n    self.can_access = false\n    self.loaded = false\n\n    this.save_form = function(e) {\n      e.preventDefault()\n      common.saveForm(\"form_new_api\", \"cruds/apis\")\n    }.bind(this)\n\n    common.get(url + \"/cruds/apis/fields\", function(d) {\n      common.get(url + \"/auth/whoami\", function(me) {\n        self.can_access = d.fields.roles === undefined || _.includes(d.fields.roles.write, me.role)\n        self.loaded = true\n        self.update()\n        if(self.can_access) {\n\n          var fields = d.fields\n          if(!_.isArray(fields)) fields = fields.model\n          common.buildForm({}, fields, '#form_new_api', 'apis');\n        }\n      })\n    })\n\n    this.on('updated', function() {\n      $(\".select_list\").select2()\n      $(\".select_mlist\").select2()\n      $(\".select_tag\").select2({ tags: true })\n    })\n});\n\nriot.tag2('apis', '<virtual if=\"{can_access}\"> <div class=\"uk-float-right\"> <a href=\"#apis/new\" class=\"uk-button uk-button-small uk-button-default\"><i class=\"fas fa-plus\"></i> New api</a> <a if=\"{export}\" onclick=\"{export_data}\" class=\"uk-button uk-button-small uk-button-primary\"><i class=\"fas fa-file-export\"></i> Export CSV</a> </div> <h3>Listing apis</h3> <form onsubmit=\"{filter}\" class=\"uk-margin-top\"> <div class=\"uk-inline uk-width-1-1\"> <span class=\"uk-form-icon\" uk-icon=\"icon: search\"></span> <input type=\"text\" ref=\"term\" id=\"term\" class=\"uk-input\" autocomplete=\"off\"> </div> </form> <table class=\"uk-table uk-table-striped\"> <thead> <tr> <th if=\"{sortable}\" width=\"20\"></th> <th each=\"{col in cols}\">{col.name == undefined ? col : col.label === undefined ? col.name : col.label}</th> <th width=\"110\"></th> </tr> </thead> <tbody id=\"list\"> <tr each=\"{row in data}\"> <td if=\"{sortable}\"><i class=\"fas fa-grip-vertical handle\"></i></td> <td each=\"{col in cols}\" class=\"{col.class}\"> <virtual if=\"{col.toggle == true}\"> <virtual if=\"{col.tr == true}\"><a onclick=\"{toggleField}\" data-key=\"{row._key}\">{col.values ? col.values[row[col.name][locale]] : _.get(row,col.name)[locale]}</a></virtual> <virtual if=\"{col.tr != true}\"><a onclick=\"{toggleField}\" data-key=\"{row._key}\">{col.values ? col.values[row[col.name]] : _.get(row,col.name)}</a></virtual> </virtual> <virtual if=\"{col.toggle != true}\"> <virtual if=\"{col.type == image}\"> <img riot-src=\"{_.get(row,col.name)[locale]} \" style=\"height:25px\"> </virtual> <virtual if=\"{col.type != image}\"> {calc_value(row, col, locale)} </virtual> </virtual> </td> <td class=\"uk-text-center\" width=\"160\"> <a onclick=\"{edit}\" class=\"uk-button uk-button-primary uk-button-small\"><i class=\"fas fa-edit\"></i></a> <a onclick=\"{install}\" class=\"uk-button uk-button-success uk-button-small\"><i class=\"fas fa-upload\"></i></a> <a onclick=\"{destroy_object}\" class=\"uk-button uk-button-danger uk-button-small\"><i class=\"fas fa-trash-alt\"></i></a> </td> </tr> </tbody> </table> <ul class=\"uk-pagination\"> <li if=\"{page > 0}\"><a onclick=\"{previousPage}\"><span class=\"uk-margin-small-right\" uk-pagination-previous></span> Previous</a></li> <li if=\"{(page + 1) * perpage < count}\" class=\"uk-margin-auto-left\"><a onclick=\"{nextPage}\">Next <span class=\"uk-margin-small-left\" uk-pagination-next></span></a></li> </ul> Per Page : {perpage > 100000 ? \\'ALL\\' : perpage} <a onclick=\"{setPerPage}\" class=\"uk-label\">25</a> <a onclick=\"{setPerPage}\" class=\"uk-label\">50</a> <a onclick=\"{setPerPage}\" class=\"uk-label\">100</a> <a onclick=\"{setPerPage}\" class=\"uk-label\">500</a> <a onclick=\"{setPerPage}\" class=\"uk-label\">1000</a> <a onclick=\"{setPerPage}\" class=\"uk-label\">ALL</a> </virtual> <virtual if=\"{!can_access && loaded}\"> Sorry, you can\\'t access this page... </virtual>', 'apis .handle,[data-is=\"apis\"] .handle{ cursor: move; }', '', function(opts) {\n\n    var self        = this\n    this.page       = 0\n    this.perpage    = per_page\n    this.locale     = window.localStorage.getItem('foxx-locale')\n    this.data       = []\n    this.export     = false\n    this.can_access = false\n    this.sortable   = false\n    this.loaded     = false\n    this.settings   = {}\n\n    common.get(url + \"/settings\", function(settings) {\n      self.settings = settings.data\n    })\n\n    this.loadPage = function(pageIndex) {\n      self.loaded = false\n      common.get(url + \"/cruds/apis/page/\"+pageIndex+\"/\"+this.perpage, function(d) {\n        self.data = d.data[0].data\n        self.export = !!d.model.export\n        self.cols = _.map(common.array_diff(common.keys(self.data[0]), [\"_id\", \"_key\", \"_rev\"]), function(v) { return { name: v }})\n        if(d.model.columns) self.cols = d.model.columns\n        self.count = d.data[0].count\n        self.sortable = !!d.model.sortable\n        common.get(url + \"/auth/whoami\", function(me) {\n          self.loaded = true\n          self.can_access = d.model.roles === undefined || _.includes(d.model.roles.read, me.role)\n          self.update()\n        })\n      })\n    }\n    this.loadPage(1)\n\n    this.calc_value = function(row, col, locale) {\n      value = _.get(row, col.name)\n      if(col.tr) { value = value[locale] }\n      if(col.truncate) { value = value.substring(0,col.truncate) }\n      if(col.capitalize) { value = _.capitalize(value) }\n      if(col.uppercase) { value = _.toUpper(value) }\n      if(col.downcase) { value = _.toLower(value) }\n      return value\n    }.bind(this)\n\n    this.filter = function(e) {\n      e.preventDefault();\n      if(self.refs.term.value != \"\") {\n        $(\".uk-form-icon i\").attr(\"class\", \"uk-icon-spin uk-icon-spinner\")\n        common.get(url + \"/cruds/apis/search/\"+self.refs.term.value, function(d) {\n          self.data = d.data\n          $(\".uk-form-icon i\").attr(\"class\", \"uk-icon-search\")\n          self.update()\n        })\n      }\n      else {\n        self.loadPage(1)\n      }\n    }.bind(this)\n\n    this.edit = function(e) {\n      route(\"/apis/\" + e.item.row._key + \"/edit\")\n    }.bind(this)\n\n    this.nextPage = function(e) {\n      self.page += 1\n      self.loadPage(self.page + 1)\n    }.bind(this)\n\n    this.previousPage = function(e) {\n      self.page -= 1\n      self.loadPage(self.page + 1)\n    }.bind(this)\n\n    this.destroy_object = function(e) {\n      UIkit.modal.confirm(\"Are you sure?\").then(function() {\n        common.delete(url + \"/cruds/apis/\" + e.item.row._key, function() {\n          self.loadPage(self.page + 1)\n        })\n      }, function() {})\n    }.bind(this)\n\n    this.toggleField = function(e) {\n      e.preventDefault()\n      common.patch(url + \"/cruds/apis/\" + e.target.dataset.key + \"/\" + e.item.col.name + \"/toggle\", \"{}\", function(data) {\n        if(data.success) {\n          e.target.innerText = data.data\n        }\n      })\n      return false\n    }.bind(this)\n\n    this.install = function(e) {\n      e.preventDefault()\n      var url = \"/service/\" + e.item.row.name\n      $.post(url, { token: self.settings.token }, function(data) {\n        if(data == \"service installed\")\n          UIkit.notification({\n            message : 'Endpoint Deployed Successfully!',\n            status  : 'success',\n            timeout : 1000,\n            pos     : 'bottom-right'\n          });\n      })\n      return false\n    }.bind(this)\n\n    this.setPerPage = function(e) {\n      e.preventDefault()\n      var perpage = parseInt(e.srcElement.innerText)\n      if(e.srcElement.innerText == 'ALL') perpage = 1000000000;\n      this.perpage = perpage\n      this.loadPage(1)\n    }.bind(this)\n\n    this.export_data = function(e) {\n      common.get(url + '/cruds/apis/export', function(d) {\n        var csvContent = d.data\n        var encodedUri = encodeURI(csvContent)\n        var link = document.createElement(\"a\")\n        link.setAttribute(\"href\", encodedUri)\n        link.setAttribute(\"download\", \"apis.csv\")\n        link.innerHTML= \"Click Here to download\"\n        document.body.appendChild(link)\n        link.click()\n        document.body.removeChild(link)\n      })\n    }.bind(this)\n\n    this.on('updated', function() {\n      if(self.sortable) {\n        var el = document.getElementById('list');\n        var sortable = new Sortable(el, {\n          animation: 150,\n          ghostClass: 'blue-background-class',\n          handle: '.fa-grip-vertical',\n          onSort: function ( evt) {\n            common.put(\n              url + 'cruds/apis/orders/' + evt.oldIndex + \"/\" + evt.newIndex, {},\n              function() {}\n            )\n          },\n        });\n      }\n    })\n});\n\n","riot.tag2('aql_edit', '<virtual if=\"{can_access}\"> <div uk-alert class=\"uk-alert-warning\" if=\"{locked_by}\"> <i class=\"fas fa-lock\"></i> This file is locked by {locked_by} </div> <ul uk-tab> <li><a href=\"#\">aqls</a></li> <li each=\"{i, k in sub_models}\"><a href=\"#\">{k}</a></li> </ul> <ul class=\"uk-switcher uk-margin\"> <li> <h3>Editing aql</h3> <form onsubmit=\"{save_form}\" class=\"uk-form\" id=\"form_aql\"> </form> <a class=\"uk-button uk-button-secondary\" onclick=\"{duplicate}\">Duplicate</a> </li> <li each=\"{i, k in sub_models}\"> <div id=\"{k}\" class=\"crud\"></div> </li> </ul> </virtual> <virtual if=\"{!can_access && loaded}\"> Sorry, you can\\'t access this page... </virtual> <script>', '', '', function(opts) {\n    var self = this\n    self.can_access = false\n    self.loaded = false\n    self.locked_by = null\n\n    this.save_form = function(e) {\n      e.preventDefault()\n      common.saveForm(\"form_aql\", \"cruds/aqls\",opts.aql_id)\n    }.bind(this)\n\n    this.duplicate = function(e) {\n      UIkit.modal.confirm(\"Are you sure?\").then(function() {\n        common.get(url + \"/cruds/aqls/\" + self.aql._key + \"/duplicate\", function(data) {\n          route('/aqls/' + data._key + '/edit')\n          UIkit.notification({\n            message : 'Successfully duplicated!',\n            status  : 'success',\n            timeout : 1000,\n            pos     : 'bottom-right'\n          });\n        })\n      }, function() {})\n    }.bind(this)\n\n    common.get(url + \"/cruds/aqls/\" + opts.aql_id, function(d) {\n      self.aql = d.data\n      self.locked_by = d.data.locked_by\n      self.fields = d.fields\n      self.sub_models = d.fields.sub_models\n      var fields = d.fields\n\n      if(!_.isArray(fields)) fields = fields.model\n      common.get(url + \"/auth/whoami\", function(me) {\n        self.can_access = d.fields.roles === undefined || _.includes(d.fields.roles.write, me.role)\n        self.loaded = true\n        self.update()\n        if(self.can_access)\n          common.buildForm(self.aql, fields, '#form_aql', 'aqls', function() {\n            $(\".crud\").each(function(i, c) {\n            var id = $(c).attr(\"id\")\n            riot.mount(\"#\" + id, \"aql_crud_index\", { model: id,\n              fields: self.sub_models[id].fields,\n              key: self.sub_models[id].key,\n              singular: self.sub_models[id].singular,\n              columns: self.sub_models[id].columns,\n              parent_id: opts.aql_id,\n              parent_name: \"aqls\" })\n          })\n        })\n      })\n    })\n\n    this.on('updated', function() {\n      $(\".select_list\").select2()\n      $(\".select_mlist\").select2()\n      $(\".select_tag\").select2({ tags: true })\n    })\n});\n\nriot.tag2('aql_new', '<virtual if=\"{can_access}\"> <h3>Creating aql</h3> <form onsubmit=\"{save_form}\" class=\"uk-form\" id=\"form_new_aql\"> </form> </virtual> <virtual if=\"{!can_access && loaded}\"> Sorry, you can\\'t access this page... </virtual>', '', '', function(opts) {\n    var self = this\n    self.can_access = false\n    self.loaded = false\n\n    this.save_form = function(e) {\n      e.preventDefault()\n      common.saveForm(\"form_new_aql\", \"cruds/aqls\")\n    }.bind(this)\n\n    common.get(url + \"/cruds/aqls/fields\", function(d) {\n      common.get(url + \"/auth/whoami\", function(me) {\n        self.can_access = d.fields.roles === undefined || _.includes(d.fields.roles.write, me.role)\n        self.loaded = true\n        self.update()\n        if(self.can_access) {\n\n          var fields = d.fields\n          if(!_.isArray(fields)) fields = fields.model\n          common.buildForm({}, fields, '#form_new_aql', 'aqls');\n        }\n      })\n    })\n\n    this.on('updated', function() {\n      $(\".select_list\").select2()\n      $(\".select_mlist\").select2()\n      $(\".select_tag\").select2({ tags: true })\n    })\n});\n\nriot.tag2('aqls', '<virtual if=\"{can_access}\"> <div class=\"uk-float-right\"> <a href=\"#aqls/new\" class=\"uk-button uk-button-small uk-button-default\"><i class=\"fas fa-plus\"></i> New aql</a> <a if=\"{export}\" onclick=\"{export_data}\" class=\"uk-button uk-button-small uk-button-primary\"><i class=\"fas fa-file-export\"></i> Export CSV</a> </div> <h3>Listing aqls</h3> <form onsubmit=\"{filter}\" class=\"uk-margin-top\"> <div class=\"uk-inline uk-width-1-1\"> <span class=\"uk-form-icon\" uk-icon=\"icon: search\"></span> <input type=\"text\" ref=\"term\" id=\"term\" class=\"uk-input\" autocomplete=\"off\"> </div> </form> <table class=\"uk-table uk-table-striped\"> <thead> <tr> <th if=\"{sortable}\" width=\"20\"></th> <th each=\"{col in cols}\">{col.name == undefined ? col : col.label === undefined ? col.name : col.label}</th> <th width=\"70\"></th> </tr> </thead> <tbody id=\"list\"> <tr each=\"{row in data}\"> <td if=\"{sortable}\"><i class=\"fas fa-grip-vertical handle\"></i></td> <td each=\"{col in cols}\" class=\"{col.class}\"> <virtual if=\"{col.toggle == true}\"> <virtual if=\"{col.tr == true}\"><a onclick=\"{toggleField}\" data-key=\"{row._key}\">{col.values ? col.values[row[col.name][locale]] : _.get(row,col.name)[locale]}</a></virtual> <virtual if=\"{col.tr != true}\"><a onclick=\"{toggleField}\" data-key=\"{row._key}\">{col.values ? col.values[row[col.name]] : _.get(row,col.name)}</a></virtual> </virtual> <virtual if=\"{col.toggle != true}\"> <virtual if=\"{col.type == image}\"> <img riot-src=\"{_.get(row,col.name)[locale]} \" style=\"height:25px\"> </virtual> <virtual if=\"{col.type != image}\"> {calc_value(row, col, locale)} </virtual> </virtual> </td> <td class=\"uk-text-center\" width=\"110\"> <a onclick=\"{edit}\" class=\"uk-button uk-button-primary uk-button-small\"><i class=\"fas fa-edit\"></i></a> <a onclick=\"{destroy_object}\" class=\"uk-button uk-button-danger uk-button-small\"><i class=\"fas fa-trash-alt\"></i></a> </td> </tr> </tbody> </table> <ul class=\"uk-pagination\"> <li if=\"{page > 0}\"><a onclick=\"{previousPage}\"><span class=\"uk-margin-small-right\" uk-pagination-previous></span> Previous</a></li> <li if=\"{(page + 1) * perpage < count}\" class=\"uk-margin-auto-left\"><a onclick=\"{nextPage}\">Next <span class=\"uk-margin-small-left\" uk-pagination-next></span></a></li> </ul> Per Page : {perpage > 100000 ? \\'ALL\\' : perpage} <a onclick=\"{setPerPage}\" class=\"uk-label\">25</a> <a onclick=\"{setPerPage}\" class=\"uk-label\">50</a> <a onclick=\"{setPerPage}\" class=\"uk-label\">100</a> <a onclick=\"{setPerPage}\" class=\"uk-label\">500</a> <a onclick=\"{setPerPage}\" class=\"uk-label\">1000</a> <a onclick=\"{setPerPage}\" class=\"uk-label\">ALL</a> </virtual> <virtual if=\"{!can_access && loaded}\"> Sorry, you can\\'t access this page... </virtual>', 'aqls .handle,[data-is=\"aqls\"] .handle{ cursor: move; }', '', function(opts) {\n\n    var self        = this\n    this.page       = 0\n    this.perpage    = per_page\n    this.locale     = window.localStorage.getItem('foxx-locale')\n    this.data       = []\n    this.export     = false\n    this.can_access = false\n    this.sortable   = false\n    this.loaded     = false\n\n    this.loadPage = function(pageIndex) {\n      self.loaded = false\n      common.get(url + \"/cruds/aqls/page/\"+pageIndex+\"/\"+this.perpage, function(d) {\n        self.data = d.data[0].data\n        self.export = !!d.model.export\n        self.cols = _.map(common.array_diff(common.keys(self.data[0]), [\"_id\", \"_key\", \"_rev\"]), function(v) { return { name: v }})\n        if(d.model.columns) self.cols = d.model.columns\n        self.count = d.data[0].count\n        self.sortable = !!d.model.sortable\n        common.get(url + \"/auth/whoami\", function(me) {\n          self.loaded = true\n          self.can_access = d.model.roles === undefined || _.includes(d.model.roles.read, me.role)\n          self.update()\n        })\n      })\n    }\n    this.loadPage(1)\n\n    this.calc_value = function(row, col, locale) {\n      value = _.get(row, col.name)\n      if(col.tr) { value = value[locale] }\n      if(col.truncate) { value = value.substring(0,col.truncate) }\n      if(col.capitalize) { value = _.capitalize(value) }\n      if(col.uppercase) { value = _.toUpper(value) }\n      if(col.downcase) { value = _.toLower(value) }\n      return value\n    }.bind(this)\n\n    this.filter = function(e) {\n      e.preventDefault();\n      if(self.refs.term.value != \"\") {\n        $(\".uk-form-icon i\").attr(\"class\", \"uk-icon-spin uk-icon-spinner\")\n        common.get(url + \"/cruds/aqls/search/\"+self.refs.term.value, function(d) {\n          self.data = d.data\n          $(\".uk-form-icon i\").attr(\"class\", \"uk-icon-search\")\n          self.update()\n        })\n      }\n      else {\n        self.loadPage(1)\n      }\n    }.bind(this)\n\n    this.edit = function(e) {\n      route(\"/aqls/\" + e.item.row._key + \"/edit\")\n    }.bind(this)\n\n    this.nextPage = function(e) {\n      self.page += 1\n      self.loadPage(self.page + 1)\n    }.bind(this)\n\n    this.previousPage = function(e) {\n      self.page -= 1\n      self.loadPage(self.page + 1)\n    }.bind(this)\n\n    this.destroy_object = function(e) {\n      UIkit.modal.confirm(\"Are you sure?\").then(function() {\n        common.delete(url + \"/cruds/aqls/\" + e.item.row._key, function() {\n          self.loadPage(self.page + 1)\n        })\n      }, function() {})\n    }.bind(this)\n\n    this.toggleField = function(e) {\n      e.preventDefault()\n      common.patch(url + \"/cruds/aqls/\" + e.target.dataset.key + \"/\" + e.item.col.name + \"/toggle\", \"{}\", function(data) {\n        if(data.success) {\n          e.target.innerText = data.data\n        }\n      })\n    }.bind(this)\n\n    this.setPerPage = function(e) {\n      e.preventDefault()\n      var perpage = parseInt(e.srcElement.innerText)\n      if(e.srcElement.innerText == 'ALL') perpage = 1000000000;\n      this.perpage = perpage\n      this.loadPage(1)\n    }.bind(this)\n\n    this.export_data = function(e) {\n      common.get(url + '/cruds/aqls/export', function(d) {\n        var csvContent = d.data\n        var encodedUri = encodeURI(csvContent)\n        var link = document.createElement(\"a\")\n        link.setAttribute(\"href\", encodedUri)\n        link.setAttribute(\"download\", \"aqls.csv\")\n        link.innerHTML= \"Click Here to download\"\n        document.body.appendChild(link)\n        link.click()\n        document.body.removeChild(link)\n      })\n    }.bind(this)\n\n    this.on('updated', function() {\n      if(self.sortable) {\n        var el = document.getElementById('list');\n        var sortable = new Sortable(el, {\n          animation: 150,\n          ghostClass: 'blue-background-class',\n          handle: '.fa-grip-vertical',\n          onSort: function ( evt) {\n            common.put(\n              url + 'cruds/aqls/orders/' + evt.oldIndex + \"/\" + evt.newIndex, {},\n              function() {}\n            )\n          },\n        });\n      }\n    })\n});\n\n","riot.tag2('component_folders', '<div> <ul class=\"uk-breadcrumb\"> <li each=\"{f in path}\"><a href=\"#components/{f._key}\">{f.name}</a></li> <li> <a if=\"{path.length > 1}\" onclick=\"{renameFolder}\"><i class=\"far fa-edit\"></i></a> <a onclick=\"{addFolder}\"><i class=\"fas fa-plus\"></i></a> <a if=\"{path.length > 1 && folders.length == 0}\" onclick=\"{deleteFolder}\"><i class=\"fas fa-trash\"></i></a> </li> </ul> <ul class=\"uk-list\"> <li each=\"{f in folders}\"><a href=\"#components/{f._key}\"><i class=\"far fa-folder\"></i> {f.name}</a></li> </ul> </div>', '', '', function(opts) {\n    this.folders = []\n    this.folder = {}\n    this.path = [ this.folder ]\n    this.folder_key = this.opts.folder_key || '';\n    var self = this\n\n    var loadFolder = function(folder_key) {\n      common.get(url + '/cruds/folders/components/' + folder_key, function(d) {\n        self.folders = d.folders\n        self.path = d.path\n        self.folder = _.last(self.path)\n        self.parent.setFolder(self.folder)\n        self.update()\n      })\n    }\n\n    this.addFolder = function(e) {\n      var name = prompt(\"Folder's name\");\n      common.post(url + \"/cruds/folders/components\", JSON.stringify({ name: name, parent_id: self.folder._key }), function(d) {\n        loadFolder(self.folder._key)\n      })\n    }.bind(this)\n\n    this.renameFolder = function(e) {\n      var name = prompt(\"Update Folder's name\");\n      common.patch(url + \"/cruds/folders/components\", JSON.stringify({ name: name, id: self.folder._key }), function(d) {\n        self.path = d.path\n        self.update()\n      })\n    }.bind(this)\n\n    this.deleteFolder = function(e) {\n      UIkit.modal.confirm('Are you sure? This action will destroy the folder and it\\'s content')\n        .then(function() {\n          var parent = _.last(_.initial(self.path));\n          common.delete(url + \"/cruds/folders/components/\" + self.folder._key, function(d) {\n            common.get(url + \"/cruds/folders/components/\" + parent._key, function(d) {\n              self.folders = d.folders\n              self.path = d.path\n              loadFolder(parent._key)\n              self.update()\n            })\n          })\n      }, function () {\n        console.log('Rejected.')\n      });\n    }.bind(this)\n\n    loadFolder(this.folder_key)\n});\n\nriot.tag2('component_crud_index', '<a href=\"#\" class=\"uk-button uk-button-small uk-button-default\" onclick=\"{new_item}\"> <i class=\"fas fa-plus\"></i> New {opts.singular} </a> <table class=\"uk-table uk-table-striped\" if=\"{data.length > 0}\"> <thead> <tr> <th each=\"{col in cols}\"> {col.name == undefined ? col : col.label === undefined ? col.name : col.label} </th> <th width=\"70\"></th> </tr> </thead> <tbody> <tr each=\"{row in data}\"> <td each=\"{col in cols}\" class=\"{col.class}\"> <virtual if=\"{col.tr == true}\">{_.get(row,col.name)[locale]}</virtual> <virtual if=\"{col.tr != true}\">{_.get(row,col.name)}</virtual> </td> <td class=\"uk-text-center\" width=\"110\"> <a onclick=\"{edit}\" class=\"uk-button uk-button-primary uk-button-small\"><i class=\"fas fa-edit\"></i></a> <a onclick=\"{destroy_object}\" class=\"uk-button uk-button-danger uk-button-small\"><i class=\"fas fa-trash-alt\"></i></a> </td> </tr> </tbody> </table> <ul class=\"uk-pagination\"> <li if=\"{component > 0}\"><a onclick=\"{previouspage}\"><span class=\"uk-margin-small-right\" uk-pagination-previous></span> Previous</a></li> <li if=\"{(component + 1) * perpage < count}\" class=\"uk-margin-auto-left\"><a onclick=\"{nextpage}\">Next <span class=\"uk-margin-small-left\" uk-pagination-next></span></a></li> </ul>', '', '', function(opts) {\n    var self = this\n    this.data = []\n    this.new_item = function(e) {\n      e.preventDefault()\n      riot.mount(\"#\"+opts.id, \"component_crud_new\", opts)\n    }.bind(this)\n\n    this.loadcomponent = function(componentIndex) {\n      common.get(url + \"/cruds/sub/\"+opts.parent_id+\"/\"+opts.id+\"/\"+opts.key+\"/component/\"+componentIndex+\"/\"+per_page, function(d) {\n        self.data = d.data[0].data\n        self.cols = _.map(common.array_diff(common.keys(self.data[0]), [\"_id\", \"_key\", \"_rev\"]), function(v) { return { name: v }})\n        if(opts.columns) self.cols = opts.columns\n        self.count = d.data[0].count\n        self.update()\n      })\n    }\n    this.loadcomponent(1)\n\n    this.edit = function(e) {\n      e.preventDefault()\n      opts.element_id = e.item.row._key\n      riot.mount(\"#\"+opts.id, \"component_crud_edit\", opts)\n    }.bind(this)\n\n    this.nextpage = function(e) {\n      e.preventDefault()\n      self.component += 1\n      self.loadcomponent(self.component + 1)\n    }.bind(this)\n\n    this.previouspage = function(e) {\n      e.preventDefault()\n      self.component -= 1\n      self.loadcomponent(self.component + 1)\n    }.bind(this)\n\n    this.destroy_object = function(e) {\n      e.preventDefault()\n      UIkit.modal.confirm(\"Are you sure?\").then(function() {\n        common.delete(url + \"/cruds/\" + opts.id + \"/\" + e.item.row._key, function() {\n          self.loadcomponent(1)\n        })\n      }, function() {})\n    }.bind(this)\n});\n\nriot.tag2('component_crud_edit', '<a href=\"#\" class=\"uk-button uk-button-link\" onclick=\"{goback}\">Back to {opts.id}</a> <form onsubmit=\"{save_form}\" class=\"uk-form\" id=\"{opts.id}_crud_component\"> </form>', '', '', function(opts) {\n    this.goback = function(e) {\n      e.preventDefault()\n      riot.mount(\"#\"+opts.id, \"component_crud_index\", opts)\n    }.bind(this)\n\n    this.save_form = function(e) {\n      e.preventDefault()\n      common.saveForm(opts.id+'_crud_component', \"cruds/sub/\"+opts.parent_name+\"/\"+ opts.id+\"/\"+opts.element_id, \"\", opts)\n    }.bind(this)\n\n    var self = this;\n    common.get(url + \"/cruds/\" + opts.id + \"/\" + opts.element_id, function(d) {\n      self.component = d.data\n\n      common.buildForm(self.component, opts.fields, '#'+opts.id+'_crud_component')\n    })\n    this.on('updated', function() {\n      $(\".select_list\").select2()\n      $(\".select_mlist\").select2()\n      $(\".select_tag\").select2({ tags: true })\n    })\n});\n\nriot.tag2('component_crud_new', '<a href=\"#\" class=\"uk-button uk-button-link\" onclick=\"{goback}\">Back to {opts.id}</a> <form onsubmit=\"{save_form}\" class=\"uk-form\" id=\"{opts.id}_crud_component\"> </form>', '', '', function(opts) {\n    var self = this\n    this.crud = {}\n    this.crud[opts.key] = opts.parent_id\n\n    this.goback = function(e) {\n      e.preventDefault()\n      riot.mount(\"#\"+opts.id, \"component_crud_index\", opts)\n    }.bind(this)\n\n    this.on('mount', function() {\n      common.buildForm(self.crud, opts.fields, '#'+opts.id+'_crud_component')\n    })\n\n    this.save_form = function(e) {\n      e.preventDefault()\n      common.saveForm(opts.id+'_crud_component', \"cruds/sub/components/\"+ opts.id, \"\", opts)\n    }.bind(this)\n\n});\n\nriot.tag2('component_edit', '<virtual if=\"{can_access}\"> <ul uk-tab> <li><a href=\"#\">components</a></li> <li each=\"{i, k in sub_models}\"><a href=\"#\">{k}</a></li> </ul> <ul class=\"uk-switcher uk-margin\"> <li> <h3>Editing component</h3> <form onsubmit=\"{save_form}\" class=\"uk-form\" id=\"form_component\"> </form> <a class=\"uk-button uk-button-primary\" onclick=\"{publish}\">Publish</a> <a class=\"uk-button uk-button-secondary\" onclick=\"{duplicate}\">Duplicate</a> </li> <li each=\"{i, k in sub_models}\"> <div id=\"{k}\" class=\"crud\"></div> </li> </ul> </virtual> <virtual if=\"{!can_access && loaded}\"> Sorry, you can\\'t access this component... </virtual> <script>', '', '', function(opts) {\n    var self = this\n    self.can_access = false\n    self.loaded = false\n\n    this.save_form = function(e) {\n      e.preventDefault()\n      common.saveForm(\"form_component\", \"cruds/components\",opts.component_id)\n    }.bind(this)\n\n    this.duplicate = function(e) {\n      UIkit.modal.confirm(\"Are you sure?\").then(function() {\n        common.get(url + \"/cruds/components/\" + opts.component_id + \"/duplicate\", function(data) {\n          route('/components/' + data._key + '/edit')\n          UIkit.notification({\n            message : 'Successfully duplicated!',\n            status  : 'success',\n            timeout : 1000,\n            pos     : 'bottom-right'\n          });\n        })\n      }, function() {})\n    }.bind(this)\n\n    this.publish = function(e) {\n      UIkit.modal.confirm(\"Are you sure?\").then(function() {\n        common.post(url + \"/cruds/components/\" + opts.component_id + \"/publish\", JSON.stringify({}), function(data) {\n          UIkit.notification({\n            message : 'Successfully published!',\n            status  : 'success',\n            timeout : 1000,\n            pos     : 'bottom-right'\n          });\n        })\n      })\n    }.bind(this)\n\n    common.get(url + \"/cruds/components/\" + opts.component_id, function(d) {\n      self.component = d.data\n      self.fields = d.fields\n      self.sub_models = d.fields.sub_models\n      var fields = d.fields\n      var act_as_tree = d.fields.act_as_tree\n\n      if(!_.isArray(fields)) fields = fields.model\n      common.get(url + \"/auth/whoami\", function(me) {\n        self.can_access = d.fields.roles === undefined || _.includes(d.fields.roles.write, me.role)\n        self.loaded = true\n        self.update()\n        var back_url = 'components'\n        if(act_as_tree) { back_url = 'components/' + self.component.folder_key }\n        if(self.can_access)\n          common.buildForm(self.component, fields, '#form_component', back_url, function() {\n            $(\".crud\").each(function(i, c) {\n            var id = $(c).attr(\"id\")\n            riot.mount(\"#\" + id, \"component_crud_index\", { model: id,\n              fields: self.sub_models[id].fields,\n              key: self.sub_models[id].key,\n              singular: self.sub_models[id].singular,\n              columns: self.sub_models[id].columns,\n              parent_id: opts.component_id,\n              parent_name: back_url })\n          })\n        })\n      })\n    })\n\n    this.on('updated', function() {\n      $(\".select_list\").select2()\n      $(\".select_mlist\").select2()\n      $(\".select_tag\").select2({ tags: true })\n    })\n});\n\nriot.tag2('component_new', '<virtual if=\"{can_access}\"> <h3>Creating component</h3> <form onsubmit=\"{save_form}\" class=\"uk-form\" id=\"form_new_component\"> </form> </virtual> <virtual if=\"{!can_access && loaded}\"> Sorry, you can\\'t access this component... </virtual>', '', '', function(opts) {\n    var self = this\n    self.can_access = false\n    self.loaded = false\n\n    this.save_form = function(e) {\n      e.preventDefault()\n      common.saveForm(\"form_new_component\", \"cruds/components\")\n    }.bind(this)\n\n    common.get(url + \"/cruds/components/fields\", function(d) {\n      common.get(url + \"/auth/whoami\", function(me) {\n        self.can_access = d.fields.roles === undefined || _.includes(d.fields.roles.write, me.role)\n        self.loaded = true\n        self.update()\n        if(self.can_access) {\n\n          var fields = d.fields\n          var obj = {}\n          if(!_.isArray(fields)) fields = fields.model\n          var back_url = 'components'\n          if(self.opts.folder_key) {\n            fields.push({ r: true, c: \"1-1\", n: \"folder_key\", t: \"hidden\" })\n            obj['folder_key'] = opts.folder_key\n            back_url = 'components/' + opts.folder_key\n          }\n          common.buildForm(obj, fields, '#form_new_component', back_url);\n        }\n      })\n    })\n\n    this.on('updated', function() {\n      $(\".select_list\").select2()\n      $(\".select_mlist\").select2()\n      $(\".select_tag\").select2({ tags: true })\n    })\n});\n\nriot.tag2('components', '<component_folders show=\"{loaded}\" folder_key=\"{folder_key}\"></component_folders> <virtual if=\"{can_access}\"> <div class=\"uk-float-right\"> <a if=\"{act_as_tree}\" href=\"#components/{folder._key}/new\" class=\"uk-button uk-button-small uk-button-default\"><i class=\"fas fa-plus\"></i> New component</a> <a if=\"{!act_as_tree}\" href=\"#components/new\" class=\"uk-button uk-button-small uk-button-default\"><i class=\"fas fa-plus\"></i> New component</a> <a if=\"{export}\" onclick=\"{export_data}\" class=\"uk-button uk-button-small uk-button-primary\"><i class=\"fas fa-file-export\"></i> Export CSV</a> </div> <h3>Listing components</h3> <form onsubmit=\"{filter}\" class=\"uk-margin-top\"> <div class=\"uk-inline uk-width-1-1\"> <span class=\"uk-form-icon\" uk-icon=\"icon: search\"></span> <input type=\"text\" ref=\"term\" id=\"term\" class=\"uk-input\" autocomplete=\"off\"> </div> </form> <table class=\"uk-table uk-table-striped\"> <thead> <tr> <th if=\"{sortable}\" width=\"20\"></th> <th each=\"{col in cols}\">{col.name == undefined ? col : col.label === undefined ? col.name : col.label}</th> <th width=\"70\"></th> </tr> </thead> <tbody id=\"list\"> <tr each=\"{row in data}\"> <td if=\"{sortable}\"><i class=\"fas fa-grip-vertical handle\"></i></td> <td each=\"{col in cols}\" class=\"{col.class}\"> <virtual if=\"{col.toggle == true}\"> <virtual if=\"{col.tr == true}\"><a onclick=\"{toggleField}\" data-key=\"{row._key}\">{col.values ? col.values[row[col.name][locale]] : _.get(row,col.name)[locale]}</a></virtual> <virtual if=\"{col.tr != true}\"><a onclick=\"{toggleField}\" data-key=\"{row._key}\">{col.values ? col.values[row[col.name]] : _.get(row,col.name)}</a></virtual> </virtual> <virtual if=\"{col.toggle != true}\"> <virtual if=\"{col.type == image}\"> <img riot-src=\"{_.get(row,col.name)[locale]} \" style=\"height:25px\"> </virtual> <virtual if=\"{col.type != image}\"> {calc_value(row, col, locale)} </virtual> </virtual> </td> <td class=\"uk-text-center\" width=\"110\"> <a onclick=\"{edit}\" class=\"uk-button uk-button-primary uk-button-small\"><i class=\"fas fa-edit\"></i></a> <a onclick=\"{destroy_object}\" class=\"uk-button uk-button-danger uk-button-small\"><i class=\"fas fa-trash-alt\"></i></a> </td> </tr> </tbody> </table> <ul class=\"uk-pagination\"> <li if=\"{component > 0}\"><a onclick=\"{previouspage}\"><span class=\"uk-margin-small-right\" uk-pagination-previous></span> Previous</a></li> <li if=\"{(component + 1) * perpage < count}\" class=\"uk-margin-auto-left\"><a onclick=\"{nextpage}\">Next <span class=\"uk-margin-small-left\" uk-pagination-next></span></a></li> </ul> Per component : {perpage > 100000 ? \\'ALL\\' : perpage} <a onclick=\"{setperpage}\" class=\"uk-label\">25</a> <a onclick=\"{setperpage}\" class=\"uk-label\">50</a> <a onclick=\"{setperpage}\" class=\"uk-label\">100</a> <a onclick=\"{setperpage}\" class=\"uk-label\">500</a> <a onclick=\"{setperpage}\" class=\"uk-label\">1000</a> <a onclick=\"{setperpage}\" class=\"uk-label\">ALL</a> </virtual> <virtual if=\"{!can_access && loaded}\"> Sorry, you can\\'t access this component... </virtual>', 'components .handle,[data-is=\"components\"] .handle{ cursor: move; }', '', function(opts) {\n\n    var self        = this\n    this.component  = 0\n    this.perpage    = per_page\n    this.locale     = window.localStorage.getItem('foxx-locale')\n    this.data       = []\n    this.export     = false\n    this.can_access = false\n    this.sortable   = false\n    this.loaded     = false\n    this.folder     = {}\n    this.folder_key = this.opts.folder_key || ''\n    this.act_as_tree = true\n\n    this.loadcomponent = function(componentIndex) {\n      self.loaded = false\n      var querystring = \"?folder=\" + self.folder._key + \"&is_root=\" + self.folder.is_root\n      common.get(url + \"/cruds/components/page/\"+componentIndex+\"/\"+this.perpage + querystring, function(d) {\n        self.data = d.data[0].data\n        self.export = !!d.model.export\n        self.cols = _.map(common.array_diff(common.keys(self.data[0]), [\"_id\", \"_key\", \"_rev\"]), function(v) { return { name: v }})\n        if(d.model.columns) self.cols = d.model.columns\n        self.count = d.data[0].count\n        self.sortable = !!d.model.sortable\n        common.get(url + \"/auth/whoami\", function(me) {\n          self.loaded = true\n          self.can_access = d.model.roles === undefined || _.includes(d.model.roles.read, me.role)\n          self.update()\n        })\n      })\n    }\n\n    this.setFolder = function(folder) {\n      self.folder = folder\n      self.act_as_tree = folder !== ''\n      self.loadcomponent(1)\n    }\n\n    this.calc_value = function(row, col, locale) {\n      value = _.get(row, col.name)\n      if(col.tr) { value = value[locale] }\n      if(col.truncate) { value = value.substring(0,col.truncate) }\n      if(col.capitalize) { value = _.capitalize(value) }\n      if(col.uppercase) { value = _.toUpper(value) }\n      if(col.downcase) { value = _.toLower(value) }\n      return value\n    }.bind(this)\n\n    this.filter = function(e) {\n      e.preventDefault();\n      if(self.refs.term.value != \"\") {\n        $(\".uk-form-icon i\").attr(\"class\", \"uk-icon-spin uk-icon-spinner\")\n        common.get(url + \"/cruds/components/search/\"+self.refs.term.value, function(d) {\n          self.data = d.data\n          $(\".uk-form-icon i\").attr(\"class\", \"uk-icon-search\")\n          self.update()\n        })\n      }\n      else {\n        self.loadcomponent(1)\n      }\n    }.bind(this)\n\n    this.edit = function(e) {\n      route(\"/components/\" + e.item.row._key + \"/edit\")\n    }.bind(this)\n\n    this.nextpage = function(e) {\n      self.component += 1\n      self.loadcomponent(self.component + 1)\n    }.bind(this)\n\n    this.previouspage = function(e) {\n      self.component -= 1\n      self.loadcomponent(self.component + 1)\n    }.bind(this)\n\n    this.destroy_object = function(e) {\n      UIkit.modal.confirm(\"Are you sure?\").then(function() {\n        common.delete(url + \"/cruds/components/\" + e.item.row._key, function() {\n          self.loadcomponent(self.component + 1)\n        })\n      }, function() {})\n    }.bind(this)\n\n    this.toggleField = function(e) {\n      e.preventDefault()\n      common.patch(url + \"/cruds/components/\" + e.target.dataset.key + \"/\" + e.item.col.name + \"/toggle\", \"{}\", function(data) {\n        if(data.success) {\n          e.target.innerText = data.data\n        }\n      })\n    }.bind(this)\n\n    this.setperpage = function(e) {\n      e.preventDefault()\n      var perpage = parseInt(e.srcElement.innerText)\n      if(e.srcElement.innerText == 'ALL') perpage = 1000000000;\n      this.perpage = perpage\n      this.loadcomponent(1)\n    }.bind(this)\n\n    this.export_data = function(e) {\n      common.get(url + '/cruds/components/export', function(d) {\n        var csvContent = d.data\n        var encodedUri = encodeURI(csvContent)\n        var link = document.createElement(\"a\")\n        link.setAttribute(\"href\", encodedUri)\n        link.setAttribute(\"download\", \"components.csv\")\n        link.innerHTML= \"Click Here to download\"\n        document.body.appendChild(link)\n        link.click()\n        document.body.removeChild(link)\n      })\n    }.bind(this)\n\n    this.on('updated', function() {\n      if(self.sortable) {\n        var el = document.getElementById('list');\n        var sortable = new Sortable(el, {\n          animation: 150,\n          ghostClass: 'blue-background-class',\n          handle: '.fa-grip-vertical',\n          onSort: function ( evt) {\n            var folder_key = \"?folder_key=\" + self.folder._key\n            if(!self.act_as_tree) folder_key = ''\n            common.put(\n              url + 'cruds/components/orders/' + evt.oldIndex + \"/\" + evt.newIndex + folder_key, {},\n              function() {}\n            )\n          },\n        });\n      }\n    })\n});\n\n","riot.tag2('dataset_folders', '<div> <ul class=\"uk-breadcrumb\"> <li each=\"{f in path}\"><a href=\"#datasets/{opts.slug}/{f._key}\">{f.name}</a></li> <li> <a if=\"{path.length > 1}\" onclick=\"{renameFolder}\"><i class=\"far fa-edit\"></i></a> <a onclick=\"{addFolder}\"><i class=\"fas fa-plus\"></i></a> <a if=\"{path.length > 1 && folders.length == 0}\" onclick=\"{deleteFolder}\"><i class=\"fas fa-trash\"></i></a> </li> </ul> <ul class=\"uk-list\"> <li each=\"{f in folders}\"><a href=\"#datasets/{opts.slug}/{f._key}\"><i class=\"far fa-folder\"></i> {f.name}</a></li> </ul> </div>', '', '', function(opts) {\n    this.folders = []\n    this.folder = {}\n    this.path = [ this.folder ]\n    this.folder_key = this.opts.folder_key || ''\n    var self = this\n\n    var loadFolder = function(folder_key) {\n      common.get(url + \"/cruds/folders/datasets_\" + opts.slug + \"/\" + folder_key, function(d) {\n        self.folders = d.folders\n        self.path = d.path\n        self.folder = _.last(self.path)\n        self.parent.setFolder(self.folder)\n        self.update()\n      })\n    }\n\n    this.addFolder = function(e) {\n      var name = prompt(\"Folder's name\");\n      common.post(url + \"/cruds/folders/datasets_\" + opts.slug, JSON.stringify({ name: name, parent_id: self.folder._key }), function(d) {\n        loadFolder(self.folder._key)\n      })\n    }.bind(this)\n\n    this.renameFolder = function(e) {\n      var name = prompt(\"Update Folder's name\");\n      common.patch(url + \"/cruds/folders/datasets_\" + opts.slug, JSON.stringify({ name: name, id: self.folder._key }), function(d) {\n        self.path = d.path\n        self.update()\n      })\n    }.bind(this)\n\n    this.deleteFolder = function(e) {\n      UIkit.modal.confirm('Are you sure? This action will destroy the folder and it\\'s content').then(function() {\n        var parent = _.last(_.initial(self.path))\n        common.delete(url + \"/cruds/folders/datasets_\" + opts.slug + \"/\" + self.folder._key, function(d) {\n          common.get(url + \"/cruds/folders/datasets_\" + opts.slug + \"/\" + parent._key, function(d) {\n            route(\"/datasets/\" + opts.slug + \"/\" + parent._key)\n          })\n        })\n      }, function () {\n        console.log('Rejected.')\n      });\n    }.bind(this)\n\n    loadFolder(this.folder_key)\n});\n\nriot.tag2('dataset_crud_index', '<a href=\"#\" class=\"uk-button uk-button-small uk-button-default\" onclick=\"{new_item}\"> <i class=\"fas fa-plus\"></i> New {opts.singular} </a> <table class=\"uk-table uk-table-striped\" if=\"{data.length > 0}\"> <thead> <tr> <th width=\"20\" if=\"{sortable}\"></th> <th each=\"{col in cols}\"> {col.name == undefined ? col : col.label === undefined ? col.name : col.label} </th> <th width=\"70\"></th> </tr> </thead> <tbody id=\"sublist\"> <tr each=\"{row in data}\"> <td if=\"{sortable}\"><i class=\"fas fa-grip-vertical handle\"></i></td> <td each=\"{col in cols}\" class=\"{col.class}\"> <virtual if=\"{col.tr == true}\">{_.get(row,col.name)[locale]}</virtual> <virtual if=\"{col.tr != true}\">{_.get(row,col.name)}</virtual> </td> <td class=\"uk-text-center\" width=\"110\"> <a onclick=\"{edit}\" class=\"uk-button uk-button-primary uk-button-small\"><i class=\"fas fa-edit\"></i></a> <a onclick=\"{destroy_object}\" class=\"uk-button uk-button-danger uk-button-small\"><i class=\"fas fa-trash-alt\"></i></a> </td> </tr> </tbody> </table> <ul class=\"uk-pagination\"> <li if=\"{page > 0}\"><a onclick=\"{previousPage}\"><span class=\"uk-margin-small-right\" uk-pagination-previous></span> Previous</a></li> <li if=\"{(page + 1) * perpage < count}\" class=\"uk-margin-auto-left\"><a onclick=\"{nextPage}\">Next <span class=\"uk-margin-small-left\" uk-pagination-next></span></a></li> </ul>', '', '', function(opts) {\n    this.sortable = false\n    this.data     = []\n\n    var self = this\n\n    this.new_item = function(e) {\n      e.preventDefault()\n      riot.mount(\"#\"+opts.id, \"dataset_crud_new\", opts)\n    }.bind(this)\n\n    this.loadPage = function(pageIndex) {\n      common.get(url + \"datasets/\"+opts.parent_name+\"/\"+ opts.parent_id + \"/\"+opts.model+\"/page/\"+pageIndex+\"/\"+per_page, function(d) {\n        self.data = d.data[0].data\n        var model = d.model\n        self.cols = _.map(common.array_diff(common.keys(self.data[0]), [\"_id\", \"_key\", \"_rev\"]), function(v) { return { name: v }})\n        if(model.columns) self.cols = model.columns\n        self.sortable = !!model.sortable\n        self.count = d.data[0].count\n        self.update()\n      })\n    }\n    this.loadPage(1)\n\n    this.edit = function(e) {\n      e.preventDefault()\n      opts.element_id = e.item.row._key\n      riot.mount(\"#\"+opts.id, \"dataset_crud_edit\", opts)\n    }.bind(this)\n\n    this.nextPage = function(e) {\n      e.preventDefault()\n      self.page += 1\n      self.loadPage(self.page + 1)\n    }.bind(this)\n\n    this.previousPage = function(e) {\n      e.preventDefault()\n      self.page -= 1\n      self.loadPage(self.page + 1)\n    }.bind(this)\n\n    this.destroy_object = function(e) {\n      e.preventDefault()\n      UIkit.modal.confirm(\"Are you sure?\").then(function() {\n        common.delete(url + \"/datasets/datasets/\" + e.item.row._key, function() {\n          self.loadPage(1)\n        })\n      }, function() {})\n    }.bind(this)\n\n    this.on('updated', function() {\n      if(self.sortable) {\n        var el = document.getElementById('sublist');\n        if(el)\n          var sortable = new Sortable(el, {\n            animation: 150,\n            ghostClass: 'blue-background-class',\n            handle: '.fa-grip-vertical',\n            onSort: function ( evt) {\n              common.put(\n                url + 'datasets/'+ opts.id +'/orders/' + evt.oldIndex + \"/\" + evt.newIndex, {},\n                function() {}\n              )\n            },\n          });\n      }\n    })\n});\n\nriot.tag2('dataset_crud_edit', '<a href=\"#\" class=\"uk-button uk-button-link\" onclick=\"{goback}\">Back to {opts.id}</a> <form onsubmit=\"{save_form}\" class=\"uk-form\" id=\"{opts.id}_crud_{opts.singular}\"> </form>', '', '', function(opts) {\n    this.goback = function(e) {\n      e.preventDefault()\n      riot.mount(\"#\"+opts.id, \"dataset_crud_index\", opts)\n    }.bind(this)\n\n    this.save_form = function(e) {\n      e.preventDefault()\n      common.saveForm(opts.id+'_crud_'+opts.singular, \"datasets/sub/\"+opts.parent_name+\"/\"+ opts.id+\"/\"+opts.element_id, \"\")\n    }.bind(this)\n\n    var self = this;\n    common.get(url + \"/datasets/\" + opts.parent_name + \"/sub/\" + opts.id + \"/\" + opts.element_id, function(d) {\n      self.subdata = d.data\n\n      common.buildForm(self.subdata, opts.fields, '#'+opts.id+'_crud_' + opts.singular)\n    })\n    this.on('updated', function() {\n      $(\".select_list\").select2()\n      $(\".select_mlist\").select2()\n      $(\".select_tag\").select2({ tags: true })\n    })\n});\n\nriot.tag2('dataset_crud_new', '<a href=\"#\" class=\"uk-button uk-button-link\" onclick=\"{goback}\">Back to {opts.id}</a> <form onsubmit=\"{save_form}\" class=\"uk-form\" id=\"{opts.id}_crud_dataset\"> </form>', '', '', function(opts) {\n    var self = this\n    this.crud = {}\n    this.crud[opts.key] = opts.parent_id\n\n    this.goback = function(e) {\n      e.preventDefault()\n      riot.mount(\"#\"+opts.id, \"dataset_crud_index\", opts)\n    }.bind(this)\n\n    this.on('mount', function() {\n      common.buildForm(self.crud, opts.fields, '#'+opts.id+'_crud_dataset')\n    })\n\n    this.save_form = function(e) {\n      e.preventDefault()\n      common.saveForm(opts.id+'_crud_dataset', \"datasets/\"+ opts.parent_name +\"/\" + opts.parent_id + \"/\"+ opts.id, \"\", opts)\n    }.bind(this)\n});\n\n\nriot.tag2('all_datatypes', '<div class=\"rightnav uk-card uk-card-default uk-card-body\"> <ul class=\"uk-nav-default uk-nav-parent-icon\" uk-nav> <li class=\"uk-nav-header\">Datasets</li> <li each=\"{datatypes}\"><a href=\"#datasets/{slug}\">{name}</a></li> </ul> </div>', '', '', function(opts) {\n    var self = this\n    this.datatypes = []\n    common.get(url + \"/datasets/datatypes\", function(data) {\n      self.datatypes = data\n      self.update()\n    })\n});\n\nriot.tag2('dataset_edit', '<virtual if=\"{can_access}\"> <ul uk-tab> <li><a href=\"#\">datasets</a></li> <li each=\"{i, k in sub_models}\"><a href=\"#\">{k}</a></li> </ul> <ul class=\"uk-switcher uk-margin\"> <li> <h3>Editing {opts.datatype}</h3> <form onsubmit=\"{save_form}\" class=\"uk-form\" id=\"form_dataset\"> </form> <a if=\"{publishable}\" class=\"uk-button uk-button-primary\" onclick=\"{publish}\">Publish</a> <a class=\"uk-button uk-button-secondary\" onclick=\"{duplicate}\">Duplicate</a> </li> <li each=\"{i, k in sub_models}\"> <div id=\"{k}\" class=\"crud\"></div> </li> </ul> </virtual> <virtual if=\"{!can_access && loaded}\"> Sorry, you can\\'t access this page... </virtual> <script>', '', '', function(opts) {\n    var self = this\n    self.can_access = false\n    self.loaded = false\n    self.sub_models = []\n    self.publishable = false\n\n    this.save_form = function(e) {\n      e.preventDefault()\n      common.saveForm(\"form_dataset\", \"datasets/\" + opts.datatype ,opts.dataset_id)\n    }.bind(this)\n\n    this.duplicate = function(e) {\n      UIkit.modal.confirm(\"Are you sure?\").then(function() {\n        common.get(url + \"/datasets/\"+ opts.datatype +\"/\" + self.dataset._key + \"/duplicate\", function(data) {\n          route('/datasets/'+ opts.datatype + '/' + data._key + '/edit')\n          UIkit.notification({\n            message : 'Successfully duplicated!',\n            status  : 'success',\n            timeout : 1000,\n            pos     : 'bottom-right'\n          });\n        })\n      }, function() {})\n    }.bind(this)\n\n    this.publish = function(e) {\n      UIkit.modal.confirm(\"Are you sure?\").then(function() {\n        common.post(url + \"/datasets/\" + self.dataset._key + \"/publish\", JSON.stringify({}), function(data) {\n          UIkit.notification({\n            message : 'Successfully published!',\n            status  : 'success',\n            timeout : 1000,\n            pos     : 'bottom-right'\n          });\n        })\n      })\n    }.bind(this)\n\n    common.get(url + \"/datasets/\" + opts.datatype + \"/\" + opts.dataset_id, function(d) {\n      self.publishable = d.model.publishable\n      self.dataset = d.data\n      self.fields = d.fields\n      self.sub_models = d.model.sub_models\n      var act_as_tree = d.model.act_as_tree\n\n      if(!_.isArray(self.fields)) fields = fields.model\n      common.get(url + \"/auth/whoami\", function(me) {\n        localStorage.setItem('resize_api_key', me.resize_api_key)\n        self.can_access = d.fields.roles === undefined || _.includes(d.fields.roles.write, me.role)\n        self.loaded = true\n        self.update()\n        if(self.can_access)\n          var back_url = 'datasets/' + opts.datatype\n          if(act_as_tree && self.dataset.folder_key) { back_url += '/' + self.dataset.folder_key }\n          common.buildForm(self.dataset, self.fields, '#form_dataset', back_url, function() {\n            $(\".crud\").each(function(i, c) {\n              var id = $(c).attr(\"id\")\n              riot.mount(\"#\" + id, \"dataset_crud_index\", { model: id,\n                fields: self.sub_models[id].fields,\n                key: self.sub_models[id].key,\n                singular: self.sub_models[id].singular,\n                columns: self.sub_models[id].columns,\n                parent_id: opts.dataset_id,\n                parent_name: opts.datatype })\n            })\n          })\n      })\n    })\n\n    this.on('updated', function() {\n      $(\".select_list\").select2()\n      $(\".select_mlist\").select2()\n      $(\".select_tag\").select2({ tags: true })\n    })\n});\n\nriot.tag2('dataset_new', '<virtual if=\"{can_access}\"> <h3>Creating {opts.datatype}</h3> <form onsubmit=\"{save_form}\" class=\"uk-form\" id=\"form_new_dataset\"> </form> </virtual> <virtual if=\"{!can_access && loaded}\"> Sorry, you can\\'t access this page... </virtual>', '', '', function(opts) {\n    var self = this\n    self.can_access = false\n    self.loaded = false\n\n    this.save_form = function(e) {\n      e.preventDefault()\n      common.saveForm(\"form_new_dataset\", \"datasets/\" + opts.datatype)\n    }.bind(this)\n\n    common.get(url + \"/datasets/\"+ opts.datatype + \"/fields\", function(d) {\n      common.get(url + \"/auth/whoami\", function(me) {\n        localStorage.setItem('resize_api_key', me.resize_api_key)\n        self.can_access = d.fields.roles === undefined || _.includes(d.fields.roles.write, me.role)\n        self.loaded = true\n        self.update()\n        if(self.can_access) {\n          var fields = d.fields\n          var obj = {}\n          var back_url = 'datasets/' + opts.datatype\n          if(self.opts.folder_key) {\n            fields.push({ r: true, c: \"1-1\", n: \"folder_key\", t: \"hidden\" })\n            obj['folder_key'] = opts.folder_key\n            back_url += '/' + opts.folder_key\n          }\n\n          common.buildForm(obj, fields, '#form_new_dataset', back_url);\n        }\n      })\n    })\n\n    this.on('updated', function() {\n      $(\".select_list\").select2()\n      $(\".select_mlist\").select2()\n      $(\".select_tag\").select2({ tags: true })\n    })\n});\n\nriot.tag2('dataset_tags', '<span each=\"{row in data}\"> {row.tag} <span class=\"uk-badge uk-margin-right\">{row.size}</span> </span>', '', '', function(opts) {\n    var self = this\n    common.get(url + \"/datasets/\" + opts.datatype + \"/stats/\" + this.opts.tag, function(d) {\n      self.data = d\n      self.update()\n    })\n});\n\nriot.tag2('datasets', '<dataset_folders show=\"{loaded}\" if=\"{act_as_tree}\" folder_key=\"{folder_key}\" slug=\"{opts.datatype}\"></dataset_folders> <virtual if=\"{can_access}\"> <div class=\"uk-float-right\"> <a if=\"{act_as_tree}\" href=\"#datasets/{opts.datatype}/new/{folder_key}\" class=\"uk-button uk-button-small uk-button-default\"><i class=\"fas fa-plus\"></i></a> <a if=\"{!act_as_tree}\" href=\"#datasets/{opts.datatype}/new\" class=\"uk-button uk-button-small uk-button-default\"><i class=\"fas fa-plus\"></i></a> <a if=\"{export}\" onclick=\"{export_data}\" class=\"uk-button uk-button-small uk-button-primary\"><i class=\"fas fa-file-export\"></i> Export CSV</a> </div> <h3>Listing {opts.datatype}</h3> <form onsubmit=\"{filter}\" class=\"uk-margin-top\"> <div class=\"uk-inline uk-width-1-1\"> <span class=\"uk-form-icon\" uk-icon=\"icon: search\"></span> <input type=\"text\" ref=\"term\" id=\"term\" class=\"uk-input\" autocomplete=\"off\"> </div> </form> <dataset_tags if=\"{show_stats}\" datatype=\"{opts.datatype}\" tag=\"{show_stats_tag}\"></dataset_tags> <table class=\"uk-table uk-table-striped\"> <thead> <tr> <th if=\"{sortable}\" width=\"20\"></th> <th each=\"{col in cols}\" class=\"{col.class}\">{col.name == undefined ? col : col.label === undefined ? col.name : col.label}</th> <th width=\"70\"></th> </tr> </thead> <tbody id=\"list\"> <tr each=\"{row in data}\" no-reorder> <td if=\"{sortable}\"><i class=\"fas fa-grip-vertical handle\"></i></td> <td each=\"{col in cols}\" class=\"{col.class}\"> <virtual if=\"{col.toggle == true}\"> <virtual if=\"{col.tr == true}\"><a onclick=\"{toggleField}\" data-key=\"{row._key}\">{col.values ? col.values[row[col.name][locale]] : _.get(row,col.name)[locale]}</a></virtual> <virtual if=\"{col.tr != true}\"><a onclick=\"{toggleField}\" data-key=\"{row._key}\">{col.values ? col.values[row[col.name]] : _.get(row,col.name)}</a></virtual> </virtual> <virtual if=\"{col.toggle != true}\"> <virtual if=\"{col.type == image}\"> <img riot-src=\"{calc_value(row, col, locale)} \" style=\"height:25px\"> </virtual> <virtual if=\"{col.type != image}\"> {calc_value(row, col, locale)} </virtual> </virtual> </td> <td class=\"uk-text-center\" width=\"110\"> <a onclick=\"{edit}\" class=\"uk-button uk-button-primary uk-button-small\"><i class=\"fas fa-edit\"></i></a> <a onclick=\"{destroy_object}\" class=\"uk-button uk-button-danger uk-button-small\"><i class=\"fas fa-trash-alt\"></i></a> </td> </tr> </tbody> </table> <ul class=\"uk-pagination noselect\"> <li if=\"{page + 1 > 1}\"><a onclick=\"{previousPage}\"><span class=\"uk-margin-small-right\" uk-pagination-previous></span> Previous</a></li> <li if=\"{(page + 1) * perpage < count}\" class=\"uk-margin-auto-left\"><a onclick=\"{nextPage}\">Next <span class=\"uk-margin-small-left\" uk-pagination-next></span></a></li> </ul> Per Page : {perpage > 100000 ? \\'ALL\\' : perpage} <a onclick=\"{setPerPage}\" class=\"uk-label\">25</a> <a onclick=\"{setPerPage}\" class=\"uk-label\">50</a> <a onclick=\"{setPerPage}\" class=\"uk-label\">100</a> <a onclick=\"{setPerPage}\" class=\"uk-label\">500</a> <a onclick=\"{setPerPage}\" class=\"uk-label\">1000</a> <a onclick=\"{setPerPage}\" class=\"uk-label\">ALL</a> </virtual> <virtual if=\"{!can_access && loaded}\"> Sorry, you can\\'t access this page... </virtual>', '', '', function(opts) {\n\n    var self        = this\n    this.show_stats = false\n    this.page       = 0\n    this.perpage    = per_page\n    this.locale     = window.localStorage.getItem('foxx-locale')\n    this.data       = []\n    this.export     = false\n    this.can_access = false\n    this.sortable   = false\n    this.loaded     = false\n    this.folder_key = this.opts.folder_key || ''\n    this.folder     = {}\n    this.act_as_tree = true\n\n    this.loadPage = function(pageIndex) {\n      self.loaded = false\n      var querystring = \"?folder=\" + self.folder._key + \"&is_root=\" + self.folder.is_root\n\n      common.get(url + \"/datasets/\" + opts.datatype + \"/page/\" + pageIndex + \"/\" + this.perpage + querystring, function(d) {\n        self.data = d.data[0].data\n        var model = d.model\n        self.act_as_tree = model.act_as_tree\n        if(model.stats_for_tag) {\n          self.show_stats = true\n          self.show_stats_tag = model.stats_for_tag\n          self.update()\n        }\n        self.export = !!model.export\n        self.cols = _.map(common.array_diff(common.keys(self.data[0]), [\"_id\", \"_key\", \"_rev\"]), function(v) { return { name: v }})\n        if(model.columns) self.cols = model.columns\n        self.count = d.data[0].count\n        self.sortable = !!model.sortable\n        common.get(url + \"/auth/whoami\", function(me) {\n          localStorage.setItem('resize_api_key', me.resize_api_key)\n          self.loaded = true\n          self.can_access = model.roles === undefined || _.includes(model.roles.read, me.role)\n          self.update()\n        })\n      })\n    }\n\n    this.setFolder = function(folder) {\n      self.folder = folder || {}\n      self.folder_key = self.folder._key\n      self.loadPage(1)\n    }\n\n    this.calc_value = function(row, col, locale) {\n      value = _.get(row, col.name)\n      if(col.tr) { value = value[locale] }\n      if(col.truncate) { value = value.substring(0,col.truncate) }\n      if(col.capitalize) { value = _.capitalize(value) }\n      if(col.uppercase) { value = _.toUpper(value) }\n      if(col.downcase) { value = _.toLower(value) }\n      return value\n    }.bind(this)\n\n    this.filter = function(e) {\n      e.preventDefault();\n      if(self.refs.term.value != \"\") {\n        $(\".uk-form-icon i\").attr(\"class\", \"uk-icon-spin uk-icon-spinner\")\n        common.get(url + \"/datasets/\"+ opts.datatype +\"/search/\"+self.refs.term.value, function(d) {\n          self.data = d.data\n          $(\".uk-form-icon i\").attr(\"class\", \"uk-icon-search\")\n          self.update()\n        })\n      }\n      else {\n        self.loadPage(1)\n      }\n    }.bind(this)\n\n    this.edit = function(e) {\n      route(\"/datasets/\" + this.opts.datatype + \"/\" + e.item.row._key + \"/edit\")\n    }.bind(this)\n\n    this.new_dataset = function(e) {\n      route(\"/datasets/\" + this.opts.datatype + \"/new\")\n    }.bind(this)\n\n    this.nextPage = function(e) {\n      self.page += 1\n      self.loadPage(self.page + 1)\n    }.bind(this)\n\n    this.previousPage = function(e) {\n      self.page -= 1\n      self.loadPage(self.page + 1)\n    }.bind(this)\n\n    this.destroy_object = function(e) {\n      UIkit.modal.confirm(\"Are you sure?\").then(function() {\n        common.delete(url + \"/datasets/\" + opts.datatype + \"/\" + e.item.row._key, function() {\n          self.loadPage(self.page + 1)\n        })\n      }, function() {})\n    }.bind(this)\n\n    this.toggleField = function(e) {\n      e.preventDefault()\n      common.patch(url + \"/datasets/\" + opts.datatype + \"/\" + e.target.dataset.key + \"/\" + e.item.col.name + \"/toggle\", \"{}\", function(data) {\n        if(data.success) {\n          e.target.innerText = data.data\n        }\n      })\n    }.bind(this)\n\n    this.setPerPage = function(e) {\n      e.preventDefault()\n      var perpage = parseInt(e.srcElement.innerText)\n      if(e.srcElement.innerText == 'ALL') perpage = 1000000000;\n      this.perpage = perpage\n      this.loadPage(1)\n    }.bind(this)\n\n    this.export_data = function(e) {\n      common.get(url + '/datasets/' + opts.datatype + '/export', function(d) {\n        var csvContent = d.data\n        var encodedUri = encodeURI(csvContent)\n        var link = document.createElement(\"a\")\n        link.setAttribute(\"href\", encodedUri)\n        link.setAttribute(\"download\", \"datasets.csv\")\n        link.innerHTML= \"Click Here to download\"\n        document.body.appendChild(link)\n        link.click()\n        document.body.removeChild(link)\n      })\n    }.bind(this)\n\n    this.on('updated', function() {\n      if(self.sortable) {\n        var el = document.getElementById('list');\n        var sortable = new Sortable(el, {\n          animation: 150,\n          ghostClass: 'blue-background-class',\n          handle: '.fa-grip-vertical',\n          onSort: function ( evt) {\n            var folder_key = \"?folder_key=\" + self.folder._key\n            if(!self.act_as_tree) folder_key = ''\n            common.put(\n              url + 'datasets/'+ opts.datatype +'/orders/' + evt.oldIndex + \"/\" + evt.newIndex + folder_key, {},\n              function() {}\n            )\n          },\n        });\n\n      }\n    })\n});\n\n","riot.tag2('datatype_folders', '<div> <ul class=\"uk-breadcrumb\"> <li each=\"{f in path}\"><a href=\"#datatypes/{f._key}\">{f.name}</a></li> <li> <a if=\"{path.length > 1}\" onclick=\"{renameFolder}\"><i class=\"far fa-edit\"></i></a> <a onclick=\"{addFolder}\"><i class=\"fas fa-plus\"></i></a> <a if=\"{path.length > 1 && folders.length == 0}\" onclick=\"{deleteFolder}\"><i class=\"fas fa-trash\"></i></a> </li> </ul> <ul class=\"uk-list\"> <li each=\"{f in folders}\"><a href=\"#datatypes/{f._key}\"><i class=\"far fa-folder\"></i> {f.name}</a></li> </ul> </div>', '', '', function(opts) {\n    this.folders = []\n    this.folder = {}\n    this.path = [ this.folder ]\n    this.folder_key = this.opts.folder_key || '';\n    var self = this\n\n    var loadFolder = function(folder_key) {\n      common.get(url + '/cruds/folders/datatypes/' + folder_key, function(d) {\n        self.folders = d.folders\n        self.path = d.path\n        self.folder = _.last(self.path)\n        self.parent.setFolder(self.folder)\n        self.update()\n      })\n    }\n\n    this.addFolder = function(e) {\n      var name = prompt(\"Folder's name\");\n      common.post(url + \"/cruds/folders/datatypes\", JSON.stringify({ name: name, parent_id: self.folder._key }), function(d) {\n        loadFolder(self.folder._key)\n      })\n    }.bind(this)\n\n    this.renameFolder = function(e) {\n      var name = prompt(\"Update Folder's name\");\n      common.patch(url + \"/cruds/folders/datatypes\", JSON.stringify({ name: name, id: self.folder._key }), function(d) {\n        self.path = d.path\n        self.update()\n      })\n    }.bind(this)\n\n    this.deleteFolder = function(e) {\n      UIkit.modal.confirm('Are you sure? This action will destroy the folder and it\\'s content')\n        .then(function() {\n          var parent = _.last(_.initial(self.path));\n          common.delete(url + \"/cruds/folders/datatypes/\" + self.folder._key, function(d) {\n            common.get(url + \"/cruds/folders/datatypes/\" + parent._key, function(d) {\n              self.folders = d.folders\n              self.path = d.path\n              loadFolder(parent._key)\n              self.update()\n            })\n          })\n      }, function () {\n        console.log('Rejected.')\n      });\n    }.bind(this)\n\n    loadFolder(this.folder_key)\n});\n\nriot.tag2('datatype_edit', '<virtual if=\"{can_access}\"> <ul uk-tab> <li><a href=\"#\">datatypes</a></li> <li each=\"{i, k in sub_models}\"><a href=\"#\">{k}</a></li> </ul> <ul class=\"uk-switcher uk-margin\"> <li> <h3>Editing datatype</h3> <form onsubmit=\"{save_form}\" class=\"uk-form\" id=\"form_datatype\"> </form> <dataset_helper></dataset_helper> <a class=\"uk-button uk-button-primary\" onclick=\"{publish}\">Publish</a> <a class=\"uk-button uk-button-secondary\" onclick=\"{duplicate}\">Duplicate</a> </li> <li each=\"{i, k in sub_models}\"> <div id=\"{k}\" class=\"crud\"></div> </li> </ul> </virtual> <virtual if=\"{!can_access && loaded}\"> Sorry, you can\\'t access this datatype... </virtual> <script>', '', '', function(opts) {\n    var self = this\n    self.can_access = false\n    self.loaded = false\n\n    this.save_form = function(e) {\n      e.preventDefault()\n      common.saveForm(\"form_datatype\", \"cruds/datatypes\",opts.datatype_id)\n    }.bind(this)\n\n    this.duplicate = function(e) {\n      UIkit.modal.confirm(\"Are you sure?\").then(function() {\n        common.get(url + \"/cruds/datatypes/\" + opts.datatype_id + \"/duplicate\", function(data) {\n          route('/datatypes/' + data._key + '/edit')\n          UIkit.notification({\n            message : 'Successfully duplicated!',\n            status  : 'success',\n            timeout : 1000,\n            pos     : 'bottom-right'\n          });\n        })\n      }, function() {})\n    }.bind(this)\n\n    this.publish = function(e) {\n      UIkit.modal.confirm(\"Are you sure?\").then(function() {\n        common.post(url + \"/cruds/datatypes/\" + opts.datatype_id + \"/publish\", JSON.stringify({}), function(data) {\n          UIkit.notification({\n            message : 'Successfully published!',\n            status  : 'success',\n            timeout : 1000,\n            pos     : 'bottom-right'\n          });\n        })\n      })\n    }.bind(this)\n\n    common.get(url + \"/cruds/datatypes/\" + opts.datatype_id, function(d) {\n      self.datatype = d.data\n      self.fields = d.fields\n      self.sub_models = d.fields.sub_models\n      var fields = d.fields\n      var act_as_tree = d.fields.act_as_tree\n\n      if(!_.isArray(fields)) fields = fields.model\n      common.get(url + \"/auth/whoami\", function(me) {\n        self.can_access = d.fields.roles === undefined || _.includes(d.fields.roles.write, me.role)\n        self.loaded = true\n        self.update()\n        var back_url = 'datatypes'\n        if(act_as_tree) { back_url = 'datatypes/' + self.datatype.folder_key }\n        if(self.can_access)\n          common.buildForm(self.datatype, fields, '#form_datatype', back_url, function() {\n            $(\".crud\").each(function(i, c) {\n            var id = $(c).attr(\"id\")\n            riot.mount(\"#\" + id, \"datatype_crud_index\", { model: id,\n              fields: self.sub_models[id].fields,\n              key: self.sub_models[id].key,\n              singular: self.sub_models[id].singular,\n              columns: self.sub_models[id].columns,\n              parent_id: opts.datatype_id,\n              parent_name: back_url })\n          })\n        })\n      })\n    })\n\n    this.on('updated', function() {\n      $(\".select_list\").select2()\n      $(\".select_mlist\").select2()\n      $(\".select_tag\").select2({ tags: true })\n    })\n});\n\nriot.tag2('datatype_new', '<virtual if=\"{can_access}\"> <h3>Creating datatype</h3> <form onsubmit=\"{save_form}\" class=\"uk-form\" id=\"form_new_datatype\"> </form> <dataset_helper></dataset_helper> </virtual> <virtual if=\"{!can_access && loaded}\"> Sorry, you can\\'t access this datatype... </virtual>', '', '', function(opts) {\n    var self = this\n    self.can_access = false\n    self.loaded = false\n\n    this.save_form = function(e) {\n      e.preventDefault()\n      common.saveForm(\"form_new_datatype\", \"cruds/datatypes\")\n    }.bind(this)\n\n    common.get(url + \"/cruds/datatypes/fields\", function(d) {\n      common.get(url + \"/auth/whoami\", function(me) {\n        self.can_access = d.fields.roles === undefined || _.includes(d.fields.roles.write, me.role)\n        self.loaded = true\n        self.update()\n        if(self.can_access) {\n\n          var fields = d.fields\n          var obj = {}\n          if(!_.isArray(fields)) fields = fields.model\n          var back_url = 'datatypes'\n          if(self.opts.folder_key) {\n            fields.push({ r: true, c: \"1-1\", n: \"folder_key\", t: \"hidden\" })\n            obj['folder_key'] = opts.folder_key\n            back_url = 'datatypes/' + opts.folder_key\n          }\n          common.buildForm(obj, fields, '#form_new_datatype', back_url);\n        }\n      })\n    })\n\n    this.on('updated', function() {\n      $(\".select_list\").select2()\n      $(\".select_mlist\").select2()\n      $(\".select_tag\").select2({ tags: true })\n    })\n});\n\nriot.tag2('datatypes', '<datatype_folders show=\"{loaded}\" folder_key=\"{folder_key}\"></datatype_folders> <virtual if=\"{can_access}\"> <div class=\"uk-float-right\"> <a if=\"{act_as_tree}\" href=\"#datatypes/{folder._key}/new\" class=\"uk-button uk-button-small uk-button-default\"><i class=\"fas fa-plus\"></i> New datatype</a> <a if=\"{!act_as_tree}\" href=\"#datatypes/new\" class=\"uk-button uk-button-small uk-button-default\"><i class=\"fas fa-plus\"></i> New datatype</a> <a if=\"{export}\" onclick=\"{export_data}\" class=\"uk-button uk-button-small uk-button-primary\"><i class=\"fas fa-file-export\"></i> Export CSV</a> </div> <h3>Listing datatypes</h3> <form onsubmit=\"{filter}\" class=\"uk-margin-top\"> <div class=\"uk-inline uk-width-1-1\"> <span class=\"uk-form-icon\" uk-icon=\"icon: search\"></span> <input type=\"text\" ref=\"term\" id=\"term\" class=\"uk-input\" autocomplete=\"off\"> </div> </form> <table class=\"uk-table uk-table-striped\"> <thead> <tr> <th if=\"{sortable}\" width=\"20\"></th> <th each=\"{col in cols}\">{col.name == undefined ? col : col.label === undefined ? col.name : col.label}</th> <th width=\"70\"></th> </tr> </thead> <tbody id=\"list\"> <tr each=\"{row in data}\"> <td if=\"{sortable}\"><i class=\"fas fa-grip-vertical handle\"></i></td> <td each=\"{col in cols}\" class=\"{col.class}\"> <virtual if=\"{col.toggle == true}\"> <virtual if=\"{col.tr == true}\"><a onclick=\"{toggleField}\" data-key=\"{row._key}\">{col.values ? col.values[row[col.name][locale]] : _.get(row,col.name)[locale]}</a></virtual> <virtual if=\"{col.tr != true}\"><a onclick=\"{toggleField}\" data-key=\"{row._key}\">{col.values ? col.values[row[col.name]] : _.get(row,col.name)}</a></virtual> </virtual> <virtual if=\"{col.toggle != true}\"> <virtual if=\"{col.type == image}\"> <img riot-src=\"{_.get(row,col.name)[locale]} \" style=\"height:25px\"> </virtual> <virtual if=\"{col.type != image}\"> {calc_value(row, col, locale)} </virtual> </virtual> </td> <td class=\"uk-text-center\" width=\"110\"> <a onclick=\"{edit}\" class=\"uk-button uk-button-primary uk-button-small\"><i class=\"fas fa-edit\"></i></a> <a onclick=\"{destroy_object}\" class=\"uk-button uk-button-danger uk-button-small\"><i class=\"fas fa-trash-alt\"></i></a> </td> </tr> </tbody> </table> <ul class=\"uk-pagination\"> <li if=\"{page > 0}\"><a onclick=\"{previouspage}\"><span class=\"uk-margin-small-right\" uk-pagination-previous></span> Previous</a></li> <li if=\"{(page + 1) * perpage < count}\" class=\"uk-margin-auto-left\"><a onclick=\"{nextpage}\">Next <span class=\"uk-margin-small-left\" uk-pagination-next></span></a></li> </ul> Per page : {perpage > 100000 ? \\'ALL\\' : perpage} <a onclick=\"{setperpage}\" class=\"uk-label\">25</a> <a onclick=\"{setperpage}\" class=\"uk-label\">50</a> <a onclick=\"{setperpage}\" class=\"uk-label\">100</a> <a onclick=\"{setperpage}\" class=\"uk-label\">500</a> <a onclick=\"{setperpage}\" class=\"uk-label\">1000</a> <a onclick=\"{setperpage}\" class=\"uk-label\">ALL</a> </virtual> <virtual if=\"{!can_access && loaded}\"> Sorry, you can\\'t access this datatype... </virtual>', 'datatypes .handle,[data-is=\"datatypes\"] .handle{ cursor: move; }', '', function(opts) {\n\n    var self        = this\n    this.page       = 0\n    this.perpage    = per_page\n    this.locale     = window.localStorage.getItem('foxx-locale')\n    this.data       = []\n    this.export     = false\n    this.can_access = false\n    this.sortable   = false\n    this.loaded     = false\n    this.folder     = {}\n    this.folder_key = this.opts.folder_key || ''\n    this.act_as_tree = true\n\n    this.loaddatatype = function(datatypeIndex) {\n      self.loaded = false\n      var querystring = \"?folder=\" + self.folder._key + \"&is_root=\" + self.folder.is_root\n      common.get(url + \"/cruds/datatypes/page/\"+datatypeIndex+\"/\"+this.perpage + querystring, function(d) {\n        self.data = d.data[0].data\n        self.export = !!d.model.export\n        self.cols = _.map(common.array_diff(common.keys(self.data[0]), [\"_id\", \"_key\", \"_rev\"]), function(v) { return { name: v }})\n        if(d.model.columns) self.cols = d.model.columns\n        self.count = d.data[0].count\n        self.sortable = !!d.model.sortable\n        common.get(url + \"/auth/whoami\", function(me) {\n          self.loaded = true\n          self.can_access = d.model.roles === undefined || _.includes(d.model.roles.read, me.role)\n          self.update()\n        })\n      })\n    }\n\n    this.setFolder = function(folder) {\n      self.folder = folder\n      self.act_as_tree = folder !== ''\n      self.loaddatatype(1)\n    }\n\n    this.calc_value = function(row, col, locale) {\n      value = _.get(row, col.name)\n      if(col.tr) { value = value[locale] }\n      if(col.truncate) { value = value.substring(0,col.truncate) }\n      if(col.capitalize) { value = _.capitalize(value) }\n      if(col.uppercase) { value = _.toUpper(value) }\n      if(col.downcase) { value = _.toLower(value) }\n      return value\n    }.bind(this)\n\n    this.filter = function(e) {\n      e.preventDefault();\n      if(self.refs.term.value != \"\") {\n        $(\".uk-form-icon i\").attr(\"class\", \"uk-icon-spin uk-icon-spinner\")\n        common.get(url + \"/cruds/datatypes/search/\"+self.refs.term.value, function(d) {\n          self.data = d.data\n          $(\".uk-form-icon i\").attr(\"class\", \"uk-icon-search\")\n          self.update()\n        })\n      }\n      else {\n        self.loaddatatype(1)\n      }\n    }.bind(this)\n\n    this.edit = function(e) {\n      route(\"/datatypes/\" + e.item.row._key + \"/edit\")\n    }.bind(this)\n\n    this.nextpage = function(e) {\n      self.page += 1\n      self.loaddatatype(self.page + 1)\n    }.bind(this)\n\n    this.previouspage = function(e) {\n      self.page -= 1\n      self.loaddatatype(self.page + 1)\n    }.bind(this)\n\n    this.destroy_object = function(e) {\n      UIkit.modal.confirm(\"Are you sure?\").then(function() {\n        common.delete(url + \"/cruds/datatypes/\" + e.item.row._key, function() {\n          self.loaddatatype(self.page + 1)\n        })\n      }, function() {})\n    }.bind(this)\n\n    this.toggleField = function(e) {\n      e.preventDefault()\n      common.patch(url + \"/cruds/datatypes/\" + e.target.dataset.key + \"/\" + e.item.col.name + \"/toggle\", \"{}\", function(data) {\n        if(data.success) {\n          e.target.innerText = data.data\n        }\n      })\n    }.bind(this)\n\n    this.setperpage = function(e) {\n      e.preventDefault()\n      var perpage = parseInt(e.srcElement.innerText)\n      if(e.srcElement.innerText == 'ALL') perpage = 1000000000;\n      this.perpage = perpage\n      this.loaddatatype(1)\n    }.bind(this)\n\n    this.export_data = function(e) {\n      common.get(url + '/cruds/datatypes/export', function(d) {\n        var csvContent = d.data\n        var encodedUri = encodeURI(csvContent)\n        var link = document.createElement(\"a\")\n        link.setAttribute(\"href\", encodedUri)\n        link.setAttribute(\"download\", \"datatypes.csv\")\n        link.innerHTML= \"Click Here to download\"\n        document.body.appendChild(link)\n        link.click()\n        document.body.removeChild(link)\n      })\n    }.bind(this)\n\n    this.on('updated', function() {\n      if(self.sortable) {\n        var el = document.getElementById('list');\n        var sortable = new Sortable(el, {\n          animation: 150,\n          ghostClass: 'blue-background-class',\n          handle: '.fa-grip-vertical',\n          onSort: function ( evt) {\n            var folder_key = \"?folder_key=\" + self.folder._key\n            if(!self.act_as_tree) folder_key = ''\n            common.put(\n              url + 'cruds/datatypes/orders/' + evt.oldIndex + \"/\" + evt.newIndex + folder_key, {},\n              function() {}\n            )\n          },\n        });\n      }\n    })\n});\n\n\nriot.tag2('dataset_helper', '<hr> <h4>Data definition sample</h4> <pre><code class=\"json\">\\\\{\\n    \"model\": [\\n      \\\\{ \"r\": true, \"c\": \"1-1\", \"n\": \"title\", \"t\": \"string\", \"j\": \"joi.string().required()\", \"l\": \"Title\", \"tr\": true \\\\},\\n      \\\\{ \"r\": true, \"c\": \"1-1\", \"n\": \"color\", \"t\": \"string:color\", \"j\": \"joi.string().required()\", \"l\": \"Pick a color\"\\\\},\\n      \\\\{ \"r\": true, \"c\": \"1-1\", \"n\": \"position\", \"t\": \"integer\", \"j\": \"joi.number().integer()\", \"l\": \"Position\" \\\\},\\n      \\\\{ \"r\": true, \"c\": \"1-1\", \"n\": \"online\", \"t\": \"boolean\", \"j\": \"joi.number().integer()\", \"l\": \"Online?\" \\\\},\\n      \\\\{ \"r\": true, \"c\": \"1-1\", \"n\": \"published_at\", \"t\": \"date\", \"j\": \"joi.date().format(\\'YYYY-MM-DD\\').raw().required()\", \"l\": \"Published_at\" \\\\},\\n      \\\\{ \"r\": true, \"c\": \"1-1\", \"n\": \"time\", \"t\": \"time\", \"j\": \"joi.string()\", \"l\": \"Time\" \\\\},\\n      \\\\{ \"r\": true, \"c\": \"1-1\", \"n\": \"desc\", \"t\": \"text\", \"j\": \"joi.string()\", \"l\": \"Description\" \\\\},\\n      \\\\{\\n        \"r\": true, \"c\": \"1-1\", \"n\": \"author_key\", \"t\": \"list\", \"j\": \"joi.string()\", \"l\": \"User\",\\n        \"d\": \"d\": \"FOR doc IN datasets FILTER doc.type == \\'authors\\' RETURN [doc._key, CONCAT(doc.ln, \\' \\', doc.fn)]\"\\n      \\\\},\\n      \\\\{ \"r\": true, \"c\": \"1-1\", \"n\": \"image\", \"t\": \"image\", \"j\": \"joi.string()\", \"l\": \"Pictures\" \\\\},\\n      \\\\{ \"r\": true, \"c\": \"1-1\", \"n\": \"file\", \"t\": \"file\", \"j\": \"joi.string()\", \"l\": \"Files\" \\\\},\\n      \\\\{\\n        \"r\": true, \"c\": \"1-1\", \"n\": \"tags\", \"t\": \"tags\", \"j\": \"joi.array()\", \"l\": \"Tags\",\\n        \"d\": \"LET tags = (FOR doc IN datasets FILTER doc.type==\\'books\\' AND doc.tags != NULL RETURN doc.tags) RETURN UNIQUE(FLATTEN(tags))\"\\n      \\\\},\\n      \\\\{ \"r\": true, \"c\": \"1-1\", \"n\": \"items\", \"t\": \"multilist\", \"j\": \"joi.array()\", \"l\": \"Multi List of tags\", \"d\": \"AQL request\" \\\\},\\n      \\\\{ \"r\": true, \"c\": \"1-1\", \"n\": \"position\", \"t\": \"map\", \"j\": \"joi.array()\", \"l\": \"Coordinates\" \\\\},\\n      \\\\{ \"r\": true, \"c\": \"1-1\", \"n\": \"html\", \"t\": \"code:html\", \"j\": \"joi.any()\", \"l\": \"Some HTML\" \\\\},\\n      \\\\{ \"r\": true, \"c\": \"1-1\", \"n\": \"scss\", \"t\": \"code:scss\", \"j\": \"joi.any()\", \"l\": \"Some SCSS\" \\\\},\\n      \\\\{ \"r\": true, \"c\": \"1-1\", \"n\": \"javascript\", \"t\": \"code:javascript\", \"j\": \"joi.any()\", \"l\": \"Some JS\" \\\\},\\n      \\\\{ \"r\": true, \"c\": \"1-1\", \"n\": \"json\", \"t\": \"code:json\", \"j\": \"joi.any()\", \"l\": \"Some Json\" \\\\},\\n      \\\\{ \"r\": true, \"c\": \"1-1\", \"n\": \"content\", \"t\": \"html\", \"j\": \"joi.any()\", \"l\": \"Content Editor\" \\\\}\\n      \\\\{ \"r\": true, \"c\": \"1-1\", \"n\": \"html_content\", \"t\": \"wysiwyg\", \"j\": \"joi.any()\", \"l\": \"Wysiwyg editor\" \\\\}\\n    ],\\n    \"columns\": [\\n      \\\\{ \"name\": \"title\", \"tr\": true, \"class\": \"uk-text-right\", \"toggle\": true,\\n        \"values\": \\\\{ \"true\": \"online\", \"false\": \"offline\" \\\\},\\n        \"truncate\": 20, \"uppercase\": true, \"lowercase\": true\\n      \\\\}\\n    ],\\n    \"act_as_tree\": true,\\n    \"sortable\": true,\\n    \"revisions\": 10,\\n    \"publishable\": true,\\n    \"slug\": [\"title\"],\\n    \"sort\": \"SORT doc.order ASC\",\\n    \"search\": [\"title\", \"barcode\", \"desc\"],\\n    \"includes\": \\\\{\\n      \"conditions\": \"FOR c IN customers FILTER c._key == doc.customer_key\",\\n      \"merges\": \", customer: c \"\\n    \\\\},\\n    \"timestamps\": true\\n  \\\\}\\n  </code></pre>', 'dataset_helper pre { padding: 0; border: none; border-radius: 4px; }', '', function(opts) {\n});","riot.tag2('helper_crud_index', '<a href=\"#\" class=\"uk-button uk-button-small uk-button-default\" onclick=\"{new_item}\"> <i class=\"fas fa-plus\"></i> New {opts.singular} </a> <table class=\"uk-table uk-table-striped\" if=\"{data.length > 0}\"> <thead> <tr> <th each=\"{col in cols}\"> {col.name == undefined ? col : col.label === undefined ? col.name : col.label} </th> <th width=\"70\"></th> </tr> </thead> <tbody> <tr each=\"{row in data}\"> <td each=\"{col in cols}\" class=\"{col.class}\"> <virtual if=\"{col.tr == true}\">{_.get(row,col.name)[locale]}</virtual> <virtual if=\"{col.tr != true}\">{_.get(row,col.name)}</virtual> </td> <td class=\"uk-text-center\" width=\"110\"> <a onclick=\"{edit}\" class=\"uk-button uk-button-primary uk-button-small\"><i class=\"fas fa-edit\"></i></a> <a onclick=\"{destroy_object}\" class=\"uk-button uk-button-danger uk-button-small\"><i class=\"fas fa-trash-alt\"></i></a> </td> </tr> </tbody> </table> <ul class=\"uk-pagination\"> <li if=\"{page > 0}\"><a onclick=\"{previousPage}\"><span class=\"uk-margin-small-right\" uk-pagination-previous></span> Previous</a></li> <li if=\"{(page + 1) * perpage < count}\" class=\"uk-margin-auto-left\"><a onclick=\"{nextPage}\">Next <span class=\"uk-margin-small-left\" uk-pagination-next></span></a></li> </ul>', '', '', function(opts) {\n    var self = this\n    this.data = []\n    this.new_item = function(e) {\n      e.preventDefault()\n      riot.mount(\"#\"+opts.id, \"helper_crud_new\", opts)\n    }.bind(this)\n\n    this.loadPage = function(pageIndex) {\n      common.get(url + \"/cruds/sub/\"+opts.parent_id+\"/\"+opts.id+\"/\"+opts.key+\"/page/\"+pageIndex+\"/\"+per_page, function(d) {\n        self.data = d.data[0].data\n        self.cols = _.map(common.array_diff(common.keys(self.data[0]), [\"_id\", \"_key\", \"_rev\"]), function(v) { return { name: v }})\n        if(opts.columns) self.cols = opts.columns\n        self.count = d.data[0].count\n        self.update()\n      })\n    }\n    this.loadPage(1)\n\n    this.edit = function(e) {\n      e.preventDefault()\n      opts.element_id = e.item.row._key\n      riot.mount(\"#\"+opts.id, \"helper_crud_edit\", opts)\n    }.bind(this)\n\n    this.nextPage = function(e) {\n      e.preventDefault()\n      self.page += 1\n      self.loadPage(self.page + 1)\n    }.bind(this)\n\n    this.previousPage = function(e) {\n      e.preventDefault()\n      self.page -= 1\n      self.loadPage(self.page + 1)\n    }.bind(this)\n\n    this.destroy_object = function(e) {\n      e.preventDefault()\n      UIkit.modal.confirm(\"Are you sure?\").then(function() {\n        common.delete(url + \"/cruds/\" + opts.id + \"/\" + e.item.row._key, function() {\n          self.loadPage(1)\n        })\n      }, function() {})\n    }.bind(this)\n});\n\nriot.tag2('helper_crud_edit', '<a href=\"#\" class=\"uk-button uk-button-link\" onclick=\"{goback}\">Back to {opts.id}</a> <form onsubmit=\"{save_form}\" class=\"uk-form\" id=\"{opts.id}_crud_helper\"> </form>', '', '', function(opts) {\n    this.goback = function(e) {\n      e.preventDefault()\n      riot.mount(\"#\"+opts.id, \"helper_crud_index\", opts)\n    }.bind(this)\n\n    this.save_form = function(e) {\n      e.preventDefault()\n      common.saveForm(opts.id+'_crud_helper', \"cruds/sub/\"+opts.parent_name+\"/\"+ opts.id+\"/\"+opts.element_id, \"\", opts)\n    }.bind(this)\n\n    var self = this;\n    common.get(url + \"/cruds/\" + opts.id + \"/\" + opts.element_id, function(d) {\n      self.helper = d.data\n\n      common.buildForm(self.helper, opts.fields, '#'+opts.id+'_crud_helper')\n    })\n    this.on('updated', function() {\n      $(\".select_list\").select2()\n      $(\".select_mlist\").select2()\n      $(\".select_tag\").select2({ tags: true })\n    })\n});\n\nriot.tag2('helper_crud_new', '<a href=\"#\" class=\"uk-button uk-button-link\" onclick=\"{goback}\">Back to {opts.id}</a> <form onsubmit=\"{save_form}\" class=\"uk-form\" id=\"{opts.id}_crud_helper\"> </form>', '', '', function(opts) {\n    var self = this\n    this.crud = {}\n    this.crud[opts.key] = opts.parent_id\n\n    this.goback = function(e) {\n      e.preventDefault()\n      riot.mount(\"#\"+opts.id, \"helper_crud_index\", opts)\n    }.bind(this)\n\n    this.on('mount', function() {\n      common.buildForm(self.crud, opts.fields, '#'+opts.id+'_crud_helper')\n    })\n\n    this.save_form = function(e) {\n      e.preventDefault()\n      common.saveForm(opts.id+'_crud_helper', \"cruds/sub/helpers/\"+ opts.id, \"\", opts)\n    }.bind(this)\n\n});\n\nriot.tag2('helper_edit', '<virtual if=\"{can_access}\"> <div uk-alert class=\"uk-alert-warning\" if=\"{locked_by}\"> <i class=\"fas fa-lock\"></i> This file is locked by {locked_by} </div> <ul uk-tab> <li><a href=\"#\">helpers</a></li> <li each=\"{i, k in sub_models}\"><a href=\"#\">{k}</a></li> </ul> <ul class=\"uk-switcher uk-margin\"> <li> <h3>Editing helper</h3> <form onsubmit=\"{save_form}\" class=\"uk-form\" id=\"form_helper\"> </form> <a class=\"uk-button uk-button-secondary\" onclick=\"{duplicate}\">Duplicate</a> </li> <li each=\"{i, k in sub_models}\"> <div id=\"{k}\" class=\"crud\"></div> </li> </ul> </virtual> <virtual if=\"{!can_access && loaded}\"> Sorry, you can\\'t access this page... </virtual> <script>', '', '', function(opts) {\n    var self = this\n    self.can_access = false\n    self.loaded = false\n    self.locked_by = null\n\n    this.save_form = function(e) {\n      e.preventDefault()\n      common.saveForm(\"form_helper\", \"cruds/helpers\",opts.helper_id)\n    }.bind(this)\n\n    this.duplicate = function(e) {\n      UIkit.modal.confirm(\"Are you sure?\").then(function() {\n        common.get(url + \"/cruds/helpers/\" + self.helper._key + \"/duplicate\", function(data) {\n          route('/helpers/' + data._key + '/edit')\n          UIkit.notification({\n            message : 'Successfully duplicated!',\n            status  : 'success',\n            timeout : 1000,\n            pos     : 'bottom-right'\n          });\n        })\n      }, function() {})\n    }.bind(this)\n\n    common.get(url + \"/cruds/helpers/\" + opts.helper_id, function(d) {\n      self.helper = d.data\n      self.locked_by = d.data.locked_by\n      self.fields = d.fields\n      self.sub_models = d.fields.sub_models\n      var fields = d.fields\n\n      if(!_.isArray(fields)) fields = fields.model\n      common.get(url + \"/auth/whoami\", function(me) {\n        self.can_access = d.fields.roles === undefined || _.includes(d.fields.roles.write, me.role)\n        self.loaded = true\n        self.update()\n        if(self.can_access)\n          common.buildForm(self.helper, fields, '#form_helper', 'helpers', function() {\n            $(\".crud\").each(function(i, c) {\n            var id = $(c).attr(\"id\")\n            riot.mount(\"#\" + id, \"helper_crud_index\", { model: id,\n              fields: self.sub_models[id].fields,\n              key: self.sub_models[id].key,\n              singular: self.sub_models[id].singular,\n              columns: self.sub_models[id].columns,\n              parent_id: opts.helper_id,\n              parent_name: \"helpers\" })\n          })\n        })\n      })\n    })\n\n    this.on('updated', function() {\n      $(\".select_list\").select2()\n      $(\".select_mlist\").select2()\n      $(\".select_tag\").select2({ tags: true })\n    })\n});\n\nriot.tag2('helper_new', '<virtual if=\"{can_access}\"> <h3>Creating helper</h3> <form onsubmit=\"{save_form}\" class=\"uk-form\" id=\"form_new_helper\"> </form> </virtual> <virtual if=\"{!can_access && loaded}\"> Sorry, you can\\'t access this page... </virtual>', '', '', function(opts) {\n    var self = this\n    self.can_access = false\n    self.loaded = false\n\n    this.save_form = function(e) {\n      e.preventDefault()\n      common.saveForm(\"form_new_helper\", \"cruds/helpers\")\n    }.bind(this)\n\n    common.get(url + \"/cruds/helpers/fields\", function(d) {\n      common.get(url + \"/auth/whoami\", function(me) {\n        self.can_access = d.fields.roles === undefined || _.includes(d.fields.roles.write, me.role)\n        self.loaded = true\n        self.update()\n        if(self.can_access) {\n\n          var fields = d.fields\n          if(!_.isArray(fields)) fields = fields.model\n          common.buildForm({}, fields, '#form_new_helper', 'helpers');\n        }\n      })\n    })\n\n    this.on('updated', function() {\n      $(\".select_list\").select2()\n      $(\".select_mlist\").select2()\n      $(\".select_tag\").select2({ tags: true })\n    })\n});\n\nriot.tag2('helpers', '<virtual if=\"{can_access}\"> <div class=\"uk-float-right\"> <a href=\"#helpers/new\" class=\"uk-button uk-button-small uk-button-default\"><i class=\"fas fa-plus\"></i> New helper</a> <a if=\"{export}\" onclick=\"{export_data}\" class=\"uk-button uk-button-small uk-button-primary\"><i class=\"fas fa-file-export\"></i> Export CSV</a> </div> <h3>Listing helpers</h3> <form onsubmit=\"{filter}\" class=\"uk-margin-top\"> <div class=\"uk-inline uk-width-1-1\"> <span class=\"uk-form-icon\" uk-icon=\"icon: search\"></span> <input type=\"text\" ref=\"term\" id=\"term\" class=\"uk-input\" autocomplete=\"off\"> </div> </form> <table class=\"uk-table uk-table-striped\"> <thead> <tr> <th if=\"{sortable}\" width=\"20\"></th> <th each=\"{col in cols}\">{col.name == undefined ? col : col.label === undefined ? col.name : col.label}</th> <th width=\"70\"></th> </tr> </thead> <tbody id=\"list\"> <tr each=\"{row in data}\"> <td if=\"{sortable}\"><i class=\"fas fa-grip-vertical handle\"></i></td> <td each=\"{col in cols}\" class=\"{col.class}\"> <virtual if=\"{col.toggle == true}\"> <virtual if=\"{col.tr == true}\"><a onclick=\"{toggleField}\" data-key=\"{row._key}\">{col.values ? col.values[row[col.name][locale]] : _.get(row,col.name)[locale]}</a></virtual> <virtual if=\"{col.tr != true}\"><a onclick=\"{toggleField}\" data-key=\"{row._key}\">{col.values ? col.values[row[col.name]] : _.get(row,col.name)}</a></virtual> </virtual> <virtual if=\"{col.toggle != true}\"> <virtual if=\"{col.type == image}\"> <img riot-src=\"{_.get(row,col.name)[locale]} \" style=\"height:25px\"> </virtual> <virtual if=\"{col.type != image}\"> {calc_value(row, col, locale)} </virtual> </virtual> </td> <td class=\"uk-text-center\" width=\"110\"> <a onclick=\"{edit}\" class=\"uk-button uk-button-primary uk-button-small\"><i class=\"fas fa-edit\"></i></a> <a onclick=\"{destroy_object}\" class=\"uk-button uk-button-danger uk-button-small\"><i class=\"fas fa-trash-alt\"></i></a> </td> </tr> </tbody> </table> <ul class=\"uk-pagination\"> <li if=\"{page > 0}\"><a onclick=\"{previousPage}\"><span class=\"uk-margin-small-right\" uk-pagination-previous></span> Previous</a></li> <li if=\"{(page + 1) * perpage < count}\" class=\"uk-margin-auto-left\"><a onclick=\"{nextPage}\">Next <span class=\"uk-margin-small-left\" uk-pagination-next></span></a></li> </ul> Per Page : {perpage > 100000 ? \\'ALL\\' : perpage} <a onclick=\"{setPerPage}\" class=\"uk-label\">25</a> <a onclick=\"{setPerPage}\" class=\"uk-label\">50</a> <a onclick=\"{setPerPage}\" class=\"uk-label\">100</a> <a onclick=\"{setPerPage}\" class=\"uk-label\">500</a> <a onclick=\"{setPerPage}\" class=\"uk-label\">1000</a> <a onclick=\"{setPerPage}\" class=\"uk-label\">ALL</a> </virtual> <virtual if=\"{!can_access && loaded}\"> Sorry, you can\\'t access this page... </virtual>', 'helpers .handle,[data-is=\"helpers\"] .handle{ cursor: move; }', '', function(opts) {\n\n    var self        = this\n    this.page       = 0\n    this.perpage    = per_page\n    this.locale     = window.localStorage.getItem('foxx-locale')\n    this.data       = []\n    this.export     = false\n    this.can_access = false\n    this.sortable   = false\n    this.loaded     = false\n\n    this.loadPage = function(pageIndex) {\n      self.loaded = false\n      common.get(url + \"/cruds/helpers/page/\"+pageIndex+\"/\"+this.perpage, function(d) {\n        self.data = d.data[0].data\n        self.export = !!d.model.export\n        self.cols = _.map(common.array_diff(common.keys(self.data[0]), [\"_id\", \"_key\", \"_rev\"]), function(v) { return { name: v }})\n        if(d.model.columns) self.cols = d.model.columns\n        self.count = d.data[0].count\n        self.sortable = !!d.model.sortable\n        common.get(url + \"/auth/whoami\", function(me) {\n          self.loaded = true\n          self.can_access = d.model.roles === undefined || _.includes(d.model.roles.read, me.role)\n          self.update()\n        })\n      })\n    }\n    this.loadPage(1)\n\n    this.calc_value = function(row, col, locale) {\n      value = _.get(row, col.name)\n      if(col.tr) { value = value[locale] }\n      if(col.truncate) { value = value.substring(0,col.truncate) }\n      if(col.capitalize) { value = _.capitalize(value) }\n      if(col.uppercase) { value = _.toUpper(value) }\n      if(col.downcase) { value = _.toLower(value) }\n      return value\n    }.bind(this)\n\n    this.filter = function(e) {\n      e.preventDefault();\n      if(self.refs.term.value != \"\") {\n        $(\".uk-form-icon i\").attr(\"class\", \"uk-icon-spin uk-icon-spinner\")\n        common.get(url + \"/cruds/helpers/search/\"+self.refs.term.value, function(d) {\n          self.data = d.data\n          $(\".uk-form-icon i\").attr(\"class\", \"uk-icon-search\")\n          self.update()\n        })\n      }\n      else {\n        self.loadPage(1)\n      }\n    }.bind(this)\n\n    this.edit = function(e) {\n      route(\"/helpers/\" + e.item.row._key + \"/edit\")\n    }.bind(this)\n\n    this.nextPage = function(e) {\n      self.page += 1\n      self.loadPage(self.page + 1)\n    }.bind(this)\n\n    this.previousPage = function(e) {\n      self.page -= 1\n      self.loadPage(self.page + 1)\n    }.bind(this)\n\n    this.destroy_object = function(e) {\n      UIkit.modal.confirm(\"Are you sure?\").then(function() {\n        common.delete(url + \"/cruds/helpers/\" + e.item.row._key, function() {\n          self.loadPage(self.page + 1)\n        })\n      }, function() {})\n    }.bind(this)\n\n    this.toggleField = function(e) {\n      e.preventDefault()\n      common.patch(url + \"/cruds/helpers/\" + e.target.dataset.key + \"/\" + e.item.col.name + \"/toggle\", \"{}\", function(data) {\n        if(data.success) {\n          e.target.innerText = data.data\n        }\n      })\n    }.bind(this)\n\n    this.setPerPage = function(e) {\n      e.preventDefault()\n      var perpage = parseInt(e.srcElement.innerText)\n      if(e.srcElement.innerText == 'ALL') perpage = 1000000000;\n      this.perpage = perpage\n      this.loadPage(1)\n    }.bind(this)\n\n    this.export_data = function(e) {\n      common.get(url + '/cruds/helpers/export', function(d) {\n        var csvContent = d.data\n        var encodedUri = encodeURI(csvContent)\n        var link = document.createElement(\"a\")\n        link.setAttribute(\"href\", encodedUri)\n        link.setAttribute(\"download\", \"helpers.csv\")\n        link.innerHTML= \"Click Here to download\"\n        document.body.appendChild(link)\n        link.click()\n        document.body.removeChild(link)\n      })\n    }.bind(this)\n\n    this.on('updated', function() {\n      if(self.sortable) {\n        var el = document.getElementById('list');\n        var sortable = new Sortable(el, {\n          animation: 150,\n          ghostClass: 'blue-background-class',\n          handle: '.fa-grip-vertical',\n          onSort: function ( evt) {\n            common.put(\n              url + 'cruds/helpers/orders/' + evt.oldIndex + \"/\" + evt.newIndex, {},\n              function() {}\n            )\n          },\n        });\n      }\n    })\n});\n\n","riot.tag2('layout_crud_index', '<a href=\"#\" class=\"uk-button uk-button-small uk-button-default\" onclick=\"{new_item}\"> <i class=\"fas fa-plus\"></i> New {opts.singular} </a> <table class=\"uk-table uk-table-striped\" if=\"{data.length > 0}\"> <thead> <tr> <th each=\"{col in cols}\"> {col.name == undefined ? col : col.label === undefined ? col.name : col.label} </th> <th width=\"70\"></th> </tr> </thead> <tbody> <tr each=\"{row in data}\"> <td each=\"{col in cols}\" class=\"{col.class}\"> <virtual if=\"{col.tr == true}\">{_.get(row,col.name)[locale]}</virtual> <virtual if=\"{col.tr != true}\">{_.get(row,col.name)}</virtual> </td> <td class=\"uk-text-center\" width=\"110\"> <a onclick=\"{edit}\" class=\"uk-button uk-button-primary uk-button-small\"><i class=\"fas fa-edit\"></i></a> <a onclick=\"{destroy_object}\" class=\"uk-button uk-button-danger uk-button-small\"><i class=\"fas fa-trash-alt\"></i></a> </td> </tr> </tbody> </table> <ul class=\"uk-pagination\"> <li if=\"{page > 0}\"><a onclick=\"{previousPage}\"><span class=\"uk-margin-small-right\" uk-pagination-previous></span> Previous</a></li> <li if=\"{(page + 1) * perpage < count}\" class=\"uk-margin-auto-left\"><a onclick=\"{nextPage}\">Next <span class=\"uk-margin-small-left\" uk-pagination-next></span></a></li> </ul>', '', '', function(opts) {\n    var self = this\n    this.data = []\n    this.new_item = function(e) {\n      e.preventDefault()\n      riot.mount(\"#\"+opts.id, \"layout_crud_new\", opts)\n    }.bind(this)\n\n    this.loadPage = function(pageIndex) {\n      common.get(url + \"/cruds/sub/\"+opts.parent_id+\"/\"+opts.id+\"/\"+opts.key+\"/page/\"+pageIndex+\"/\"+per_page, function(d) {\n        self.data = d.data[0].data\n        self.cols = _.map(common.array_diff(common.keys(self.data[0]), [\"_id\", \"_key\", \"_rev\"]), function(v) { return { name: v }})\n        if(opts.columns) self.cols = opts.columns\n        self.count = d.data[0].count\n        self.update()\n      })\n    }\n    this.loadPage(1)\n\n    this.edit = function(e) {\n      e.preventDefault()\n      opts.element_id = e.item.row._key\n      riot.mount(\"#\"+opts.id, \"layout_crud_edit\", opts)\n    }.bind(this)\n\n    this.nextPage = function(e) {\n      e.preventDefault()\n      self.page += 1\n      self.loadPage(self.page + 1)\n    }.bind(this)\n\n    this.previousPage = function(e) {\n      e.preventDefault()\n      self.page -= 1\n      self.loadPage(self.page + 1)\n    }.bind(this)\n\n    this.destroy_object = function(e) {\n      e.preventDefault()\n      UIkit.modal.confirm(\"Are you sure?\").then(function() {\n        common.delete(url + \"/cruds/\" + opts.id + \"/\" + e.item.row._key, function() {\n          self.loadPage(1)\n        })\n      }, function() {})\n    }.bind(this)\n});\n\nriot.tag2('layout_crud_edit', '<a href=\"#\" class=\"uk-button uk-button-link\" onclick=\"{goback}\">Back to {opts.id}</a> <form onsubmit=\"{save_form}\" class=\"uk-form\" id=\"{opts.id}_crud_layout\"> </form>', '', '', function(opts) {\n    this.goback = function(e) {\n      e.preventDefault()\n      riot.mount(\"#\"+opts.id, \"layout_crud_index\", opts)\n    }.bind(this)\n\n    this.save_form = function(e) {\n      e.preventDefault()\n      common.saveForm(opts.id+'_crud_layout', \"cruds/sub/\"+opts.parent_name+\"/\"+ opts.id+\"/\"+opts.element_id, \"\", opts)\n    }.bind(this)\n\n    var self = this;\n    common.get(url + \"/cruds/\" + opts.id + \"/\" + opts.element_id, function(d) {\n      self.layout = d.data\n\n      common.buildForm(self.layout, opts.fields, '#'+opts.id+'_crud_layout')\n    })\n    this.on('updated', function() {\n      $(\".select_list\").select2()\n      $(\".select_mlist\").select2()\n      $(\".select_tag\").select2({ tags: true })\n    })\n});\n\nriot.tag2('layout_crud_new', '<a href=\"#\" class=\"uk-button uk-button-link\" onclick=\"{goback}\">Back to {opts.id}</a> <form onsubmit=\"{save_form}\" class=\"uk-form\" id=\"{opts.id}_crud_layout\"> </form>', '', '', function(opts) {\n    var self = this\n    this.crud = {}\n    this.crud[opts.key] = opts.parent_id\n\n    this.goback = function(e) {\n      e.preventDefault()\n      riot.mount(\"#\"+opts.id, \"layout_crud_index\", opts)\n    }.bind(this)\n\n    this.on('mount', function() {\n      common.buildForm(self.crud, opts.fields, '#'+opts.id+'_crud_layout')\n    })\n\n    this.save_form = function(e) {\n      e.preventDefault()\n      common.saveForm(opts.id+'_crud_layout', \"cruds/sub/layouts/\"+ opts.id, \"\", opts)\n    }.bind(this)\n\n});\n\nriot.tag2('layout_edit', '<virtual if=\"{can_access}\"> <div uk-alert class=\"uk-alert-warning\" if=\"{locked_by}\"> <i class=\"fas fa-lock\"></i> This file is locked by {locked_by} </div> <ul uk-tab> <li><a href=\"#\">layouts</a></li> <li each=\"{i, k in sub_models}\"><a href=\"#\">{k}</a></li> </ul> <ul class=\"uk-switcher uk-margin\"> <li> <h3>Editing layout</h3> <form onsubmit=\"{save_form}\" class=\"uk-form\" id=\"form_layout\"> </form> <a class=\"uk-button uk-button-secondary\" onclick=\"{duplicate}\">Duplicate</a> </li> <li each=\"{i, k in sub_models}\"> <div id=\"{k}\" class=\"crud\"></div> </li> </ul> </virtual> <virtual if=\"{!can_access && loaded}\"> Sorry, you can\\'t access this page... </virtual> <script>', '', '', function(opts) {\n    var self = this\n    self.can_access = false\n    self.loaded = false\n    self.locked_by = null\n\n    this.save_form = function(e) {\n      e.preventDefault()\n      common.saveForm(\"form_layout\", \"cruds/layouts\",opts.layout_id)\n    }.bind(this)\n\n    this.duplicate = function(e) {\n      UIkit.modal.confirm(\"Are you sure?\").then(function() {\n        common.get(url + \"/cruds/layouts/\" + self.layout._key + \"/duplicate\", function(data) {\n          route('/layouts/' + data._key + '/edit')\n          UIkit.notification({\n            message : 'Successfully duplicated!',\n            status  : 'success',\n            timeout : 1000,\n            pos     : 'bottom-right'\n          });\n        })\n      }, function() {})\n    }.bind(this)\n\n    common.get(url + \"/cruds/layouts/\" + opts.layout_id, function(d) {\n      self.layout = d.data\n      self.locked_by = d.data.locked_by\n      self.fields = d.fields\n      self.sub_models = d.fields.sub_models\n      var fields = d.fields\n\n      if(!_.isArray(fields)) fields = fields.model\n      common.get(url + \"/auth/whoami\", function(me) {\n        self.can_access = d.fields.roles === undefined || _.includes(d.fields.roles.write, me.role)\n        self.loaded = true\n        self.update()\n        if(self.can_access)\n          common.buildForm(self.layout, fields, '#form_layout', 'layouts', function() {\n            $(\".crud\").each(function(i, c) {\n            var id = $(c).attr(\"id\")\n            riot.mount(\"#\" + id, \"layout_crud_index\", { model: id,\n              fields: self.sub_models[id].fields,\n              key: self.sub_models[id].key,\n              singular: self.sub_models[id].singular,\n              columns: self.sub_models[id].columns,\n              parent_id: opts.layout_id,\n              parent_name: \"layouts\" })\n          })\n        })\n      })\n    })\n\n    this.on('updated', function() {\n      $(\".select_list\").select2()\n      $(\".select_mlist\").select2()\n      $(\".select_tag\").select2({ tags: true })\n    })\n});\n\nriot.tag2('layout_new', '<virtual if=\"{can_access}\"> <h3>Creating layout</h3> <form onsubmit=\"{save_form}\" class=\"uk-form\" id=\"form_new_layout\"> </form> </virtual> <virtual if=\"{!can_access && loaded}\"> Sorry, you can\\'t access this page... </virtual>', '', '', function(opts) {\n    var self = this\n    self.can_access = false\n    self.loaded = false\n\n    this.save_form = function(e) {\n      e.preventDefault()\n      common.saveForm(\"form_new_layout\", \"cruds/layouts\")\n    }.bind(this)\n\n    common.get(url + \"/cruds/layouts/fields\", function(d) {\n      common.get(url + \"/auth/whoami\", function(me) {\n        self.can_access = d.fields.roles === undefined || _.includes(d.fields.roles.write, me.role)\n        self.loaded = true\n        self.update()\n        if(self.can_access) {\n\n          var fields = d.fields\n          if(!_.isArray(fields)) fields = fields.model\n          common.buildForm({}, fields, '#form_new_layout', 'layouts');\n        }\n      })\n    })\n\n    this.on('updated', function() {\n      $(\".select_list\").select2()\n      $(\".select_mlist\").select2()\n      $(\".select_tag\").select2({ tags: true })\n    })\n});\n\nriot.tag2('layouts', '<virtual if=\"{can_access}\"> <div class=\"uk-float-right\"> <a href=\"#layouts/new\" class=\"uk-button uk-button-small uk-button-default\"><i class=\"fas fa-plus\"></i> New layout</a> <a if=\"{export}\" onclick=\"{export_data}\" class=\"uk-button uk-button-small uk-button-primary\"><i class=\"fas fa-file-export\"></i> Export CSV</a> </div> <h3>Listing layouts</h3> <form onsubmit=\"{filter}\" class=\"uk-margin-top\"> <div class=\"uk-inline uk-width-1-1\"> <span class=\"uk-form-icon\" uk-icon=\"icon: search\"></span> <input type=\"text\" ref=\"term\" id=\"term\" class=\"uk-input\" autocomplete=\"off\"> </div> </form> <table class=\"uk-table uk-table-striped\"> <thead> <tr> <th if=\"{sortable}\" width=\"20\"></th> <th each=\"{col in cols}\">{col.name == undefined ? col : col.label === undefined ? col.name : col.label}</th> <th width=\"70\"></th> </tr> </thead> <tbody id=\"list\"> <tr each=\"{row in data}\"> <td if=\"{sortable}\"><i class=\"fas fa-grip-vertical handle\"></i></td> <td each=\"{col in cols}\" class=\"{col.class}\"> <virtual if=\"{col.toggle == true}\"> <virtual if=\"{col.tr == true}\"><a onclick=\"{toggleField}\" data-key=\"{row._key}\">{col.values ? col.values[row[col.name][locale]] : _.get(row,col.name)[locale]}</a></virtual> <virtual if=\"{col.tr != true}\"><a onclick=\"{toggleField}\" data-key=\"{row._key}\">{col.values ? col.values[row[col.name]] : _.get(row,col.name)}</a></virtual> </virtual> <virtual if=\"{col.toggle != true}\"> <virtual if=\"{col.type == image}\"> <img riot-src=\"{_.get(row,col.name)[locale]} \" style=\"height:25px\"> </virtual> <virtual if=\"{col.type != image}\"> {calc_value(row, col, locale)} </virtual> </virtual> </td> <td class=\"uk-text-center\" width=\"110\"> <a onclick=\"{edit}\" class=\"uk-button uk-button-primary uk-button-small\"><i class=\"fas fa-edit\"></i></a> <a onclick=\"{destroy_object}\" class=\"uk-button uk-button-danger uk-button-small\"><i class=\"fas fa-trash-alt\"></i></a> </td> </tr> </tbody> </table> <ul class=\"uk-pagination\"> <li if=\"{page > 0}\"><a onclick=\"{previousPage}\"><span class=\"uk-margin-small-right\" uk-pagination-previous></span> Previous</a></li> <li if=\"{(page + 1) * perpage < count}\" class=\"uk-margin-auto-left\"><a onclick=\"{nextPage}\">Next <span class=\"uk-margin-small-left\" uk-pagination-next></span></a></li> </ul> Per Page : {perpage > 100000 ? \\'ALL\\' : perpage} <a onclick=\"{setPerPage}\" class=\"uk-label\">25</a> <a onclick=\"{setPerPage}\" class=\"uk-label\">50</a> <a onclick=\"{setPerPage}\" class=\"uk-label\">100</a> <a onclick=\"{setPerPage}\" class=\"uk-label\">500</a> <a onclick=\"{setPerPage}\" class=\"uk-label\">1000</a> <a onclick=\"{setPerPage}\" class=\"uk-label\">ALL</a> </virtual> <virtual if=\"{!can_access && loaded}\"> Sorry, you can\\'t access this page... </virtual>', 'layouts .handle,[data-is=\"layouts\"] .handle{ cursor: move; }', '', function(opts) {\n\n    var self        = this\n    this.page       = 0\n    this.perpage    = per_page\n    this.locale     = window.localStorage.getItem('foxx-locale')\n    this.data       = []\n    this.export     = false\n    this.can_access = false\n    this.sortable   = false\n    this.loaded     = false\n\n    this.loadPage = function(pageIndex) {\n      self.loaded = false\n      common.get(url + \"/cruds/layouts/page/\"+pageIndex+\"/\"+this.perpage, function(d) {\n        self.data = d.data[0].data\n        self.export = !!d.model.export\n        self.cols = _.map(common.array_diff(common.keys(self.data[0]), [\"_id\", \"_key\", \"_rev\"]), function(v) { return { name: v }})\n        if(d.model.columns) self.cols = d.model.columns\n        self.count = d.data[0].count\n        self.sortable = !!d.model.sortable\n        common.get(url + \"/auth/whoami\", function(me) {\n          self.loaded = true\n          self.can_access = d.model.roles === undefined || _.includes(d.model.roles.read, me.role)\n          self.update()\n        })\n      })\n    }\n    this.loadPage(1)\n\n    this.calc_value = function(row, col, locale) {\n      value = _.get(row, col.name)\n      if(col.tr) { value = value[locale] }\n      if(col.truncate) { value = value.substring(0,col.truncate) }\n      if(col.capitalize) { value = _.capitalize(value) }\n      if(col.uppercase) { value = _.toUpper(value) }\n      if(col.downcase) { value = _.toLower(value) }\n      return value\n    }.bind(this)\n\n    this.filter = function(e) {\n      e.preventDefault();\n      if(self.refs.term.value != \"\") {\n        $(\".uk-form-icon i\").attr(\"class\", \"uk-icon-spin uk-icon-spinner\")\n        common.get(url + \"/cruds/layouts/search/\"+self.refs.term.value, function(d) {\n          self.data = d.data\n          $(\".uk-form-icon i\").attr(\"class\", \"uk-icon-search\")\n          self.update()\n        })\n      }\n      else {\n        self.loadPage(1)\n      }\n    }.bind(this)\n\n    this.edit = function(e) {\n      route(\"/layouts/\" + e.item.row._key + \"/edit\")\n    }.bind(this)\n\n    this.nextPage = function(e) {\n      self.page += 1\n      self.loadPage(self.page + 1)\n    }.bind(this)\n\n    this.previousPage = function(e) {\n      self.page -= 1\n      self.loadPage(self.page + 1)\n    }.bind(this)\n\n    this.destroy_object = function(e) {\n      UIkit.modal.confirm(\"Are you sure?\").then(function() {\n        common.delete(url + \"/cruds/layouts/\" + e.item.row._key, function() {\n          self.loadPage(self.page + 1)\n        })\n      }, function() {})\n    }.bind(this)\n\n    this.toggleField = function(e) {\n      e.preventDefault()\n      common.patch(url + \"/cruds/layouts/\" + e.target.dataset.key + \"/\" + e.item.col.name + \"/toggle\", \"{}\", function(data) {\n        if(data.success) {\n          e.target.innerText = data.data\n        }\n      })\n    }.bind(this)\n\n    this.setPerPage = function(e) {\n      e.preventDefault()\n      var perpage = parseInt(e.srcElement.innerText)\n      if(e.srcElement.innerText == 'ALL') perpage = 1000000000;\n      this.perpage = perpage\n      this.loadPage(1)\n    }.bind(this)\n\n    this.export_data = function(e) {\n      common.get(url + '/cruds/layouts/export', function(d) {\n        var csvContent = d.data\n        var encodedUri = encodeURI(csvContent)\n        var link = document.createElement(\"a\")\n        link.setAttribute(\"href\", encodedUri)\n        link.setAttribute(\"download\", \"layouts.csv\")\n        link.innerHTML= \"Click Here to download\"\n        document.body.appendChild(link)\n        link.click()\n        document.body.removeChild(link)\n      })\n    }.bind(this)\n\n    this.on('updated', function() {\n      if(self.sortable) {\n        var el = document.getElementById('list');\n        var sortable = new Sortable(el, {\n          animation: 150,\n          ghostClass: 'blue-background-class',\n          handle: '.fa-grip-vertical',\n          onSort: function ( evt) {\n            common.put(\n              url + 'cruds/layouts/orders/' + evt.oldIndex + \"/\" + evt.newIndex, {},\n              function() {}\n            )\n          },\n        });\n      }\n    })\n});\n\n","riot.tag2('loading', '<div class=\"uk-text-center\"> Loading app ... <br><div uk-spinner></div> </div>', '', '', function(opts) {\n    common.get(url + \"auth/whoami\", function(d) {\n      if(d.username === null) document.location.href=\"login.html\";\n      else {\n\n        localStorage.setItem('resize_api_key', d.resize_api_key)\n        route('/welcome')\n      }\n    })\n});\n\nriot.tag2('welcome', '<h1>Welcome aboard</h1> <p>This is a landing page ... Nothing special here, replace it by what you want !</p> <p>Find me in <code>app/widgets/loading.html.tag</code></p>', '', '', function(opts) {\n});\n\nriot.tag2('rightnav', '<ul class=\"uk-navbar-nav\"> <li><a onclick=\"{deploy}\" if=\"{settings.deploy_secret != }\">Deploy</a></li> <li each=\"{lang in langs}\" class=\"{lang == window.localStorage.getItem(\\'foxx-locale\\') ? \\'uk-active\\' : \\'\\'}\"><a onclick=\"{changeLang}\">{lang}</a></li> <li><a href=\"#logout\"><i class=\"uk-icon-sign-out\"></i> Logout</a></li> </ul>', '', '', function(opts) {\n    this.settings   = {}\n    var self = this\n\n    common.get(url + \"/settings\", function(settings) {\n      self.settings = settings.data\n      self.langs = self.settings.langs.split(\",\")\n      self.update()\n    })\n\n    this.changeLang = function(e) {\n      window.localStorage.setItem('foxx-locale', e.item.lang)\n      document.location.reload()\n    }.bind(this)\n\n    this.deploy = function(e) {\n      e.preventDefault()\n      var url = \"/deploy\"\n      $.post(url, { token: self.settings.token }, function(data) {\n        if(data == \"site deployed\")\n          UIkit.notification({\n            message : 'Site Deployed Successfully!',\n            status  : 'success',\n            timeout : 1000,\n            pos     : 'bottom-right'\n          });\n      })\n      return false\n    }.bind(this)\n});","riot.tag2('loading', '<div class=\"uk-text-center\"> Loading app ... <br><div uk-spinner></div> </div>', '', '', function(opts) {\n    route('/login');\n});\n\nriot.tag2('login', '<div class=\"uk-container uk-container-center\"> <div uk-grid class=\"uk-grid-small uk-child-width-1-3@s uk-flex-center uk-text-center\"> <div> <h1 class=\"uk-margin-large-top\"><i class=\"uk-icon-sign-in\"></i> Connection</h1> <form class=\"uk-form uk-margin-top\" onsubmit=\"{save_form}\"> <div class=\"uk-margin\"> <input placeholder=\"Email\" class=\"uk-input\" id=\"username\" name=\"username\" value=\"\" type=\"email\"> </div> <div class=\"uk-margin\"> <input type=\"password\" class=\"uk-input\" placeholder=\"Mot de passe\" class=\"uk-input\" id=\"password\" name=\"password\" value=\"\"> </div> <hr> <div class=\"uk-margin\"> <button type=\"submit\" class=\"uk-button uk-button-primary\">Connection</button> </div> <div class=\"uk-margin-small\"> <div id=\"login_error\" class=\"uk-alert uk-alert-danger uk-hidden uk-text-center\"> Bad login or password </div> </div> </form> </div> </div> </div>', '', '', function(opts) {\n    this.save_form = function(e) {\n      e.preventDefault()\n      common.post(url + \"auth/login\", JSON.stringify({ \"username\": $(\"#username\").val(), \"password\": $(\"#password\").val() }) , function(data) {\n        if(data.success) document.location.href=\"index.html\";\n        else {\n          $(\"#login_error\").removeClass(\"uk-hidden\")\n        }\n      })\n    }.bind(this)\n});\n","riot.tag2('page_folders', '<div> <ul class=\"uk-breadcrumb\"> <li each=\"{f in path}\"><a href=\"#pages/{f._key}\">{f.name}</a></li> <li> <a if=\"{path.length > 1}\" onclick=\"{renameFolder}\"><i class=\"far fa-edit\"></i></a> <a onclick=\"{addFolder}\"><i class=\"fas fa-plus\"></i></a> <a if=\"{path.length > 1 && folders.length == 0}\" onclick=\"{deleteFolder}\"><i class=\"fas fa-trash\"></i></a> </li> </ul> <ul class=\"uk-list\"> <li each=\"{f in folders}\"><a href=\"#pages/{f._key}\"><i class=\"far fa-folder\"></i> {f.name}</a></li> </ul> </div>', '', '', function(opts) {\n    this.folders = []\n    this.folder = {}\n    this.path = [ this.folder ]\n    this.folder_key = this.opts.folder_key || '';\n    var self = this\n\n    var loadFolder = function(folder_key) {\n      common.get(url + '/cruds/folders/pages/' + folder_key, function(d) {\n        self.folders = d.folders\n        self.path = d.path\n        self.folder = _.last(self.path)\n        self.parent.setFolder(self.folder)\n        self.update()\n      })\n    }\n\n    this.addFolder = function(e) {\n      var name = prompt(\"Folder's name\");\n      common.post(url + \"/cruds/folders/pages\", JSON.stringify({ name: name, parent_id: self.folder._key }), function(d) {\n        loadFolder(self.folder._key)\n      })\n    }.bind(this)\n\n    this.renameFolder = function(e) {\n      var name = prompt(\"Update Folder's name\");\n      common.patch(url + \"/cruds/folders/pages\", JSON.stringify({ name: name, id: self.folder._key }), function(d) {\n        self.path = d.path\n        self.update()\n      })\n    }.bind(this)\n\n    this.deleteFolder = function(e) {\n      UIkit.modal.confirm('Are you sure? This action will destroy the folder and it\\'s content')\n        .then(function() {\n          var parent = _.last(_.initial(self.path));\n          common.delete(url + \"/cruds/folders/pages/\" + self.folder._key, function(d) {\n            common.get(url + \"/cruds/folders/pages/\" + parent._key, function(d) {\n              self.folders = d.folders\n              self.path = d.path\n              loadFolder(parent._key)\n              self.update()\n            })\n          })\n      }, function () {\n        console.log('Rejected.')\n      });\n    }.bind(this)\n\n    loadFolder(this.folder_key)\n});\n\nriot.tag2('page_crud_index', '<a href=\"#\" class=\"uk-button uk-button-small uk-button-default\" onclick=\"{new_item}\"> <i class=\"fas fa-plus\"></i> New {opts.singular} </a> <table class=\"uk-table uk-table-striped\" if=\"{data.length > 0}\"> <thead> <tr> <th each=\"{col in cols}\"> {col.name == undefined ? col : col.label === undefined ? col.name : col.label} </th> <th width=\"70\"></th> </tr> </thead> <tbody> <tr each=\"{row in data}\"> <td each=\"{col in cols}\" class=\"{col.class}\"> <virtual if=\"{col.tr == true}\">{_.get(row,col.name)[locale]}</virtual> <virtual if=\"{col.tr != true}\">{_.get(row,col.name)}</virtual> </td> <td class=\"uk-text-center\" width=\"110\"> <a onclick=\"{edit}\" class=\"uk-button uk-button-primary uk-button-small\"><i class=\"fas fa-edit\"></i></a> <a onclick=\"{destroy_object}\" class=\"uk-button uk-button-danger uk-button-small\"><i class=\"fas fa-trash-alt\"></i></a> </td> </tr> </tbody> </table> <ul class=\"uk-pagination\"> <li if=\"{page > 0}\"><a onclick=\"{previousPage}\"><span class=\"uk-margin-small-right\" uk-pagination-previous></span> Previous</a></li> <li if=\"{(page + 1) * perpage < count}\" class=\"uk-margin-auto-left\"><a onclick=\"{nextPage}\">Next <span class=\"uk-margin-small-left\" uk-pagination-next></span></a></li> </ul>', '', '', function(opts) {\n    var self = this\n    this.data = []\n    this.new_item = function(e) {\n      e.preventDefault()\n      riot.mount(\"#\"+opts.id, \"page_crud_new\", opts)\n    }.bind(this)\n\n    this.loadPage = function(pageIndex) {\n      common.get(url + \"/cruds/sub/\"+opts.parent_id+\"/\"+opts.id+\"/\"+opts.key+\"/page/\"+pageIndex+\"/\"+per_page, function(d) {\n        self.data = d.data[0].data\n        self.cols = _.map(common.array_diff(common.keys(self.data[0]), [\"_id\", \"_key\", \"_rev\"]), function(v) { return { name: v }})\n        if(opts.columns) self.cols = opts.columns\n        self.count = d.data[0].count\n        self.update()\n      })\n    }\n    this.loadPage(1)\n\n    this.edit = function(e) {\n      e.preventDefault()\n      opts.element_id = e.item.row._key\n      riot.mount(\"#\"+opts.id, \"page_crud_edit\", opts)\n    }.bind(this)\n\n    this.nextPage = function(e) {\n      e.preventDefault()\n      self.page += 1\n      self.loadPage(self.page + 1)\n    }.bind(this)\n\n    this.previousPage = function(e) {\n      e.preventDefault()\n      self.page -= 1\n      self.loadPage(self.page + 1)\n    }.bind(this)\n\n    this.destroy_object = function(e) {\n      e.preventDefault()\n      UIkit.modal.confirm(\"Are you sure?\").then(function() {\n        common.delete(url + \"/cruds/\" + opts.id + \"/\" + e.item.row._key, function() {\n          self.loadPage(1)\n        })\n      }, function() {})\n    }.bind(this)\n});\n\nriot.tag2('page_crud_edit', '<a href=\"#\" class=\"uk-button uk-button-link\" onclick=\"{goback}\">Back to {opts.id}</a> <form onsubmit=\"{save_form}\" class=\"uk-form\" id=\"{opts.id}_crud_page\"> </form>', '', '', function(opts) {\n    this.goback = function(e) {\n      e.preventDefault()\n      riot.mount(\"#\"+opts.id, \"page_crud_index\", opts)\n    }.bind(this)\n\n    this.save_form = function(e) {\n      e.preventDefault()\n      common.saveForm(opts.id+'_crud_page', \"cruds/sub/\"+opts.parent_name+\"/\"+ opts.id+\"/\"+opts.element_id, \"\", opts)\n    }.bind(this)\n\n    var self = this;\n    common.get(url + \"/cruds/\" + opts.id + \"/\" + opts.element_id, function(d) {\n      self.page = d.data\n\n      common.buildForm(self.page, opts.fields, '#'+opts.id+'_crud_page')\n    })\n    this.on('updated', function() {\n      $(\".select_list\").select2()\n      $(\".select_mlist\").select2()\n      $(\".select_tag\").select2({ tags: true })\n    })\n});\n\nriot.tag2('page_crud_new', '<a href=\"#\" class=\"uk-button uk-button-link\" onclick=\"{goback}\">Back to {opts.id}</a> <form onsubmit=\"{save_form}\" class=\"uk-form\" id=\"{opts.id}_crud_page\"> </form>', '', '', function(opts) {\n    var self = this\n    this.crud = {}\n    this.crud[opts.key] = opts.parent_id\n\n    this.goback = function(e) {\n      e.preventDefault()\n      riot.mount(\"#\"+opts.id, \"page_crud_index\", opts)\n    }.bind(this)\n\n    this.on('mount', function() {\n      common.buildForm(self.crud, opts.fields, '#'+opts.id+'_crud_page')\n    })\n\n    this.save_form = function(e) {\n      e.preventDefault()\n      common.saveForm(opts.id+'_crud_page', \"cruds/sub/pages/\"+ opts.id, \"\", opts)\n    }.bind(this)\n\n});\n\nriot.tag2('page_edit', '<virtual if=\"{can_access}\"> <ul uk-tab> <li><a href=\"#\">pages</a></li> <li each=\"{i, k in sub_models}\"><a href=\"#\">{k}</a></li> </ul> <ul class=\"uk-switcher uk-margin\"> <li> <h3>Editing page</h3> <form onsubmit=\"{save_form}\" class=\"uk-form\" id=\"form_page\"> </form> <a class=\"uk-button uk-button-primary\" onclick=\"{publish}\">Publish</a> <a class=\"uk-button uk-button-secondary\" onclick=\"{duplicate}\">Duplicate</a> </li> <li each=\"{i, k in sub_models}\"> <div id=\"{k}\" class=\"crud\"></div> </li> </ul> </virtual> <virtual if=\"{!can_access && loaded}\"> Sorry, you can\\'t access this page... </virtual> <script>', '', '', function(opts) {\n    var self = this\n    self.can_access = false\n    self.loaded = false\n\n    this.save_form = function(e) {\n      e.preventDefault()\n      common.saveForm(\"form_page\", \"cruds/pages\",opts.page_id)\n    }.bind(this)\n\n    this.duplicate = function(e) {\n      UIkit.modal.confirm(\"Are you sure?\").then(function() {\n        common.get(url + \"/cruds/pages/\" + opts.page_id + \"/duplicate\", function(data) {\n          route('/pages/' + data._key + '/edit')\n          UIkit.notification({\n            message : 'Successfully duplicated!',\n            status  : 'success',\n            timeout : 1000,\n            pos     : 'bottom-right'\n          });\n        })\n      }, function() {})\n    }.bind(this)\n\n    this.publish = function(e) {\n      UIkit.modal.confirm(\"Are you sure?\").then(function() {\n        common.post(url + \"/cruds/pages/\" + opts.page_id + \"/publish\", JSON.stringify({}), function(data) {\n          UIkit.notification({\n            message : 'Successfully published!',\n            status  : 'success',\n            timeout : 1000,\n            pos     : 'bottom-right'\n          });\n        })\n      })\n    }.bind(this)\n\n    common.get(url + \"/cruds/pages/\" + opts.page_id, function(d) {\n      self.page = d.data\n      self.fields = d.fields\n      self.sub_models = d.fields.sub_models\n      var fields = d.fields\n      var act_as_tree = d.fields.act_as_tree\n\n      if(!_.isArray(fields)) fields = fields.model\n      common.get(url + \"/auth/whoami\", function(me) {\n        localStorage.setItem('resize_api_key', me.resize_api_key)\n        self.can_access = d.fields.roles === undefined || _.includes(d.fields.roles.write, me.role)\n        self.loaded = true\n        self.update()\n        var back_url = 'pages'\n        if(act_as_tree) { back_url = 'pages/' + self.page.folder_key }\n        if(self.can_access)\n          common.buildForm(self.page, fields, '#form_page', back_url, function() {\n            $(\".crud\").each(function(i, c) {\n              var id = $(c).attr(\"id\")\n              riot.mount(\"#\" + id, \"page_crud_index\", {\n                model: id,\n                fields: self.sub_models[id].fields,\n                key: self.sub_models[id].key,\n                singular: self.sub_models[id].singular,\n                columns: self.sub_models[id].columns,\n                parent_id: opts.page_id,\n                parent_name: back_url\n              })\n            })\n          })\n      })\n    })\n\n    this.on('updated', function() {\n      $(\".select_list\").select2()\n      $(\".select_mlist\").select2()\n      $(\".select_tag\").select2({ tags: true })\n    })\n});\n\nriot.tag2('page_new', '<virtual if=\"{can_access}\"> <h3>Creating page</h3> <form onsubmit=\"{save_form}\" class=\"uk-form\" id=\"form_new_page\"> </form> </virtual> <virtual if=\"{!can_access && loaded}\"> Sorry, you can\\'t access this page... </virtual>', '', '', function(opts) {\n    var self = this\n    self.can_access = false\n    self.loaded = false\n\n    this.save_form = function(e) {\n      e.preventDefault()\n      common.saveForm(\"form_new_page\", \"cruds/pages\")\n    }.bind(this)\n\n    common.get(url + \"/cruds/pages/fields\", function(d) {\n      common.get(url + \"/auth/whoami\", function(me) {\n        localStorage.setItem('resize_api_key', me.resize_api_key)\n        self.can_access = d.fields.roles === undefined || _.includes(d.fields.roles.write, me.role)\n        self.loaded = true\n        self.update()\n        if(self.can_access) {\n\n          var fields = d.fields\n          var obj = {}\n          if(!_.isArray(fields)) fields = fields.model\n          var back_url = 'pages'\n          if(self.opts.folder_key) {\n            fields.push({ r: true, c: \"1-1\", n: \"folder_key\", t: \"hidden\" })\n            obj['folder_key'] = opts.folder_key\n            back_url = 'pages/' + opts.folder_key\n          }\n          common.buildForm(obj, fields, '#form_new_page', back_url);\n        }\n      })\n    })\n\n    this.on('updated', function() {\n      $(\".select_list\").select2()\n      $(\".select_mlist\").select2()\n      $(\".select_tag\").select2({ tags: true })\n    })\n});\n\nriot.tag2('pages', '<page_folders show=\"{loaded}\" folder_key=\"{folder_key}\"></page_folders> <virtual if=\"{can_access}\"> <div class=\"uk-float-right\"> <a if=\"{act_as_tree}\" href=\"#pages/{folder._key}/new\" class=\"uk-button uk-button-small uk-button-default\"><i class=\"fas fa-plus\"></i> New page</a> <a if=\"{!act_as_tree}\" href=\"#pages/new\" class=\"uk-button uk-button-small uk-button-default\"><i class=\"fas fa-plus\"></i> New page</a> <a if=\"{export}\" onclick=\"{export_data}\" class=\"uk-button uk-button-small uk-button-primary\"><i class=\"fas fa-file-export\"></i> Export CSV</a> </div> <h3>Listing pages</h3> <form onsubmit=\"{filter}\" class=\"uk-margin-top\"> <div class=\"uk-inline uk-width-1-1\"> <span class=\"uk-form-icon\" uk-icon=\"icon: search\"></span> <input type=\"text\" ref=\"term\" id=\"term\" class=\"uk-input\" autocomplete=\"off\"> </div> </form> <table class=\"uk-table uk-table-striped\"> <thead> <tr> <th if=\"{sortable}\" width=\"20\"></th> <th each=\"{col in cols}\">{col.name == undefined ? col : col.label === undefined ? col.name : col.label}</th> <th width=\"70\"></th> </tr> </thead> <tbody id=\"list\"> <tr each=\"{row in data}\"> <td if=\"{sortable}\"><i class=\"fas fa-grip-vertical handle\"></i></td> <td each=\"{col in cols}\" class=\"{col.class}\"> <virtual if=\"{col.toggle == true}\"> <virtual if=\"{col.tr == true}\"><a onclick=\"{toggleField}\" data-key=\"{row._key}\">{col.values ? col.values[row[col.name][locale]] : _.get(row,col.name)[locale]}</a></virtual> <virtual if=\"{col.tr != true}\"><a onclick=\"{toggleField}\" data-key=\"{row._key}\">{col.values ? col.values[row[col.name]] : _.get(row,col.name)}</a></virtual> </virtual> <virtual if=\"{col.toggle != true}\"> <virtual if=\"{col.type == image}\"> <img riot-src=\"{_.get(row,col.name)[locale]} \" style=\"height:25px\"> </virtual> <virtual if=\"{col.type != image}\"> {calc_value(row, col, locale)} </virtual> </virtual> </td> <td class=\"uk-text-center\" width=\"110\"> <a onclick=\"{edit}\" class=\"uk-button uk-button-primary uk-button-small\"><i class=\"fas fa-edit\"></i></a> <a onclick=\"{destroy_object}\" class=\"uk-button uk-button-danger uk-button-small\"><i class=\"fas fa-trash-alt\"></i></a> </td> </tr> </tbody> </table> <ul class=\"uk-pagination\"> <li if=\"{page > 0}\"><a onclick=\"{previousPage}\"><span class=\"uk-margin-small-right\" uk-pagination-previous></span> Previous</a></li> <li if=\"{(page + 1) * perpage < count}\" class=\"uk-margin-auto-left\"><a onclick=\"{nextPage}\">Next <span class=\"uk-margin-small-left\" uk-pagination-next></span></a></li> </ul> Per Page : {perpage > 100000 ? \\'ALL\\' : perpage} <a onclick=\"{setPerPage}\" class=\"uk-label\">25</a> <a onclick=\"{setPerPage}\" class=\"uk-label\">50</a> <a onclick=\"{setPerPage}\" class=\"uk-label\">100</a> <a onclick=\"{setPerPage}\" class=\"uk-label\">500</a> <a onclick=\"{setPerPage}\" class=\"uk-label\">1000</a> <a onclick=\"{setPerPage}\" class=\"uk-label\">ALL</a> </virtual> <virtual if=\"{!can_access && loaded}\"> Sorry, you can\\'t access this page... </virtual>', 'pages .handle,[data-is=\"pages\"] .handle{ cursor: move; }', '', function(opts) {\n\n    var self        = this\n    this.page       = 0\n    this.perpage    = per_page\n    this.locale     = window.localStorage.getItem('foxx-locale')\n    this.data       = []\n    this.export     = false\n    this.can_access = false\n    this.sortable   = false\n    this.loaded     = false\n    this.folder     = {}\n    this.folder_key = this.opts.folder_key || ''\n    this.act_as_tree = true\n\n    this.loadPage = function(pageIndex) {\n      self.loaded = false\n      var querystring = \"?folder=\" + self.folder._key + \"&is_root=\" + self.folder.is_root\n      common.get(url + \"/cruds/pages/page/\"+pageIndex+\"/\"+this.perpage + querystring, function(d) {\n        self.data = d.data[0].data\n        self.export = !!d.model.export\n        self.cols = _.map(common.array_diff(common.keys(self.data[0]), [\"_id\", \"_key\", \"_rev\"]), function(v) { return { name: v }})\n        if(d.model.columns) self.cols = d.model.columns\n        self.count = d.data[0].count\n        self.sortable = !!d.model.sortable\n        common.get(url + \"/auth/whoami\", function(me) {\n          localStorage.setItem('resize_api_key', me.resize_api_key)\n          self.loaded = true\n          self.can_access = d.model.roles === undefined || _.includes(d.model.roles.read, me.role)\n          self.update()\n        })\n      })\n    }\n\n    this.setFolder = function(folder) {\n      self.folder = folder\n      self.act_as_tree = folder !== ''\n      self.loadPage(1)\n    }\n\n    this.calc_value = function(row, col, locale) {\n      value = _.get(row, col.name)\n      if(col.tr) { value = value[locale] }\n      if(col.truncate) { value = value.substring(0,col.truncate) }\n      if(col.capitalize) { value = _.capitalize(value) }\n      if(col.uppercase) { value = _.toUpper(value) }\n      if(col.downcase) { value = _.toLower(value) }\n      return value\n    }.bind(this)\n\n    this.filter = function(e) {\n      e.preventDefault();\n      if(self.refs.term.value != \"\") {\n        $(\".uk-form-icon i\").attr(\"class\", \"uk-icon-spin uk-icon-spinner\")\n        common.get(url + \"/cruds/pages/search/\"+self.refs.term.value, function(d) {\n          self.data = d.data\n          $(\".uk-form-icon i\").attr(\"class\", \"uk-icon-search\")\n          self.update()\n        })\n      }\n      else {\n        self.loadPage(1)\n      }\n    }.bind(this)\n\n    this.edit = function(e) {\n      route(\"/pages/\" + e.item.row._key + \"/edit\")\n    }.bind(this)\n\n    this.nextPage = function(e) {\n      self.page += 1\n      self.loadPage(self.page + 1)\n    }.bind(this)\n\n    this.previousPage = function(e) {\n      self.page -= 1\n      self.loadPage(self.page + 1)\n    }.bind(this)\n\n    this.destroy_object = function(e) {\n      UIkit.modal.confirm(\"Are you sure?\").then(function() {\n        common.delete(url + \"/cruds/pages/\" + e.item.row._key, function() {\n          self.loadPage(self.page + 1)\n        })\n      }, function() {})\n    }.bind(this)\n\n    this.toggleField = function(e) {\n      e.preventDefault()\n      common.patch(url + \"/cruds/pages/\" + e.target.dataset.key + \"/\" + e.item.col.name + \"/toggle\", \"{}\", function(data) {\n        if(data.success) {\n          e.target.innerText = data.data\n        }\n      })\n    }.bind(this)\n\n    this.setPerPage = function(e) {\n      e.preventDefault()\n      var perpage = parseInt(e.srcElement.innerText)\n      if(e.srcElement.innerText == 'ALL') perpage = 1000000000;\n      this.perpage = perpage\n      this.loadPage(1)\n    }.bind(this)\n\n    this.export_data = function(e) {\n      common.get(url + '/cruds/pages/export', function(d) {\n        var csvContent = d.data\n        var encodedUri = encodeURI(csvContent)\n        var link = document.createElement(\"a\")\n        link.setAttribute(\"href\", encodedUri)\n        link.setAttribute(\"download\", \"pages.csv\")\n        link.innerHTML= \"Click Here to download\"\n        document.body.appendChild(link)\n        link.click()\n        document.body.removeChild(link)\n      })\n    }.bind(this)\n\n    this.on('updated', function() {\n      if(self.sortable) {\n        var el = document.getElementById('list');\n        var sortable = new Sortable(el, {\n          animation: 150,\n          ghostClass: 'blue-background-class',\n          handle: '.fa-grip-vertical',\n          onSort: function ( evt) {\n            var folder_key = \"?folder_key=\" + self.folder._key\n            if(!self.act_as_tree) folder_key = ''\n            common.put(\n              url + 'cruds/pages/orders/' + evt.oldIndex + \"/\" + evt.newIndex + folder_key, {},\n              function() {}\n            )\n          },\n        });\n      }\n    })\n});\n\n","riot.tag2('partial_folders', '<div> <ul class=\"uk-breadcrumb\"> <li each=\"{f in path}\"><a href=\"#partials/{f._key}\">{f.name}</a></li> <li> <a if=\"{path.length > 1}\" onclick=\"{renameFolder}\"><i class=\"far fa-edit\"></i></a> <a onclick=\"{addFolder}\"><i class=\"fas fa-plus\"></i></a> <a if=\"{path.length > 1 && folders.length == 0}\" onclick=\"{deleteFolder}\"><i class=\"fas fa-trash\"></i></a> </li> </ul> <ul class=\"uk-list\"> <li each=\"{f in folders}\"><a href=\"#partials/{f._key}\"><i class=\"far fa-folder\"></i> {f.name}</a></li> </ul> </div>', '', '', function(opts) {\n    this.folders = []\n    this.folder = {}\n    this.path = [ this.folder ]\n    this.folder_key = this.opts.folder_key || '';\n    var self = this\n\n    var loadFolder = function(folder_key) {\n      common.get(url + '/cruds/folders/partials/' + folder_key, function(d) {\n        self.folders = d.folders\n        self.path = d.path\n        self.folder = _.last(self.path)\n        self.parent.setFolder(self.folder)\n        self.update()\n      })\n    }\n\n    this.addFolder = function(e) {\n      var name = prompt(\"Folder's name\");\n      common.post(url + \"/cruds/folders/partials\", JSON.stringify({ name: name, parent_id: self.folder._key }), function(d) {\n        loadFolder(self.folder._key)\n      })\n    }.bind(this)\n\n    this.renameFolder = function(e) {\n      var name = prompt(\"Update Folder's name\");\n      common.patch(url + \"/cruds/folders/partials\", JSON.stringify({ name: name, id: self.folder._key }), function(d) {\n        self.path = d.path\n        self.update()\n      })\n    }.bind(this)\n\n    this.deleteFolder = function(e) {\n      UIkit.modal.confirm('Are you sure? This action will destroy the folder and it\\'s content')\n        .then(function() {\n          var parent = _.last(_.initial(self.path));\n          common.delete(url + \"/cruds/folders/partials/\" + self.folder._key, function(d) {\n            common.get(url + \"/cruds/folders/partials/\" + parent._key, function(d) {\n              self.folders = d.folders\n              self.path = d.path\n              loadFolder(parent._key)\n              self.update()\n            })\n          })\n      }, function () {\n        console.log('Rejected.')\n      });\n    }.bind(this)\n\n    loadFolder(this.folder_key)\n});\n\nriot.tag2('partial_crud_index', '<a href=\"#\" class=\"uk-button uk-button-small uk-button-default\" onclick=\"{new_item}\"> <i class=\"fas fa-plus\"></i> New {opts.singular} </a> <table class=\"uk-table uk-table-striped\" if=\"{data.length > 0}\"> <thead> <tr> <th each=\"{col in cols}\"> {col.name == undefined ? col : col.label === undefined ? col.name : col.label} </th> <th width=\"70\"></th> </tr> </thead> <tbody> <tr each=\"{row in data}\"> <td each=\"{col in cols}\" class=\"{col.class}\"> <virtual if=\"{col.tr == true}\">{_.get(row,col.name)[locale]}</virtual> <virtual if=\"{col.tr != true}\">{_.get(row,col.name)}</virtual> </td> <td class=\"uk-text-center\" width=\"110\"> <a onclick=\"{edit}\" class=\"uk-button uk-button-primary uk-button-small\"><i class=\"fas fa-edit\"></i></a> <a onclick=\"{destroy_object}\" class=\"uk-button uk-button-danger uk-button-small\"><i class=\"fas fa-trash-alt\"></i></a> </td> </tr> </tbody> </table> <ul class=\"uk-pagination\"> <li if=\"{partial > 0}\"><a onclick=\"{previouspage}\"><span class=\"uk-margin-small-right\" uk-pagination-previous></span> Previous</a></li> <li if=\"{(partial + 1) * perpage < count}\" class=\"uk-margin-auto-left\"><a onclick=\"{nextpage}\">Next <span class=\"uk-margin-small-left\" uk-pagination-next></span></a></li> </ul>', '', '', function(opts) {\n    var self = this\n    this.data = []\n    this.new_item = function(e) {\n      e.preventDefault()\n      riot.mount(\"#\"+opts.id, \"partial_crud_new\", opts)\n    }.bind(this)\n\n    this.loadpartial = function(partialIndex) {\n      common.get(url + \"/cruds/sub/\"+opts.parent_id+\"/\"+opts.id+\"/\"+opts.key+\"/partial/\"+partialIndex+\"/\"+per_page, function(d) {\n        self.data = d.data[0].data\n        self.cols = _.map(common.array_diff(common.keys(self.data[0]), [\"_id\", \"_key\", \"_rev\"]), function(v) { return { name: v }})\n        if(opts.columns) self.cols = opts.columns\n        self.count = d.data[0].count\n        self.update()\n      })\n    }\n    this.loadpartial(1)\n\n    this.edit = function(e) {\n      e.preventDefault()\n      opts.element_id = e.item.row._key\n      riot.mount(\"#\"+opts.id, \"partial_crud_edit\", opts)\n    }.bind(this)\n\n    this.nextpage = function(e) {\n      e.preventDefault()\n      self.partial += 1\n      self.loadpartial(self.partial + 1)\n    }.bind(this)\n\n    this.previouspage = function(e) {\n      e.preventDefault()\n      self.partial -= 1\n      self.loadpartial(self.partial + 1)\n    }.bind(this)\n\n    this.destroy_object = function(e) {\n      e.preventDefault()\n      UIkit.modal.confirm(\"Are you sure?\").then(function() {\n        common.delete(url + \"/cruds/\" + opts.id + \"/\" + e.item.row._key, function() {\n          self.loadpartial(1)\n        })\n      }, function() {})\n    }.bind(this)\n});\n\nriot.tag2('partial_crud_edit', '<a href=\"#\" class=\"uk-button uk-button-link\" onclick=\"{goback}\">Back to {opts.id}</a> <form onsubmit=\"{save_form}\" class=\"uk-form\" id=\"{opts.id}_crud_partial\"> </form>', '', '', function(opts) {\n    this.goback = function(e) {\n      e.preventDefault()\n      riot.mount(\"#\"+opts.id, \"partial_crud_index\", opts)\n    }.bind(this)\n\n    this.save_form = function(e) {\n      e.preventDefault()\n      common.saveForm(opts.id+'_crud_partial', \"cruds/sub/\"+opts.parent_name+\"/\"+ opts.id+\"/\"+opts.element_id, \"\", opts)\n    }.bind(this)\n\n    var self = this;\n    common.get(url + \"/cruds/\" + opts.id + \"/\" + opts.element_id, function(d) {\n      self.partial = d.data\n\n      common.buildForm(self.partial, opts.fields, '#'+opts.id+'_crud_partial')\n    })\n    this.on('updated', function() {\n      $(\".select_list\").select2()\n      $(\".select_mlist\").select2()\n      $(\".select_tag\").select2({ tags: true })\n    })\n});\n\nriot.tag2('partial_crud_new', '<a href=\"#\" class=\"uk-button uk-button-link\" onclick=\"{goback}\">Back to {opts.id}</a> <form onsubmit=\"{save_form}\" class=\"uk-form\" id=\"{opts.id}_crud_partial\"> </form>', '', '', function(opts) {\n    var self = this\n    this.crud = {}\n    this.crud[opts.key] = opts.parent_id\n\n    this.goback = function(e) {\n      e.preventDefault()\n      riot.mount(\"#\"+opts.id, \"partial_crud_index\", opts)\n    }.bind(this)\n\n    this.on('mount', function() {\n      common.buildForm(self.crud, opts.fields, '#'+opts.id+'_crud_partial')\n    })\n\n    this.save_form = function(e) {\n      e.preventDefault()\n      common.saveForm(opts.id+'_crud_partial', \"cruds/sub/partials/\"+ opts.id, \"\", opts)\n    }.bind(this)\n\n});\n\nriot.tag2('partial_edit', '<virtual if=\"{can_access}\"> <ul uk-tab> <li><a href=\"#\">partials</a></li> <li each=\"{i, k in sub_models}\"><a href=\"#\">{k}</a></li> </ul> <ul class=\"uk-switcher uk-margin\"> <li> <h3>Editing partial</h3> <form onsubmit=\"{save_form}\" class=\"uk-form\" id=\"form_partial\"> </form> <a class=\"uk-button uk-button-primary\" onclick=\"{publish}\">Publish</a> <a class=\"uk-button uk-button-secondary\" onclick=\"{duplicate}\">Duplicate</a> </li> <li each=\"{i, k in sub_models}\"> <div id=\"{k}\" class=\"crud\"></div> </li> </ul> </virtual> <virtual if=\"{!can_access && loaded}\"> Sorry, you can\\'t access this partial... </virtual> <script>', '', '', function(opts) {\n    var self = this\n    self.can_access = false\n    self.loaded = false\n\n    this.save_form = function(e) {\n      e.preventDefault()\n      common.saveForm(\"form_partial\", \"cruds/partials\",opts.partial_id)\n    }.bind(this)\n\n    this.duplicate = function(e) {\n      UIkit.modal.confirm(\"Are you sure?\").then(function() {\n        common.get(url + \"/cruds/partials/\" + opts.partial_id + \"/duplicate\", function(data) {\n          route('/partials/' + data._key + '/edit')\n          UIkit.notification({\n            message : 'Successfully duplicated!',\n            status  : 'success',\n            timeout : 1000,\n            pos     : 'bottom-right'\n          });\n        })\n      }, function() {})\n    }.bind(this)\n\n    this.publish = function(e) {\n      UIkit.modal.confirm(\"Are you sure?\").then(function() {\n        common.post(url + \"/cruds/partials/\" + opts.partial_id + \"/publish\", JSON.stringify({}), function(data) {\n          UIkit.notification({\n            message : 'Successfully published!',\n            status  : 'success',\n            timeout : 1000,\n            pos     : 'bottom-right'\n          });\n        })\n      })\n    }.bind(this)\n\n    common.get(url + \"/cruds/partials/\" + opts.partial_id, function(d) {\n      self.partial = d.data\n      self.fields = d.fields\n      self.sub_models = d.fields.sub_models\n      var fields = d.fields\n      var act_as_tree = d.fields.act_as_tree\n\n      if(!_.isArray(fields)) fields = fields.model\n      common.get(url + \"/auth/whoami\", function(me) {\n        self.can_access = d.fields.roles === undefined || _.includes(d.fields.roles.write, me.role)\n        self.loaded = true\n        self.update()\n        var back_url = 'partials'\n        if(act_as_tree) { back_url = 'partials/' + self.partial.folder_key }\n        if(self.can_access)\n          common.buildForm(self.partial, fields, '#form_partial', back_url, function() {\n            $(\".crud\").each(function(i, c) {\n            var id = $(c).attr(\"id\")\n            riot.mount(\"#\" + id, \"partial_crud_index\", { model: id,\n              fields: self.sub_models[id].fields,\n              key: self.sub_models[id].key,\n              singular: self.sub_models[id].singular,\n              columns: self.sub_models[id].columns,\n              parent_id: opts.partial_id,\n              parent_name: back_url })\n          })\n        })\n      })\n    })\n\n    this.on('updated', function() {\n      $(\".select_list\").select2()\n      $(\".select_mlist\").select2()\n      $(\".select_tag\").select2({ tags: true })\n    })\n});\n\nriot.tag2('partial_new', '<virtual if=\"{can_access}\"> <h3>Creating partial</h3> <form onsubmit=\"{save_form}\" class=\"uk-form\" id=\"form_new_partial\"> </form> </virtual> <virtual if=\"{!can_access && loaded}\"> Sorry, you can\\'t access this partial... </virtual>', '', '', function(opts) {\n    var self = this\n    self.can_access = false\n    self.loaded = false\n\n    this.save_form = function(e) {\n      e.preventDefault()\n      common.saveForm(\"form_new_partial\", \"cruds/partials\")\n    }.bind(this)\n\n    common.get(url + \"/cruds/partials/fields\", function(d) {\n      common.get(url + \"/auth/whoami\", function(me) {\n        self.can_access = d.fields.roles === undefined || _.includes(d.fields.roles.write, me.role)\n        self.loaded = true\n        self.update()\n        if(self.can_access) {\n\n          var fields = d.fields\n          var obj = {}\n          if(!_.isArray(fields)) fields = fields.model\n          var back_url = 'partials'\n          if(self.opts.folder_key) {\n            fields.push({ r: true, c: \"1-1\", n: \"folder_key\", t: \"hidden\" })\n            obj['folder_key'] = opts.folder_key\n            back_url = 'partials/' + opts.folder_key\n          }\n          common.buildForm(obj, fields, '#form_new_partial', back_url);\n        }\n      })\n    })\n\n    this.on('updated', function() {\n      $(\".select_list\").select2()\n      $(\".select_mlist\").select2()\n      $(\".select_tag\").select2({ tags: true })\n    })\n});\n\nriot.tag2('partials', '<partial_folders show=\"{loaded}\" folder_key=\"{folder_key}\"></partial_folders> <virtual if=\"{can_access}\"> <div class=\"uk-float-right\"> <a if=\"{act_as_tree}\" href=\"#partials/{folder._key}/new\" class=\"uk-button uk-button-small uk-button-default\"><i class=\"fas fa-plus\"></i> New partial</a> <a if=\"{!act_as_tree}\" href=\"#partials/new\" class=\"uk-button uk-button-small uk-button-default\"><i class=\"fas fa-plus\"></i> New partial</a> <a if=\"{export}\" onclick=\"{export_data}\" class=\"uk-button uk-button-small uk-button-primary\"><i class=\"fas fa-file-export\"></i> Export CSV</a> </div> <h3>Listing partials</h3> <form onsubmit=\"{filter}\" class=\"uk-margin-top\"> <div class=\"uk-inline uk-width-1-1\"> <span class=\"uk-form-icon\" uk-icon=\"icon: search\"></span> <input type=\"text\" ref=\"term\" id=\"term\" class=\"uk-input\" autocomplete=\"off\"> </div> </form> <table class=\"uk-table uk-table-striped\"> <thead> <tr> <th if=\"{sortable}\" width=\"20\"></th> <th each=\"{col in cols}\">{col.name == undefined ? col : col.label === undefined ? col.name : col.label}</th> <th width=\"70\"></th> </tr> </thead> <tbody id=\"list\"> <tr each=\"{row in data}\"> <td if=\"{sortable}\"><i class=\"fas fa-grip-vertical handle\"></i></td> <td each=\"{col in cols}\" class=\"{col.class}\"> <virtual if=\"{col.toggle == true}\"> <virtual if=\"{col.tr == true}\"><a onclick=\"{toggleField}\" data-key=\"{row._key}\">{col.values ? col.values[row[col.name][locale]] : _.get(row,col.name)[locale]}</a></virtual> <virtual if=\"{col.tr != true}\"><a onclick=\"{toggleField}\" data-key=\"{row._key}\">{col.values ? col.values[row[col.name]] : _.get(row,col.name)}</a></virtual> </virtual> <virtual if=\"{col.toggle != true}\"> <virtual if=\"{col.type == image}\"> <img riot-src=\"{_.get(row,col.name)[locale]} \" style=\"height:25px\"> </virtual> <virtual if=\"{col.type != image}\"> {calc_value(row, col, locale)} </virtual> </virtual> </td> <td class=\"uk-text-center\" width=\"110\"> <a onclick=\"{edit}\" class=\"uk-button uk-button-primary uk-button-small\"><i class=\"fas fa-edit\"></i></a> <a onclick=\"{destroy_object}\" class=\"uk-button uk-button-danger uk-button-small\"><i class=\"fas fa-trash-alt\"></i></a> </td> </tr> </tbody> </table> <ul class=\"uk-pagination\"> <li if=\"{partial > 0}\"><a onclick=\"{previouspage}\"><span class=\"uk-margin-small-right\" uk-pagination-previous></span> Previous</a></li> <li if=\"{(partial + 1) * perpage < count}\" class=\"uk-margin-auto-left\"><a onclick=\"{nextpage}\">Next <span class=\"uk-margin-small-left\" uk-pagination-next></span></a></li> </ul> Per partial : {perpage > 100000 ? \\'ALL\\' : perpage} <a onclick=\"{setperpage}\" class=\"uk-label\">25</a> <a onclick=\"{setperpage}\" class=\"uk-label\">50</a> <a onclick=\"{setperpage}\" class=\"uk-label\">100</a> <a onclick=\"{setperpage}\" class=\"uk-label\">500</a> <a onclick=\"{setperpage}\" class=\"uk-label\">1000</a> <a onclick=\"{setperpage}\" class=\"uk-label\">ALL</a> </virtual> <virtual if=\"{!can_access && loaded}\"> Sorry, you can\\'t access this partial... </virtual>', 'partials .handle,[data-is=\"partials\"] .handle{ cursor: move; }', '', function(opts) {\n\n    var self        = this\n    this.partial    = 0\n    this.perpage    = per_page\n    this.locale     = window.localStorage.getItem('foxx-locale')\n    this.data       = []\n    this.export     = false\n    this.can_access = false\n    this.sortable   = false\n    this.loaded     = false\n    this.folder     = {}\n    this.folder_key = this.opts.folder_key || ''\n    this.act_as_tree = true\n\n    this.loadpartial = function(partialIndex) {\n      self.loaded = false\n      var querystring = \"?folder=\" + self.folder._key + \"&is_root=\" + self.folder.is_root\n      common.get(url + \"/cruds/partials/page/\"+partialIndex+\"/\"+this.perpage + querystring, function(d) {\n        self.data = d.data[0].data\n        self.export = !!d.model.export\n        self.cols = _.map(common.array_diff(common.keys(self.data[0]), [\"_id\", \"_key\", \"_rev\"]), function(v) { return { name: v }})\n        if(d.model.columns) self.cols = d.model.columns\n        self.count = d.data[0].count\n        self.sortable = !!d.model.sortable\n        common.get(url + \"/auth/whoami\", function(me) {\n          self.loaded = true\n          self.can_access = d.model.roles === undefined || _.includes(d.model.roles.read, me.role)\n          self.update()\n        })\n      })\n    }\n\n    this.setFolder = function(folder) {\n      self.folder = folder\n      self.act_as_tree = folder !== ''\n      self.loadpartial(1)\n    }\n\n    this.calc_value = function(row, col, locale) {\n      value = _.get(row, col.name)\n      if(col.tr) { value = value[locale] }\n      if(col.truncate) { value = value.substring(0,col.truncate) }\n      if(col.capitalize) { value = _.capitalize(value) }\n      if(col.uppercase) { value = _.toUpper(value) }\n      if(col.downcase) { value = _.toLower(value) }\n      return value\n    }.bind(this)\n\n    this.filter = function(e) {\n      e.preventDefault();\n      if(self.refs.term.value != \"\") {\n        $(\".uk-form-icon i\").attr(\"class\", \"uk-icon-spin uk-icon-spinner\")\n        common.get(url + \"/cruds/partials/search/\"+self.refs.term.value, function(d) {\n          self.data = d.data\n          $(\".uk-form-icon i\").attr(\"class\", \"uk-icon-search\")\n          self.update()\n        })\n      }\n      else {\n        self.loadpartial(1)\n      }\n    }.bind(this)\n\n    this.edit = function(e) {\n      route(\"/partials/\" + e.item.row._key + \"/edit\")\n    }.bind(this)\n\n    this.nextpage = function(e) {\n      self.partial += 1\n      self.loadpartial(self.partial + 1)\n    }.bind(this)\n\n    this.previouspage = function(e) {\n      self.partial -= 1\n      self.loadpartial(self.partial + 1)\n    }.bind(this)\n\n    this.destroy_object = function(e) {\n      UIkit.modal.confirm(\"Are you sure?\").then(function() {\n        common.delete(url + \"/cruds/partials/\" + e.item.row._key, function() {\n          self.loadpartial(self.partial + 1)\n        })\n      }, function() {})\n    }.bind(this)\n\n    this.toggleField = function(e) {\n      e.preventDefault()\n      common.patch(url + \"/cruds/partials/\" + e.target.dataset.key + \"/\" + e.item.col.name + \"/toggle\", \"{}\", function(data) {\n        if(data.success) {\n          e.target.innerText = data.data\n        }\n      })\n    }.bind(this)\n\n    this.setperpage = function(e) {\n      e.preventDefault()\n      var perpage = parseInt(e.srcElement.innerText)\n      if(e.srcElement.innerText == 'ALL') perpage = 1000000000;\n      this.perpage = perpage\n      this.loadpartial(1)\n    }.bind(this)\n\n    this.export_data = function(e) {\n      common.get(url + '/cruds/partials/export', function(d) {\n        var csvContent = d.data\n        var encodedUri = encodeURI(csvContent)\n        var link = document.createElement(\"a\")\n        link.setAttribute(\"href\", encodedUri)\n        link.setAttribute(\"download\", \"partials.csv\")\n        link.innerHTML= \"Click Here to download\"\n        document.body.appendChild(link)\n        link.click()\n        document.body.removeChild(link)\n      })\n    }.bind(this)\n\n    this.on('updated', function() {\n      if(self.sortable) {\n        var el = document.getElementById('list');\n        var sortable = new Sortable(el, {\n          animation: 150,\n          ghostClass: 'blue-background-class',\n          handle: '.fa-grip-vertical',\n          onSort: function ( evt) {\n            var folder_key = \"?folder_key=\" + self.folder._key\n            if(!self.act_as_tree) folder_key = ''\n            common.put(\n              url + 'cruds/partials/orders/' + evt.oldIndex + \"/\" + evt.newIndex + folder_key, {},\n              function() {}\n            )\n          },\n        });\n      }\n    })\n});\n\n","riot.tag2('redirection_crud_index', '<a href=\"#\" class=\"uk-button uk-button-small uk-button-default\" onclick=\"{new_item}\"> <i class=\"fas fa-plus\"></i> New {opts.singular} </a> <table class=\"uk-table uk-table-striped\" if=\"{data.length > 0}\"> <thead> <tr> <th each=\"{col in cols}\"> {col.name == undefined ? col : col.label === undefined ? col.name : col.label} </th> <th width=\"70\"></th> </tr> </thead> <tbody> <tr each=\"{row in data}\"> <td each=\"{col in cols}\" class=\"{col.class}\"> <virtual if=\"{col.tr == true}\">{_.get(row,col.name)[locale]}</virtual> <virtual if=\"{col.tr != true}\">{_.get(row,col.name)}</virtual> </td> <td class=\"uk-text-center\" width=\"110\"> <a onclick=\"{edit}\" class=\"uk-button uk-button-primary uk-button-small\"><i class=\"fas fa-edit\"></i></a> <a onclick=\"{destroy_object}\" class=\"uk-button uk-button-danger uk-button-small\"><i class=\"fas fa-trash-alt\"></i></a> </td> </tr> </tbody> </table> <ul class=\"uk-pagination\"> <li if=\"{page > 0}\"><a onclick=\"{previousPage}\"><span class=\"uk-margin-small-right\" uk-pagination-previous></span> Previous</a></li> <li if=\"{(page + 1) * perpage < count}\" class=\"uk-margin-auto-left\"><a onclick=\"{nextPage}\">Next <span class=\"uk-margin-small-left\" uk-pagination-next></span></a></li> </ul>', '', '', function(opts) {\n    var self = this\n    this.data = []\n    this.new_item = function(e) {\n      e.preventDefault()\n      riot.mount(\"#\"+opts.id, \"redirection_crud_new\", opts)\n    }.bind(this)\n\n    this.loadPage = function(pageIndex) {\n      common.get(url + \"/cruds/sub/\"+opts.parent_id+\"/\"+opts.id+\"/\"+opts.key+\"/page/\"+pageIndex+\"/\"+per_page, function(d) {\n        self.data = d.data[0].data\n        self.cols = _.map(common.array_diff(common.keys(self.data[0]), [\"_id\", \"_key\", \"_rev\"]), function(v) { return { name: v }})\n        if(opts.columns) self.cols = opts.columns\n        self.count = d.data[0].count\n        self.update()\n      })\n    }\n    this.loadPage(1)\n\n    this.edit = function(e) {\n      e.preventDefault()\n      opts.element_id = e.item.row._key\n      riot.mount(\"#\"+opts.id, \"redirection_crud_edit\", opts)\n    }.bind(this)\n\n    this.nextPage = function(e) {\n      e.preventDefault()\n      self.page += 1\n      self.loadPage(self.page + 1)\n    }.bind(this)\n\n    this.previousPage = function(e) {\n      e.preventDefault()\n      self.page -= 1\n      self.loadPage(self.page + 1)\n    }.bind(this)\n\n    this.destroy_object = function(e) {\n      e.preventDefault()\n      UIkit.modal.confirm(\"Are you sure?\").then(function() {\n        common.delete(url + \"/cruds/\" + opts.id + \"/\" + e.item.row._key, function() {\n          self.loadPage(1)\n        })\n      }, function() {})\n    }.bind(this)\n});\n\nriot.tag2('redirection_crud_edit', '<a href=\"#\" class=\"uk-button uk-button-link\" onclick=\"{goback}\">Back to {opts.id}</a> <form onsubmit=\"{save_form}\" class=\"uk-form\" id=\"{opts.id}_crud_redirection\"> </form>', '', '', function(opts) {\n    this.goback = function(e) {\n      e.preventDefault()\n      riot.mount(\"#\"+opts.id, \"redirection_crud_index\", opts)\n    }.bind(this)\n\n    this.save_form = function(e) {\n      e.preventDefault()\n      common.saveForm(opts.id+'_crud_redirection', \"cruds/sub/\"+opts.parent_name+\"/\"+ opts.id+\"/\"+opts.element_id, \"\", opts)\n    }.bind(this)\n\n    var self = this;\n    common.get(url + \"/cruds/\" + opts.id + \"/\" + opts.element_id, function(d) {\n      self.redirection = d.data\n\n      common.buildForm(self.redirection, opts.fields, '#'+opts.id+'_crud_redirection')\n    })\n    this.on('updated', function() {\n      $(\".select_list\").select2()\n      $(\".select_mlist\").select2()\n      $(\".select_tag\").select2({ tags: true })\n    })\n});\n\nriot.tag2('redirection_crud_new', '<a href=\"#\" class=\"uk-button uk-button-link\" onclick=\"{goback}\">Back to {opts.id}</a> <form onsubmit=\"{save_form}\" class=\"uk-form\" id=\"{opts.id}_crud_redirection\"> </form>', '', '', function(opts) {\n    var self = this\n    this.crud = {}\n    this.crud[opts.key] = opts.parent_id\n\n    this.goback = function(e) {\n      e.preventDefault()\n      riot.mount(\"#\"+opts.id, \"redirection_crud_index\", opts)\n    }.bind(this)\n\n    this.on('mount', function() {\n      common.buildForm(self.crud, opts.fields, '#'+opts.id+'_crud_redirection')\n    })\n\n    this.save_form = function(e) {\n      e.preventDefault()\n      common.saveForm(opts.id+'_crud_redirection', \"cruds/sub/redirections/\"+ opts.id, \"\", opts)\n    }.bind(this)\n\n});\n\nriot.tag2('redirection_edit', '<virtual if=\"{can_access}\"> <ul uk-tab> <li><a href=\"#\">redirections</a></li> <li each=\"{i, k in sub_models}\"><a href=\"#\">{k}</a></li> </ul> <ul class=\"uk-switcher uk-margin\"> <li> <h3>Editing redirection</h3> <form onsubmit=\"{save_form}\" class=\"uk-form\" id=\"form_redirection\"> </form> <a class=\"uk-button uk-button-secondary\" onclick=\"{duplicate}\">Duplicate</a> </li> <li each=\"{i, k in sub_models}\"> <div id=\"{k}\" class=\"crud\"></div> </li> </ul> </virtual> <virtual if=\"{!can_access && loaded}\"> Sorry, you can\\'t access this redirection... </virtual> <script>', '', '', function(opts) {\n    var self = this\n    self.can_access = false\n    self.loaded = false\n\n    this.save_form = function(e) {\n      e.preventDefault()\n      common.saveForm(\"form_redirection\", \"cruds/redirections\",opts.redirection_id)\n    }.bind(this)\n\n    this.duplicate = function(e) {\n      UIkit.modal.confirm(\"Are you sure?\").then(function() {\n        common.get(url + \"/cruds/redirections/\" + self.redirection._key + \"/duplicate\", function(data) {\n          route('/redirections/' + data._key + '/edit')\n          UIkit.notification({\n            message : 'Successfully duplicated!',\n            status  : 'success',\n            timeout : 1000,\n            pos     : 'bottom-right'\n          });\n        })\n      }, function() {})\n    }.bind(this)\n\n    common.get(url + \"/cruds/redirections/\" + opts.redirection_id, function(d) {\n      self.redirection = d.data\n      self.fields = d.fields\n      self.sub_models = d.fields.sub_models\n      var fields = d.fields\n\n      if(!_.isArray(fields)) fields = fields.model\n      common.get(url + \"/auth/whoami\", function(me) {\n        self.can_access = _.includes(d.fields.roles.write, me.role)\n        self.loaded = true\n        self.update()\n        if(self.can_access)\n          common.buildForm(self.redirection, fields, '#form_redirection', 'redirections', function() {\n            $(\".crud\").each(function(i, c) {\n            var id = $(c).attr(\"id\")\n            riot.mount(\"#\" + id, \"redirection_crud_index\", { model: id,\n              fields: self.sub_models[id].fields,\n              key: self.sub_models[id].key,\n              singular: self.sub_models[id].singular,\n              columns: self.sub_models[id].columns,\n              parent_id: opts.redirection_id,\n              parent_name: \"redirections\" })\n          })\n        })\n      })\n    })\n\n    this.on('updated', function() {\n      $(\".select_list\").select2()\n      $(\".select_mlist\").select2()\n      $(\".select_tag\").select2({ tags: true })\n    })\n});\n\nriot.tag2('redirection_new', '<virtual if=\"{can_access}\"> <h3>Creating redirection</h3> <form onsubmit=\"{save_form}\" class=\"uk-form\" id=\"form_new_redirection\"> </form> </virtual> <virtual if=\"{!can_access && loaded}\"> Sorry, you can\\'t access this redirection... </virtual>', '', '', function(opts) {\n    var self = this\n    self.can_access = false\n    self.loaded = false\n\n    this.save_form = function(e) {\n      e.preventDefault()\n      common.saveForm(\"form_new_redirection\", \"cruds/redirections\")\n    }.bind(this)\n\n    common.get(url + \"/cruds/redirections/fields\", function(d) {\n      common.get(url + \"/auth/whoami\", function(me) {\n        self.can_access = _.includes(d.fields.roles.write, me.role)\n        self.loaded = true\n        self.update()\n        if(self.can_access) {\n\n          var fields = d.fields\n          if(!_.isArray(fields)) fields = fields.model\n          common.buildForm({}, fields, '#form_new_redirection', 'redirections');\n        }\n      })\n    })\n\n    this.on('updated', function() {\n      $(\".select_list\").select2()\n      $(\".select_mlist\").select2()\n      $(\".select_tag\").select2({ tags: true })\n    })\n});\n\nriot.tag2('redirections', '<virtual if=\"{can_access}\"> <div class=\"uk-float-right\"> <a href=\"#redirections/new\" class=\"uk-button uk-button-small uk-button-default\"><i class=\"fas fa-plus\"></i> New redirection</a> <a if=\"{export}\" onclick=\"{export_data}\" class=\"uk-button uk-button-small uk-button-primary\"><i class=\"fas fa-file-export\"></i> Export CSV</a> </div> <h3>Listing redirections</h3> <form onsubmit=\"{filter}\" class=\"uk-margin-top\"> <div class=\"uk-inline uk-width-1-1\"> <span class=\"uk-form-icon\" uk-icon=\"icon: search\"></span> <input type=\"text\" ref=\"term\" id=\"term\" class=\"uk-input\" autocomplete=\"off\"> </div> </form> <table class=\"uk-table uk-table-striped\"> <thead> <tr> <th if=\"{sortable}\" width=\"20\"></th> <th each=\"{col in cols}\">{col.name == undefined ? col : col.label === undefined ? col.name : col.label}</th> <th width=\"70\"></th> </tr> </thead> <tbody id=\"list\"> <tr each=\"{row in data}\"> <td if=\"{sortable}\"><i class=\"fas fa-grip-vertical handle\"></i></td> <td each=\"{col in cols}\" class=\"{col.class}\"> <virtual if=\"{col.toggle == true}\"> <virtual if=\"{col.tr == true}\"><a onclick=\"{toggleField}\" data-key=\"{row._key}\">{col.values ? col.values[row[col.name][locale]] : _.get(row,col.name)[locale]}</a></virtual> <virtual if=\"{col.tr != true}\"><a onclick=\"{toggleField}\" data-key=\"{row._key}\">{col.values ? col.values[row[col.name]] : _.get(row,col.name)}</a></virtual> </virtual> <virtual if=\"{col.toggle != true}\"> <virtual if=\"{col.type == image}\"> <img riot-src=\"{_.get(row,col.name)[locale]} \" style=\"height:25px\"> </virtual> <virtual if=\"{col.type != image}\"> {calc_value(row, col, locale)} </virtual> </virtual> </td> <td class=\"uk-text-center\" width=\"110\"> <a onclick=\"{edit}\" class=\"uk-button uk-button-primary uk-button-small\"><i class=\"fas fa-edit\"></i></a> <a onclick=\"{destroy_object}\" class=\"uk-button uk-button-danger uk-button-small\"><i class=\"fas fa-trash-alt\"></i></a> </td> </tr> </tbody> </table> <ul class=\"uk-pagination\"> <li if=\"{page > 0}\"><a onclick=\"{previousPage}\"><span class=\"uk-margin-small-right\" uk-pagination-previous></span> Previous</a></li> <li if=\"{(page + 1) * perpage < count}\" class=\"uk-margin-auto-left\"><a onclick=\"{nextPage}\">Next <span class=\"uk-margin-small-left\" uk-pagination-next></span></a></li> </ul> Per Page : {perpage > 100000 ? \\'ALL\\' : perpage} <a onclick=\"{setPerPage}\" class=\"uk-label\">25</a> <a onclick=\"{setPerPage}\" class=\"uk-label\">50</a> <a onclick=\"{setPerPage}\" class=\"uk-label\">100</a> <a onclick=\"{setPerPage}\" class=\"uk-label\">500</a> <a onclick=\"{setPerPage}\" class=\"uk-label\">1000</a> <a onclick=\"{setPerPage}\" class=\"uk-label\">ALL</a> </virtual> <virtual if=\"{!can_access && loaded}\"> Sorry, you can\\'t access this page... </virtual>', 'redirections .handle,[data-is=\"redirections\"] .handle{ cursor: move; }', '', function(opts) {\n\n    var self        = this\n    this.page       = 0\n    this.perpage    = per_page\n    this.locale     = window.localStorage.getItem('foxx-locale')\n    this.data       = []\n    this.export     = false\n    this.can_access = false\n    this.sortable   = false\n    this.loaded     = false\n\n    this.loadPage = function(pageIndex) {\n      self.loaded = false\n      common.get(url + \"/cruds/redirections/page/\"+pageIndex+\"/\"+this.perpage, function(d) {\n        self.data = d.data[0].data\n        self.export = !!d.model.export\n        self.cols = _.map(common.array_diff(common.keys(self.data[0]), [\"_id\", \"_key\", \"_rev\"]), function(v) { return { name: v }})\n        if(d.model.columns) self.cols = d.model.columns\n        self.count = d.data[0].count\n        self.sortable = !!d.model.sortable\n        common.get(url + \"/auth/whoami\", function(me) {\n          self.loaded = true\n          self.can_access = d.model.roles === undefined || _.includes(d.model.roles.read, me.role)\n          self.update()\n        })\n      })\n    }\n    this.loadPage(1)\n\n    this.calc_value = function(row, col, locale) {\n      value = _.get(row, col.name)\n      if(col.tr) { value = value[locale] }\n      if(col.truncate) { value = value.substring(0,col.truncate) }\n      if(col.capitalize) { value = _.capitalize(value) }\n      if(col.uppercase) { value = _.toUpper(value) }\n      if(col.downcase) { value = _.toLower(value) }\n      return value\n    }.bind(this)\n\n    this.filter = function(e) {\n      e.preventDefault();\n      if(self.refs.term.value != \"\") {\n        $(\".uk-form-icon i\").attr(\"class\", \"uk-icon-spin uk-icon-spinner\")\n        common.get(url + \"/cruds/redirections/search/\"+self.refs.term.value, function(d) {\n          self.data = d.data\n          $(\".uk-form-icon i\").attr(\"class\", \"uk-icon-search\")\n          self.update()\n        })\n      }\n      else {\n        self.loadPage(1)\n      }\n    }.bind(this)\n\n    this.edit = function(e) {\n      route(\"/redirections/\" + e.item.row._key + \"/edit\")\n    }.bind(this)\n\n    this.nextPage = function(e) {\n      self.page += 1\n      self.loadPage(self.page + 1)\n    }.bind(this)\n\n    this.previousPage = function(e) {\n      self.page -= 1\n      self.loadPage(self.page + 1)\n    }.bind(this)\n\n    this.destroy_object = function(e) {\n      UIkit.modal.confirm(\"Are you sure?\").then(function() {\n        common.delete(url + \"/cruds/redirections/\" + e.item.row._key, function() {\n          self.loadPage(self.page + 1)\n        })\n      }, function() {})\n    }.bind(this)\n\n    this.toggleField = function(e) {\n      e.preventDefault()\n      common.patch(url + \"/cruds/redirections/\" + e.target.dataset.key + \"/\" + e.item.col.name + \"/toggle\", \"{}\", function(data) {\n        if(data.success) {\n          e.target.innerText = data.data\n        }\n      })\n    }.bind(this)\n\n    this.setPerPage = function(e) {\n      e.preventDefault()\n      var perpage = parseInt(e.srcElement.innerText)\n      if(e.srcElement.innerText == 'ALL') perpage = 1000000000;\n      this.perpage = perpage\n      this.loadPage(1)\n    }.bind(this)\n\n    this.export_data = function(e) {\n      common.get(url + '/cruds/redirections/export', function(d) {\n        var csvContent = d.data\n        var encodedUri = encodeURI(csvContent)\n        var link = document.createElement(\"a\")\n        link.setAttribute(\"href\", encodedUri)\n        link.setAttribute(\"download\", \"redirections.csv\")\n        link.innerHTML= \"Click Here to download\"\n        document.body.appendChild(link)\n        link.click()\n        document.body.removeChild(link)\n      })\n    }.bind(this)\n\n    this.on('updated', function() {\n      if(self.sortable) {\n        var el = document.getElementById('list');\n        var sortable = new Sortable(el, {\n          animation: 150,\n          ghostClass: 'blue-background-class',\n          handle: '.fa-grip-vertical',\n          onSort: function ( evt) {\n            common.put(\n              url + 'cruds/redirections/orders/' + evt.oldIndex + \"/\" + evt.newIndex, {},\n              function() {}\n            )\n          },\n        });\n      }\n    })\n});\n\n","riot.tag2('script_crud_index', '<a href=\"#\" class=\"uk-button uk-button-small uk-button-default\" onclick=\"{new_item}\"> <i class=\"fas fa-plus\"></i> New {opts.singular} </a> <table class=\"uk-table uk-table-striped\" if=\"{data.length > 0}\"> <thead> <tr> <th each=\"{col in cols}\"> {col.name == undefined ? col : col.label === undefined ? col.name : col.label} </th> <th width=\"70\"></th> </tr> </thead> <tbody> <tr each=\"{row in data}\"> <td each=\"{col in cols}\" class=\"{col.class}\"> <virtual if=\"{col.tr == true}\">{_.get(row,col.name)[locale]}</virtual> <virtual if=\"{col.tr != true}\">{_.get(row,col.name)}</virtual> </td> <td class=\"uk-text-center\" width=\"110\"> <a onclick=\"{edit}\" class=\"uk-button uk-button-primary uk-button-small\"><i class=\"fas fa-edit\"></i></a> <a onclick=\"{destroy_object}\" class=\"uk-button uk-button-danger uk-button-small\"><i class=\"fas fa-trash-alt\"></i></a> </td> </tr> </tbody> </table> <ul class=\"uk-pagination\"> <li if=\"{page > 0}\"><a onclick=\"{previousPage}\"><span class=\"uk-margin-small-right\" uk-pagination-previous></span> Previous</a></li> <li if=\"{(page + 1) * perpage < count}\" class=\"uk-margin-auto-left\"><a onclick=\"{nextPage}\">Next <span class=\"uk-margin-small-left\" uk-pagination-next></span></a></li> </ul>', '', '', function(opts) {\n    var self = this\n    this.data = []\n    this.new_item = function(e) {\n      e.preventDefault()\n      riot.mount(\"#\"+opts.id, \"script_crud_new\", opts)\n    }.bind(this)\n\n    this.loadPage = function(pageIndex) {\n      common.get(url + \"/cruds/\" + opts.parent_name + \"/\" +opts.parent_id + \"/\" + opts.id + \"/\" + opts.key + \"/page/\" + pageIndex + \"/\" + per_page, function(d) {\n        self.data = d.data[0].data\n        self.cols = _.map(common.array_diff(common.keys(self.data[0]), [\"_id\", \"_key\", \"_rev\"]), function(v) { return { name: v }})\n        if(opts.columns) self.cols = opts.columns\n        self.count = d.data[0].count\n        self.update()\n      })\n    }\n    this.loadPage(1)\n\n    this.edit = function(e) {\n      e.preventDefault()\n      opts.element_id = e.item.row._key\n      riot.mount(\"#\"+opts.id, \"script_crud_edit\", opts)\n    }.bind(this)\n\n    this.nextPage = function(e) {\n      e.preventDefault()\n      self.page += 1\n      self.loadPage(self.page + 1)\n    }.bind(this)\n\n    this.previousPage = function(e) {\n      e.preventDefault()\n      self.page -= 1\n      self.loadPage(self.page + 1)\n    }.bind(this)\n\n    this.destroy_object = function(e) {\n      e.preventDefault()\n      UIkit.modal.confirm(\"Are you sure?\").then(function() {\n        common.delete(url + \"/cruds/\" + opts.id + \"/\" + e.item.row._key, function() {\n          self.loadPage(1)\n        })\n      }, function() {})\n    }.bind(this)\n});\n\nriot.tag2('script_crud_edit', '<a href=\"#\" class=\"uk-button uk-button-link\" onclick=\"{goback}\">Back to {opts.id}</a> <form onsubmit=\"{save_form}\" class=\"uk-form\" id=\"{opts.id}_crud_script\"> </form>', '', '', function(opts) {\n    this.goback = function(e) {\n      e.preventDefault()\n      riot.mount(\"#\"+opts.id, \"script_crud_index\", opts)\n    }.bind(this)\n\n    this.save_form = function(e) {\n      e.preventDefault()\n      common.saveForm(opts.id+'_crud_script', \"cruds/sub/\"+opts.parent_name+\"/\"+ opts.id+\"/\"+opts.element_id, \"\", opts)\n    }.bind(this)\n\n    var self = this;\n    common.get(url + \"/cruds/\" + opts.id + \"/\" + opts.element_id, function(d) {\n      self.script = d.data\n\n      common.buildForm(self.script, opts.fields, '#'+opts.id+'_crud_script')\n    })\n    this.on('updated', function() {\n      $(\".select_list\").select2()\n      $(\".select_mlist\").select2()\n      $(\".select_tag\").select2({ tags: true })\n    })\n});\n\nriot.tag2('script_crud_new', '<a href=\"#\" class=\"uk-button uk-button-link\" onclick=\"{goback}\">Back to {opts.id}</a> <form onsubmit=\"{save_form}\" class=\"uk-form\" id=\"{opts.id}_crud_script\"> </form>', '', '', function(opts) {\n    var self = this\n    this.crud = {}\n    this.crud[opts.key] = opts.parent_id\n\n    this.goback = function(e) {\n      e.preventDefault()\n      riot.mount(\"#\"+opts.id, \"script_crud_index\", opts)\n    }.bind(this)\n\n    this.on('mount', function() {\n      common.buildForm(self.crud, opts.fields, '#'+opts.id+'_crud_script')\n    })\n\n    this.save_form = function(e) {\n      e.preventDefault()\n      common.saveForm(opts.id+'_crud_script', \"cruds/sub/scripts/\"+ opts.id, \"\", opts)\n    }.bind(this)\n\n});\n\nriot.tag2('script_edit', '<virtual if=\"{can_access}\"> <ul uk-tab> <li><a href=\"#\">scripts</a></li> <li each=\"{i, k in sub_models}\"><a href=\"#\">{k}</a></li> </ul> <ul class=\"uk-switcher uk-margin\"> <li> <h3>Editing script</h3> <form onsubmit=\"{save_form}\" class=\"uk-form\" id=\"form_script\"> </form> <a class=\"uk-button uk-button-secondary\" onclick=\"{install}\">Launch / Restart</a> </li> <li each=\"{i, k in sub_models}\"> <div id=\"{k}\" class=\"crud\"></div> </li> </ul> </virtual> <virtual if=\"{!can_access && loaded}\"> Sorry, you can\\'t access this page... </virtual> <script>', '', '', function(opts) {\n    var self = this\n    self.can_access = false\n    self.loaded = false\n    this.settings   = {}\n    self.locked_by = null\n\n    common.get(url + \"/settings\", function(settings) { self.settings = settings.data })\n\n    this.save_form = function(e) {\n      e.preventDefault()\n      common.saveForm(\"form_script\", \"cruds/scripts\",opts.script_id)\n    }.bind(this)\n\n    this.duplicate = function(e) {\n      UIkit.modal.confirm(\"Are you sure?\").then(function() {\n        common.get(url + \"/cruds/scripts/\" + self.script._key + \"/duplicate\", function(data) {\n          route('/scripts/' + data._key + '/edit')\n          UIkit.notification({\n            message : 'Successfully duplicated!',\n            status  : 'success',\n            timeout : 1000,\n            pos     : 'bottom-right'\n          });\n        })\n      }, function() {})\n    }.bind(this)\n\n    common.get(url + \"/cruds/scripts/\" + opts.script_id, function(d) {\n      self.script = d.data\n      self.fields = d.fields\n      self.sub_models = d.fields.sub_models\n      var fields = d.fields\n\n      if(!_.isArray(fields)) fields = fields.model\n      common.get(url + \"/auth/whoami\", function(me) {\n        self.can_access = d.fields.roles === undefined || _.includes(d.fields.roles.write, me.role)\n        self.loaded = true\n        self.update()\n        if(self.can_access)\n          common.buildForm(self.script, fields, '#form_script', 'scripts', function() {\n            $(\".crud\").each(function(i, c) {\n            var id = $(c).attr(\"id\")\n            riot.mount(\"#\" + id, \"script_crud_index\", { model: id,\n              fields: self.sub_models[id].fields,\n              key: self.sub_models[id].key,\n              singular: self.sub_models[id].singular,\n              columns: self.sub_models[id].columns,\n              parent_id: opts.script_id,\n              parent_name: \"scripts\" })\n          })\n        })\n      })\n    })\n\n    this.install = function(e) {\n      e.preventDefault()\n      var url = \"/script/\" + self.script.name\n      $.post(url, { token: self.settings.token }, function(data) {\n        if(data == \"script installed\")\n          UIkit.notification({\n            message : 'Script Launched Successfully!',\n            status  : 'success',\n            timeout : 1000,\n            pos     : 'bottom-right'\n          });\n      })\n      return false\n    }.bind(this)\n\n    this.on('updated', function() {\n      $(\".select_list\").select2()\n      $(\".select_mlist\").select2()\n      $(\".select_tag\").select2({ tags: true })\n    })\n});\n\nriot.tag2('script_new', '<virtual if=\"{can_access}\"> <h3>Creating script</h3> <form onsubmit=\"{save_form}\" class=\"uk-form\" id=\"form_new_script\"> </form> </virtual> <virtual if=\"{!can_access && loaded}\"> Sorry, you can\\'t access this page... </virtual>', '', '', function(opts) {\n    var self = this\n    self.can_access = false\n    self.loaded = false\n\n    this.save_form = function(e) {\n      e.preventDefault()\n      common.saveForm(\"form_new_script\", \"cruds/scripts\")\n    }.bind(this)\n\n    common.get(url + \"/cruds/scripts/fields\", function(d) {\n      common.get(url + \"/auth/whoami\", function(me) {\n        self.can_access = d.fields.roles === undefined || _.includes(d.fields.roles.write, me.role)\n        self.loaded = true\n        self.update()\n        if(self.can_access) {\n\n          var fields = d.fields\n          if(!_.isArray(fields)) fields = fields.model\n          common.buildForm({}, fields, '#form_new_script', 'scripts');\n        }\n      })\n    })\n\n    this.on('updated', function() {\n      $(\".select_list\").select2()\n      $(\".select_mlist\").select2()\n      $(\".select_tag\").select2({ tags: true })\n    })\n});\n\nriot.tag2('scripts', '<virtual if=\"{can_access}\"> <div class=\"uk-float-right\"> <a href=\"#scripts/new\" class=\"uk-button uk-button-small uk-button-default\"><i class=\"fas fa-plus\"></i> New script</a> <a if=\"{export}\" onclick=\"{export_data}\" class=\"uk-button uk-button-small uk-button-primary\"><i class=\"fas fa-file-export\"></i> Export CSV</a> </div> <h3>Listing scripts</h3> <form onsubmit=\"{filter}\" class=\"uk-margin-top\"> <div class=\"uk-inline uk-width-1-1\"> <span class=\"uk-form-icon\" uk-icon=\"icon: search\"></span> <input type=\"text\" ref=\"term\" id=\"term\" class=\"uk-input\" autocomplete=\"off\"> </div> </form> <table class=\"uk-table uk-table-striped\"> <thead> <tr> <th if=\"{sortable}\" width=\"20\"></th> <th each=\"{col in cols}\">{col.name == undefined ? col : col.label === undefined ? col.name : col.label}</th> <th width=\"70\"></th> </tr> </thead> <tbody id=\"list\"> <tr each=\"{row in data}\"> <td if=\"{sortable}\"><i class=\"fas fa-grip-vertical handle\"></i></td> <td each=\"{col in cols}\" class=\"{col.class}\"> <virtual if=\"{col.toggle == true}\"> <virtual if=\"{col.tr == true}\"><a onclick=\"{toggleField}\" data-key=\"{row._key}\">{col.values ? col.values[row[col.name][locale]] : _.get(row,col.name)[locale]}</a></virtual> <virtual if=\"{col.tr != true}\"><a onclick=\"{toggleField}\" data-key=\"{row._key}\">{col.values ? col.values[row[col.name]] : _.get(row,col.name)}</a></virtual> </virtual> <virtual if=\"{col.toggle != true}\"> <virtual if=\"{col.type == image}\"> <img riot-src=\"{_.get(row,col.name)[locale]} \" style=\"height:25px\"> </virtual> <virtual if=\"{col.type != image}\"> {calc_value(row, col, locale)} </virtual> </virtual> </td> <td class=\"uk-text-center\" width=\"110\"> <a onclick=\"{edit}\" class=\"uk-button uk-button-primary uk-button-small\"><i class=\"fas fa-edit\"></i></a> <a onclick=\"{destroy_object}\" class=\"uk-button uk-button-danger uk-button-small\"><i class=\"fas fa-trash-alt\"></i></a> </td> </tr> </tbody> </table> <ul class=\"uk-pagination\"> <li if=\"{page > 0}\"><a onclick=\"{previousPage}\"><span class=\"uk-margin-small-right\" uk-pagination-previous></span> Previous</a></li> <li if=\"{(page + 1) * perpage < count}\" class=\"uk-margin-auto-left\"><a onclick=\"{nextPage}\">Next <span class=\"uk-margin-small-left\" uk-pagination-next></span></a></li> </ul> Per Page : {perpage > 100000 ? \\'ALL\\' : perpage} <a onclick=\"{setPerPage}\" class=\"uk-label\">25</a> <a onclick=\"{setPerPage}\" class=\"uk-label\">50</a> <a onclick=\"{setPerPage}\" class=\"uk-label\">100</a> <a onclick=\"{setPerPage}\" class=\"uk-label\">500</a> <a onclick=\"{setPerPage}\" class=\"uk-label\">1000</a> <a onclick=\"{setPerPage}\" class=\"uk-label\">ALL</a> </virtual> <virtual if=\"{!can_access && loaded}\"> Sorry, you can\\'t access this page... </virtual>', 'scripts .handle,[data-is=\"scripts\"] .handle{ cursor: move; }', '', function(opts) {\n\n    var self        = this\n    this.page       = 0\n    this.perpage    = per_page\n    this.locale     = window.localStorage.getItem('foxx-locale')\n    this.data       = []\n    this.export     = false\n    this.can_access = false\n    this.sortable   = false\n    this.loaded     = false\n\n    this.loadPage = function(pageIndex) {\n      self.loaded = false\n      common.get(url + \"/cruds/scripts/page/\"+pageIndex+\"/\"+this.perpage, function(d) {\n        self.data = d.data[0].data\n        self.export = !!d.model.export\n        self.cols = _.map(common.array_diff(common.keys(self.data[0]), [\"_id\", \"_key\", \"_rev\"]), function(v) { return { name: v }})\n        if(d.model.columns) self.cols = d.model.columns\n        self.count = d.data[0].count\n        self.sortable = !!d.model.sortable\n        common.get(url + \"/auth/whoami\", function(me) {\n          self.loaded = true\n          self.can_access = d.model.roles === undefined || _.includes(d.model.roles.read, me.role)\n          self.update()\n        })\n      })\n    }\n    this.loadPage(1)\n\n    this.calc_value = function(row, col, locale) {\n      value = _.get(row, col.name)\n      if(col.tr) { value = value[locale] }\n      if(col.truncate) { value = value.substring(0,col.truncate) }\n      if(col.capitalize) { value = _.capitalize(value) }\n      if(col.uppercase) { value = _.toUpper(value) }\n      if(col.downcase) { value = _.toLower(value) }\n      return value\n    }.bind(this)\n\n    this.filter = function(e) {\n      e.preventDefault();\n      if(self.refs.term.value != \"\") {\n        $(\".uk-form-icon i\").attr(\"class\", \"uk-icon-spin uk-icon-spinner\")\n        common.get(url + \"/cruds/scripts/search/\"+self.refs.term.value, function(d) {\n          self.data = d.data\n          $(\".uk-form-icon i\").attr(\"class\", \"uk-icon-search\")\n          self.update()\n        })\n      }\n      else {\n        self.loadPage(1)\n      }\n    }.bind(this)\n\n    this.edit = function(e) {\n      route(\"/scripts/\" + e.item.row._key + \"/edit\")\n    }.bind(this)\n\n    this.nextPage = function(e) {\n      self.page += 1\n      self.loadPage(self.page + 1)\n    }.bind(this)\n\n    this.previousPage = function(e) {\n      self.page -= 1\n      self.loadPage(self.page + 1)\n    }.bind(this)\n\n    this.destroy_object = function(e) {\n      UIkit.modal.confirm(\"Are you sure?\").then(function() {\n        common.delete(url + \"/cruds/scripts/\" + e.item.row._key, function() {\n          self.loadPage(self.page + 1)\n        })\n      }, function() {})\n    }.bind(this)\n\n    this.toggleField = function(e) {\n      e.preventDefault()\n      common.patch(url + \"/cruds/scripts/\" + e.target.dataset.key + \"/\" + e.item.col.name + \"/toggle\", \"{}\", function(data) {\n        if(data.success) {\n          e.target.innerText = data.data\n        }\n      })\n    }.bind(this)\n\n    this.setPerPage = function(e) {\n      e.preventDefault()\n      var perpage = parseInt(e.srcElement.innerText)\n      if(e.srcElement.innerText == 'ALL') perpage = 1000000000;\n      this.perpage = perpage\n      this.loadPage(1)\n    }.bind(this)\n\n    this.export_data = function(e) {\n      common.get(url + '/cruds/scripts/export', function(d) {\n        var csvContent = d.data\n        var encodedUri = encodeURI(csvContent)\n        var link = document.createElement(\"a\")\n        link.setAttribute(\"href\", encodedUri)\n        link.setAttribute(\"download\", \"scripts.csv\")\n        link.innerHTML= \"Click Here to download\"\n        document.body.appendChild(link)\n        link.click()\n        document.body.removeChild(link)\n      })\n    }.bind(this)\n\n    this.on('updated', function() {\n      if(self.sortable) {\n        var el = document.getElementById('list');\n        var sortable = new Sortable(el, {\n          animation: 150,\n          ghostClass: 'blue-background-class',\n          handle: '.fa-grip-vertical',\n          onSort: function ( evt) {\n            common.put(\n              url + 'cruds/scripts/orders/' + evt.oldIndex + \"/\" + evt.newIndex, {},\n              function() {}\n            )\n          },\n        });\n      }\n    })\n});\n\n","riot.tag2('settings', '<h3 if=\"{can_access}\">settings</h3> <form onsubmit=\"{save_form}\" id=\"form_settings\"> </form> <virtual if=\"{!can_access && loaded}\"> Sorry, you can\\'t access this page... </virtual>', '', '', function(opts) {\n    var self = this;\n    this.can_access = false\n    this.loaded     = false\n\n    this.save_form = function(e) {\n      e.preventDefault()\n      common.saveForm(\"form_settings\", \"settings\", _this.obj._key)\n    }.bind(this)\n\n    var _this = this;\n\n    common.get(url + \"settings/\", function(d) {\n      _this.obj = d.data\n      common.get(url + \"/auth/whoami\", function(me) {\n        self.update()\n        self.loaded = true\n        self.can_access = d.roles === undefined || _.includes(d.roles.write, me.role)\n        if(self.can_access) common.buildForm(_this.obj, d.fields, '#form_settings')\n        self.update()\n      })\n    })\n\n    this.on('updated', function() {\n      $(\".select_list\").select2()\n      $(\".select_tag\").select2({ tags: true })\n    })\n});\n\n","riot.tag2('spa_crud_index', '<a href=\"#\" class=\"uk-button uk-button-small uk-button-default\" onclick=\"{new_item}\"> <i class=\"fas fa-plus\"></i> New {opts.singular} </a> <table class=\"uk-table uk-table-striped\" if=\"{data.length > 0}\"> <thead> <tr> <th each=\"{col in cols}\"> {col.name == undefined ? col : col.label === undefined ? col.name : col.label} </th> <th width=\"70\"></th> </tr> </thead> <tbody> <tr each=\"{row in data}\"> <td each=\"{col in cols}\" class=\"{col.class}\"> <virtual if=\"{col.tr == true}\">{_.get(row,col.name)[locale]}</virtual> <virtual if=\"{col.tr != true}\">{_.get(row,col.name)}</virtual> </td> <td class=\"uk-text-center\" width=\"110\"> <a onclick=\"{edit}\" class=\"uk-button uk-button-primary uk-button-small\"><i class=\"fas fa-edit\"></i></a> <a onclick=\"{destroy_object}\" class=\"uk-button uk-button-danger uk-button-small\"><i class=\"fas fa-trash-alt\"></i></a> </td> </tr> </tbody> </table> <ul class=\"uk-pagination\"> <li if=\"{page > 0}\"><a onclick=\"{previousPage}\"><span class=\"uk-margin-small-right\" uk-pagination-previous></span> Previous</a></li> <li if=\"{(page + 1) * perpage < count}\" class=\"uk-margin-auto-left\"><a onclick=\"{nextPage}\">Next <span class=\"uk-margin-small-left\" uk-pagination-next></span></a></li> </ul>', '', '', function(opts) {\n    var self = this\n    this.data = []\n    this.new_item = function(e) {\n      e.preventDefault()\n      riot.mount(\"#\"+opts.id, \"spa_crud_new\", opts)\n    }.bind(this)\n\n    this.loadPage = function(pageIndex) {\n      common.get(url + \"/cruds/sub/\"+opts.parent_id+\"/\"+opts.id+\"/\"+opts.key+\"/page/\"+pageIndex+\"/\"+per_page, function(d) {\n        self.data = d.data[0].data\n        self.cols = _.map(common.array_diff(common.keys(self.data[0]), [\"_id\", \"_key\", \"_rev\"]), function(v) { return { name: v }})\n        if(opts.columns) self.cols = opts.columns\n        self.count = d.data[0].count\n        self.update()\n      })\n    }\n    this.loadPage(1)\n\n    this.edit = function(e) {\n      e.preventDefault()\n      opts.element_id = e.item.row._key\n      riot.mount(\"#\"+opts.id, \"spa_crud_edit\", opts)\n    }.bind(this)\n\n    this.nextPage = function(e) {\n      e.preventDefault()\n      self.page += 1\n      self.loadPage(self.page + 1)\n    }.bind(this)\n\n    this.previousPage = function(e) {\n      e.preventDefault()\n      self.page -= 1\n      self.loadPage(self.page + 1)\n    }.bind(this)\n\n    this.destroy_object = function(e) {\n      e.preventDefault()\n      UIkit.modal.confirm(\"Are you sure?\").then(function() {\n        common.delete(url + \"/cruds/\" + opts.id + \"/\" + e.item.row._key, function() {\n          self.loadPage(1)\n        })\n      }, function() {})\n    }.bind(this)\n});\n\nriot.tag2('spa_crud_edit', '<a href=\"#\" class=\"uk-button uk-button-link\" onclick=\"{goback}\">Back to {opts.id}</a> <form onsubmit=\"{save_form}\" class=\"uk-form\" id=\"{opts.id}_crud_spa\"> </form>', '', '', function(opts) {\n    this.goback = function(e) {\n      e.preventDefault()\n      riot.mount(\"#\"+opts.id, \"spa_crud_index\", opts)\n    }.bind(this)\n\n    this.save_form = function(e) {\n      e.preventDefault()\n      common.saveForm(opts.id+'_crud_spa', \"cruds/sub/\"+opts.parent_name+\"/\"+ opts.id+\"/\"+opts.element_id, \"\", opts)\n    }.bind(this)\n\n    var self = this;\n    common.get(url + \"/cruds/\" + opts.id + \"/\" + opts.element_id, function(d) {\n      self.spa = d.data\n\n      common.buildForm(self.spa, opts.fields, '#'+opts.id+'_crud_spa')\n    })\n    this.on('updated', function() {\n      $(\".select_list\").select2()\n      $(\".select_mlist\").select2()\n      $(\".select_tag\").select2({ tags: true })\n    })\n});\n\nriot.tag2('spa_crud_new', '<a href=\"#\" class=\"uk-button uk-button-link\" onclick=\"{goback}\">Back to {opts.id}</a> <form onsubmit=\"{save_form}\" class=\"uk-form\" id=\"{opts.id}_crud_spa\"> </form>', '', '', function(opts) {\n    var self = this\n    this.crud = {}\n    this.crud[opts.key] = opts.parent_id\n\n    this.goback = function(e) {\n      e.preventDefault()\n      riot.mount(\"#\"+opts.id, \"spa_crud_index\", opts)\n    }.bind(this)\n\n    this.on('mount', function() {\n      common.buildForm(self.crud, opts.fields, '#'+opts.id+'_crud_spa')\n    })\n\n    this.save_form = function(e) {\n      e.preventDefault()\n      common.saveForm(opts.id+'_crud_spa', \"cruds/sub/spas/\"+ opts.id, \"\", opts)\n    }.bind(this)\n\n});\n\nriot.tag2('spa_edit', '<virtual if=\"{can_access}\"> <div uk-alert class=\"uk-alert-warning\" if=\"{locked_by}\"> <i class=\"fas fa-lock\"></i> This file is locked by {locked_by} </div> <ul uk-tab> <li><a href=\"#\">spas</a></li> <li each=\"{i, k in sub_models}\"><a href=\"#\">{k}</a></li> </ul> <ul class=\"uk-switcher uk-margin\"> <li> <h3>Editing spa</h3> <form onsubmit=\"{save_form}\" class=\"uk-form\" id=\"form_spa\"> </form> <a class=\"uk-button uk-button-secondary\" onclick=\"{duplicate}\">Duplicate</a> </li> <li each=\"{i, k in sub_models}\"> <div id=\"{k}\" class=\"crud\"></div> </li> </ul> </virtual> <virtual if=\"{!can_access && loaded}\"> Sorry, you can\\'t access this page... </virtual> <script>', '', '', function(opts) {\n    var self = this\n    self.can_access = false\n    self.loaded = false\n    self.locked_by = null\n    this.save_form = function(e) {\n      e.preventDefault()\n      common.saveForm(\"form_spa\", \"cruds/spas\",opts.spa_id)\n    }.bind(this)\n\n    this.duplicate = function(e) {\n      UIkit.modal.confirm(\"Are you sure?\").then(function() {\n        common.get(url + \"/cruds/spas/\" + self.spa._key + \"/duplicate\", function(data) {\n          route('/spas/' + data._key + '/edit')\n          UIkit.notification({\n            message : 'Successfully duplicated!',\n            status  : 'success',\n            timeout : 1000,\n            pos     : 'bottom-right'\n          });\n        })\n      }, function() {})\n    }.bind(this)\n\n    common.get(url + \"/cruds/spas/\" + opts.spa_id, function(d) {\n      self.spa = d.data\n      self.locked_by = d.data.locked_by\n      self.fields = d.fields\n      self.sub_models = d.fields.sub_models\n      var fields = d.fields\n\n      if(!_.isArray(fields)) fields = fields.model\n      common.get(url + \"/auth/whoami\", function(me) {\n        self.can_access = d.fields.roles === undefined || _.includes(d.fields.roles.write, me.role)\n        self.loaded = true\n        self.update()\n        if(self.can_access)\n          common.buildForm(self.spa, fields, '#form_spa', 'spas', function() {\n            $(\".crud\").each(function(i, c) {\n            var id = $(c).attr(\"id\")\n            riot.mount(\"#\" + id, \"spa_crud_index\", { model: id,\n              fields: self.sub_models[id].fields,\n              key: self.sub_models[id].key,\n              singular: self.sub_models[id].singular,\n              columns: self.sub_models[id].columns,\n              parent_id: opts.spa_id,\n              parent_name: \"spas\" })\n          })\n        })\n      })\n    })\n\n    this.on('updated', function() {\n      $(\".select_list\").select2()\n      $(\".select_mlist\").select2()\n      $(\".select_tag\").select2({ tags: true })\n    })\n});\n\nriot.tag2('spa_new', '<virtual if=\"{can_access}\"> <h3>Creating spa</h3> <form onsubmit=\"{save_form}\" class=\"uk-form\" id=\"form_new_spa\"> </form> </virtual> <virtual if=\"{!can_access && loaded}\"> Sorry, you can\\'t access this page... </virtual>', '', '', function(opts) {\n    var self = this\n    self.can_access = false\n    self.loaded = false\n\n    this.save_form = function(e) {\n      e.preventDefault()\n      common.saveForm(\"form_new_spa\", \"cruds/spas\")\n    }.bind(this)\n\n    common.get(url + \"/cruds/spas/fields\", function(d) {\n      common.get(url + \"/auth/whoami\", function(me) {\n        self.can_access = d.fields.roles === undefined || _.includes(d.fields.roles.write, me.role)\n        self.loaded = true\n        self.update()\n        if(self.can_access) {\n\n          var fields = d.fields\n          if(!_.isArray(fields)) fields = fields.model\n          common.buildForm({}, fields, '#form_new_spa', 'spas');\n        }\n      })\n    })\n\n    this.on('updated', function() {\n      $(\".select_list\").select2()\n      $(\".select_mlist\").select2()\n      $(\".select_tag\").select2({ tags: true })\n    })\n});\n\nriot.tag2('spas', '<virtual if=\"{can_access}\"> <div class=\"uk-float-right\"> <a href=\"#spas/new\" class=\"uk-button uk-button-small uk-button-default\"><i class=\"fas fa-plus\"></i> New spa</a> <a if=\"{export}\" onclick=\"{export_data}\" class=\"uk-button uk-button-small uk-button-primary\"><i class=\"fas fa-file-export\"></i> Export CSV</a> </div> <h3>Listing spas</h3> <form onsubmit=\"{filter}\" class=\"uk-margin-top\"> <div class=\"uk-inline uk-width-1-1\"> <span class=\"uk-form-icon\" uk-icon=\"icon: search\"></span> <input type=\"text\" ref=\"term\" id=\"term\" class=\"uk-input\" autocomplete=\"off\"> </div> </form> <table class=\"uk-table uk-table-striped\"> <thead> <tr> <th if=\"{sortable}\" width=\"20\"></th> <th each=\"{col in cols}\">{col.name == undefined ? col : col.label === undefined ? col.name : col.label}</th> <th width=\"70\"></th> </tr> </thead> <tbody id=\"list\"> <tr each=\"{row in data}\"> <td if=\"{sortable}\"><i class=\"fas fa-grip-vertical handle\"></i></td> <td each=\"{col in cols}\" class=\"{col.class}\"> <virtual if=\"{col.toggle == true}\"> <virtual if=\"{col.tr == true}\"><a onclick=\"{toggleField}\" data-key=\"{row._key}\">{col.values ? col.values[row[col.name][locale]] : _.get(row,col.name)[locale]}</a></virtual> <virtual if=\"{col.tr != true}\"><a onclick=\"{toggleField}\" data-key=\"{row._key}\">{col.values ? col.values[row[col.name]] : _.get(row,col.name)}</a></virtual> </virtual> <virtual if=\"{col.toggle != true}\"> <virtual if=\"{col.type == image}\"> <img riot-src=\"{_.get(row,col.name)[locale]} \" style=\"height:25px\"> </virtual> <virtual if=\"{col.type != image}\"> {calc_value(row, col, locale)} </virtual> </virtual> </td> <td class=\"uk-text-center\" width=\"110\"> <a onclick=\"{edit}\" class=\"uk-button uk-button-primary uk-button-small\"><i class=\"fas fa-edit\"></i></a> <a onclick=\"{destroy_object}\" class=\"uk-button uk-button-danger uk-button-small\"><i class=\"fas fa-trash-alt\"></i></a> </td> </tr> </tbody> </table> <ul class=\"uk-pagination\"> <li if=\"{page > 0}\"><a onclick=\"{previousPage}\"><span class=\"uk-margin-small-right\" uk-pagination-previous></span> Previous</a></li> <li if=\"{(page + 1) * perpage < count}\" class=\"uk-margin-auto-left\"><a onclick=\"{nextPage}\">Next <span class=\"uk-margin-small-left\" uk-pagination-next></span></a></li> </ul> Per Page : {perpage > 100000 ? \\'ALL\\' : perpage} <a onclick=\"{setPerPage}\" class=\"uk-label\">25</a> <a onclick=\"{setPerPage}\" class=\"uk-label\">50</a> <a onclick=\"{setPerPage}\" class=\"uk-label\">100</a> <a onclick=\"{setPerPage}\" class=\"uk-label\">500</a> <a onclick=\"{setPerPage}\" class=\"uk-label\">1000</a> <a onclick=\"{setPerPage}\" class=\"uk-label\">ALL</a> </virtual> <virtual if=\"{!can_access && loaded}\"> Sorry, you can\\'t access this page... </virtual>', 'spas .handle,[data-is=\"spas\"] .handle{ cursor: move; }', '', function(opts) {\n\n    var self        = this\n    this.page       = 0\n    this.perpage    = per_page\n    this.locale     = window.localStorage.getItem('foxx-locale')\n    this.data       = []\n    this.export     = false\n    this.can_access = false\n    this.sortable   = false\n    this.loaded     = false\n\n    this.loadPage = function(pageIndex) {\n      self.loaded = false\n      common.get(url + \"/cruds/spas/page/\"+pageIndex+\"/\"+this.perpage, function(d) {\n        self.data = d.data[0].data\n        self.export = !!d.model.export\n        self.cols = _.map(common.array_diff(common.keys(self.data[0]), [\"_id\", \"_key\", \"_rev\"]), function(v) { return { name: v }})\n        if(d.model.columns) self.cols = d.model.columns\n        self.count = d.data[0].count\n        self.sortable = !!d.model.sortable\n        common.get(url + \"/auth/whoami\", function(me) {\n          self.loaded = true\n          self.can_access = d.model.roles === undefined || _.includes(d.model.roles.read, me.role)\n          self.update()\n        })\n      })\n    }\n    this.loadPage(1)\n\n    this.calc_value = function(row, col, locale) {\n      value = _.get(row, col.name)\n      if(col.tr) { value = value[locale] }\n      if(col.truncate) { value = value.substring(0,col.truncate) }\n      if(col.capitalize) { value = _.capitalize(value) }\n      if(col.uppercase) { value = _.toUpper(value) }\n      if(col.downcase) { value = _.toLower(value) }\n      return value\n    }.bind(this)\n\n    this.filter = function(e) {\n      e.preventDefault();\n      if(self.refs.term.value != \"\") {\n        $(\".uk-form-icon i\").attr(\"class\", \"uk-icon-spin uk-icon-spinner\")\n        common.get(url + \"/cruds/spas/search/\"+self.refs.term.value, function(d) {\n          self.data = d.data\n          $(\".uk-form-icon i\").attr(\"class\", \"uk-icon-search\")\n          self.update()\n        })\n      }\n      else {\n        self.loadPage(1)\n      }\n    }.bind(this)\n\n    this.edit = function(e) {\n      route(\"/spas/\" + e.item.row._key + \"/edit\")\n    }.bind(this)\n\n    this.nextPage = function(e) {\n      self.page += 1\n      self.loadPage(self.page + 1)\n    }.bind(this)\n\n    this.previousPage = function(e) {\n      self.page -= 1\n      self.loadPage(self.page + 1)\n    }.bind(this)\n\n    this.destroy_object = function(e) {\n      UIkit.modal.confirm(\"Are you sure?\").then(function() {\n        common.delete(url + \"/cruds/spas/\" + e.item.row._key, function() {\n          self.loadPage(self.page + 1)\n        })\n      }, function() {})\n    }.bind(this)\n\n    this.toggleField = function(e) {\n      e.preventDefault()\n      common.patch(url + \"/cruds/spas/\" + e.target.dataset.key + \"/\" + e.item.col.name + \"/toggle\", \"{}\", function(data) {\n        if(data.success) {\n          e.target.innerText = data.data\n        }\n      })\n    }.bind(this)\n\n    this.setPerPage = function(e) {\n      e.preventDefault()\n      var perpage = parseInt(e.srcElement.innerText)\n      if(e.srcElement.innerText == 'ALL') perpage = 1000000000;\n      this.perpage = perpage\n      this.loadPage(1)\n    }.bind(this)\n\n    this.export_data = function(e) {\n      common.get(url + '/cruds/spas/export', function(d) {\n        var csvContent = d.data\n        var encodedUri = encodeURI(csvContent)\n        var link = document.createElement(\"a\")\n        link.setAttribute(\"href\", encodedUri)\n        link.setAttribute(\"download\", \"spas.csv\")\n        link.innerHTML= \"Click Here to download\"\n        document.body.appendChild(link)\n        link.click()\n        document.body.removeChild(link)\n      })\n    }.bind(this)\n\n    this.on('updated', function() {\n      if(self.sortable) {\n        var el = document.getElementById('list');\n        var sortable = new Sortable(el, {\n          animation: 150,\n          ghostClass: 'blue-background-class',\n          handle: '.fa-grip-vertical',\n          onSort: function ( evt) {\n            common.put(\n              url + 'cruds/spas/orders/' + evt.oldIndex + \"/\" + evt.newIndex, {},\n              function() {}\n            )\n          },\n        });\n      }\n    })\n});\n\n","riot.tag2('trad_crud_index', '<a href=\"#\" class=\"uk-button uk-button-small uk-button-default\" onclick=\"{new_item}\"> <i class=\"fas fa-plus\"></i> New {opts.singular} </a> <table class=\"uk-table uk-table-striped\" if=\"{data.length > 0}\"> <thead> <tr> <th each=\"{col in cols}\"> {col.name == undefined ? col : col.label === undefined ? col.name : col.label} </th> <th width=\"70\"></th> </tr> </thead> <tbody> <tr each=\"{row in data}\"> <td each=\"{col in cols}\" class=\"{col.class}\"> <virtual if=\"{col.tr == true}\">{_.get(row,col.name)[locale]}</virtual> <virtual if=\"{col.tr != true}\">{_.get(row,col.name)}</virtual> </td> <td class=\"uk-text-center\" width=\"110\"> <a onclick=\"{edit}\" class=\"uk-button uk-button-primary uk-button-small\"><i class=\"fas fa-edit\"></i></a> <a onclick=\"{destroy_object}\" class=\"uk-button uk-button-danger uk-button-small\"><i class=\"fas fa-trash-alt\"></i></a> </td> </tr> </tbody> </table> <ul class=\"uk-pagination\"> <li if=\"{page > 0}\"><a onclick=\"{previousPage}\"><span class=\"uk-margin-small-right\" uk-pagination-previous></span> Previous</a></li> <li if=\"{(page + 1) * perpage < count}\" class=\"uk-margin-auto-left\"><a onclick=\"{nextPage}\">Next <span class=\"uk-margin-small-left\" uk-pagination-next></span></a></li> </ul>', '', '', function(opts) {\n    var self = this\n    this.data = []\n    this.new_item = function(e) {\n      e.preventDefault()\n      riot.mount(\"#\"+opts.id, \"trad_crud_new\", opts)\n    }.bind(this)\n\n    this.loadPage = function(pageIndex) {\n      common.get(url + \"/cruds/sub/\"+opts.parent_id+\"/\"+opts.id+\"/\"+opts.key+\"/page/\"+pageIndex+\"/\"+per_page, function(d) {\n        self.data = d.data[0].data\n        self.cols = _.map(common.array_diff(common.keys(self.data[0]), [\"_id\", \"_key\", \"_rev\"]), function(v) { return { name: v }})\n        if(opts.columns) self.cols = opts.columns\n        self.count = d.data[0].count\n        self.update()\n      })\n    }\n    this.loadPage(1)\n\n    this.edit = function(e) {\n      e.preventDefault()\n      opts.element_id = e.item.row._key\n      riot.mount(\"#\"+opts.id, \"trad_crud_edit\", opts)\n    }.bind(this)\n\n    this.nextPage = function(e) {\n      e.preventDefault()\n      self.page += 1\n      self.loadPage(self.page + 1)\n    }.bind(this)\n\n    this.previousPage = function(e) {\n      e.preventDefault()\n      self.page -= 1\n      self.loadPage(self.page + 1)\n    }.bind(this)\n\n    this.destroy_object = function(e) {\n      e.preventDefault()\n      UIkit.modal.confirm(\"Are you sure?\").then(function() {\n        common.delete(url + \"/cruds/\" + opts.id + \"/\" + e.item.row._key, function() {\n          self.loadPage(1)\n        })\n      }, function() {})\n    }.bind(this)\n});\n\nriot.tag2('trad_crud_edit', '<a href=\"#\" class=\"uk-button uk-button-link\" onclick=\"{goback}\">Back to {opts.id}</a> <form onsubmit=\"{save_form}\" class=\"uk-form\" id=\"{opts.id}_crud_trad\"> </form>', '', '', function(opts) {\n    this.goback = function(e) {\n      e.preventDefault()\n      riot.mount(\"#\"+opts.id, \"trad_crud_index\", opts)\n    }.bind(this)\n\n    this.save_form = function(e) {\n      e.preventDefault()\n      common.saveForm(opts.id+'_crud_trad', \"cruds/sub/\"+opts.parent_name+\"/\"+ opts.id+\"/\"+opts.element_id, \"\", opts)\n    }.bind(this)\n\n    var self = this;\n    common.get(url + \"/cruds/\" + opts.id + \"/\" + opts.element_id, function(d) {\n      self.trad = d.data\n\n      common.buildForm(self.trad, opts.fields, '#'+opts.id+'_crud_trad')\n    })\n    this.on('updated', function() {\n      $(\".select_list\").select2()\n      $(\".select_mlist\").select2()\n      $(\".select_tag\").select2({ tags: true })\n    })\n});\n\nriot.tag2('trad_crud_new', '<a href=\"#\" class=\"uk-button uk-button-link\" onclick=\"{goback}\">Back to {opts.id}</a> <form onsubmit=\"{save_form}\" class=\"uk-form\" id=\"{opts.id}_crud_trad\"> </form>', '', '', function(opts) {\n    var self = this\n    this.crud = {}\n    this.crud[opts.key] = opts.parent_id\n\n    this.goback = function(e) {\n      e.preventDefault()\n      riot.mount(\"#\"+opts.id, \"trad_crud_index\", opts)\n    }.bind(this)\n\n    this.on('mount', function() {\n      common.buildForm(self.crud, opts.fields, '#'+opts.id+'_crud_trad')\n    })\n\n    this.save_form = function(e) {\n      e.preventDefault()\n      common.saveForm(opts.id+'_crud_trad', \"cruds/sub/trads/\"+ opts.id, \"\", opts)\n    }.bind(this)\n\n});\n\nriot.tag2('trad_edit', '<virtual if=\"{can_access}\"> <ul uk-tab> <li><a href=\"#\">trads</a></li> <li each=\"{i, k in sub_models}\"><a href=\"#\">{k}</a></li> </ul> <ul class=\"uk-switcher uk-margin\"> <li> <h3>Editing trad</h3> <form onsubmit=\"{save_form}\" class=\"uk-form\" id=\"form_trad\"> </form> <a class=\"uk-button uk-button-secondary\" onclick=\"{duplicate}\">Duplicate</a> </li> <li each=\"{i, k in sub_models}\"> <div id=\"{k}\" class=\"crud\"></div> </li> </ul> </virtual> <virtual if=\"{!can_access && loaded}\"> Sorry, you can\\'t access this page... </virtual> <script>', '', '', function(opts) {\n    var self = this\n    self.can_access = false\n    self.loaded = false\n\n    this.save_form = function(e) {\n      e.preventDefault()\n      common.saveForm(\"form_trad\", \"cruds/trads\",opts.trad_id)\n    }.bind(this)\n\n    this.duplicate = function(e) {\n      UIkit.modal.confirm(\"Are you sure?\").then(function() {\n        common.get(url + \"/cruds/trads/\" + self.trad._key + \"/duplicate\", function(data) {\n          route('/trads/' + data._key + '/edit')\n          UIkit.notification({\n            message : 'Successfully duplicated!',\n            status  : 'success',\n            timeout : 1000,\n            pos     : 'bottom-right'\n          });\n        })\n      }, function() {})\n    }.bind(this)\n\n    common.get(url + \"/cruds/trads/\" + opts.trad_id, function(d) {\n      self.trad = d.data\n      self.fields = d.fields\n      self.sub_models = d.fields.sub_models\n      var fields = d.fields\n\n      if(!_.isArray(fields)) fields = fields.model\n      common.get(url + \"/auth/whoami\", function(me) {\n        self.can_access = d.fields.roles === undefined || _.includes(d.fields.roles.write, me.role)\n        self.loaded = true\n        self.update()\n        if(self.can_access)\n          common.buildForm(self.trad, fields, '#form_trad', 'trads', function() {\n            $(\".crud\").each(function(i, c) {\n            var id = $(c).attr(\"id\")\n            riot.mount(\"#\" + id, \"trad_crud_index\", { model: id,\n              fields: self.sub_models[id].fields,\n              key: self.sub_models[id].key,\n              singular: self.sub_models[id].singular,\n              columns: self.sub_models[id].columns,\n              parent_id: opts.trad_id,\n              parent_name: \"trads\" })\n          })\n        })\n      })\n    })\n\n    this.on('updated', function() {\n      $(\".select_list\").select2()\n      $(\".select_mlist\").select2()\n      $(\".select_tag\").select2({ tags: true })\n    })\n});\n\nriot.tag2('trad_new', '<virtual if=\"{can_access}\"> <h3>Creating trad</h3> <form onsubmit=\"{save_form}\" class=\"uk-form\" id=\"form_new_trad\"> </form> </virtual> <virtual if=\"{!can_access && loaded}\"> Sorry, you can\\'t access this page... </virtual>', '', '', function(opts) {\n    var self = this\n    self.can_access = false\n    self.loaded = false\n\n    this.save_form = function(e) {\n      e.preventDefault()\n      common.saveForm(\"form_new_trad\", \"cruds/trads\")\n    }.bind(this)\n\n    common.get(url + \"/cruds/trads/fields\", function(d) {\n      common.get(url + \"/auth/whoami\", function(me) {\n        self.can_access = d.fields.roles === undefined || _.includes(d.fields.roles.write, me.role)\n        self.loaded = true\n        self.update()\n        if(self.can_access) {\n\n          var fields = d.fields\n          if(!_.isArray(fields)) fields = fields.model\n          common.buildForm({}, fields, '#form_new_trad', 'trads');\n        }\n      })\n    })\n\n    this.on('updated', function() {\n      $(\".select_list\").select2()\n      $(\".select_mlist\").select2()\n      $(\".select_tag\").select2({ tags: true })\n    })\n});\n\nriot.tag2('trads', '<virtual if=\"{can_access}\"> <div class=\"uk-float-right\"> <a href=\"#trads/new\" class=\"uk-button uk-button-small uk-button-default\"><i class=\"fas fa-plus\"></i> New trad</a> <a if=\"{export}\" onclick=\"{export_data}\" class=\"uk-button uk-button-small uk-button-primary\"><i class=\"fas fa-file-export\"></i> Export CSV</a> </div> <h3>Listing trads</h3> <form onsubmit=\"{filter}\" class=\"uk-margin-top\"> <div class=\"uk-inline uk-width-1-1\"> <span class=\"uk-form-icon\" uk-icon=\"icon: search\"></span> <input type=\"text\" ref=\"term\" id=\"term\" class=\"uk-input\" autocomplete=\"off\"> </div> </form> <table class=\"uk-table uk-table-striped\"> <thead> <tr> <th if=\"{sortable}\" width=\"20\"></th> <th each=\"{col in cols}\">{col.name == undefined ? col : col.label === undefined ? col.name : col.label}</th> <th width=\"70\"></th> </tr> </thead> <tbody id=\"list\"> <tr each=\"{row in data}\"> <td if=\"{sortable}\"><i class=\"fas fa-grip-vertical handle\"></i></td> <td each=\"{col in cols}\" class=\"{col.class}\"> <virtual if=\"{col.toggle == true}\"> <virtual if=\"{col.tr == true}\"><a onclick=\"{toggleField}\" data-key=\"{row._key}\">{col.values ? col.values[row[col.name][locale]] : _.get(row,col.name)[locale]}</a></virtual> <virtual if=\"{col.tr != true}\"><a onclick=\"{toggleField}\" data-key=\"{row._key}\">{col.values ? col.values[row[col.name]] : _.get(row,col.name)}</a></virtual> </virtual> <virtual if=\"{col.toggle != true}\"> <virtual if=\"{col.type == image}\"> <img riot-src=\"{_.get(row,col.name)[locale]} \" style=\"height:25px\"> </virtual> <virtual if=\"{col.type != image}\"> {calc_value(row, col, locale)} </virtual> </virtual> </td> <td class=\"uk-text-center\" width=\"110\"> <a onclick=\"{edit}\" class=\"uk-button uk-button-primary uk-button-small\"><i class=\"fas fa-edit\"></i></a> <a onclick=\"{destroy_object}\" class=\"uk-button uk-button-danger uk-button-small\"><i class=\"fas fa-trash-alt\"></i></a> </td> </tr> </tbody> </table> <ul class=\"uk-pagination\"> <li if=\"{page > 0}\"><a onclick=\"{previousPage}\"><span class=\"uk-margin-small-right\" uk-pagination-previous></span> Previous</a></li> <li if=\"{(page + 1) * perpage < count}\" class=\"uk-margin-auto-left\"><a onclick=\"{nextPage}\">Next <span class=\"uk-margin-small-left\" uk-pagination-next></span></a></li> </ul> Per Page : {perpage > 100000 ? \\'ALL\\' : perpage} <a onclick=\"{setPerPage}\" class=\"uk-label\">25</a> <a onclick=\"{setPerPage}\" class=\"uk-label\">50</a> <a onclick=\"{setPerPage}\" class=\"uk-label\">100</a> <a onclick=\"{setPerPage}\" class=\"uk-label\">500</a> <a onclick=\"{setPerPage}\" class=\"uk-label\">1000</a> <a onclick=\"{setPerPage}\" class=\"uk-label\">ALL</a> </virtual> <virtual if=\"{!can_access && loaded}\"> Sorry, you can\\'t access this page... </virtual>', 'trads .handle,[data-is=\"trads\"] .handle{ cursor: move; }', '', function(opts) {\n\n    var self        = this\n    this.page       = 0\n    this.perpage    = per_page\n    this.locale     = window.localStorage.getItem('foxx-locale')\n    this.data       = []\n    this.export     = false\n    this.can_access = false\n    this.sortable   = false\n    this.loaded     = false\n\n    this.loadPage = function(pageIndex) {\n      self.loaded = false\n      common.get(url + \"/cruds/trads/page/\"+pageIndex+\"/\"+this.perpage, function(d) {\n        self.data = d.data[0].data\n        self.export = !!d.model.export\n        self.cols = _.map(common.array_diff(common.keys(self.data[0]), [\"_id\", \"_key\", \"_rev\"]), function(v) { return { name: v }})\n        if(d.model.columns) self.cols = d.model.columns\n        self.count = d.data[0].count\n        self.sortable = !!d.model.sortable\n        common.get(url + \"/auth/whoami\", function(me) {\n          self.loaded = true\n          self.can_access = d.model.roles === undefined || _.includes(d.model.roles.read, me.role)\n          self.update()\n        })\n      })\n    }\n    this.loadPage(1)\n\n    this.calc_value = function(row, col, locale) {\n      value = _.get(row, col.name)\n      if(col.tr) { value = value[locale] }\n      if(col.truncate) { value = value.substring(0,col.truncate) }\n      if(col.capitalize) { value = _.capitalize(value) }\n      if(col.uppercase) { value = _.toUpper(value) }\n      if(col.downcase) { value = _.toLower(value) }\n      return value\n    }.bind(this)\n\n    this.filter = function(e) {\n      e.preventDefault();\n      if(self.refs.term.value != \"\") {\n        $(\".uk-form-icon i\").attr(\"class\", \"uk-icon-spin uk-icon-spinner\")\n        common.get(url + \"/cruds/trads/search/\"+self.refs.term.value, function(d) {\n          self.data = d.data\n          $(\".uk-form-icon i\").attr(\"class\", \"uk-icon-search\")\n          self.update()\n        })\n      }\n      else {\n        self.loadPage(1)\n      }\n    }.bind(this)\n\n    this.edit = function(e) {\n      route(\"/trads/\" + e.item.row._key + \"/edit\")\n    }.bind(this)\n\n    this.nextPage = function(e) {\n      self.page += 1\n      self.loadPage(self.page + 1)\n    }.bind(this)\n\n    this.previousPage = function(e) {\n      self.page -= 1\n      self.loadPage(self.page + 1)\n    }.bind(this)\n\n    this.destroy_object = function(e) {\n      UIkit.modal.confirm(\"Are you sure?\").then(function() {\n        common.delete(url + \"/cruds/trads/\" + e.item.row._key, function() {\n          self.loadPage(self.page + 1)\n        })\n      }, function() {})\n    }.bind(this)\n\n    this.toggleField = function(e) {\n      e.preventDefault()\n      common.patch(url + \"/cruds/trads/\" + e.target.dataset.key + \"/\" + e.item.col.name + \"/toggle\", \"{}\", function(data) {\n        if(data.success) {\n          e.target.innerText = data.data\n        }\n      })\n    }.bind(this)\n\n    this.setPerPage = function(e) {\n      e.preventDefault()\n      var perpage = parseInt(e.srcElement.innerText)\n      if(e.srcElement.innerText == 'ALL') perpage = 1000000000;\n      this.perpage = perpage\n      this.loadPage(1)\n    }.bind(this)\n\n    this.export_data = function(e) {\n      common.get(url + '/cruds/trads/export', function(d) {\n        var csvContent = d.data\n        var encodedUri = encodeURI(csvContent)\n        var link = document.createElement(\"a\")\n        link.setAttribute(\"href\", encodedUri)\n        link.setAttribute(\"download\", \"trads.csv\")\n        link.innerHTML= \"Click Here to download\"\n        document.body.appendChild(link)\n        link.click()\n        document.body.removeChild(link)\n      })\n    }.bind(this)\n\n    this.on('updated', function() {\n      if(self.sortable) {\n        var el = document.getElementById('list');\n        var sortable = new Sortable(el, {\n          animation: 150,\n          ghostClass: 'blue-background-class',\n          handle: '.fa-grip-vertical',\n          onSort: function ( evt) {\n            common.put(\n              url + 'cruds/trads/orders/' + evt.oldIndex + \"/\" + evt.newIndex, {},\n              function() {}\n            )\n          },\n        });\n      }\n    })\n});\n\n","riot.tag2('images', '<div class=\"sortable_{opts.field}\" style=\"user-select: none;\"> <virtual each=\"{row in data}\"> <div uk-grid class=\"uk-grid-small\" data-id=\"{row._key}\"> <div class=\"uk-width-1-5\"><a href=\"{row.url}\" target=\"_blank\"><img riot-src=\"{row.url}\" alt=\"\" style=\"max-width: 100%\"></a></div> <div class=\"uk-width-3-5\">{row.filename.split(\\'/\\')[row.filename.split(\\'/\\').length - 1]}<br>{prettyBytes(row.length)}</div> <div class=\"uk-width-1-5 uk-text-center\"><a onclick=\"{delete_asset}\" uk-icon=\"icon: trash\"></a></div> </div> </virtual> </div>', 'images div, images span { color: white; }', '', function(opts) {\n    var _this = this\n    this.data = []\n\n    var use_i18n = \"\"\n    if(opts.i18n != \"undefined\") use_i18n = \"/\" + window.localStorage.getItem(\"foxx-locale\")\n    common.get(url + \"uploads/\" + opts.id + '/' + opts.field + use_i18n, function(d) {\n      _this.data = d\n      _this.update()\n    })\n\n    $(function() {\n      UIkit.sortable(\".sortable_\" + opts.field, {})\n      UIkit.util.on(\".sortable_\" + opts.field, 'moved', function(data) {\n        var i = 0\n        var ids = _.map($(\".sortable_\" + opts.field+\" > div\"), function(el) {\n          return { k: \"\" + $(el).data(\"id\"), c: i++ }\n        })\n        common.post(url+\"uploads/reorder\", JSON.stringify({ ids: ids }), function(d) {\n          if(d.success) {\n            UIkit.notification({\n              message : 'Successfully reordered!',\n              status  : 'success',\n              timeout : 1000,\n              pos     : 'bottom-right'\n            });\n          }\n        })\n      })\n    })\n\n    this.delete_asset = function(e) {\n      UIkit.modal.confirm(\"Are you sure?\").then(function() {\n        common.delete(url + \"uploads/\" + e.item.row._key, function() {\n          $('[data-id='+e.item.row._key+']').remove()\n        })\n      }, function() {})\n    }.bind(this)\n});\n\nriot.tag2('files', '<div class=\"sortable_{opts.field}\" style=\"user-select: none;\"> <virtual each=\"{row in data}\"> <div uk-grid class=\"uk-grid-small\" data-id=\"{row._key}\"> <div class=\"uk-width-3-5\">{row.filename} <a href=\"{row.url}\" target=\"_blank\"><i class=\"fas fa-external-link-alt\"></i></a></div> <div class=\"uk-width-1-5 uk-text-right\">{prettyBytes(row.length)}</div> <div class=\"uk-width-1-5 uk-text-center\"><a onclick=\"{delete_asset}\" uk-icon=\"icon: trash\"></a></div> </div> </div>', 'files div, files span { color: white; }', '', function(opts) {\n    var _this = this;\n    this.data = []\n\n    var use_i18n = \"\"\n    if(opts.i18n != \"undefined\") use_i18n = \"/\" + window.localStorage.getItem(\"foxx-locale\")\n\n    common.get(url + \"uploads/\" + opts.id + '/' + opts.field + use_i18n, function(d) {\n      _this.data = d\n      _this.update()\n    })\n\n    this.filename = function(row) {\n      return row.path.split('/').slice(2).join('/')\n    }.bind(this)\n\n    $(function() {\n      UIkit.sortable(\".sortable_\" + opts.field, {})\n      UIkit.util.on(\".sortable_\" + opts.field, 'moved', function(data) {\n        var i = 0\n        var ids = _.map($(\".sortable_\" + opts.field+\" > div\"), function(el) {\n          return { k: \"\" + $(el).data(\"id\"), c: i++ }\n        })\n        common.post(url+\"uploads/reorder\", JSON.stringify({ ids: ids }), function(d) {\n          if(d.success) {\n            UIkit.notification({\n              message : 'Successfully reordered!',\n              status  : 'success',\n              timeout : 1000,\n              pos     : 'bottom-right'\n            });\n          }\n        })\n      })\n    })\n\n    this.delete_asset = function(e) {\n      UIkit.modal.confirm(\"Are you sure?\").then(function() {\n        common.delete(url + \"uploads/\" + e.item.row._key, function() {\n          $('[data-id='+e.item.row._key+']').remove()\n        })\n      }, function() {})\n    }.bind(this)\n});","riot.tag2('user_crud_index', '<a href=\"#\" class=\"uk-button uk-button-small uk-button-default\" onclick=\"{new_item}\"> <i class=\"fas fa-plus\"></i> New {opts.singular} </a> <table class=\"uk-table uk-table-striped\" if=\"{data.length > 0}\"> <thead> <tr> <th each=\"{col in cols}\"> {col.name == undefined ? col : col.label === undefined ? col.name : col.label} </th> <th width=\"70\"></th> </tr> </thead> <tbody> <tr each=\"{row in data}\"> <td each=\"{col in cols}\" class=\"{col.class}\"> <virtual if=\"{col.tr == true}\">{_.get(row,col.name)[locale]}</virtual> <virtual if=\"{col.tr != true}\">{_.get(row,col.name)}</virtual> </td> <td class=\"uk-text-center\" width=\"110\"> <a onclick=\"{edit}\" class=\"uk-button uk-button-primary uk-button-small\"><i class=\"fas fa-edit\"></i></a> <a onclick=\"{destroy_object}\" class=\"uk-button uk-button-danger uk-button-small\"><i class=\"fas fa-trash-alt\"></i></a> </td> </tr> </tbody> </table> <ul class=\"uk-pagination\"> <li if=\"{page > 0}\"><a onclick=\"{previousPage}\"><span class=\"uk-margin-small-right\" uk-pagination-previous></span> Previous</a></li> <li if=\"{(page + 1) * perpage < count}\" class=\"uk-margin-auto-left\"><a onclick=\"{nextPage}\">Next <span class=\"uk-margin-small-left\" uk-pagination-next></span></a></li> </ul>', '', '', function(opts) {\n    var self = this\n    this.data = []\n    this.new_item = function(e) {\n      e.preventDefault()\n      riot.mount(\"#\"+opts.id, \"user_crud_new\", opts)\n    }.bind(this)\n\n    this.loadPage = function(pageIndex) {\n      common.get(url + \"/cruds/sub/\"+opts.parent_id+\"/\"+opts.id+\"/\"+opts.key+\"/page/\"+pageIndex+\"/\"+per_page, function(d) {\n        self.data = d.data[0].data\n        self.cols = _.map(common.array_diff(common.keys(self.data[0]), [\"_id\", \"_key\", \"_rev\"]), function(v) { return { name: v }})\n        if(opts.columns) self.cols = opts.columns\n        self.count = d.data[0].count\n        self.update()\n      })\n    }\n    this.loadPage(1)\n\n    this.edit = function(e) {\n      e.preventDefault()\n      opts.element_id = e.item.row._key\n      riot.mount(\"#\"+opts.id, \"user_crud_edit\", opts)\n    }.bind(this)\n\n    this.nextPage = function(e) {\n      e.preventDefault()\n      self.page += 1\n      self.loadPage(self.page + 1)\n    }.bind(this)\n\n    this.previousPage = function(e) {\n      e.preventDefault()\n      self.page -= 1\n      self.loadPage(self.page + 1)\n    }.bind(this)\n\n    this.destroy_object = function(e) {\n      e.preventDefault()\n      UIkit.modal.confirm(\"Are you sure?\").then(function() {\n        common.delete(url + \"/cruds/\" + opts.id + \"/\" + e.item.row._key, function() {\n          self.loadPage(1)\n        })\n      }, function() {})\n    }.bind(this)\n});\n\nriot.tag2('user_crud_edit', '<a href=\"#\" class=\"uk-button uk-button-link\" onclick=\"{goback}\">Back to {opts.id}</a> <form onsubmit=\"{save_form}\" class=\"uk-form\" id=\"{opts.id}_crud_user\"> </form>', '', '', function(opts) {\n    this.goback = function(e) {\n      e.preventDefault()\n      riot.mount(\"#\"+opts.id, \"user_crud_index\", opts)\n    }.bind(this)\n\n    this.save_form = function(e) {\n      e.preventDefault()\n      common.saveForm(opts.id+'_crud_user', \"cruds/sub/\"+opts.parent_name+\"/\"+ opts.id+\"/\"+opts.element_id, \"\", opts)\n    }.bind(this)\n\n    var self = this;\n    common.get(url + \"/cruds/\" + opts.id + \"/\" + opts.element_id, function(d) {\n      self.user = d.data\n\n      common.buildForm(self.user, opts.fields, '#'+opts.id+'_crud_user')\n    })\n    this.on('updated', function() {\n      $(\".select_list\").select2()\n      $(\".select_mlist\").select2()\n      $(\".select_tag\").select2({ tags: true })\n    })\n});\n\nriot.tag2('user_crud_new', '<a href=\"#\" class=\"uk-button uk-button-link\" onclick=\"{goback}\">Back to {opts.id}</a> <form onsubmit=\"{save_form}\" class=\"uk-form\" id=\"{opts.id}_crud_user\"> </form>', '', '', function(opts) {\n    var self = this\n    this.crud = {}\n    this.crud[opts.key] = opts.parent_id\n\n    this.goback = function(e) {\n      e.preventDefault()\n      riot.mount(\"#\"+opts.id, \"user_crud_index\", opts)\n    }.bind(this)\n\n    this.on('mount', function() {\n      common.buildForm(self.crud, opts.fields, '#'+opts.id+'_crud_user')\n    })\n\n    this.save_form = function(e) {\n      e.preventDefault()\n      common.saveForm(opts.id+'_crud_user', \"cruds/sub/users/\"+ opts.id, \"\", opts)\n    }.bind(this)\n\n});\n\nriot.tag2('user_edit', '<virtual if=\"{can_access}\"> <ul uk-tab> <li><a href=\"#\">users</a></li> <li each=\"{i, k in sub_models}\"><a href=\"#\">{k}</a></li> </ul> <ul class=\"uk-switcher uk-margin\"> <li> <h3>Editing user</h3> <form onsubmit=\"{save_form}\" class=\"uk-form\" id=\"form_user\"> </form> <a class=\"uk-button uk-button-secondary\" onclick=\"{duplicate}\">Duplicate</a> </li> <li each=\"{i, k in sub_models}\"> <div id=\"{k}\" class=\"crud\"></div> </li> </ul> </virtual> <virtual if=\"{!can_access && loaded}\"> Sorry, you can\\'t access this page... </virtual> <script>', '', '', function(opts) {\n    var self = this\n    self.can_access = false\n    self.loaded = false\n\n    this.save_form = function(e) {\n      e.preventDefault()\n      common.saveForm(\"form_user\", \"cruds/users\",opts.user_id)\n    }.bind(this)\n\n    this.duplicate = function(e) {\n      UIkit.modal.confirm(\"Are you sure?\").then(function() {\n        common.get(url + \"/cruds/users/\" + self.user._key + \"/duplicate\", function(data) {\n          route('/users/' + data._key + '/edit')\n          UIkit.notification({\n            message : 'Successfully duplicated!',\n            status  : 'success',\n            timeout : 1000,\n            pos     : 'bottom-right'\n          });\n        })\n      }, function() {})\n    }.bind(this)\n\n    common.get(url + \"/cruds/users/\" + opts.user_id, function(d) {\n      self.user = d.data\n      self.fields = d.fields\n      self.sub_models = d.fields.sub_models\n      var fields = d.fields\n\n      if(!_.isArray(fields)) fields = fields.model\n      common.get(url + \"/auth/whoami\", function(me) {\n        self.can_access = d.fields.roles === undefined || _.includes(d.fields.roles.write, me.role)\n        self.loaded = true\n        self.update()\n        if(self.can_access)\n          common.buildForm(self.user, fields, '#form_user', 'users', function() {\n            $(\".crud\").each(function(i, c) {\n            var id = $(c).attr(\"id\")\n            riot.mount(\"#\" + id, \"user_crud_index\", { model: id,\n              fields: self.sub_models[id].fields,\n              key: self.sub_models[id].key,\n              singular: self.sub_models[id].singular,\n              columns: self.sub_models[id].columns,\n              parent_id: opts.user_id,\n              parent_name: \"users\" })\n          })\n        })\n      })\n    })\n\n    this.on('updated', function() {\n      $(\".select_list\").select2()\n      $(\".select_mlist\").select2()\n      $(\".select_tag\").select2({ tags: true })\n    })\n});\n\nriot.tag2('user_new', '<virtual if=\"{can_access}\"> <h3>Creating user</h3> <form onsubmit=\"{save_form}\" class=\"uk-form\" id=\"form_new_user\"> </form> </virtual> <virtual if=\"{!can_access && loaded}\"> Sorry, you can\\'t access this page... </virtual>', '', '', function(opts) {\n    var self = this\n    self.can_access = false\n    self.loaded = false\n\n    this.save_form = function(e) {\n      e.preventDefault()\n      common.saveForm(\"form_new_user\", \"cruds/users\")\n    }.bind(this)\n\n    common.get(url + \"/cruds/users/fields\", function(d) {\n      common.get(url + \"/auth/whoami\", function(me) {\n        self.can_access = d.fields.roles === undefined || _.includes(d.fields.roles.write, me.role)\n        self.loaded = true\n        self.update()\n        if(self.can_access) {\n\n          var fields = d.fields\n          if(!_.isArray(fields)) fields = fields.model\n          common.buildForm({}, fields, '#form_new_user', 'users');\n        }\n      })\n    })\n\n    this.on('updated', function() {\n      $(\".select_list\").select2()\n      $(\".select_mlist\").select2()\n      $(\".select_tag\").select2({ tags: true })\n    })\n});\n\nriot.tag2('users', '<virtual if=\"{can_access}\"> <div class=\"uk-float-right\"> <a href=\"#users/new\" class=\"uk-button uk-button-small uk-button-default\"><i class=\"fas fa-plus\"></i> New user</a> <a if=\"{export}\" onclick=\"{export_data}\" class=\"uk-button uk-button-small uk-button-primary\"><i class=\"fas fa-file-export\"></i> Export CSV</a> </div> <h3>Listing users</h3> <form onsubmit=\"{filter}\" class=\"uk-margin-top\"> <div class=\"uk-inline uk-width-1-1\"> <span class=\"uk-form-icon\" uk-icon=\"icon: search\"></span> <input type=\"text\" ref=\"term\" id=\"term\" class=\"uk-input\" autocomplete=\"off\"> </div> </form> <table class=\"uk-table uk-table-striped\"> <thead> <tr> <th if=\"{sortable}\" width=\"20\"></th> <th each=\"{col in cols}\">{col.name == undefined ? col : col.label === undefined ? col.name : col.label}</th> <th width=\"70\"></th> </tr> </thead> <tbody id=\"list\"> <tr each=\"{row in data}\"> <td if=\"{sortable}\"><i class=\"fas fa-grip-vertical handle\"></i></td> <td each=\"{col in cols}\" class=\"{col.class}\"> <virtual if=\"{col.toggle == true}\"> <virtual if=\"{col.tr == true}\"><a onclick=\"{toggleField}\" data-key=\"{row._key}\">{col.values ? col.values[row[col.name][locale]] : _.get(row,col.name)[locale]}</a></virtual> <virtual if=\"{col.tr != true}\"><a onclick=\"{toggleField}\" data-key=\"{row._key}\">{col.values ? col.values[row[col.name]] : _.get(row,col.name)}</a></virtual> </virtual> <virtual if=\"{col.toggle != true}\"> <virtual if=\"{col.type == image}\"> <img riot-src=\"{_.get(row,col.name)[locale]} \" style=\"height:25px\"> </virtual> <virtual if=\"{col.type != image}\"> {calc_value(row, col, locale)} </virtual> </virtual> </td> <td class=\"uk-text-center\" width=\"110\"> <a onclick=\"{edit}\" class=\"uk-button uk-button-primary uk-button-small\"><i class=\"fas fa-edit\"></i></a> <a onclick=\"{destroy_object}\" class=\"uk-button uk-button-danger uk-button-small\"><i class=\"fas fa-trash-alt\"></i></a> </td> </tr> </tbody> </table> <ul class=\"uk-pagination\"> <li if=\"{page > 0}\"><a onclick=\"{previousPage}\"><span class=\"uk-margin-small-right\" uk-pagination-previous></span> Previous</a></li> <li if=\"{(page + 1) * perpage < count}\" class=\"uk-margin-auto-left\"><a onclick=\"{nextPage}\">Next <span class=\"uk-margin-small-left\" uk-pagination-next></span></a></li> </ul> Per Page : {perpage > 100000 ? \\'ALL\\' : perpage} <a onclick=\"{setPerPage}\" class=\"uk-label\">25</a> <a onclick=\"{setPerPage}\" class=\"uk-label\">50</a> <a onclick=\"{setPerPage}\" class=\"uk-label\">100</a> <a onclick=\"{setPerPage}\" class=\"uk-label\">500</a> <a onclick=\"{setPerPage}\" class=\"uk-label\">1000</a> <a onclick=\"{setPerPage}\" class=\"uk-label\">ALL</a> </virtual> <virtual if=\"{!can_access && loaded}\"> Sorry, you can\\'t access this page... </virtual>', 'users .handle,[data-is=\"users\"] .handle{ cursor: move; }', '', function(opts) {\n\n    var self        = this\n    this.page       = 0\n    this.perpage    = per_page\n    this.locale     = window.localStorage.getItem('foxx-locale')\n    this.data       = []\n    this.export     = false\n    this.can_access = false\n    this.sortable   = false\n    this.loaded     = false\n\n    this.loadPage = function(pageIndex) {\n      self.loaded = false\n      common.get(url + \"/cruds/users/page/\"+pageIndex+\"/\"+this.perpage, function(d) {\n        self.data = d.data[0].data\n        self.export = !!d.model.export\n        self.cols = _.map(common.array_diff(common.keys(self.data[0]), [\"_id\", \"_key\", \"_rev\"]), function(v) { return { name: v }})\n        if(d.model.columns) self.cols = d.model.columns\n        self.count = d.data[0].count\n        self.sortable = !!d.model.sortable\n        common.get(url + \"/auth/whoami\", function(me) {\n          self.loaded = true\n          self.can_access = d.model.roles === undefined || _.includes(d.model.roles.read, me.role)\n          self.update()\n        })\n      })\n    }\n    this.loadPage(1)\n\n    this.calc_value = function(row, col, locale) {\n      value = _.get(row, col.name)\n      if(col.tr) { value = value[locale] }\n      if(col.truncate) { value = value.substring(0,col.truncate) }\n      if(col.capitalize) { value = _.capitalize(value) }\n      if(col.uppercase) { value = _.toUpper(value) }\n      if(col.downcase) { value = _.toLower(value) }\n      return value\n    }.bind(this)\n\n    this.filter = function(e) {\n      e.preventDefault();\n      if(self.refs.term.value != \"\") {\n        $(\".uk-form-icon i\").attr(\"class\", \"uk-icon-spin uk-icon-spinner\")\n        common.get(url + \"/cruds/users/search/\"+self.refs.term.value, function(d) {\n          self.data = d.data\n          $(\".uk-form-icon i\").attr(\"class\", \"uk-icon-search\")\n          self.update()\n        })\n      }\n      else {\n        self.loadPage(1)\n      }\n    }.bind(this)\n\n    this.edit = function(e) {\n      route(\"/users/\" + e.item.row._key + \"/edit\")\n    }.bind(this)\n\n    this.nextPage = function(e) {\n      self.page += 1\n      self.loadPage(self.page + 1)\n    }.bind(this)\n\n    this.previousPage = function(e) {\n      self.page -= 1\n      self.loadPage(self.page + 1)\n    }.bind(this)\n\n    this.destroy_object = function(e) {\n      UIkit.modal.confirm(\"Are you sure?\").then(function() {\n        common.delete(url + \"/cruds/users/\" + e.item.row._key, function() {\n          self.loadPage(self.page + 1)\n        })\n      }, function() {})\n    }.bind(this)\n\n    this.toggleField = function(e) {\n      e.preventDefault()\n      common.patch(url + \"/cruds/users/\" + e.target.dataset.key + \"/\" + e.item.col.name + \"/toggle\", \"{}\", function(data) {\n        if(data.success) {\n          e.target.innerText = data.data\n        }\n      })\n    }.bind(this)\n\n    this.setPerPage = function(e) {\n      e.preventDefault()\n      var perpage = parseInt(e.srcElement.innerText)\n      if(e.srcElement.innerText == 'ALL') perpage = 1000000000;\n      this.perpage = perpage\n      this.loadPage(1)\n    }.bind(this)\n\n    this.export_data = function(e) {\n      common.get(url + '/cruds/users/export', function(d) {\n        var csvContent = d.data\n        var encodedUri = encodeURI(csvContent)\n        var link = document.createElement(\"a\")\n        link.setAttribute(\"href\", encodedUri)\n        link.setAttribute(\"download\", \"users.csv\")\n        link.innerHTML= \"Click Here to download\"\n        document.body.appendChild(link)\n        link.click()\n        document.body.removeChild(link)\n      })\n    }.bind(this)\n\n    this.on('updated', function() {\n      if(self.sortable) {\n        var el = document.getElementById('list');\n        var sortable = new Sortable(el, {\n          animation: 150,\n          ghostClass: 'blue-background-class',\n          handle: '.fa-grip-vertical',\n          onSort: function ( evt) {\n            common.put(\n              url + 'cruds/users/orders/' + evt.oldIndex + \"/\" + evt.newIndex, {},\n              function() {}\n            )\n          },\n        });\n      }\n    })\n});\n\n"]}