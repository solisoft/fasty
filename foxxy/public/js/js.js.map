{"version":3,"sources":["app/index.html","app/js/common.js","app/js/config.js","app/js/editor.js","app/js/js.js","app/widgets/datasets.html.tag","app/widgets/loading.html.tag","app/widgets/login.html.tag","app/widgets/settings.html.tag","app/widgets/uploads.html.tag"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;CCAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA1dA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AAJA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAr3BA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAzEA;AAAA;CCAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAhiBA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAhDA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAfA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA7BA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA/GA;AAAA","file":"public/js/js.js","sourcesContent":["","var Common = {\n  init: function init(){\n    $.fn.serializeObject = function() {\n      var o = {}\n      var a = this.serializeArray()\n      $.each(a, function() {\n        if (o[this.name] !== undefined) {\n          if (!o[this.name].push) {\n            o[this.name] = [o[this.name]]\n          }\n          o[this.name].push(this.value || '')\n        } else {\n          o[this.name] = this.value || ''\n        }\n      })\n      return o\n    }\n  },\n\n  startEditor: function (name, mode, id) {\n    var editor = ace.edit(name)\n    editor.setTheme(\"ace/theme/twilight\")\n    editor.getSession().setMode(mode)\n    editor.setOptions({ tabSize: 2, useSoftTabs: true })\n    editor.getSession().setUseWrapMode(true)\n    editor.getSession().setValue(unescape($(\"#\" + id).val()))\n    editor.getSession().on('change', function () { $(\"#\" + id).val(editor.getSession().getValue()) })\n  },\n\n  checkConditions: function checkConditions(fields, formId) {\n    _.each(fields, function (field) {\n      if (field.if) {\n        if ($('#' + field.if[0]).val() != field.if[1]) {\n          $('#field_' + field.n).hide()\n        } else {\n          $('#field_' + field.n).show()\n        }\n      }\n    })\n  },\n\n  buildForm: function buildForm(obj, fields, formId, back_str, callback) {\n\n    var html = \"\"\n    var uploads = []\n    var _this = this\n    var editors = []\n    var values = []\n    var positions = []\n    var wysiwygs = []\n    var html_editors = []\n    var usetab = false\n    var tabs = []\n    var tab_last_id = ''\n    var y = 0\n    var _html = ''\n\n    fields.forEach(function(l, i) {\n      if (l.tab) {\n        if (y > 0) html += \"</div>\"\n        if (usetab == false) html += '<ul uk-tab>'\n        if (usetab == false) tabs = []\n        usetab = true\n        html += '<li><a href=\"#\">' + l.tab + '</a></li>'\n        if (html != '') {\n          tabs.push(_html)\n          _html = ''\n        }\n        tab_last_id = l.id\n\n        y = 0\n      } else {\n        if (l.h !== undefined) {\n          _html += '<div class=\"uk-grid uk-grid-small uk-margin-top\"><h3>'+ l.h +'</h3></div>'\n        }\n        else {\n          if (l.r && y > 0) _html += '</div>'\n          if (l.r) _html += '<div class=\"uk-grid uk-grid-small\">'\n          if (l.c && l.c.indexOf(\"uk-width\") == -1) l.c = \"uk-width-\" + l.c\n\n          var validation = l.j\n          if (obj['_key'] && l.ju) validation = l.ju\n\n          var hidden = ''\n          if(l.t === 'hidden') hidden = 'uk-hidden'\n\n          _html += '<div class=\"' + l.c + ' ' + hidden + '\" id=\"field_' + l.n + '\">'\n\n          var title = l.l\n\n          if (_.isString(validation)) {\n            if (validation.indexOf('required') > 0) {\n              title = \"<strong>\" + title + \"*</strong>\"\n            }\n          } else {\n            if (validation && validation._flags.presence === \"required\") {\n              title = \"<strong>\" + title + \"*</strong>\"\n            }\n          }\n\n          if (!((l.t === \"file\" || l.t === \"image\") && obj._id === undefined))\n            _html += '<label for=\"\" class=\"uk-form-label\">'+ title +'</label>'\n\n          var value = obj[l.n]\n          if(l.tr && obj[l.n]) value = obj[l.n][window.localStorage.getItem('foxx-locale')]\n          if (value === undefined) value = \"\"\n\n          //value = escape(value)\n          if(l.t.match(/string/)) {\n            _html += '<input type=\"'+(l.t.split(\":\").length == 2 ? l.t.split(\":\")[1] : \"text\")+'\" id=\"'+l.n+'\" class=\"uk-input\" name=\"'+ l.n +'\" value=\"\" autocomplete=\"off\"><div data-hint=\"'+ l.n +'\" class=\"uk-text-danger\"></div>'\n            values.push([l.n, value])\n          }\n          if(l.t.match(/password/)) {\n            _html += '<input type=\"password\" id=\"'+l.n+'\" class=\"uk-input\" name=\"'+ l.n +'\" value=\"\" autocomplete=\"off\"><div data-hint=\"'+ l.n +'\" class=\"uk-text-danger\"></div>'\n          }\n          if(l.t === \"integer\") {\n            _html += '<input type=\"number\" id=\"'+l.n+'\" class=\"uk-input\" name=\"'+ l.n +'\" value=\"'+value+'\" autocomplete=\"off\"><div data-hint=\"'+ l.n +'\" class=\"uk-text-danger\"></div>'\n            values.push([l.n, value])\n          }\n          if(l.t === \"float\") {\n            _html += '<input type=\"text\" id=\"'+l.n+'\" class=\"uk-input\" name=\"'+ l.n +'\" value=\"'+value+'\" autocomplete=\"off\"><div data-hint=\"'+ l.n +'\" class=\"uk-text-danger\"></div>'\n            values.push([l.n, value])\n          }\n          if(l.t === \"hidden\") _html += '<input type=\"hidden\" id=\"'+l.n+'\"  name=\"'+ l.n +'\"  value=\"'+value+'\"></div><div data-hint=\"'+ l.n +'\">'\n          if(l.t === \"date\") _html += '<div><div class=\"uk-inline\"><span class=\"uk-form-icon\" uk-icon=\"icon: calendar\"></span><input type=\"date\" id=\"'+l.n+'\" data-date-format=\"YYYY/MM/DD\" class=\"uk-input\" name=\"'+ l.n +'\"  value=\"'+value+'\"></div><div data-hint=\"'+ l.n +'\" class=\"uk-text-danger\"></div></div>'\n          if (l.t === \"datetime\") {\n            value = value.replace(\":00.000\", \"\")\n            _html += '<div><div class=\"uk-inline\"><span class=\"uk-form-icon\" uk-icon=\"icon: calendar\"></span><input type=\"text\" id=\"' + l.n + '\" class=\"uk-input datepicker-here\" data-language=\"en\" name=\"' + l.n + '\"  value=\"' + value + '\" autocomplete=\"off\"></div><div data-hint=\"' + l.n + '\" class=\"uk-text-danger\"></div></div>'\n          }\n          if(l.t === \"time\") _html += '<div><div class=\"uk-inline\"><span class=\"uk-form-icon\" uk-icon=\"icon: calendar\"></span><input type=\"time\" id=\"'+l.n+'\" class=\"uk-input\" name=\"'+ l.n +'\"  value=\"'+value+'\"></div><div data-hint=\"'+ l.n +'\" class=\"uk-text-danger\"></div></div>'\n          if(l.t === \"text\") _html += '<textarea id=\"'+l.n+'\" class=\"uk-textarea\" name=\"'+ l.n +'\" style=\"'+l.s+'\">'+ value +'</textarea><div data-hint=\"'+ l.n +'\" class=\"uk-text-danger\"></div>'\n            if(l.t === \"wysiwyg\") {\n            wysiwygs.push(l.n)\n            _html += '<textarea id=\"'+l.n+'\" name=\"'+ l.n +'\" ></textarea><div data-hint=\"'+ l.n +'\" class=\"uk-text-danger\"></div>'\n            values.push([l.n, value])\n          }\n          if(l.t.match(/^code/)) {\n            _html += '<input type=\"hidden\" id=\"'+l.n+'\" name=\"'+ l.n +'\" value=\"\">'\n            values.push([l.n, value])\n            _html += '<div id=\"editor_'+l.n+'\" class=\"editor\" style=\"'+l.s+'\"></div>'\n            editors.push([\"editor_\"+l.n, \"ace/mode/\" + l.t.split(\":\")[1], l.n])\n          }\n          if (l.t == 'html') {\n            _html += '<input type=\"hidden\" id=\"'+l.n+'\" name=\"'+ l.n +'\" value=\"\">'\n            _html += '<div id=\"html_editor_'+l.n+'\" data-name=\"'+l.n+'\" class=\"html_editor\" style=\"'+l.s+'\"></div>'\n            html_editors.push([l.n, value])\n          }\n          if(l.t === \"list\") {\n            _html += '<select name=\"' + l.n + '\" style=\"width:100%\" class=\"uk-select select_list\" id=\"' + l.n + '\">'\n            if(l.empty === true) _html += '<option value=\"\">--</option>'\n            l.d.forEach(function(o) {\n              selected = \"\"\n              if(value === o[0]) selected=\"selected='selected'\"\n              _html += '<option value=\"'+ o[0] +'\" '+selected+'>'+ o[1] +'</option>'\n            })\n            _html += '</select>'\n          }\n          if(l.t === \"multilist\") {\n            _html += '<select name=\"'+ l.n +'\" style=\"width:100%\" class=\"uk-select select_mlist\" multiple=\"multiple\" id=\"'+l.n+'\">'\n            l.d.forEach(function(o) {\n              selected = \"\"\n              if(value && value.indexOf(o[0]) >= 0) selected=\"selected='selected'\"\n              _html += '<option value=\"'+ o[0] +'\" '+selected+'>'+ o[1] +'</option>'\n            })\n            _html += '</select>'\n          }\n          if(l.t === \"tags\") {\n            _html +='<select name=\"'+l.n+'\" style=\"width:100%\" class=\"select_tag\" multiple=\"multiple\">'\n            var tags = _.filter(l.d[0], function (t) { return t != \"undefined\" })\n            if (l.tr) tags = _.flatten(_.map(tags, function (t) { return t[window.localStorage.getItem('foxx-locale')] }))\n            _.uniq(tags).forEach(function (v) {\n              if(v != 'undefined' && v != '' && v != undefined) {\n                selected = \"\"\n                if(value && value.indexOf(v) >= 0) selected=\"selected='selected'\"\n                _html += '<option value=\"'+ v +'\" '+selected+'>'+ v +'</option>'\n              }\n            })\n            _html +='</select>'\n          }\n\n          if(l.t === \"map\") {\n            if(value === \"\") value = [0,0]\n            _html += '<div class=\"uk-text-center\" id=\"'+l.n+'_infos\"><span class=\"uk-label\"></span></div>'\n            _html += '<div id=\"map_'+l.n+'\" class=\"map\" style=\"'+l.s+'\"></div>'\n            _html += '<input id=\"'+l.n+'_lat\" type=\"hidden\" name=\"'+l.n+'\" value=\"'+value[0]+'\" />'\n            _html += '<input id=\"'+l.n+'_lng\" type=\"hidden\" name=\"'+l.n+'\" value=\"'+value[1]+'\" />'\n            positions.push([l.n, value])\n          }\n          if(l.t === \"image\" && obj._id) {\n            _html += '<div id=\"upload-drop_'+l.n+'\" class=\"js-upload uk-placeholder uk-text-center\">'\n            _html += '    <span uk-icon=\"icon: cloud-upload\"></span>'\n            _html += '    <span class=\"uk-text-middle\">Attach images by dropping them here or</span>'\n            _html += '    <div uk-form-custom>'\n            _html += '        <input type=\"file\" multiple>'\n            _html += '        <span class=\"uk-link\">selecting one</span>'\n            _html += '    </div>'\n            _html += '</div>'\n            _html += '<progress id=\"progressbar_'+l.n+'\" class=\"uk-progress\" value=\"0\" max=\"100\" hidden></progress>'\n\n            _html += '<images i18n=\"'+l.tr+'\" field=\"'+l.n+'\" id=\"'+obj._id+'\" />'\n            uploads.push([obj._key, obj._id.split('/')[0], l.n, '*.(jpg|jpeg|gif|png)', 'progressbar_'+l.n, '#upload-drop_'+l.n, l.tr])\n          }\n          if(l.t === \"file\" && obj._id) {\n            _html += '<div id=\"upload-drop_'+l.n+'\" class=\"js-upload uk-placeholder uk-text-center\">'\n            _html += '    <span uk-icon=\"icon: cloud-upload\"></span>'\n            _html += '    <span class=\"uk-text-middle\">Attach binaries by dropping them here or</span>'\n            _html += '    <div uk-form-custom>'\n            _html += '        <input type=\"file\" multiple>'\n            _html += '        <span class=\"uk-link\">selecting one</span>'\n            _html += '    </div>'\n            _html += '</div>'\n            _html += '<progress id=\"progressbar_'+l.n+'\" class=\"uk-progress\" value=\"0\" max=\"100\" hidden></progress>'\n            _html += '<files i18n=\"'+l.tr+'\" field=\"'+l.n+'\" id=\"'+obj._id+'\" />'\n            uploads.push([obj._key, obj._id.split('/')[0], l.n, '*.*', 'progressbar_'+l.n, '#upload-drop_'+l.n, l.tr])\n          }\n          if(l.t === \"boolean\") {\n            var checked = obj[l.n] === true ? \" checked='checked' \" : ''\n            _html += ' <input name=\"'+ l.n +'\" '+ checked +'  class=\"uk-checkbox\" type=\"checkbox\" value=\"1\"  /> '\n          }\n\n          _html += '</div>'\n\n          if (!usetab) {\n            html += _html\n            _html = ''\n          }\n\n          if (l.endtab == true) {\n            if (html != '') tabs.push(_html)\n            _html = ''\n            usetab = false\n            html += '</ul><ul class=\"uk-switcher\">{{'+tab_last_id+'}}</ul>'\n          }\n          y++\n        }\n      }\n    })\n\n    html += '</div>'\n\n    if (tabs.length > 0) {\n      var switcher = \"\"\n      _.each(tabs, function (t) { if (t!='') switcher += \"<li>\" + t + \"</li>\" })\n      html = html.replace('{{'+ tab_last_id +'}}', switcher)\n    }\n\n    html += '<hr><div class=\"uk-grid uk-grid-small uk-text-right\"><div class=\"uk-width-1-1\">'\n\n    if (back_str != undefined) { html += '<a href=\"#' + back_str + '\" class=\"uk-button\">Back</a> ' }\n\n    html += '<input type=\"submit\" class=\"uk-button uk-button-primary\" value=\"Save\" /></div></div><hr>'\n\n    $(formId).html(html)\n\n    $(formId).find('select').on('change', function () { _this.checkConditions(fields, formId) })\n\n    _this.checkConditions(fields, formId)\n\n    values.forEach(function (v, i) { $(formId + \" #\" + v[0]).val(v[1]) })\n\n    $('.datepicker-here').datepicker({\n      language: 'en', timepicker: true,\n      timeFormat: 'hh:ii',\n      dateFormat: 'yyyy-mm-dd'\n    })\n\n    html_editors.forEach(function (e, i) {\n      if(_.isString(e[1])) {\n        try { e[1] = JSON.parse(e[1]) } catch(e) {}\n      }\n      $('#html_editor_' + e[0]).contentEditor({ value: e[1].html || '' })\n      $(\"#\" + e[0]).val(JSON.stringify(e[1]))\n    })\n    editors.forEach(function(e, i) { _this.startEditor(e[0], e[1], e[2]) })\n    wysiwygs.forEach(function (e, i) { $(\"#\" + e).trumbowyg(); })\n\n    $(\"button\").attr(\"type\", \"button\") // TODO : remove once Pell accept PR\n    positions.forEach(function(p, i) {\n      var mymap = L.map('map_' + p[0], { dragging: true, tap: false}).setView(p[1], 6)\n      L.tileLayer('https://stamen-tiles-{s}.a.ssl.fastly.net/toner-lite/{z}/{x}/{y}.png', {\n        attribution: 'Map tiles by <a href=\"http://stamen.com\">Stamen Design</a>, <a href=\"http://creativecommons.org/licenses/by/3.0\">CC BY 3.0</a> &mdash; Map data &copy; <a href=\"http://www.openstreetmap.org/copyright\">OpenStreetMap</a>',\n        subdomains: 'abcd',\n        minZoom: 0,\n        maxZoom: 20,\n        ext: 'png'\n      }).addTo(mymap)\n      mymap.scrollWheelZoom.disable()\n      var marker = L.marker(p[1], { draggable: true }).addTo(mymap)\n      $('#'+p[0]+'_infos span').html(p[1].join(', '))\n      marker.on('dragend', function(data) {\n        var coords = data.target.getLatLng()\n        $('#'+p[0]+'_lat').val(coords.lat)\n        $('#'+p[0]+'_lng').val(coords.lng)\n        $('#'+p[0]+'_infos span').html([coords.lat, coords.lng].join(', '))\n      })\n\n      setTimeout(function() { mymap.invalidateSize(true) }, 0)\n    })\n\n    var _this = this\n    uploads.forEach(function(u) {\n      _this.prepare_upload(u[0], u[1], u[2], u[3], u[4], u[5], u[6])\n    })\n\n    riot.mount(\"images\"); riot.mount(\"files\")\n    riot.update()\n\n    if (callback !== undefined) { callback() }\n  },\n\n  checkLogin: function checkLogin() {\n    this.ajax(url + \"auth/whoami\", \"GET\", \"\", function(d) {\n      if(d.username === null) document.location.href = \"login.html\";\n    })\n  },\n\n  saveForm: function (formID, path, objID, opts) {\n    objID = objID||\"\"\n    opts = opts||{}\n    var _this = this\n    var json = $(\"#\"+ formID).serializeObject()\n    _.each(json, function(v, k) { if(k.split('-')[0] == \"trumbowyg\") delete json[k] })\n\n    $('.select_tag, .select_mlist').each(function(i, st) {\n      if(typeof json[$(st).attr(\"name\")] === \"string\") {\n        json[$(st).attr(\"name\")] = [ json[$(st).attr(\"name\")] ]\n      }\n    })\n\n    $(\"div[data-hint]\").html(\"\")\n    var selector = \"#\" + formID + \" textarea, #\"+ formID + \" input, #\"+ formID + \" select\"\n\n    $(selector).removeClass(\"uk-form-danger\")\n    $(selector).removeClass(\"uk-form-success\")\n    $(selector).addClass(\"uk-form-success\")\n\n    _this.ajax(url + path + \"/\" + objID, \"POST\", JSON.stringify(json), function(d) {\n      if(d.errors.length > 0) {\n        d.errors.forEach(function(e) {\n          $(\"#\" + e.path).removeClass(\"uk-form-success\")\n          $(\"#\" + e.path).addClass(\"uk-form-danger\")\n          $(\"div[data-hint=\"+e.path+\"]\").html(\"<div>\"+e.message.replace(/\"(.*)\"/, '').trim()+\"</div>\")\n        })\n      } else {\n        UIkit.notification({\n          message : 'Successfully saved!',\n          status  : 'success',\n          timeout : 1000,\n          pos     : 'bottom-right'\n        });\n        if(objID == \"\" && _.isEmpty(opts)) {\n          objID = d.data._key\n          if(path.split('/')[0] != 'datasets')\n            path = path.split(\"/\").length == 2 ? path.split(\"/\")[1] : path\n          route(\"/\"+ path +\"/\" + objID + \"/edit\")\n        }\n        if(!_.isEmpty(opts) && opts.element_id == undefined) {\n          riot.mount(\"#\"+opts.id, _.last(formID.split(\"_\")) + \"_crud_index\", opts)\n        }\n      }\n      setTimeout(function() {\n        $(selector).removeClass(\"uk-form-success\")\n      }, 300 )\n    })\n\n  },\n\n  ajax: function(url, method, dataForm, callback, errorCallback) {\n    if(typeof(errorCallback) === \"undefined\") errorCallback = function() {}\n    $.ajax({\n      url: url,\n      data: dataForm || \"\",\n      type: method,\n      beforeSend: function(xhr){\n        var x = localStorage.getItem('X-Session-Id')\n        if(x !== null) {\n          xhr.setRequestHeader('foxx-locale', localStorage.getItem('foxx-locale'))\n          xhr.setRequestHeader('X-Session-Id', localStorage.getItem('X-Session-Id'))\n        }\n      },\n      success: function(data, textStatus, request) {\n        if(request.getResponseHeader('X-Session-Id'))\n          localStorage.setItem('X-Session-Id',request.getResponseHeader('X-Session-Id'))\n        callback(data)\n      },\n      statusCode: {\n        401: function() { document.location.href = \"/static/admin/login.html\" },\n        500: errorCallback(),\n        503: function() {\n          localStorage.removeItem('X-Session-Id')\n          localStorage.removeItem('foxx-locale')\n          document.location.href = \"/static/admin/login.html\"\n        }\n      }\n    });\n  },\n\n  get: function(url, callback, errorCallback) {\n    this.ajax(url, \"GET\", \"\", callback, errorCallback)\n  },\n  delete: function(url, callback, errorCallback) {\n    this.ajax(url, \"DELETE\", \"\", callback, errorCallback)\n  },\n  post: function(url, json, callback, errorCallback) {\n    this.ajax(url, \"POST\", json, callback, errorCallback)\n  },\n  patch: function(url, json, callback, errorCallback) {\n    this.ajax(url, \"PATCH\", json, callback, errorCallback)\n  },\n  put: function(url, json, callback, errorCallback) {\n    this.ajax(url, \"PUT\", json, callback, errorCallback)\n  },\n\n  array_diff: function(a, b) {\n    return a.filter(function(i) {return b.indexOf(i) < 0;});\n  },\n\n  keys: function(h) {\n    var keys = []\n    for(var k in h) keys.push(k)\n    return keys\n  },\n\n  prepare_upload: function(key, collection, field, filter, progressbar_id, drop_id, i18n) {\n\n    var bar = document.getElementById(progressbar_id);\n\n    UIkit.upload(drop_id, {\n      url: '/file/upload/' + key + '/' + collection + '/' + field, // upload url,\n      multiple: true,\n      allow: filter,\n\n      error: function () {\n        console.log('error', arguments);\n      },\n\n      beforeSend: function(env) {\n        env.headers = {\n          'X-Session-Id': localStorage.getItem('X-Session-Id'),\n          'foxx-locale': i18n == true ? localStorage.getItem('foxx-locale') : null\n        }\n      },\n\n      loadStart: function (e) {\n        bar.removeAttribute('hidden');\n        bar.max = e.total;\n        bar.value = e.loaded;\n      },\n\n      progress: function (e) {\n        bar.max = e.total;\n        bar.value = e.loaded;\n      },\n\n      loadEnd: function (e) {\n        bar.max = e.total;\n        bar.value = e.loaded;\n      },\n\n      completeAll: function () {\n        bar.value = 100;\n        setTimeout(function(){\n          bar.setAttribute('hidden', null);\n          riot.mount(\"images\"); riot.mount(\"files\")\n          riot.update()\n\n        }, 250);\n      }\n\n    });\n  }\n\n};\n\nmodule.exports = Common;","var Config = {\n  \".fasty.ovh\": \"https://fasty.ovh/_db/\"\n};\n\nmodule.exports = Config;","/* jshint asi: true */\n(function ($) {\n\n  $.fn.contentEditor = function (options) {\n\n    var object_name = $(this).attr('data-name') || 'solicms'\n\n    var self = this\n\n    var settings = $.extend({\n      widgets: [\n        { id: 'h1', icon: 'fas fa-heading', title: 'h1' },\n        { id: 'h2', icon: 'fas fa-heading', title: 'h2' },\n        { id: 'h3', icon: 'fas fa-heading', title: 'h3' },\n        { id: 'h4', icon: 'fas fa-heading', title: 'h4' },\n        { id: 'h5', icon: 'fas fa-heading', title: 'h5' },\n        { id: 'h6', icon: 'fas fa-heading', title: 'h6' },\n        { id: 'col2', icon: 'fas fa-columns', title: '2' },\n        { id: 'col3', icon: 'fas fa-columns', title: '3' },\n        { id: 'col4', icon: 'fas fa-columns', title: '4' },\n        { id: 'col363', icon: 'fas fa-columns', title: '3-6-3' },\n        { id: 'col48', icon: 'fas fa-columns', title: '4-8' },\n        { id: 'col84', icon: 'fas fa-columns', title: '8-4' },\n        { id: 'text', icon: 'fas fa-align-left', title: 'text' },\n        { id: 'img', icon: 'fas fa-image', title: 'img' },\n        { id: 'slide', icon: 'fas fa-images', title: 'slide' },\n        { id: 'code', icon: 'fas fa-code', title: 'code' },\n        { id: 'video', icon: 'fas fa-video', title: 'video' },\n        { id: 'html5', icon: 'fab fa-html5', title: 'html5' }\n      ],\n    }, options)\n\n    var dragObj, activeObj, loopid = 0, editObj, ace_editor, widgets;\n\n    var LSet = function (key, val) { window.localStorage.setItem(key, val) }\n    var LGet = function (key) { return window.localStorage.getItem(key) }\n    var LDel = function (key) { return window.localStorage.removeItem(key) }\n\n    LDel('editor-history')\n\n    var ipsum = function (nb) {\n      var array = 'Chocolate lollipop pastry tiramisu. Chocolate cake sweet roll dragée. Cookie halvah tootsie roll cupcake candy canes pie oat cake danish chocolate cake. Cheesecake biscuit powder sweet powder. Chocolate bar lollipop jelly-o chocolate cake. Sweet roll sweet roll cupcake topping chocolate cake. Fruitcake chocolate cake jelly-o. Marzipan candy canes jujubes. Cotton candy candy canes icing sesame snaps chocolate cake toffee liquorice jelly-o. Pastry pastry bear claw toffee. Liquorice biscuit dessert chocolate bar gummies. Carrot cake danish cookie croissant toffee gingerbread sweet roll. Icing danish muffin cheesecake jelly-o sugar plum pastry cotton candy. Chocolate bar pie apple pie chocolate bar cupcake lollipop.'.split('.')\n      var output = []\n      for (var i = 0; i < nb; i++) {\n        output.push(array[parseInt((Math.random() * 1000) % array.length)])\n      }\n      return output.join('. ') + '.'\n    }\n\n    var htmlEntities = function (str) {\n      return String(str).replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;')\n        .replace(/\"/g, '&quot;');\n    }\n\n    var get_widget_html = function (el, id, full) {\n      var before\n      var html\n      var after\n\n      loopid = loopid % 3\n\n      switch (id) {\n        case 'h1':\n          before = '<div class=\"sg-row cms_row\" data-type=\"h1\"><div class=\"col-12 cms_col\">'\n          html = '<h1 data-type=\"h1\" class=\"drag drop\" data-editable=\"true\">Macaroon donut tiramisu sweet roll.</h1>'\n          after = '</div></div>'\n          break;\n        case 'h2':\n          before = '<div class=\"sg-row cms_row\" data-type=\"h2\"><div class=\"col-12 cms_col\">'\n          html = '<h2 data-type=\"h2\" class=\"drag drop\" data-editable=\"true\">Macaroon donut tiramisu sweet roll.</h2>'\n          after = '</div></div>'\n          break;\n        case 'h3':\n          before = '<div class=\"sg-row cms_row\" data-type=\"h3\"><div class=\"col-12 cms_col\">'\n          html = '<h3 data-type=\"h3\" class=\"drag drop\" data-editable=\"true\">Macaroon donut tiramisu sweet roll.</h3>'\n          after = '</div></div>'\n          break;\n        case 'h4':\n          before = '<div class=\"sg-row cms_row\" data-type=\"h4\"><div class=\"col-12 cms_col\">'\n          html = '<h4 data-type=\"h4\" class=\"drag drop\" data-editable=\"true\">Macaroon donut tiramisu sweet roll.</h4>'\n          after = '</div></div>'\n          break;\n        case 'h5':\n          before = '<div class=\"sg-row cms_row\" data-type=\"h5\"><div class=\"col-12 cms_col\">'\n          html = '<h5 data-type=\"h5\" class=\"drag drop\" data-editable=\"true\">Macaroon donut tiramisu sweet roll.</h5>'\n          after = '</div></div>'\n          break;\n        case 'h6':\n          before = '<div class=\"sg-row cms_row\" data-type=\"h6\"><div class=\"col-12 cms_col\">'\n          html = '<h6 data-type=\"h6\" class=\"drag drop\" data-editable=\"true\">Macaroon donut tiramisu sweet roll.</h6>'\n          after = '</div></div>'\n          break;\n        case 'img':\n          before = '<div class=\"sg-row cms_row\" data-type=\"img\"><div class=\"col-12 cms_col\">'\n          html = '<div data-type=\"img\" class=\"drag drop\" data-editable=\"true\"><img src=\"https://fasty.ovh/asset/o/06650e1c-2579-463b-94fd-fc09655d3cd1?_from=Y21z\" alt=\"\"></div>'\n          after = '</div></div>'\n          break;\n        case 'text':\n          before = '<div class=\"sg-row cms_row\" data-type=\"text\"><div class=\"col-12 cms_col\">'\n          html = '<div data-type=\"text\" class=\"drag drop\" data-editable=\"true\"><p style=\"text-align: justify;\">' + ipsum(5) + '</p></div>'\n          after = '</div></div>'\n          break;\n        case 'code':\n          var codes = []\n          codes.push('<code class=\"language-html\">' + htmlEntities('<h1>Some html code</h1>') + '</code>')\n          codes.push('<code class=\"language-javascript\">console.log(\"JS ... really ? \")</code>')\n          codes.push('<code class=\"language-ruby\">puts \"I Love Ruby\"</code>')\n          before = '<div class=\"sg-row cms_row\" data-type=\"code\"><div class=\"col-12 cms_col\">'\n          html = '<div data-type=\"code\" class=\"drag drop\" data-editable=\"true\"><pre>' + codes[loopid] + '</pre></div>'\n          after = '</div></div>'\n          break;\n        case 'video':\n          var ids = ['AWKEWqx8OyA', 'TmDKbUrSYxQ', 'X8zLJlU_-60']\n          var data = '<div style=\"position:relative;padding-top:56.25%;\"><iframe src=\"https://www.youtube.com/embed/' + ids[loopid] + '\" frameborder=\"0\" allow=\"accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture\" allowfullscreen style=\"position:absolute;top:0;left:0;width:100%;height:100%;\"></iframe></div>'\n          before = '<div class=\"sg-row cms_row\" data-type=\"embed\"><div class=\"col-12 cms_col\">'\n          html = '<div data-type=\"embed\" class=\"drag drop\" data-editable=\"true\" data-html=\"' + data.replace(/\"/g, \"&quot;\") + '\">' + data + '</div>'\n          after = '</div></div>'\n          break\n        case 'html5':\n          before = '<div class=\"sg-row cms_row\" data-type=\"embed\"><div class=\"col-12 cms_col\">'\n          var data = '<p>HTML5 Code here</p>'\n          html = '<div data-type=\"embed\" class=\"drag drop\" data-editable=\"true\" data-html=\"' + data.replace(/\"/g, \"&quot;\") + '\">' + data + '</div>'\n          after = '</div></div>'\n          break\n        case 'col2':\n          before = ''\n          html = '<div class=\"sg-row cms_row sub_row drag\" data-type=\"col2\"><div class=\"col-6 cms_col\"></div><div class=\"col-6 cms_col\"></div></div>'\n          after = ''\n          break\n        case 'col3':\n          before = ''\n          html = '<div class=\"sg-row cms_row sub_row drag\" data-type=\"col3\"><div class=\"col-4 cms_col\"></div><div class=\"col-4 cms_col\"></div><div class=\"col-4 cms_col\"></div></div>'\n          after = ''\n          break\n        case 'col4':\n          before = ''\n          html = '<div class=\"sg-row cms_row sub_row drag\" data-type=\"col4\"><div class=\"col-3 cms_col\"></div><div class=\"col-3 cms_col\"></div><div class=\"col-3 cms_col\"></div><div class=\"col-3 cms_col\"></div></div>'\n          after = ''\n          break\n        case 'col282':\n          before = ''\n          html = '<div class=\"sg-row cms_row sub_row drag\" data-type=\"col282\"><div class=\"col-2 cms_col\"></div><div class=\"col-8 cms_col\"></div><div class=\"col-2 cms_col\"></div><div class=\"col-3 cms_col\"></div></div>'\n          after = ''\n          break\n        case 'col363':\n          before = ''\n          html = '<div class=\"sg-row cms_row sub_row drag\" data-type=\"col363\"><div class=\"col-3 cms_col\"></div><div class=\"col-6 cms_col\"></div><div class=\"col-3 cms_col\"></div></div></div>'\n          after = ''\n          break\n        case 'col48':\n          before = ''\n          html = '<div class=\"sg-row cms_row sub_row drag\" data-type=\"col48\"><div class=\"col-4 cms_col\"></div><div class=\"col-8 cms_col\"></div></div></div>'\n          after = ''\n          break\n        case 'col84':\n          before = ''\n          html = '<div class=\"sg-row cms_row sub_row drag\" data-type=\"col84\"><div class=\"col-8 cms_col\"></div><div class=\"col-4 cms_col\"></div></div></div>'\n          after = ''\n          break\n        default:\n          before = ''\n          html = interpolate_widget(\n            atob(el.data(\"partial\")),\n            JSON.parse(atob(el.data(\"model\"))),\n            JSON.parse(atob(el.data(\"dataset\")))\n          )\n          after = \"\"\n          break\n      }\n      loopid++\n\n      return full ? $(before + html + after) : $(html)\n    }\n\n    var interpolate_widget = function(html, model, dataset) {\n      var _html = html + \"\"\n      model.forEach(function(f) {\n        var k = Object.keys(f)[0]\n        var v = Object.values(f)[0]\n        if(Object.keys(v).indexOf(\"_fields\") < 0) {\n          var value = dataset[k] || v.default || \"\"\n          html = html.replace(\"<!-- @\" + k + \" -->\", value)\n        } else {\n          var key_length = (\"<!-- #\" + k + \" -->\").length\n          var pos_start  = html.indexOf(\"<!-- #\" + k + \" -->\")\n          var pos_end    = html.indexOf(\"<!-- /\" + k + \" -->\")\n          var sub_html = html.substring(pos_start + key_length, pos_end)\n\n          var build = \"\"\n          //console.log(dataset[k] || v.default, v)\n          var ds = (dataset[k] || v.default)\n          ds.forEach(function(d) {\n            v[\"_fields\"].forEach(function(f) {\n              build += sub_html.replace(\"<!-- @\" + f.name + \" -->\", d[f.name])\n            })\n          })\n          html = \"<div class='drag' data-editable='true' data-type='widget' data-model='\"+ btoa(_html) +\"' data-dataset='\"+btoa(JSON.stringify(model))+\"' data-partial='\"+btoa(JSON.stringify(dataset))+\"'>\" + html.substring(0, pos_start) + build + html.substring(pos_end + key_length, html.length) + \"</div>\"\n        }\n      })\n      return html\n    }\n    /*\n      get_widgets <function>\n      Load widgets defined in Fasty\n    */\n    var get_widgets = function() {\n      $.get(url + \"/api/_widgets\", function(data) {\n        if(data.data) {\n          widgets = data.data\n          var w_html = '<aside class=\"edit-mode sg-widgets\">'\n          var c_html = \"\"\n          widgets.forEach(function(w) {\n            c_html += \"<div class='drag' data-dataset=\\\"\"+btoa(\"{}\")+\"\\\" data-partial=\\\"\" + btoa(w.partial) + \"\\\" data-menuItem='widget' data-model=\\\"\" + btoa(w.model)+ \"\\\" dragdraggable=\\\"true\\\"><img style=\\\"max-width: 100%;\\\" src=\\\"\"+ (w.picture || \"https://fasty.ovh/asset/o/06650e1c-2579-463b-94fd-fc09655d3cd1?_from=Y21z\") +\"\\\" /></div>\"\n            c_html += \"<div>\" + w.name + \"</div>\"\n          })\n\n          if (c_html != \"\") {\n            w_html += c_html + \"</aside>\"\n            $(self).append(w_html)\n          }\n\n          set_content(options.value)\n\n        }\n      })\n    }\n\n    /*\n      set_windows_events <function>\n      Activate drag & drop events\n    */\n    var set_windows_events = function () {\n      window.drag = function (event) {\n        var el = $(event.target).hasClass('drag') ? $(event.target) : $(event.target).closest('.drag')\n        el.addClass('dragging')\n        event.stopPropagation();\n        dragObj = el\n        event.dataTransfer.setData('text', '');\n        setTimeout(function () {\n          add_drop_empty()\n        }, 0)\n      }\n\n      window.drop = function (event) {\n        event.stopPropagation()\n        event.preventDefault()\n\n        var el = $(event.target).hasClass('drop') ? $(event.target) : $(event.target).closest('.drop')\n\n        if (event.dataTransfer.items) { // File drag & drop\n          var isFile = false\n          // Use DataTransferItemList interface to access the file(s)\n          var count = event.dataTransfer.items.length\n          if (count > 1) count = 1\n          for (var i = 0; i < event.dataTransfer.items.length; i++) {\n            // If dropped items aren't files, reject them\n            if (event.dataTransfer.items[i].kind === 'file') {\n              isFile = true\n              var file = event.dataTransfer.items[i].getAsFile();\n              if (file.type.indexOf('image') >= 0) {\n                var reader = new FileReader();\n                reader.readAsDataURL(file);\n                reader.onloadend = function () {\n                  base64data = reader.result;\n\n                  var formData = new FormData();\n                  formData.append(\"files\", file)\n                  formData.append(\"key\", localStorage.getItem('resize_api_key'))\n\n                  $.ajax({\n                    headers: {\n                      'X-Session-Id': localStorage.getItem('X-Session-Id')\n                    },\n                    xhr: function () {\n                      var xhr = new window.XMLHttpRequest();\n                      //Upload progress\n                      xhr.upload.addEventListener('progress', function (evt) {\n                        if (evt.lengthComputable) {\n                          var percentComplete = evt.loaded / evt.total;\n                          //Do something with upload progress\n                          $(el).html(parseInt(percentComplete * 100) + '%')\n                        }\n                      }, false);\n\n                      return xhr;\n                    },\n                    type: 'POST',\n                    url: '/file/upload',\n                    data: formData,\n                    processData: false,\n                    contentType: false,\n                    success: function (data) {\n                      data = JSON.parse(data)\n                      setTimeout(function () {\n                        var picture = '<picture>'\n                        picture += \"\\n\"+'  <source media=\"(max-width: 480px)\" srcset=\"/asset/r/' + data.filename + '/480.webp?_from='+ btoa(subdomain) +'\" type=\"image/webp\">'\n                        picture += \"\\n\"+'  <source media=\"(max-width: 480px)\" srcset=\"/asset/r/' + data.filename + '/480?_from='+ btoa(subdomain) +'\">'\n                        picture += \"\\n\"+'  <source media=\"(max-width: 799px)\" srcset=\"/asset/r/' + data.filename + '/799.webp?_from='+ btoa(subdomain) +'\" type=\"image/webp\">'\n                        picture += \"\\n\"+'  <source media=\"(max-width: 799px)\" srcset=\"/asset/r/' + data.filename + '/799?_from='+ btoa(subdomain) +'\">'\n                        picture += \"\\n\"+'  <source media=\"(min-width: 800px)\" srcset=\"/asset/o/' + data.filename + '.webp?_from='+ btoa(subdomain) +'\" type=\"image/webp\">'\n                        picture += \"\\n\"+'  <source media=\"(min-width: 800px)\" srcset=\"/asset/o/' + data.filename + '?_from='+ btoa(subdomain) +'\">'\n                        picture += \"\\n\"+'  <img src=\"/asset/o/' + data.filename + '\">'\n                        picture += \"\\n\"+'</picture>'\n                        $(el).html(picture)\n                      }, 100)\n                      clear_empty_drags()\n                    }\n                  });\n                }\n              }\n            }\n          }\n\n          if (!isFile) {\n            $('.active').removeClass('active')\n            if (dragObj.hasClass('cms_col')) {\n              if (el.hasClass('cms_col')) {\n                swap(dragObj, el)\n              } else {\n                swap(dragObj, el.children().length == 0 ? el : el.children().first())\n              }\n            } else {\n              if (el.hasClass('cms_col')) {\n                swap(dragObj.children().first(), el)\n              } else {\n                swap(dragObj, el)\n              }\n            }\n\n            el.removeClass('drop_empty')\n            if (!el.hasClass('drag')) {\n              prepare_drag(el);\n              prepare_drop(el)\n            }\n            $('.drop_empty').remove()\n            clear_empty_drags()\n            set_empty_rows()\n          }\n        }\n      }\n\n      window.drag_end = function (event) {\n        event.stopPropagation()\n\n        $('.row_editor').css('margin-left', (-99999) + 'px')\n        $('.dragging').removeClass('dragging')\n        $('.active').removeClass('active')\n        $('.drop_empty').remove()\n        clear_empty_drags()\n      }\n\n      window.allow_drop = function (event) {\n        event.stopPropagation();\n        event.preventDefault();\n\n        var el = $(event.target).hasClass('drop') ? $(event.target) : $(event.target).closest('.drag')\n        $('.active').removeClass('active')\n        el.addClass('active')\n      }\n    }\n\n    /*\n      set_empty_rows <function>\n      add Class .empty_row to all empty .cms_row\n    */\n    var set_empty_rows = function () {\n      $(self).find('.cms_row').removeClass('empty_row')\n      $(self).find('.cms_row').each(function (y, col) {\n        if ($(col).text().trim() === '') {\n          $(col).addClass('empty_row')\n        }\n      })\n    }\n\n    /*\n      add_drop_empty <function>\n      add drop DIVs when starting a drag\n    */\n    var add_drop_empty = function () {\n      clear_empty_drags()\n      var empty = '<div class=\"sg-row cms_row\" data-type=\"full\"><div class=\"col-12 cms_col\"><div class=\"drop drop_empty row_empty\"></div></div></div>'\n      var drop_empty = '<div class=\"drop drop_empty col_empty\"><div></div></div>'\n\n      $(self).find('.edit-mode .cms_editor .sub_row .cms_col .drop').each(function (i, el) {\n        if ($(el).parent().hasClass('cms_col') ||\n          $(el).parent().hasClass('cms_row')) {\n          $(el).after(drop_empty)\n        }\n      })\n\n      $(self).find('.edit-mode .page-content > .cms_row').each(function (y, row) {\n        $(row).before(empty)\n      })\n      $(self).find('.edit-mode .cms_col').each(function (y, col) {\n        if (!$(col).hasClass('col-12')) $(col).prepend(drop_empty)\n      })\n      $(self).find('.edit-mode .cms_editor .page-content').append(empty)\n      $(self).find('.edit-mode .drop_empty').attr('ondragover', 'allow_drop(event)')\n      $(self).find('.edit-mode .drop_empty').attr('ondrop', 'drop(event)')\n    }\n\n    /*\n      swap <function(from, to)>\n      swap 2 widgets\n    */\n    var swap = function (from, to) {\n      from = from[0]\n      to = to[0]\n\n      const afterTo = to.nextElementSibling\n      const parent = to.parentNode\n\n      if ($(from).data('menuitem')) {\n        var html = get_widget_html($(from), $(from).data('menuitem'), false)\n\n        if ($(to).hasClass('row_empty')) {\n          var dest = $(html).hasClass('sub_row') ? $(parent).parent() : $(parent)\n          dest.html(html[0].outerHTML)\n        } else {\n          if ($(to).hasClass('col_empty')) {\n            $(to).html(html[0].outerHTML)\n            $(to).removeClass(\"row_empty\")\n            $(to).removeClass(\"col_empty\")\n            $(to).addClass(\"drag\")\n          } else {\n            if (!$(parent).hasClass('sg-container')) $(parent).html(html[0].outerHTML)\n          }\n        }\n\n        prepare_drag($('.drag'));\n        prepare_drop($('.drop'));\n\n      } else {\n        try {\n          const tmp = from\n          from.replaceWith(to)\n          parent.insertBefore(from, afterTo)\n        } catch (err) {\n          parent.appendChild(tmp)\n        }\n        clear_empty_drags()\n      }\n\n      $(self).find('[data-type=full] .col-12').each(function(i, item) {\n        if($(item).find('.sg-row').length > 0) {\n          var html = $(item).html()\n          $(item).parent()[0].outerHTML = html\n        }\n      })\n    }\n\n    /*\n      prepare_drag <function(element)>\n      set the element draggable\n    */\n    var prepare_drag = function (el) {\n      el.attr('draggable', true)\n      el.attr('ondragstart', 'drag(event)')\n      el.attr('ondragend', 'drag_end(event)')\n    }\n\n    /*\n      prepare_drop <function(element)>\n      set the element dropable\n    */\n    var prepare_drop = function (el) {\n      el.addClass('drop')\n      el.attr('ondragover', 'allow_drop(event)')\n      el.attr('ondrop', 'drop(event)')\n    }\n\n    /*\n      clear_empty_drags <function>\n      Remove empty drag elements\n    */\n    var clear_empty_drags = function () {\n      $(self).find('.edit-mode .drop').each(function (i, el) {\n        var from_col = $(el).parents()\n          .map(function (i, el) {\n            return el.className.split(' ')\n          })\n          .filter(function (i, el) {\n            return el == 'cms_col'\n          })\n          .length >= 1\n\n        if ($(el).find('.cms_col').length == 0 && !from_col &&\n          $(el).text().trim() == '' && $(el).data('type') != 'img' && $(el).data('type') != 'embed') {\n          $(el).remove()\n        }\n        if ($(el).hasClass('drop') && !$(el).hasClass('drag')) {\n          $(el).remove()\n        }\n      })\n\n      $(self).find('.edit-mode .drag').each(function (i, el) {\n        var from_col = $(el).parents()\n          .map(function (i, el) {\n            return el.className.split(' ')\n          })\n          .filter(function (i, el) {\n            return el == 'cms_col'\n          })\n          .length >= 1\n        if (from_col && $(el).parent().find('.drag').length > 1 &&\n          ($(el).html().trim() == '' || $(el).html().trim() == '<div></div>') &&\n          !$(el).is('img')) {\n          $(el).remove()\n        }\n      })\n\n      $(self).find('.edit-mode .cms_row > *').each(function (i, el) {\n        var from_col = $(el).parents()\n          .map(function (i, el) {\n            return el.className.split(' ')\n          })\n          .filter(function (i, el) {\n            return el == 'cms_col'\n          })\n          .length >= 1\n\n        if (!$(el).hasClass('cms_col') &&\n          $(el).html().trim() == '' || $(el).html().trim() == '<div></div>') {\n          $(el).remove()\n        }\n      })\n\n      $(self).find('.edit-mode .cms_row').each(function (i, el) {\n        if ($(el).html().trim() == '' ||\n          $(el).html().trim() == '<div></div>' ||\n          $(el).html().trim() == '<div class=\"col-12 cms_col\"></div>') {\n          $(el).remove()\n        }\n      })\n    }\n\n    /*\n      run_export <function(base)>\n      Export base element as json structure\n    */\n    var run_export = function (base) {\n      var data = []\n      $(base).find('> .cms_row').each(function (i, row) {\n\n        if($(row).data('type') == 'full') {\n          if($(row).find('div:first').hasClass('cms_col')) $(row).data('type', $(row).find(\"[data-type]\").data('type'))\n          else row = $(row).children()[0]\n        }\n        var data_row = { data: [], type: $(row).data('type') }\n\n        $(row).find('> .cms_col').each(function (y, col) {\n          var data_col = []\n          $(col).find('[data-type]').each(function (z, widget) {\n            if($(widget).data('exported') == undefined) {\n              $(widget).data('exported', true)\n\n              var data_widget = {}\n              data_widget['type'] = $(widget).data('type')\n              data_widget['attr'] = $(widget).data('attr')\n              if ($(widget).data('type').indexOf('col') >= 0) {\n                data_widget['content'] = run_export($(widget).parent())\n              } else {\n                data_widget['content'] = $(widget).data('html') || $(widget).html()\n              }\n\n              data_col.push(data_widget)\n            }\n          })\n\n          data_row['data'].push(data_col)\n        })\n\n        data.push(data_row)\n      })\n\n      $(base).find('[data-exported]').removeAttr('data-exported')\n      return data\n    }\n\n    /*\n      set_content <function>\n      Load HTML content into .page_content and run all useful methods for starting the editor\n    */\n    var set_content = function (value) {\n      $(self).find('.page-content').html(value || '')\n\n      clear_empty_drags()\n      set_empty_rows()\n      prepare_drag($(self).find(\".drag\"))\n      prepare_drag($(self).find(\".drop\"))\n      activate_events()\n      remove_drag_attributes()\n\n      $(self).find('[data-html]').each(function (i, el) { $(el).html($(el).data('html')) })\n    }\n\n    /*\n      activate_events <function>\n      Add jQuery events on page content\n    */\n    var activate_events = function () {\n      // Set the active Row\n      $(self).find('.edit-mode .cms_editor').on('mouseenter', '.cms_row', function () {\n        $(self).find('.edit-mode .row_editor').css('margin-left', (-99999) + 'px')\n        var y = (0 - $(self).find('.cms_editor').offset().top) + $(this).offset().top + $(this).height() - $(self).find('.row_editor').height()\n        var x = $(this).offset().left + 16 - 100\n\n        $(self).find('.edit-mode .row_editor').css('margin-left', x + 'px')\n        $(self).find('.edit-mode .row_editor').css('margin-top', y + 'px')\n        activeObj = $(this)\n      })\n\n      // Set the active Widget\n      $(self).find('.edit-mode .cms_editor').on('mouseenter', '.cms_col > *', function () {\n        var y = $(this).offset().top\n        var x = $(this).offset().left - $(self).find('aside').width()\n        activeObj = $(this)\n      })\n\n      // When you delete a row\n      $(self).find('.edit-mode .cms_row_delete').on('click', function () {\n        activeObj.closest('.edit-mode .sg-row').remove()\n        return false\n      })\n\n      // When you click on a widget\n      // It should open the editor modal with the right content / tools\n      $(self).find('.edit-mode .page-content').on('click', '[data-type]', function () {\n        editObj = $(this)\n        raw_object = $(this.outerHTML)\n        if (raw_object.data('type') != 'widget') {\n          if (raw_object.data(\"attr\")) {\n            $(self).find(\"input[data-name=col-class]\").val(raw_object.data(\"attr\")['col-class'])\n            $(self).find(\"input[data-name=row-class]\").val(raw_object.data(\"attr\")['row-class'])\n            $(self).find(\"input[data-name=container-class]\").val(raw_object.data(\"attr\")['container-class'])\n          } else {\n            $(self).find(\"input[data-name=col-class]\").val('')\n            $(self).find(\"input[data-name=row-class]\").val('')\n            $(self).find(\"input[data-name=container-class]\").val('')\n          }\n          $(self).find(\".editor-code\").hide()\n          $(self).find(\".editor-simplecode\").hide()\n          $(self).find(\".editor-img-code\").hide()\n\n          if (raw_object.data('editable')) {\n            $(self).find('.trumbowyg').hide()\n            $(self).find('#ace-editor-' + object_name).hide()\n\n            var html = $(this).html().trim()\n            $(self).find('.edit-mode .cms_editor').addClass('editmode')\n            if (raw_object.data('type') == 'text') {\n              $('#trumbowyg-' + object_name).trumbowyg('html', html);\n              $(self).find('.trumbowyg').show()\n            }\n\n            if (raw_object.data('type') == 'code') {\n              $(self).find(\".editor-code\").show()\n              $(self).find('#ace-editor-' + object_name).show()\n              $(self).find(\"input[data-name=lang]\").val(raw_object.find(\"code:first\")[0].className.replace('language-', ''))\n              ace_editor.session.setMode('ace/mode/' + mode);\n              ace_editor.setOptions({ maxLines: Infinity, tabSize: 2, useSoftTabs: true });\n              ace_editor.getSession().setValue($(this).text());\n            }\n\n            if (['embed', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6'].indexOf(raw_object.data('type')) >= 0) {\n              $(self).find(\".editor-simplecode\").show()\n              $('#ace-editor-'+object_name).show()\n              var mode = 'html'\n              ace_editor.session.setMode('ace/mode/' + mode);\n              ace_editor.setOptions({ maxLines: Infinity, tabSize: 2, useSoftTabs: true });\n              var html = $(this).html()\n              if (raw_object.data('type') == 'embed') html = $(this).attr('data-html').replace(/&quot;/g, '\"')\n              ace_editor.getSession().setValue(html);\n            }\n\n            if (['img'].indexOf(editObj.data('type')) >= 0) {\n              var img_div = $(this).find('.img-div').length > 0 ? $(this).find('.img-div') : $(this).find('img').parent()\n              $(self).find(\".editor-simplecode\").show()\n              $(self).find(\".editor-img-code\").show()\n              $('#ace-editor-'+object_name).show()\n              $(self).find(\"input[data-name=img-width\").val(img_div.attr('data-img-width'))\n              $(self).find(\"select[data-name=img-alignment\").val(img_div[0].style['text-align'])\n              var mode = 'html'\n              ace_editor.session.setMode('ace/mode/' + mode);\n              ace_editor.setOptions({ maxLines: Infinity, tabSize: 2, useSoftTabs: true });\n              html = $(this).find('.img-div').length > 0 ? $(this).find('.img-div').html() : $(this).html()\n              ace_editor.getSession().setValue(html);\n            }\n\n          }\n        } else {\n          $(self).find('.edit-mode .widget_editor').addClass('editmode')\n        }\n\n        return false\n      })\n\n      // Close the editor modal\n      $(self).find('.edit-mode .sg-editcontent').on('click', '.fa-times-circle', function () {\n        $('.edit-mode .cms_editor').removeClass('editmode')\n        $('.edit-mode .widget_editor').removeClass('editmode')\n        save_editor()\n\n        return false\n      })\n\n      // When you click on the toolbar item\n      $(self).find('.edit-mode .addwidget').on('click', function (e) {\n        e.preventDefault();\n        var html = get_widget_html($(this), $(this).data('id'), true)\n        $(self).find('.edit-mode .page-content').append(html)\n        $(self).find('.edit-mode .drag').attr('draggable', true)\n        $(self).find('.edit-mode .drag').attr('ondragstart', 'drag(event)')\n        $(self).find('.edit-mode .drag').attr('ondragover', 'allow_drop(event)')\n        $(self).find('.edit-mode .drag').attr('ondrop', 'drop(event)')\n        $(self).find('.edit-mode .drag').attr('ondragend', 'drag_end(event)')\n\n        set_empty_rows()\n\n        return false\n      })\n\n      $(self).find('.toggle-layout').on('click', function (e) {\n        e.preventDefault()\n        set_windows_events()\n        $(self).find('.view-mode').toggleClass('isactive')\n        $(self).find('.edit-mode').toggleClass('isactive')\n        $(self).toggleClass('fullscreen')\n        $('[data-exported]').removeAttr('data-exported')\n        var data = {\n          html: $(self).find('.edit-mode .page-content').html(),\n          json: run_export($(self).find('.edit-mode .page-content'))\n        }\n        $('input[name=\"' + object_name + '\"]').val(JSON.stringify(data))\n        $(self).find('.page-content').html(data['html'] || '')\n        remove_drag_attributes()\n        $(self).find('[data-html]').each(function (i, el) {\n          $(el).html($(el).attr('data-html'))\n        })\n\n        return false\n      })\n    }\n\n    /*\n      remove_drag_attributes <function(element)>\n    */\n    var remove_drag_attributes = function () {\n      $(self).find('.view-mode .drag, .view-mode .drop').removeAttr('ondragend')\n        .removeAttr('ondragstart')\n        .removeAttr('ondragover')\n        .removeAttr('ondrop')\n    }\n\n\n    var view_mode = '<a href=\"\" class=\"toggle-layout view-mode isactive\">Edit content</a>'\n    view_mode += '<section class=\"view-mode isactive\">\\\n                        <div class=\"page-content\"></div></section>'\n\n    $(self).append(view_mode)\n\n    var items = '<aside class=\"edit-mode\">\\\n                   <div class=\"sg-container toolbox\"><h1>Page tools</h1> \\\n                   <div class=\"sg-row\"></div>\\\n                   <div class=\"sg-row\"><a href=\"\" class=\"toggle-layout\">Exit</a></div></div>\\\n                  </aside>'\n\n    $(self).append(items)\n    $(self).addClass('editor-cms')\n\n    settings.widgets.forEach(function (w) {\n      $(self).find(\".toolbox .sg-row:first\").append('\\\n      <div class=\"col-4 drag\" dragdraggable=\"true\" data-menuitem=\"' + w.id + '\">\\\n        <a href=\"#\" class=\"addwidget\" data-id=\"' + w.id + '\">\\\n          <i class=\"' + w.icon + '\"></i>\\\n          <div class=\"small\">' + w.title + '</div></a>\\\n      </div>')\n    })\n\n    var content = '<section class=\"edit-mode\">\\\n      <div class=\"widget_editor\"><div class=\"sg-editcontent\"><i class=\"far fa-times-circle\" style=\"float: right;padding: 10px\"></i></div></div>\\\n      <div class=\"cms_editor\">\\\n        <div class=\"row_editor\">\\\n          <div class=\"cms_toolbar\">\\\n            <ul>\\\n              <li><a href=\"#\" class=\"cms_row_delete\"><i class=\"fas fa-trash-alt\"></i></a></li>\\\n            </ul>\\\n          </div>\\\n        </div>\\\n        <div class=\"sg-container page-content\"></div>\\\n        <div class=\"sg-editcontent\">\\\n          <i class=\"far fa-times-circle\" style=\"float: right;padding: 10px\"></i>\\\n          <div class=\"content\">\\\n            <div id=\"trumbowyg-'+object_name+'\"></div>\\\n            <div><label>Container Class</label><input type=\"text\" data-name=\"container-class\" class=\"uk-input\"></div>\\\n            <div><label>Row Class</label><input type=\"text\" data-name=\"row-class\" class=\"uk-input\"></div>\\\n            <div><label>Col Class</label><input type=\"text\" data-name=\"col-class\" class=\"uk-input\"></div>\\\n            <div class=\"editor-code\"><label>Language</label><input type=\"text\" data-name=\"lang\" class=\"uk-input\"></div>\\\n            <div class=\"uk-grid\"><div class=\"uk-width-1-2 editor-img-code\"><label>Image Width</label><input type=\"text\" data-name=\"img-width\" class=\"uk-input\"></div>\\\n            <div class=\"uk-width-1-2 editor-img-code\"><label>Image Alignment</label>\\\n            <select class=\"uk-select\" data-name=\"img-alignment\">\\\n            <option>left</option><option>center</option><option>right</option></select></div></div>\\\n            <div class=\"editor-code editor-simplecode\"><label>Code</label><div id=\"ace-editor-'+object_name+'\" class=\"ace-editor\"></div></div>\\\n          </div>\\\n        </div>\\\n      </div>\\\n    </section>'\n\n    $(self).append(content)\n\n    get_widgets()\n    //set_content(options.value)\n\n    $('#trumbowyg-'+object_name).trumbowyg({\n      btns: [\n        ['viewHTML'],\n        ['undo', 'redo'],\n        ['formatting'],\n        ['strong', 'em', 'del'],\n        ['superscript', 'subscript'],\n        ['link'],\n        ['foreColor', 'backColor'],\n        ['justifyLeft', 'justifyCenter', 'justifyRight', 'justifyFull'],\n        ['unorderedList', 'orderedList'],\n        ['table'],\n        ['horizontalRule'],\n        ['removeformat'],\n        ['fullscreen']\n      ],\n      resetCss: true,\n      svgPath: 'img/icons.svg',\n      removeformatPasted: true\n    }).on('tbwchange', function () {\n      editObj.html($('#trumbowyg-' + object_name).trumbowyg('html'))\n    });\n\n    // Activate Ace editor\n    ace_editor = ace.edit('ace-editor-'+object_name)\n    ace_editor.getSession().setUseWrapMode(true)\n\n    ace_editor.setTheme('ace/theme/twilight')\n    ace_editor.session.setMode('ace/mode/html')\n\n    var save_editor = function () {\n      if (editObj) {\n        var attributes = {\n          'col-class': $('input[data-name=col-class]').val(),\n          'row-class': $('input[data-name=row-class]').val(),\n          'container-class': $('input[data-name=container-class]').val()\n        }\n        var content = ace_editor.getSession().getValue()\n        if (editObj.data('type') == 'code') {\n          var mode = 'language-' + $(self).find(\"input[data-name=lang]\").val()\n          editObj.html('<pre><code class=\"' + mode + '\">' + htmlEntities(content) + '</code></pre>')\n        }\n        if (['h1', 'h2', 'h3', 'h4', 'h5', 'h6'].indexOf(editObj.data('type')) >= 0) {\n          editObj.html(content)\n        }\n        if (['embed'].indexOf(editObj.data('type')) >= 0) {\n          editObj.html(content)\n          editObj.attr('data-html', content)\n        }\n        if (['text'].indexOf(editObj.data('type')) >= 0) {\n          editObj.html($('#trumbowyg-'+object_name).trumbowyg('html'))\n        }\n        if(['img'].indexOf(editObj.data('type')) >= 0) {\n          var width = $(self).find(\"input[data-name=img-width\").val() ? $(self).find(\"input[data-name=img-width\").val() : '100%'\n          var alignment = $(self).find(\"select[data-name=img-alignment\").val() ? $(self).find(\"select[data-name=img-alignment\").val() : 'left'\n          var temp = $('<div>').append($.parseHTML(content))\n          temp.each(function() {\n            var img = $(this).find('img')\n            for(var i = 0; i < img.length; i++) {\n              img[i].style.width = width\n            }\n          })\n          editObj.html('<div class=\"img-div\" style=\"text-align: ' + alignment + '\" data-img-width=\"' + width + '\">' + temp[0].innerHTML + '</div>')\n        }\n        editObj.attr('data-attr', JSON.stringify(attributes))\n\n      }\n    }\n\n    return this;\n  };\n\n})(jQuery);","document.removeEventListener(\"keydown\", function() {})\ndocument.addEventListener(\"keydown\", function(e) {\n  if (e.keyCode == 83 && (navigator.platform.match(\"Mac\") ? e.metaKey : e.ctrlKey)) {\n    e.preventDefault();\n    $('input[type=submit]:visible').click();\n  }\n}, false);\n\n\n$(function () {\n\n  riot.mount('rightnav')\n\n  route('/', function(name) {\n    // Here set the / mount\n    riot.mount('div#app', 'loading')\n  })\n\n  route('/welcome', function(name) {riot.mount('div#app', 'welcome') })\n\n  route('/login', function(name) {riot.mount('div#app', 'login') })\n  route('/signup', function(name) {riot.mount('div#app', 'signup') })\n\n  route('/confirm/*', function(id) {\n    common.post(url+'auth/confirm', JSON.stringify({ uuid: id }), function() {\n      document.location.href = \"index.html\"\n    })\n  })\n\n  route('/logout', function(name) {\n    common.post(url +\"auth/logout\", \"\", function(d) {\n      localStorage.removeItem('X-Session-Id')\n      document.location.href = \"login.html\"\n    })\n  })\n\n  route('/settings', function() { riot.mount('div#app', 'settings') })\n\n  /*@{{router}}*/\n\n\n  route('/datasets/*', function(type) { riot.mount('div#app', 'datasets', { datatype: type }) })\n  route('/datasets/*/new', function (type) {\n    riot.mount('div#app', 'dataset_new', { datatype: type })\n  })\n  route('/datasets/*/*', function (type, folder_key) {\n    riot.mount('div#app', 'datasets', { datatype: type, folder_key: folder_key })\n  })\n  route('/datasets/*/new/*', function (type, folder_key) {\n    riot.mount('div#app', 'dataset_new', { datatype: type, folder_key: folder_key })\n  })\n  route('/datasets/*/*/edit', function(type, id) {\n    riot.mount('div#app', 'dataset_edit', { datatype: type, dataset_id: id })\n  })\n\n  route(function(collection, id, action) {\n    if(action != undefined) {\n      /*@{{router_cia}}*/\n    }\n  })\n\n  route(function(collection, action) {\n    /*@{{router_ca}}*/\n  })\n\n\n  route.start(true)\n  //riot.mount(\"*\")\n\n  if(document.location.host.indexOf(\"prod.\") >= 0) $(\"body\").css(\"background\", \"linear-gradient(150deg,#370d13 0,#283a63 100%)\")\n  if(document.location.host.indexOf(\"staging.\") >= 0) $(\"body\").css(\"background\", \"linear-gradient(150deg,#33521c 0,#283a63 100%)\")\n  if(document.location.host.indexOf(\"qa.\") >= 0) $(\"body\").css(\"background\", \"linear-gradient(150deg, rgb(61, 64, 18) 0px, rgb(37, 43, 2) 100%)\")\n})\n","riot.tag2('dataset_folders', '<div> <ul class=\"uk-breadcrumb\"> <li each=\"{f in path}\"><a href=\"#datasets/{opts.slug}/{f._key}\">{f.name}</a></li> <li> <a if=\"{path.length > 1}\" onclick=\"{renameFolder}\"><i class=\"far fa-edit\"></i></a> <a onclick=\"{addFolder}\"><i class=\"fas fa-plus\"></i></a> <a if=\"{path.length > 1 && folders.length == 0}\" onclick=\"{deleteFolder}\"><i class=\"fas fa-trash\"></i></a> </li> </ul> <ul class=\"uk-list\"> <li each=\"{f in folders}\"><a href=\"#datasets/{opts.slug}/{f._key}\"><i class=\"far fa-folder\"></i> {f.name}</a></li> </ul> </div>', '', '', function(opts) {\n    this.folders = []\n    this.folder = {}\n    this.path = [ this.folder ]\n    this.folder_key = this.opts.folder_key || ''\n    var self = this\n\n    var loadFolder = function(folder_key) {\n      common.get(url + \"/datasets/folders/\" + opts.slug + \"/\" + folder_key, function(d) {\n        self.folders = d.folders\n        self.path = d.path\n        self.folder = _.last(self.path)\n        self.parent.setFolder(self.folder)\n        self.update()\n      })\n    }\n\n    this.addFolder = function(e) {\n      var name = prompt(\"Folder's name\")\n      common.post(url + \"/datasets/folders/\" + opts.slug, JSON.stringify({ name: name, parent_id: self.folder._key }), function(d) {\n        loadFolder(self.folder._key)\n      })\n    }.bind(this)\n\n    this.renameFolder = function(e) {\n      var name = prompt(\"Update Folder's name\")\n      common.patch(url + \"/datasets/folders/\" + opts.slug, JSON.stringify({ name: name, id: self.folder._key }), function(d) {\n        self.path = d.path\n        self.update()\n      })\n    }.bind(this)\n\n    this.deleteFolder = function(e) {\n      UIkit.modal.confirm('Are you sure? This action will destroy the folder and it\\'s content').then(function() {\n        var parent = _.last(_.initial(self.path))\n        common.delete(url + \"/datasets/folders/\" + opts.slug + \"/\" + self.folder._key, function(d) {\n          common.get(url + \"/datasets/folders/\" + opts.slug + \"/\" + parent._key, function(d) {\n            route(\"/datasets/\" + opts.slug + \"/\" + parent._key)\n          })\n        })\n      }, function () {\n        console.log('Rejected.')\n      })\n    }.bind(this)\n\n    loadFolder(this.folder_key)\n});\n\nriot.tag2('dataset_crud_index', '<a href=\"#\" class=\"uk-button uk-button-small uk-button-default\" onclick=\"{new_item}\"> <i class=\"fas fa-plus\"></i> New {opts.singular} </a> <table class=\"uk-table uk-table-striped\" if=\"{data.length > 0}\"> <thead> <tr> <th width=\"20\" if=\"{sortable}\"></th> <th each=\"{col in cols}\"> {col.name == undefined ? col : col.label === undefined ? col.name : col.label} </th> <th width=\"70\"></th> </tr> </thead> <tbody id=\"sublist\"> <tr each=\"{row in data}\"> <td if=\"{sortable}\"><i class=\"fas fa-grip-vertical handle\"></i></td> <td each=\"{col in cols}\" class=\"{col.class}\"> <virtual if=\"{col.type == ⁗image⁗}\"> <img riot-src=\"{calc_value(row, col, locale)} \" style=\"height:50px\"> </virtual> <virtual if=\"{col.type != ⁗image⁗}\"> <virtual if=\"{col.tr == true}\">{_.get(row,col.name)[locale]}</virtual> <virtual if=\"{col.tr != true}\">{_.get(row,col.name)}</virtual> </virtual> </td> <td class=\"uk-text-center\" width=\"110\"> <a onclick=\"{edit}\" class=\"uk-button uk-button-primary uk-button-small\"><i class=\"fas fa-edit\"></i></a> <a onclick=\"{destroy_object}\" class=\"uk-button uk-button-danger uk-button-small\"><i class=\"fas fa-trash-alt\"></i></a> </td> </tr> </tbody> </table> <ul class=\"uk-pagination\"> <li if=\"{page > 0}\"><a onclick=\"{previousPage}\"><span class=\"uk-margin-small-right\" uk-pagination-previous></span> Previous</a></li> <li if=\"{(page + 1) * perpage < count}\" class=\"uk-margin-auto-left\"><a onclick=\"{nextPage}\">Next <span class=\"uk-margin-small-left\" uk-pagination-next></span></a></li> </ul>', '', '', function(opts) {\n    this.sortable = false\n    this.data     = []\n\n    var self = this\n\n    this.new_item = function(e) {\n      e.preventDefault()\n      riot.mount(\"#\"+opts.id, \"dataset_crud_new\", opts)\n    }.bind(this)\n\n    this.loadPage = function(pageIndex) {\n      common.get(url + \"datasets/\"+opts.parent_name+\"/\"+ opts.parent_id + \"/\"+opts.model+\"/page/\"+pageIndex+\"/\"+per_page, function(d) {\n        self.data = d.data[0].data\n        var model = d.model\n        self.cols = _.map(common.array_diff(common.keys(self.data[0]), [\"_id\", \"_key\", \"_rev\"]), function(v) { return { name: v }})\n        if(model.columns) self.cols = model.columns\n        self.sortable = !!model.sortable\n        self.count = d.data[0].count\n        self.update()\n      })\n    }\n    this.loadPage(1)\n\n    this.edit = function(e) {\n      e.preventDefault()\n      opts.element_id = e.item.row._key\n      riot.mount(\"#\"+opts.id, \"dataset_crud_edit\", opts)\n    }.bind(this)\n\n    this.nextPage = function(e) {\n      e.preventDefault()\n      self.page += 1\n      self.loadPage(self.page + 1)\n    }.bind(this)\n\n    this.previousPage = function(e) {\n      e.preventDefault()\n      self.page -= 1\n      self.loadPage(self.page + 1)\n    }.bind(this)\n\n    this.destroy_object = function(e) {\n      e.preventDefault()\n      UIkit.modal.confirm(\"Are you sure?\").then(function() {\n        common.delete(url + \"/datasets/\" + opts.parent_name + \"/\" + opts.model +\"/\" + e.item.row._key, function() {\n          self.loadPage(1)\n        })\n      }, function() {})\n    }.bind(this)\n\n    this.calc_value = function(row, col, locale) {\n      value = _.get(row, col.name)\n      if(col.tr) { value = value[locale] }\n      if(col.truncate) { value = value.substring(0,col.truncate) }\n      if(col.capitalize) { value = _.capitalize(value) }\n      if(col.uppercase) { value = _.toUpper(value) }\n      if(col.downcase) { value = _.toLower(value) }\n      return value\n    }.bind(this)\n\n    this.on('updated', function() {\n      if(self.sortable) {\n        var el = document.getElementById('sublist')\n        if(el)\n          var sortable = new Sortable(el, {\n            animation: 150,\n            ghostClass: 'blue-background-class',\n            handle: '.fa-grip-vertical',\n            onSort: function ( evt) {\n              common.put(\n                url + 'datasets/'+ opts.parent_name + '/' + opts.id +'/orders/' + evt.oldIndex + \"/\" + evt.newIndex, {},\n                function() {}\n              )\n            },\n          })\n      }\n    })\n});\n\nriot.tag2('dataset_crud_edit', '<a href=\"#\" class=\"uk-button uk-button-link\" onclick=\"{goback}\">Back to {opts.id}</a> <form onsubmit=\"{save_form}\" class=\"uk-form\" id=\"{opts.id}_crud_{opts.singular}\"> </form>', '', '', function(opts) {\n    this.goback = function(e) {\n      e.preventDefault()\n      riot.mount(\"#\"+opts.id, \"dataset_crud_index\", opts)\n    }.bind(this)\n\n    this.save_form = function(e) {\n      e.preventDefault()\n      common.saveForm(opts.id+'_crud_'+opts.singular, \"datasets/sub/\"+opts.parent_name+\"/\"+ opts.id+\"/\"+opts.element_id, \"\")\n    }.bind(this)\n\n    var self = this\n    common.get(url + \"/datasets/\" + opts.parent_name + \"/sub/\" + opts.id + \"/\" + opts.element_id, function(d) {\n      self.subdata = d.data\n\n      common.buildForm(self.subdata, opts.fields, '#'+opts.id+'_crud_' + opts.singular)\n    })\n    this.on('updated', function() {\n      $(\".select_list\").select2()\n      $(\".select_mlist\").select2()\n      $(\".select_tag\").select2({ tags: true })\n    })\n});\n\nriot.tag2('dataset_crud_new', '<a href=\"#\" class=\"uk-button uk-button-link\" onclick=\"{goback}\">Back to {opts.id}</a> <form onsubmit=\"{save_form}\" class=\"uk-form\" id=\"{opts.id}_crud_dataset\"> </form>', '', '', function(opts) {\n    var self = this\n    this.crud = {}\n    this.crud[opts.key] = opts.parent_id\n\n    this.goback = function(e) {\n      e.preventDefault()\n      riot.mount(\"#\"+opts.id, \"dataset_crud_index\", opts)\n    }.bind(this)\n\n    this.on('mount', function() {\n      common.buildForm(self.crud, opts.fields, '#'+opts.id+'_crud_dataset')\n    })\n\n    this.save_form = function(e) {\n      e.preventDefault()\n      common.saveForm(opts.id+'_crud_dataset', \"datasets/\"+ opts.parent_name +\"/\" + opts.parent_id + \"/\"+ opts.id, \"\", opts)\n    }.bind(this)\n});\n\nriot.tag2('all_datatypes', '<div class=\"rightnav uk-card uk-card-default uk-card-body\"> <ul class=\"uk-nav-default uk-nav-parent-icon\" uk-nav> <li class=\"uk-nav-header\">Datasets</li> <li each=\"{datatypes}\"><a href=\"#datasets/{slug}\">{name}</a></li> </ul> </div>', '', '', function(opts) {\n    var self = this\n    this.datatypes = []\n    common.get(url + \"/datasets/datatypes\", function(data) {\n      self.datatypes = data\n      self.update()\n    })\n});\n\nriot.tag2('dataset_edit', '<virtual if=\"{can_access}\"> <ul uk-tab> <li><a href=\"#\">datasets</a></li> <li each=\"{i, k in sub_models}\"><a href=\"#\">{k}</a></li> </ul> <ul class=\"uk-switcher uk-margin\"> <li> <h3>Editing {object.singular}</h3> <virtual if=\"{folders.length > 0}\"> <label class=\"uk-label\">Path</label> <form onsubmit=\"{changePath}\"> <div class=\"uk-grid uk-grid-small\"> <div class=\"uk-width-3-4\"> <select class=\"uk-select\" ref=\"folder\"> <option riot-value=\"{folders[0].root._key}\" selected=\"{folders[0].root._key == dataset.folder_key}\">Root</option> <option each=\"{f in folders}\" riot-value=\"{f.folder._key}\" selected=\"{f.folder._key == dataset.folder_key}\">{pathName(f.path)}</option> </select> </div> <div class=\"uk-width-1-4\"> <a onclick=\"{changePath}\" class=\"uk-button uk-button-primary\">Change</a> </div> </div> </form> </virtual> <form onsubmit=\"{save_form}\" class=\"uk-form\" id=\"form_dataset\"> </form> <a if=\"{publishable}\" class=\"uk-button uk-button-primary\" onclick=\"{publish}\">Publish</a> <a class=\"uk-button uk-button-secondary\" onclick=\"{duplicate}\">Duplicate</a> </li> <li each=\"{i, k in sub_models}\"> <div id=\"{k}\" class=\"crud\"></div> </li> </ul> </virtual> <virtual if=\"{!can_access && loaded}\"> Sorry, you can\\'t access this page... </virtual>', '', '', function(opts) {\n    var self = this\n    self.can_access = false\n    self.loaded = false\n    self.sub_models = []\n    self.publishable = false\n    self.folders = []\n\n    this.changePath = function(e) {\n      e.preventDefault()\n      common.put(url + \"/datasets/\"+ opts.datatype +\"/\" + opts.dataset_id + \"/change_folder\", JSON.stringify({ folder_key: self.refs.folder.value}), function(d) {\n        UIkit.notification({\n          message : 'Successfully updated!',\n          status  : 'success',\n          timeout : 1000,\n          pos     : 'bottom-right'\n        })\n      })\n    }.bind(this)\n\n    this.save_form = function(e) {\n      e.preventDefault()\n      common.saveForm(\"form_dataset\", \"datasets/\" + opts.datatype, opts.dataset_id)\n    }.bind(this)\n\n    this.duplicate = function(e) {\n      UIkit.modal.confirm(\"Are you sure?\").then(function() {\n        common.get(url + \"/datasets/\"+ opts.datatype +\"/\" + self.dataset._key + \"/duplicate\", function(data) {\n          route('/datasets/'+ opts.datatype + '/' + data._key + '/edit')\n          UIkit.notification({\n            message : 'Successfully duplicated!',\n            status  : 'success',\n            timeout : 1000,\n            pos     : 'bottom-right'\n          })\n        })\n      }, function() {})\n    }.bind(this)\n\n    this.pathName = function(path) {\n      return _.map(path, function(p) { return p.name }).join(\" > \")\n    }.bind(this)\n\n    this.publish = function(e) {\n      UIkit.modal.confirm(\"Are you sure?\").then(function() {\n        common.post(url + \"/datasets/\" + self.dataset._key + \"/publish\", JSON.stringify({}), function(data) {\n          UIkit.notification({\n            message : 'Successfully published!',\n            status  : 'success',\n            timeout : 1000,\n            pos     : 'bottom-right'\n          })\n        })\n      })\n    }.bind(this)\n\n    common.get(url + \"/datasets/\" + opts.datatype + \"/\" + opts.dataset_id, function(d) {\n      self.publishable = d.model.publishable\n      self.object = d.model\n      self.dataset = d.data\n      self.folders = d.folders\n      self.fields = d.fields\n      self.sub_models = d.model.sub_models\n      var act_as_tree = d.model.act_as_tree\n\n      if(!_.isArray(self.fields)) fields = fields.model\n      common.get(url + \"/auth/whoami\", function(me) {\n        localStorage.setItem('resize_api_key', me.resize_api_key)\n        self.can_access = d.fields.roles === undefined || _.includes(d.fields.roles.write, me.role)\n        self.loaded = true\n        self.update()\n        var back_url = \"\"\n        if(self.can_access) back_url = 'datasets/' + opts.datatype\n        if(act_as_tree && self.dataset.folder_key) { back_url += '/' + self.dataset.folder_key }\n        common.buildForm(self.dataset, self.fields, '#form_dataset', back_url, function() {\n          $(\".crud\").each(function(i, c) {\n            var id = $(c).attr(\"id\")\n            riot.mount(\"#\" + id, \"dataset_crud_index\", { model: id,\n              fields: self.sub_models[id].fields,\n              key: self.sub_models[id].key,\n              singular: self.sub_models[id].singular,\n              columns: self.sub_models[id].columns,\n              parent_id: opts.dataset_id,\n              parent_name: opts.datatype })\n          })\n        })\n      })\n    })\n\n    this.on('updated', function() {\n      $(\".select_list\").select2()\n      $(\".select_mlist\").select2()\n      $(\".select_tag\").select2({ tags: true })\n    })\n});\n\nriot.tag2('dataset_new', '<virtual if=\"{can_access}\"> <h3>Creating {object.singular}</h3> <form onsubmit=\"{save_form}\" class=\"uk-form\" id=\"form_new_dataset\"> </form> </virtual> <virtual if=\"{!can_access && loaded}\"> Sorry, you can\\'t access this page... </virtual>', '', '', function(opts) {\n    var self = this\n    self.can_access = false\n    self.loaded = false\n\n    this.save_form = function(e) {\n      e.preventDefault()\n      common.saveForm(\"form_new_dataset\", \"datasets/\" + opts.datatype)\n    }.bind(this)\n\n    common.get(url + \"/datasets/\"+ opts.datatype + \"/fields\", function(d) {\n      self.object = d.object\n      common.get(url + \"/auth/whoami\", function(me) {\n        localStorage.setItem('resize_api_key', me.resize_api_key)\n        self.can_access = d.fields.roles === undefined || _.includes(d.fields.roles.write, me.role)\n        self.loaded = true\n        self.update()\n        if(self.can_access) {\n          var fields = d.fields\n          var obj = {}\n          var back_url = 'datasets/' + opts.datatype\n          if(self.opts.folder_key) {\n            fields.push({ r: true, c: \"1-1\", n: \"folder_key\", t: \"hidden\" })\n            obj['folder_key'] = opts.folder_key\n            back_url += '/' + opts.folder_key\n          }\n\n          common.buildForm(obj, fields, '#form_new_dataset', back_url)\n        }\n      })\n    })\n\n    this.on('updated', function() {\n      $(\".select_list\").select2()\n      $(\".select_mlist\").select2()\n      $(\".select_tag\").select2({ tags: true })\n    })\n});\n\nriot.tag2('dataset_tags', '<span each=\"{row in data}\"> {row.tag} <span class=\"uk-badge uk-margin-right\">{row.size}</span> </span>', '', '', function(opts) {\n    var self = this\n    common.get(url + \"/datasets/\" + opts.datatype + \"/stats/\" + this.opts.tag, function(d) {\n      self.data = d\n      self.update()\n    })\n});\n\nriot.tag2('datasets', '<dataset_folders show=\"{loaded}\" if=\"{act_as_tree}\" folder_key=\"{folder_key}\" slug=\"{opts.datatype}\"></dataset_folders> <virtual if=\"{can_access}\"> <div class=\"uk-float-right\"> <a if=\"{act_as_tree}\" href=\"#datasets/{opts.datatype}/new/{folder_key}\" class=\"uk-button uk-button-small uk-button-default\"><i class=\"fas fa-plus\"></i> New {model.singular}</a> <a if=\"{!act_as_tree}\" href=\"#datasets/{opts.datatype}/new\" class=\"uk-button uk-button-small uk-button-default\"><i class=\"fas fa-plus\"></i> New {model.singular}</a> <a if=\"{export}\" onclick=\"{export_data}\" class=\"uk-button uk-button-small uk-button-primary\"><i class=\"fas fa-file-export\"></i> Export CSV</a> </div> <h3>Listing {opts.datatype}</h3> <form onsubmit=\"{filter}\" class=\"uk-margin-top\"> <div class=\"uk-inline uk-width-1-1\"> <span class=\"uk-form-icon\" uk-icon=\"icon: search\"></span> <input type=\"text\" ref=\"term\" id=\"term\" class=\"uk-input\" autocomplete=\"off\"> </div> </form> <dataset_tags if=\"{show_stats}\" datatype=\"{opts.datatype}\" tag=\"{show_stats_tag}\"></dataset_tags> <table class=\"uk-table uk-table-striped\"> <thead> <tr> <th if=\"{sortable}\" width=\"20\"></th> <th each=\"{col in cols}\" class=\"{col.class}\">{col.name == undefined ? col : col.label === undefined ? col.name : col.label}</th> <th width=\"70\"></th> </tr> </thead> <tbody id=\"list\"> <tr each=\"{row in data}\" id=\"row_{row._key}\" no-reorder key=\"{row._key}\"> <td if=\"{sortable}\"><i class=\"fas fa-grip-vertical handle\"></i></td> <td each=\"{col in cols}\" class=\"{col.class}\"> <virtual if=\"{col.trads == true}\"> <div each=\"{lang in langs}\"><a onclick=\"{traduct}\" data-lang=\"{lang}\" data-id=\"{row._key}\" data-value=\"{calc_value(row, col, lang)}\" class=\"uk-button uk-button-small\">{lang} :</a> <span id=\"trad_{lang}_{row._key}\">{calc_value(row, col, lang)}</span></div> </virtual> <virtual if=\"{col.trads != true}\"> <virtual if=\"{col.toggle == true}\"> <virtual if=\"{col.tr == true}\"><a riot-style=\"color: {col.colors ? col.colors[row[col.name][locale]] : \\'white\\'}\" onclick=\"{toggleField}\" data-key=\"{row._key}\">{col.values ? col.values[row[col.name][locale]] : _.get(row,col.name)[locale]}</a></virtual> <virtual if=\"{col.tr != true}\"><a riot-style=\"color: {col.colors ? col.colors[row[col.name]] : \\'white\\'}\" onclick=\"{toggleField}\" data-key=\"{row._key}\">{col.values ? col.values[row[col.name]] : _.get(row,col.name)}</a></virtual> </virtual> <virtual if=\"{col.toggle != true}\"> <virtual if=\"{col.type == ⁗image⁗}\"> <img riot-src=\"{calc_value(row, col, locale)} \" style=\"height:25px\"> </virtual> <virtual if=\"{col.type != ⁗image⁗}\"> {calc_value(row, col, locale)} </virtual> </virtual> </virtual> </td> <td class=\"uk-text-center\" width=\"160\"> <a onclick=\"{edit}\" class=\"uk-button uk-button-primary uk-button-small\"><i class=\"fas fa-edit\"></i></a> <a if=\"{is_api}\" onclick=\"{install}\" class=\"uk-button uk-button-success uk-button-small\"><i class=\"fas fa-upload\"></i></a> <a if=\"{is_script}\" onclick=\"{install_script}\" class=\"uk-button uk-button-success uk-button-small\"><i class=\"fas fa-upload\"></i></a> <a onclick=\"{destroy_object}\" class=\"uk-button uk-button-danger uk-button-small\"><i class=\"fas fa-trash-alt\"></i></a> </td> </tr> </tbody> </table> <div id=\"moreitems\" style=\"height: 50px;\">{loaded ? ⁗⁗ : ⁗Loading ...⁗}</div> </virtual> <virtual if=\"{!can_access && loaded}\"> Sorry, you can\\'t access this page... </virtual>', '', '', function(opts) {\n    var self        = this\n\n    this.show_stats = false\n    this.page       = 1\n    this.perpage    = per_page\n    this.locale     = window.localStorage.getItem('foxx-locale')\n    this.data       = []\n    this.export     = false\n    this.can_access = false\n    this.sortable   = false\n    this.loaded     = false\n    this.folder_key = this.opts.folder_key || ''\n    this.folder     = {}\n    this.reach_end  = false\n    this.act_as_tree = true\n\n    this.settings   = {}\n\n    common.get(url + \"/settings\", function(settings) { self.settings = settings.data })\n\n    this.loadPage = function(pageIndex) {\n      self.loaded = false\n      self.update()\n      var querystring = \"?folder=\" + self.folder._key + \"&is_root=\" + self.folder.is_root\n\n      common.get(url + \"/datasets/\" + opts.datatype + \"/page/\" + pageIndex + \"/\" + this.perpage + querystring, function(d) {\n        self.reach_end = d.data[0].data.length == 0\n        _.each(d.data[0].data, function(d) { self.data.push(d) })\n\n        var model = d.model\n        self.model = d.model\n\n        self.act_as_tree = model.act_as_tree\n        self.is_api = !!model.is_api\n        self.is_script = !!model.is_script\n        if(model.stats_for_tag) {\n          self.show_stats = true\n          self.show_stats_tag = model.stats_for_tag\n          self.update()\n        }\n        self.export = !!model.export\n        self.cols = _.map(common.array_diff(common.keys(self.data[0]), [\"_id\", \"_key\", \"_rev\"]), function(v) { return { name: v }})\n        if(model.columns) self.cols = model.columns\n        self.count = d.data[0].count\n        self.sortable = !!model.sortable\n        self.loaded = true\n        self.langs = d.langs\n\n        if(self.can_access == false) {\n          common.get(url + \"/auth/whoami\", function(me) {\n            localStorage.setItem('resize_api_key', me.resize_api_key)\n            console.log(model)\n            self.can_access = model.roles === undefined || _.includes(model.roles.read, me.role)\n            self.update()\n          })\n        } else {\n          self.update()\n        }\n      })\n    }\n\n    this.setFolder = function(folder) {\n      self.folder = folder || {}\n      self.folder_key = self.folder._key\n      self.loadPage(1)\n    }\n\n    this.calc_value = function(row, col, locale) {\n      value = _.get(row, col.name)\n      if(col.tr) { value = value[locale] }\n      if(col.truncate) { value = value.substring(0,col.truncate) }\n      if(col.capitalize) { value = _.capitalize(value) }\n      if(col.uppercase) { value = _.toUpper(value) }\n      if(col.downcase) { value = _.toLower(value) }\n      return value\n    }.bind(this)\n\n    this.traduct = function(e) {\n      e.preventDefault()\n      var lang = e.item.lang\n      var id = $(e.srcElement).data(\"id\")\n      var traduction = prompt(lang, $(e.srcElement).data(\"value\"))\n      if(traduction) {\n        common.patch(url + \"/datasets/\" + opts.datatype + \"/\" + id + \"/value/\" + lang + \"/field\", JSON.stringify({ value: traduction }), function(d) {\n          $(\"#trad_\" + lang + \"_\" + id).text(traduction)\n          $(e.srcElement).data(\"value\", traduction)\n        })\n      }\n\n      return false\n    }.bind(this)\n\n    this.filter = function(e) {\n      e.preventDefault()\n      if(self.refs.term.value != \"\") {\n        $(\".uk-form-icon i\").attr(\"class\", \"uk-icon-spin uk-icon-spinner\")\n        common.get(url + \"/datasets/\"+ opts.datatype +\"/search/\"+self.refs.term.value, function(d) {\n          self.data = d.data\n          $(\".uk-form-icon i\").attr(\"class\", \"uk-icon-search\")\n          self.update()\n        })\n      }\n      else {\n        self.loadPage(1)\n      }\n    }.bind(this)\n\n    this.edit = function(e) {\n      route(\"/datasets/\" + this.opts.datatype + \"/\" + e.item.row._key + \"/edit\")\n    }.bind(this)\n\n    this.new_dataset = function(e) {\n      route(\"/datasets/\" + this.opts.datatype + \"/new\")\n    }.bind(this)\n\n    this.destroy_object = function(e) {\n      UIkit.modal.confirm(\"Are you sure?\").then(function() {\n        common.delete(url + \"/datasets/\" + opts.datatype + \"/\" + e.item.row._key, function() {\n          $(\"#row_\" + e.item.row._key).remove()\n        })\n      }, function() {})\n    }.bind(this)\n\n    this.toggleField = function(e) {\n      e.preventDefault()\n      common.patch(url + \"/datasets/\" + opts.datatype + \"/\" + e.target.dataset.key + \"/\" + e.item.col.name + \"/toggle\", \"{}\", function(data) {\n        if(data.success) {\n          e.target.innerText = data.data\n        }\n      })\n    }.bind(this)\n\n    this.export_data = function(e) {\n      common.get(url + '/datasets/' + opts.datatype + '/export', function(d) {\n        var csvContent = d.data\n        var encodedUri = encodeURI(csvContent)\n        var link = document.createElement(\"a\")\n        link.setAttribute(\"href\", encodedUri)\n        link.setAttribute(\"download\", \"datasets.csv\")\n        link.innerHTML= \"Click Here to download\"\n        document.body.appendChild(link)\n        link.click()\n        document.body.removeChild(link)\n      })\n    }.bind(this)\n\n    this.install = function(e) {\n      e.preventDefault()\n      var url = \"/service/\" + e.item.row.name\n      $.post(url, { token: self.settings.token }, function(data) {\n        if(data == \"service installed\")\n          UIkit.notification({\n            message : 'Endpoint Deployed Successfully!',\n            status  : 'success',\n            timeout : 1000,\n            pos     : 'bottom-right'\n          })\n      })\n      return false\n    }.bind(this)\n\n    this.install_script = function(e) {\n      e.preventDefault()\n      var url = \"/script/\" + e.item.row.name\n\n      $.post(url, { token: self.settings.token }, function(data) {\n        if(data == \"script installed\")\n          UIkit.notification({\n            message : 'Script Launched Successfully!',\n            status  : 'success',\n            timeout : 1000,\n            pos     : 'bottom-right'\n          })\n      })\n      return false\n    }.bind(this)\n\n    this.isElementInViewport = function(el) {\n      if(el) {\n        var rect = el.getBoundingClientRect()\n\n        return rect.bottom > 0 &&\n          rect.right > 0 &&\n          rect.left < (window.innerWidth || document.documentElement.clientWidth) &&\n          rect.top < (window.innerHeight || document.documentElement.clientHeight) + 300\n      } else {\n        return false\n      }\n    }\n\n    this.on('mount', function() {\n      $(window).on('DOMContentLoaded load resize scroll', function(i) {\n        if(!self.reach_end && self.loaded && self.isElementInViewport(document.getElementById(\"moreitems\"))) {\n          self.page += 1\n          self.loadPage(self.page)\n        }\n      })\n    })\n\n    this.on('updated', function() {\n      if(self.sortable) {\n        var el = document.getElementById('list')\n        if(el) {\n          var sortable = new Sortable(el, {\n            animation: 150,\n            ghostClass: 'blue-background-class',\n            handle: '.fa-grip-vertical',\n            onSort: function ( evt) {\n              var folder_key = \"?folder_key=\" + self.folder._key\n              if(!self.act_as_tree) folder_key = ''\n              common.put(\n                url + 'datasets/'+ opts.datatype +'/orders/' + evt.oldIndex + \"/\" + evt.newIndex + folder_key, {},\n                function() {}\n              )\n            }\n          })\n        }\n      }\n    })\n});","riot.tag2('loading', '<div class=\"uk-text-center\"> Loading app ... <br><div uk-spinner></div> </div>', '', '', function(opts) {\n    common.get(url + \"auth/whoami\", function(d) {\n      if(d.username === null) document.location.href=\"login.html\";\n      else {\n\n        localStorage.setItem('resize_api_key', d.resize_api_key)\n        route('/welcome')\n      }\n    })\n});\n\nriot.tag2('welcome', '<h1 class=\"uk-text-center\">Welcome aboard</h1> <p class=\"uk-text-center\" style=\"color: white\">This is a landing page ... Nothing special here, replace it by what you want !</p> <p class=\"uk-text-center\" style=\"color: white\">Find me in <code>app/widgets/loading.html.tag</code></p> <h2 class=\"uk-text-center\" style=\"margin-top:80px\"><a href=\"https://fasty.ovh\" target=\"_blank\">Fasty</a> is powered by powerful opensource projects</h2> <div class=\"uk-container uk-text-center\" style=\"color: white;margin-top:80px\"> <div class=\"uk-column-1-2\"> <div class=\"uk-margin\"> <a href=\"https://www.arangodb.com/\" target=\"_blank\"><img src=\"/static/admin/img/ArangoDB-logo-bg.svg\" style=\"height:90px\"></a> <br>ArangoDB </div> <div class=\"uk-margin\"> <a href=\"https://openresty.org/en/\" target=\"_blank\"><img src=\"/static/admin/img/logo.png\" style=\"height:90px\"></a> <br>openresty </div> </div> <div class=\"uk-column-1-2\"> <div class=\"uk-margin\"> <a href=\"https://riot.js.org/\" target=\"_blank\"><img src=\"/static/admin/img/square.svg\" style=\"height:90px\"></a> <br>RiotJS </div> <div class=\"uk-margin\"> <a href=\"https://leafo.net/lapis/\" target=\"_blank\"><img src=\"/static/admin/img/lapis.jpg\" style=\"height:90px\"></a> <br>LAPIS </div> </div> </div> </div>', '', '', function(opts) {\n});\n\nriot.tag2('rightnav', '<ul class=\"uk-navbar-nav\"> <li><a onclick=\"{deploy}\" if=\"{settings.deploy_secret != ⁗⁗}\">Deploy</a></li> <li each=\"{lang in langs}\" class=\"{lang == window.localStorage.getItem(\\'foxx-locale\\') ? \\'uk-active\\' : \\'\\'}\"><a onclick=\"{changeLang}\">{lang}</a></li> <li><a href=\"#logout\"><i class=\"uk-icon-sign-out\"></i> Logout</a></li> </ul>', '', '', function(opts) {\n    this.settings   = {}\n    var self = this\n\n    common.get(url + \"/settings\", function(settings) {\n      self.settings = settings.data\n      self.langs = self.settings.langs.split(\",\")\n      if(!_.includes(self.langs, window.localStorage.getItem('foxx-locale'))) {\n        window.localStorage.setItem('foxx-locale', self.langs[0])\n      }\n      self.update()\n    })\n\n    this.changeLang = function(e) {\n      window.localStorage.setItem('foxx-locale', e.item.lang)\n      document.location.reload()\n    }.bind(this)\n\n    this.deploy = function(e) {\n      e.preventDefault()\n      if(confirm(\"Are you sure?\")) {\n        var url = \"/deploy\"\n        $.post(url, { token: self.settings.token }, function(data) {\n          if(data == \"site deployed\")\n            UIkit.notification({\n              message : 'Site Deployed Successfully!',\n              status  : 'success',\n              timeout : 1000,\n              pos     : 'bottom-right'\n            });\n        })\n      }\n      return false\n    }.bind(this)\n});","riot.tag2('loading', '<div class=\"uk-text-center\"> Loading app ... <br><div uk-spinner></div> </div>', '', '', function(opts) {\n    route('/login');\n});\n\nriot.tag2('login', '<div class=\"uk-container uk-container-center\"> <div uk-grid class=\"uk-grid-small uk-child-width-1-3@s uk-flex-center uk-text-center\"> <div> <h1 class=\"uk-margin-large-top\"><i class=\"uk-icon-sign-in\"></i> Connection</h1> <form class=\"uk-form uk-margin-top\" onsubmit=\"{save_form}\"> <div class=\"uk-margin\"> <input placeholder=\"Email\" class=\"uk-input\" id=\"username\" name=\"username\" value=\"\" type=\"email\"> </div> <div class=\"uk-margin\"> <input type=\"password\" class=\"uk-input\" placeholder=\"Mot de passe\" class=\"uk-input\" id=\"password\" name=\"password\" value=\"\"> </div> <hr> <div class=\"uk-margin\"> <button type=\"submit\" class=\"uk-button uk-button-primary\">Connection</button> </div> <div class=\"uk-margin-small\"> <div id=\"login_error\" class=\"uk-alert uk-alert-danger uk-hidden uk-text-center\"> Bad login or password </div> </div> </form> </div> </div> </div>', '', '', function(opts) {\n    this.save_form = function(e) {\n      e.preventDefault()\n      common.post(url + \"auth/login\", JSON.stringify({ \"username\": $(\"#username\").val(), \"password\": $(\"#password\").val() }) , function(data) {\n        if(data.success) document.location.href=\"index.html\";\n        else {\n          $(\"#login_error\").removeClass(\"uk-hidden\")\n        }\n      })\n    }.bind(this)\n});\n","riot.tag2('settings', '<h3 if=\"{can_access}\">settings</h3> <form onsubmit=\"{save_form}\" id=\"form_settings\"> </form> <virtual if=\"{!can_access && loaded}\"> Sorry, you can\\'t access this page... </virtual>', '', '', function(opts) {\n    var self = this;\n    this.can_access = false\n    this.loaded     = false\n\n    this.save_form = function(e) {\n      e.preventDefault()\n      common.saveForm(\"form_settings\", \"settings\", _this.obj._key)\n    }.bind(this)\n\n    var _this = this;\n\n    common.get(url + \"settings/\", function(d) {\n      _this.obj = d.data\n      common.get(url + \"/auth/whoami\", function(me) {\n        self.update()\n        self.loaded = true\n        self.can_access = d.roles === undefined || _.includes(d.roles.write, me.role)\n        if(self.can_access) common.buildForm(_this.obj, d.fields, '#form_settings')\n        self.update()\n      })\n    })\n\n    this.on('updated', function() {\n      $(\".select_list\").select2()\n      $(\".select_tag\").select2({ tags: true })\n    })\n});\n\n","riot.tag2('images', '<div class=\"sortable_{opts.field}\" style=\"user-select: none;\" uk-sortable=\"group: upload\"> <virtual each=\"{row in data}\"> <div uk-grid class=\"uk-grid-small\" data-id=\"{row._key}\"> <div class=\"uk-width-1-5\"><a href=\"{row.url}?_from={from}\" target=\"_blank\"><img riot-src=\"{row.url}\" alt=\"\" style=\"max-width: 100%\"></a></div> <div class=\"uk-width-3-5\">{row.filename.split(\\'/\\')[row.filename.split(\\'/\\').length - 1]}<br>{prettyBytes(row.length)}</div> <div class=\"uk-width-1-5 uk-text-center\"><a onclick=\"{delete_asset}\" uk-icon=\"icon: trash\"></a></div> </div> </virtual> </div>', 'images div, images span { color: white; }', '', function(opts) {\n    var _this = this\n    this.from = btoa(subdomain)\n    this.data = []\n\n    var use_i18n = \"\"\n    if(opts.i18n != \"undefined\") use_i18n = \"/\" + window.localStorage.getItem(\"foxx-locale\")\n\n    this.load = function() {\n      common.get(url + \"uploads/\" + opts.id + '/' + opts.field + use_i18n, function(d) {\n        _this.data = d\n        _this.update()\n      })\n    }.bind(this)\n\n    this.load()\n\n    $(function() {\n\n      UIkit.util.on(\".sortable_\" + opts.field, 'moved', function(data) {\n        var i = 0\n        var ids = _.map($(\".sortable_\" + opts.field+\" > div\"), function(el) {\n          return { k: \"\" + $(el).data(\"id\"), c: i++ }\n        })\n        common.post(url+\"uploads/reorder\", JSON.stringify({ ids: ids, field: opts.field }), function(d) {\n          if(d.success) {\n            UIkit.notification({\n              message : 'Successfully reordered!',\n              status  : 'success',\n              timeout : 1000,\n              pos     : 'bottom-right'\n            });\n          }\n        })\n      })\n      UIkit.util.on(\".sortable_\" + opts.field, 'added', function(data) {\n        var i = 0\n        var ids = _.map($(\".sortable_\" + opts.field+\" > div\"), function(el) {\n          return { k: \"\" + $(el).data(\"id\"), c: i++ }\n        })\n        common.post(url+\"uploads/reorder\", JSON.stringify({ ids: ids, field: opts.field }), function(d) {\n          if(d.success) {\n            eventHub.trigger(\"refresh_uploads\")\n            UIkit.notification({\n              message : 'Successfully reordered!',\n              status  : 'success',\n              timeout : 1000,\n              pos     : 'bottom-right'\n            });\n          }\n        })\n      })\n    })\n\n    eventHub.on(\"refresh_uploads\", function() {\n      _this.load()\n    })\n\n    this.delete_asset = function(e) {\n      UIkit.modal.confirm(\"Are you sure?\").then(function() {\n        common.delete(url + \"uploads/\" + e.item.row._key, function() {\n          $('[data-id='+e.item.row._key+']').remove()\n        })\n      }, function() {})\n    }.bind(this)\n});\n\nriot.tag2('files', '<div class=\"sortable_{opts.field}\" style=\"user-select: none;\"> <virtual each=\"{row in data}\"> <div uk-grid class=\"uk-grid-small\" data-id=\"{row._key}\"> <div class=\"uk-width-3-5\">{row.filename} <a href=\"{row.url}?_from={from}\" target=\"_blank\"><i class=\"fas fa-external-link-alt\"></i></a></div> <div class=\"uk-width-1-5 uk-text-right\">{prettyBytes(row.length)}</div> <div class=\"uk-width-1-5 uk-text-center\"><a onclick=\"{delete_asset}\" uk-icon=\"icon: trash\"></a></div> </div> </div>', 'files div, files span { color: white; }', '', function(opts) {\n    var _this = this;\n    this.from = btoa(subdomain)\n    this.data = []\n\n    var use_i18n = \"\"\n    if(opts.i18n != \"undefined\") use_i18n = \"/\" + window.localStorage.getItem(\"foxx-locale\")\n\n    common.get(url + \"uploads/\" + opts.id + '/' + opts.field + use_i18n, function(d) {\n      _this.data = d\n      _this.update()\n    })\n\n    this.filename = function(row) {\n      return row.path.split('/').slice(2).join('/')\n    }.bind(this)\n\n    $(function() {\n      UIkit.sortable(\".sortable_\" + opts.field, {}) \n      UIkit.util.on(\".sortable_\" + opts.field, 'moved', function(data) {\n        var i = 0\n        var ids = _.map($(\".sortable_\" + opts.field+\" > div\"), function(el) {\n          return { k: \"\" + $(el).data(\"id\"), c: i++ }\n        })\n        common.post(url+\"uploads/reorder\", JSON.stringify({ ids: ids }), function(d) {\n          if(d.success) {\n            UIkit.notification({\n              message : 'Successfully reordered!',\n              status  : 'success',\n              timeout : 1000,\n              pos     : 'bottom-right'\n            });\n          }\n        })\n      })\n    })\n\n    this.delete_asset = function(e) {\n      UIkit.modal.confirm(\"Are you sure?\").then(function() {\n        common.delete(url + \"uploads/\" + e.item.row._key, function() {\n          $('[data-id='+e.item.row._key+']').remove()\n        })\n      }, function() {})\n    }.bind(this)\n});"]}